BEGIN Definition 2.1  
 A Borel measure is {\em $\tau $-smooth} if for every collection $\{U_\alpha : \alpha \in \Lambda \}$ of open sets, $\mu (\cup _\alpha U_\alpha ) = \sup \mu (\cup _{i=1}^nU_{\alpha _i})$, where the supremum is taken over all finite subcollections of $\{U_\alpha : \alpha \in \Lambda \}$. We say that $(X, d, \mu )$ is a {\em metric measure space} if $\mu $ is a Borel measure on the metric space $(X, d)$, such that for all balls $B(x,r)$, $\mu (B(x,r)) < \infty $, and furthermore, $\mu $ is $\tau $-smooth.
END Definition
 
BEGIN Definition 2.2  
 \label {maxfun} Let $(X, d, \mu )$ be a metric measure space and let $g$ be a locally integrable function on $X$. For each $x\in X$, the centered Hardy-Littlewood maximal operator $M_{\mu }$ is given by \begin {equation}\label {HLMFc} M_{\mu } g(x) := \sup _{\{r : 0 < \mu (B(x, r))\}} \frac {1}{\mu (B(x, r))} \int _{B(x, r)} |g| d\mu . \end {equation}
END Definition
 
BEGIN Definition 2.3  
 A Borel measure $\mu $ on $(X,d)$ is {\em doubling} if there exists a $C> 0 $ such that for all $r>0 $ and all $x\in X$, $\mu (B(x, 2 r)) \le C\mu (B(x,r)) < \infty $.
END Definition
 
BEGIN Definition 2.4  
 \label {geomdoub} A metric space is {\it $D$-geometrically doubling} if there exists a positive integer $D$ such that every ball of radius $r$ can be covered with no more than $D$ balls of radius $r/2$.
END Definition
 
BEGIN Definition 2.5  
 (\cite [p. 735] {NaTa} Let $0 < t < 1$ and let $K\ge 1$. Then $\mu $ is said to be $t$-microdoubling with constant $K$ if for all $x \in X$ and all $r >0$, we have $$ \mu B\left (x,\left (1 + t \right ) r \right ) \le K \mu B(x,r). $$
END Definition
 
BEGIN Definition 2.6  
 \label {loccomp} A measure $\mu $ satisfies a {\it local comparability condition} if there exists a constant $C\in [1, \infty )$ such that for all pairs of points $x,y\in X$, and all $r >0$, whenever $d(x,y) < r$, we have $$\mu (B(x,r))\le C \mu (B(y,r)).$$ We denote the smallest such $C$ by $C(\mu )$ or $C_\mu $.
END Definition
 
BEGIN Remark 2.7  
 \label {doublingandmicro} If $\mu $ is doubling with constant $K_1$ then it is microdoubling and satisfies a local comparability condition with the same constant $K_1$, while if it is $t$-microdoubling with constant $K_2$ and $2 \le (1 + t)^M$, then $\mu $ is doubling and satisfies a local comparability condition with constant $K_2^M$. Thus, the difference between doubling and microdoubling lies in the size of the constants, it is quantitative, not qualitative: The microdoubling condition adds something new only when $K_2 < K_1$, in which case it entails a greater regularity in the growth of the measure of balls, as the radii increase. Likewise, bounds of the form $\mu B(x, T r) \le K \mu B(x, r)$ for $T > 2$, allow a greater irregularity in the growth of balls than standard doubling ($T = 2$) or than microdoubling. \par We mention that while local comparability is implied by doubling, it is a uniformity condition, not a growth condition. Thus, it is compatible with the failure of doubling, and even for doubling measures, it is compatible with any rate of growth for the volume of balls. Consider, for instance, the case of $d$-dimensional Lebesgue measure $\lambda ^d$: A doubling constant is $2^d$, a $1/d$-microdoubling constant is $e$, and the smallest local comparability constant is $C(\lambda ^d) = 1$. \par 
END Remark
 
BEGIN Definition 2.8  
 (\cite [p. 737] {NaTa} Let $0 < t < 1$ and let $K\ge 1$. Then $\mu $ is said to be strong $t$-microdoubling with constant $K$ if for all $x \in X$, all $r > 0$, and all $y\in B(x,r)$, $$ \mu B\left (y,\left (1 + t \right )r\right ) \le K \mu B(x,r). $$
END Definition
 
BEGIN Definition 2.9  
 Given a set $S$ we define its $s$-{\em blossom} as the enlarged set \begin {equation} \label {altblossom} Bl(S, s):= \cup _{x\in S}B(x,s), \end {equation} and its {\em uncentered $s$-blossom} as the set \begin {equation} \label {altublossom} Blu(S, s):= \cup _{x\in S}\cup \{B(y, s): x\in B(y, s)\}. \end {equation} When $S= B(x,r)$, we simplify the notation and write $Bl(x,r, s)$, instead of $Bl(B(x,r), s)$, and likewise for uncentered blossoms. We say that $\mu $ {\em blossoms boundedly} if there exists a $K\ge 1$ such that for all $r>0 $ and all $x\in X$, $\mu (Blu(x, r, r)) \le K \mu (B(x,r)) < \infty $.
END Definition
 
BEGIN Definition 2.10  
 A metric space has the {\it approximate midpoint property} if for every $\varepsilon > 0$ and every pair of points $x,y$, there exists a point $z$ such that $d(x,z), d(z,y) < \varepsilon + d(x,y)/2$.
END Definition
 
BEGIN Definition 2.11  
 \label {quasi}A metric space $X$ is {\it quasiconvex} if there exists a constant $C\ge 1$ such that for every pair of points $x,y$, there exists a curve with $x$ and $y$ as endpoints, such that its length is bounded above by $C d(x,y)$. If for every $\varepsilon > 0$ we can take $C=1 + \varepsilon $, then we say that $X$ is a {\it length space}.
END Definition
 
BEGIN Example 2.12  
 \label {blossomsballs} The $s$-blossom of an $r$-ball may fail to contain a strictly larger ball, even in quasiconvex spaces. \par For instance, let $X \subset \mathbb {R}^2$ be the set $\{0\} \times [0,1] \cup [0,1]\times \{0\}$ with metric defined by restriction of the $\ell _\infty $ norm; then we can take $C = 2$. Now $B((1,0), 1) = (0,1]\times \{0\}$, while for every $r > 1$, $B((1,0), r) = X$, which is not contained in $Blu((1,0), 1, 1/6)$. Furthermore, neither $Blu((1,0), 1, 1/6)$ nor $Bl((1,0), 1, 1/6)$ are balls, i.e., given any $x\in X$ and any $r > 0$, we have that $B(x, r) \ne Blu((1,0), 1, 1/6)$ and $B(x, r) \ne Bl((1,0), 1, 1/6)$. \par \par On the other hand, if a metric space $X$ has the approximate midpoint property, then blossoms and balls coincide (as we show next) so in this case considering blossoms gives nothing new.
END Example
 
BEGIN Theorem 2.13  
 \label {equiv} Let $(X, d)$ be a metric space. The following are equivalent: \par a) $X$ has the approximate midpoint property. \par b) For all $x\in X$, and all $r, s >0$, $Bl(x, r, s) = B(x, r + s).$ \par c) For all $x\in X$, and all $r >0$, $Bl(x, r, r) = B(x, 2 r).$
END Theorem
 
BEGIN Proof 
 Suppose first that $X$ has the approximate midpoint property. Since $Bl(x, r, s) \subset B(x, r + s),$ to prove b) it is enough to show that if $y\in B(x, r + s),$ then $y \in Bl(x, r, s)$, or equivalently, that there is a $z\in X$ such that $d(x, z) < r$ and $d(z, y) < s$. If either $d(x, y) < s$ or $d(x, y) < r$ we can take $z = x$ and there is nothing to prove, so assume otherwise. Let $(\hat X, \hat d)$ be the completion of $(X, d)$; then $\hat X$ is a length space, since it has the approximate midpoint property. Let $\Gamma :[0,1] \to \hat X$ be a curve with $\Gamma (0) = x$, $\Gamma (1) = y$, and length $\ell (\Gamma ) < r + s$. Then $\Gamma ([0, 1]) \subset B(x, r) \cup B(y, s)$, for if there is a $w \in [0,1]$ with $\Gamma (w) \notin B(x, r) \cup B(y, s)$, then $\ell (\Gamma ) \ge r + s$. Now let $c \in [0,1]$ be the time of first exit of $\Gamma (t)$ from $B(x,r)$, that is, for all $t < c$, $\Gamma (t) \in B(x,r)$ and $\Gamma (c) \notin B(x,r)$ . Then $\Gamma (c) \in B(y,s)$, so by continuity of $\Gamma $, there is a $\delta \in [0, c) $ such that $\Gamma (\delta ) \in B(y,s)$. Thus, the open set $ B(x, r) \cap B(y, s) \ne \emptyset $ in $\hat X$. But $X$ is dense in $\hat X$, so there exists a $z\in X$ such that $d(x, z) < r$ and $d(z, y) < s$, as we wanted to show. \par \par Part c) is a special case of part b). From part c) we obtain a) as follows. Let $x, y \in X$, and let $r >0$ be such that $d(x,y) < 2 r$. By hypothesis, $y\in Bl(x, r, r) = B(x, 2r)$, so there is a $z\in X$ such that $d(x, z) < r$ and $d(z, y) < r$. Thus, $X$ has the approximate midpoint property.
END Proof
 
BEGIN Example 2.14  
 \label {chordal} Let $X$ be the unit sphere (unit circumference) in the plane, with the chordal metric, that is, with the restriction to $X$ of the euclidean metric in the plane. While this space does not have the approximate midpoint property, blossoms are nevertheless geodesic balls. However, the equality $Bl(x, r, s) = B(x, r + s)$ no loger holds. For instance, $Bl((1, 0), 1, 1) \ne Bl((1, 0), \sqrt 2, \sqrt 2 ) = B((1, 0), 2) = X \setminus \{(-1,0)\}$.
END Example
 
BEGIN Definition 3.1  
 \label {bmicroblu} Let $0 < t < 1$ and let $K\ge 1$. Then $\mu $ is said to $t$-microblossom boundedly with constant $K$, if for all $x \in X$ and all $r >0$, we have \begin {equation} \mu (Blu \left (x, r, t r \right )) \le K \mu B(x,r). \end {equation}
END Definition
 
BEGIN Example 3.2  
 \label {bmicrobluex} Microblossoming (even together with doubling) is more general than microdoubling, in a quantitative sense. Consider $(\mathbb {Z}^d, \ell _\infty , \mu )$, where $\mu $ is the counting measure. Then $\mu $ is doubling, and ``microdoubling in the large", since for large radii ($r > d$), $\mu $ can be regarded as a discrete approximation to Lebesgue measure. However, $\mu B(0,1) = 1$, and for every $t > 0$, $\mu B(0,1 + t ) \ge 3^d$, no matter how small $t$ is. Thus, the measure $\mu $ is not $(t,K)$-microdoubling, for any $K < 3^d$, $0 < t << 1$. However, $\mu $ is $1/d$-microblossoming, since for $r > d$, $\mu $ behaves as a microdoubling measure, and for $r \le d$, $Blu(x, r, r/d) = B(x,r)$. \par A less natural but stronger example is furnished by the measure $\mu $ given by \cite [Theorem 5.9]{A2}. Since $\mu $ satisfies a local comparability condition, and is defined in a geometrically doubling space, it blossoms boundedly, so it microblossoms boundedly (at least with the blossoming constant). But $\mu $ is not doubling, and hence it is not microdoubling.
END Example
 
BEGIN Example 3.3  
 \label {bmicroblunonblu} While $(t,K_1)$-microdoubling entails $(2, K_2)$-doubling for some $K_2 \ge K_1$, the analogous statement is not true for microblossoming. The following example shows that $(1/2,1)$-microblossoming does not entail local comparability. Let $X = \{0, 1, 3\}$ with the inherited metric from $\mathbb {R}$, and let $\mu = \delta _3$. Then $B(0,3) \cap B(3, 3) = \{1\}$, but $\mu B(0,3) = 0$ while $\mu B(3,3) = 1$, so local comparability fails. Since bounded blossoming implies local comparability, all we have to do is to check that $\mu $ is $(1/2,1)$-microblossoming. For $t\le 3$, $B(0,t) \subset Blu(0, t, t/2) \subset \{0,1\}$, so $\mu B(0,t) = \mu Blu(0, t, t/2)= 0$, and for $t > 3$, $B(0,t) = Blu(0, t, t/2) = X$. Likewise, for $t\le 2$, $B(1,t) = Blu(1, t, t/2) \subset \{0,1\}$, so $\mu B(1,t) = \mu Blu(1, t, t/2)= 0$, and for $t > 2$, $B(1,t) = Blu(1, t, t/2) = X$.
END Example
 
BEGIN Definition 3.4  
 Given a metric measure space $(X, d, \mu )$, and denoting the support of $\mu $ by $supp(\mu )$, the {\em relative increment function} of $\mu $, $ri_{\mu }: supp(\mu )\times (0,\infty )\times [1,\infty )$, is defined as \begin {equation} \label {ri} ri_{\mu }(x, r, t) := \frac {\mu B(x, tr)}{\mu B(x, r)}, \end {equation} and the {\em maximal relative increment function}, as \begin {equation} \label {mri} mri_{\mu }(r, t) := \sup _{x \in supp(\mu )}\frac {\mu B(x, tr)}{\mu B(x, r)}. \end {equation} When $\mu $ is understood we will simply write $ri$ and $mri$.
END Definition
 
BEGIN Example 3.5  
 \label {macrodoub} The interest of considering values of $t >2$ in the preceding definition comes from the fact that, under the additional assumption of microblossoming, it will allow a much more irregular growth of balls than microdoubling or plain doubling, without a comparable worsening of the estimates for the weak type (1,1) bounds. \par To fix ideas, consider the right hand side $ C(\mu ) \ K_1 K \left (2 + \frac {\log K_2}{\log K}\right )$ of formula (\ref {sum}) below. This bound is related to the centered maximal operator when the supremum is restricted to radii $R$ between $r$ and $T r$, $T > 1$. The constant $K_2$ depends on $T$, as it must satisfy $ mri_{\mu }(r, T) \le K_2$. For Lebesgue measure on $\mathbb {R}^d$ with the $\ell _\infty $-norm, $ C(\lambda ^d) = 1$. If we set $T=2$, then we can take $K_2 = 2^d$, while $K_2 = d^d$ for $T=d$, a choice which yields bounds of order $O( d \log d)$. A $1/d$-microdoubling constant is $K_1 = e$ ($\mathbb {R}^d$ has the approximate midpoint property, and in fact it is a geodesic space, so microdoubling is the same as microblossoming in this case) and $K := \max \{K_1, e\} = e$. \par Returning to Example \ref {bmicrobluex}, by a rescaling argument it is clear that the situation for $(\mathbb {Z}^d, \ell _\infty , \mu )$ cannot be much worse than for $(\mathbb {R}^d, \ell _\infty , \lambda ^d)$, and in fact it is easy to see that the same argument of Stein and Str\"omberg (which will be presented in greater generality below) yields the $O( d \log d)$ bounds. Now suppose we modify the measure so that at one single point it is much smaller. Clearly, this will have little impact in the weak type (1,1) bounds, since for $d >>1$, $x \in \mathbb {Z}^d,$ and $r>1$, the measure of $B(x,r)$ will be changed by little or not at all, while for $ r \le 1$, balls with distinct centers do not intersect. For definiteness, set $\nu = \mu $ on $\mathbb {Z}^d \setminus \{0\}$, and $\nu \{0\} = d ^{-d}$. Then the doubling constant, and the $(t,K)$-microdoubling constant, for any $t > 0$, is at least $d ^{d} (3 ^{d} -1) \le K = K_2$, much larger than the corresponding constants for $\mu $. However, the local comparability constant is still very close to 1, since intersecting balls of the same radius must contain at least $3^d$ points each, and a $1/d$-microblossoming constant can be taken to be very close to $e$. Setting $T = d$, we get $K_2 \le d^d (2d + 1)^d$, so $\log K_2$ in this case is comparable to the constant obtained when $T = 2$.
END Example
 
BEGIN Remark 3.6  
 One might define $(T, K)$-macroblossoming, with $T > 1$, by analogy with Definition \ref {bmicroblu}. However, since $B(x, T r) \subset Blu(x, r, T r)$, assuming directly that $mri_{\mu }(r, T) \le K$ is not stronger than $(T, K)$-macroblossoming,
END Remark
 
BEGIN Theorem 4.1  
 \label {StSt1} {\bf Stein-Str\"omberg covering theorem for sparse radii.} Let $(X, d, \mu )$ be a metric measure space, where $\mu $ satisfies a $C(\mu )$ local comparability condition, and let $R:= \{r_n: n\in \mathbb {Z}\}$ be a $T$-lacunary sequence of radii, i.e., $r_n >0$ and $r_{n+1}/r_n \ge T > 1$. Suppose there exists a $t > 0$ such that $T t \ge 1$ and $\mu $ $t$-microblossoms boundedly with constant $K$. Let $\{B(x_i, s_i): s_i \in R, 1 \le i \le M\}$ be a finite collection of balls with positive measure, ordered by non-increasing radii. Set $U:= \cup _{i = 1}^M B(x_i, t s_i)$. Then there exists a subcollection $\{B(x_{i_1}, s_{i_1}), \dots , B(x_{i_N}, s_{i_N})\}$, such that, denoting by $D_{i_j}$ the disjointifications of the reduced balls $B(x_{i_j}, t s_{i_j})$, \begin {equation}\label {set} \mu U \le (K + 1) \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j}), \end {equation} and \begin {equation}\label {bound} \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})} \le C(\mu ) \ K + 1. \end {equation}
END Theorem
 
BEGIN Proof 
 We use the Stein-Str\"omberg selection algorithm. Let $B(x_{i_1}, s_{i_1}) = B(x_{1}, s_{1})$ and suppose that the balls $B(x_{i_1}, s_{i_1}), \dots ,B(x_{i_k}, s_{i_k})$ have already been selected. If $$ \sum _{j=1}^k \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{Bl(x_{i_j}, s_{i_j}, t s_{i_j})} (x_{i_{k} + 1}) \le 1, $$ accept $B(x_{i_{k + 1}}, s_{i_{k + 1}}) := B(x_{i_{k} + 1}, s_{i_{k} + 1})$ as the next ball in the subcollection. Otherwise, reject it. Repeat till we run out of balls. Let $\mathcal {C}$ be the collection of all rejected balls. Then $\mu $ a.e., $$ \mathbf {1}_{\cup \mathcal {C}} < \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{Blu(x_{i_j}, s_{i_j}, t s_{i_j})}. $$ Integrating both sides and using microblossoming we conclude that $\mu \cup \mathcal {C} \le K \sum _i^N \mu D_{i_j} = K \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j})$, whence $\mu U \le (K + 1) \ \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j})$. \par Next we show that $$ \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})} \le C(\mu ) \ K + 1. $$ Suppose $\sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})}(z) > 0$. Let $\{B(x_{i_{k_1}}, s_{i_{k_1}}),$ $ \dots , B(x_{i_{k_n}}, s_{i_{k_n}})\}$ be the collection of all balls containing $z$ (keeping the original ordering by decreasing radii). Then each $B(x_{i_{k_j}}, s_{i_{k_j}})$ has radius either equal to or (substantially) larger than $s_{i_{k_n}}$. We separate the contributions of these balls into two sums. Suppose $B(x_{i_{k_1}}, s_{i_{k_1}}), \dots , B(x_{i_{k_m}}, s_{i_{k_m}})$ all have radii larger than $s_{i_{k_n}}$, while $B(x_{i_{k_{m} + 1}}, s_{i_{k_{m} + 1}}), \dots , B(x_{i_{k_n}}, s_{i_{k_n}})$ have radii equal to $s_{i_{k_{n}}}$. Now for $1 \le j \le m$, by $T$ lacunarity and the fact that $T t \ge 1$, we have $s_{i_{k_n}} \le t s_{i_{k_j}}$, so $z\in B(x_{i_{k_j}}, s_{i_{k_j}})$ implies that $x_{i_{k_n}}\in Bl(x_{i_{k_j}}, s_{i_{k_j}}, t s_{i_{k_j}})$, whence $$ \sum _{j=1}^m \frac {\mu D_{i_{k_j}}}{\mu B(x_{i_{k_j}}, s_{i_{k_j}})} \mathbf {1}_{Bl(x_{i_{k_j}}, s_{i_{k_j}}, t s_{i_{k_j}})} (x_{i_{k_n}}) \le 1, $$ and thus $$ \sum _{j=1}^m \frac {\mu D_{i_{k_j}}}{\mu B(x_{i_{k_j}}, s_{i_{k_j}})} \mathbf {1}_{B(x_{i_{k_j}}, s_{i_{k_j}})} (z) \le 1. $$ Next, note that the sets $D_{i_{k_{m} + 1}}, \dots , D_{i_{k_{n}}}$ are all disjoint and contained in $Bl(z, s_{i_{k_{n}}}, t s_{i_{k_{n}}})$. By microblossoming and local comparability, for $j = m + 1, \dots , n$ we have $$ \mu \cup _{j= m+1}^n D_{i_{k_{j}}}\le \mu Bl(z, s_{i_{k_{n}}}, t s_{i_{k_{n}}}) \le K \mu B(z, s_{i_{k_{n}}})\le K \ C(\mu ) \ \mu B(x_{i_{k_{j}}}, s_{i_{k_{n}}}). $$ It follows that $$ \sum _{j= m +1}^n \frac {\mu D_{i_{k_{j}}}}{\mu B(x_{i_{k_{j}}}, s_{i_{k_{n}}})}\mathbf {1}_{B(x_{i_{k_{j}}}, s_{i_{k_{n}}})} (z) \le \frac { C(\mu ) \ \mu Bl(z, s_{i_{k_{n}}}, t s_{i_{k_{n}}})}{\mu B(z, s_{i_{k_{n}}})} \le C(\mu ) \ K. $$
END Proof
 
BEGIN Corollary 4.2  
 \label {MR} Let $(X, d, \mu )$ be a metric measure space, where $\mu $ satisfies a $C(\mu )$ local comparability condition, and let $R:= \{r_n: n\in \mathbb {Z}\}$ be a $T$-lacunary sequence of radii. Suppose there exists a $t > 0$ with $T t \ge 1$ such that $\mu $ $(t, K)$-microblossoms boundedly. Then $\|M_R\|_{L^1-L^{1,\infty }} \le (K + 1) \ (C(\mu ) \ K + 1)$.
END Corollary
 
BEGIN Proof 
 Fix $\varepsilon > 0$, let $a > 0$, and let $f\in L^1(\mu )$. For each $x\in \{M_R f > a\}$ select $B(x,r)$ with $r\in R$, such that $a \mu B(x,r) < \int _{B(x,r)} |f|$. Then the collection of ``small" balls $\{ B(x, tr) : x\in \{M_R f > a\}\}$ is a cover of $\{M_R f > a\}$. By the $\tau $-smoothness of $\mu $, there is a finite subcollection $\{B(x_i, t s_i): s_i \in R, 1 \le i \le M\}$ of balls with positive measure, ordered by non-increasing radii, such that $$ (1 - \varepsilon ) \mu \{M_R f > a\} \le (1 - \varepsilon ) \mu \cup \{ B(x, tr) : x\in \{M_R f > a\}\} < \mu \cup _{i= 1}^M B(x_i, t s_i). $$ \par Next, let $\{B(x_{i_1}, s_{i_1}), \dots , B(x_{i_N}, s_{i_N})\}$ be the subcollection given by the Stein-Str\"omberg covering theorem for sparse radii. Then we have $$ \mu \cup _{i= 1}^M B(x_i, t s_i) \le (K + 1) \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j}) = (K + 1) \sum _{j=1}^N \mu D_{i_j} $$ $$ = (K + 1) \sum _{j=1}^N \frac {\mu D_{i_j} }{\mu B(x_{i_j}, s_{i_j})}\int \mathbf {1}_{B(x_{i_j}, s_{i_j})} \le (K + 1) \frac {1}{a }\int |f| \sum _{j=1}^N \frac {\mu D_{i_j} }{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})} $$ $$\le (K + 1) \ (C(\mu ) \ K + 1) \frac {1}{a }\int |f| . $$
END Proof
 
BEGIN Corollary 4.3  
 Let $(X, d, \mu )$ be a metric measure space, where $\mu $ satisfies a $C(\mu )$ local comparability condition and is $(t, K^{1/2})$-microdoubling. If $N$ is the least integer such that $(1 + t)^N \ge 1/t$, then $$\|M\|_{L^1-L^{1,\infty }} \le N \ K^{1/2} \ (K + 1) \ (C(\mu ) \ K^{1/2} + 1).$$
END Corollary
 
BEGIN Theorem 4.4  
 \label {StSt2} {\bf Stein-Str\"omberg covering theorem for bounded radii.} Let $(X, d, \mu )$ be a metric measure space such that $\mu $ satisfies a $C(\mu )$ local comparability condition, and is $(t,K_1)$-microblossoming. Set $K = \max \{K_1 , e\}$. Let $ r > 0$, and suppose there exists a $T > 1$ such that $K_2:= mri(r,T) <\infty $. Let $\{B(x_i, s_i): r \le s_i < T r, 1 \le i \le M\}$ be a finite collection of balls with positive measure, given in any order, and let $D_1 = B(x_1, t s_1), \dots , D_{M} = B(x_{M}, t s_{M})\setminus \cup _1^{M-1} B(x_{i}, t s_{i})$ be the disjointifications of the $t$-reduced balls. Then \begin {equation}\label {sum} \sum _{i=1}^M\frac {\mu D_i}{\mu B(x_{i}, s_{i})}\mathbf {1}_{B(x_{i}, s_{i})} \le C(\mu ) \ K_1 K \left (2 + \frac {\log K_2}{\log K}\right ). \end {equation}
END Theorem
 
BEGIN Proof 
 Suppose $$\sum _{i=1}^M\frac {\mu D_i}{\mu B(x_{i}, s_{i})}\mathbf {1}_{B(x_{i}, s_{i})} (y) > 0. $$ Let $s = \min \{s_i: 1 \le i \le M \mbox { and } y\in B(x_{i}, s_{i})\}$. Then $r \le s < Tr$. Select $$h_1 = \sup \{h > 0 : \mu B(y , (1 + h) s) \le K \mu B^{cl} (y ,s) \mbox { \ and \ } (1 + h) s \le T r\}. $$ This is always possible since $ \lim _{h\downarrow 0}\mu B(y , (1 + h) s) = \mu B^{cl} (y ,s) $. Now either $(1 + h_1) s = T r$, in which case the process finishes in one step, and then it could happen that $\mu B^{cl}(y , (1 + h_1) s) < K \mu B^{cl} (y ,s)$, or $(1 + h_1) s < T r$, in which case $\mu B(y , (1 + h_1) s) \le K \mu B^{cl} (y ,s) \le \mu B^{cl}(y , (1 + h_1) s)$ (the last inequality must hold, since otherwise we would be able to select a larger value for $h_1$). \par If $h_2, \dots , h_m$ have been chosen, let $$h_{m + 1} := \sup \{h > 0 : \mu B(y , s (1 + h)\Pi _{i=1}^m (1 + h_i) \le K \mu B^{cl} (y , s \Pi _{i=1}^m (1 + h_i) ) \mbox { \ and \ } $$ $$ s (1 + h)\Pi _{i=1}^m (1 + h_i) \le T r\}.$$ Since $\mu B (y , Tr) < \infty $, the process stops after a finite number of steps, so there is an $N \ge 0$ (assigning value 1 to the empty product) such that $ s \Pi _{i=1}^{N + 1} (1 + h_i) = T r$ and $$ \mu B^{cl} (y , s \Pi _{i=1}^N (1 + h_i) ) \le \mu B (y , Tr) \le K \mu B^{cl} (y , s \Pi _{i=1}^N (1 + h_i) ). $$ To estimate $N$, note that since $r \le s$, $$ \mu B (y , T r) \le K_2 \mu B (y , s) \le \frac {K_2}{K} \mu B^{cl} (y ,(1 + h_1) s) $$ $$ \le \dots \le \frac {K_2}{K^N} \mu B^{cl} (y , s \Pi _{i=1}^N (1 + h_i) ) \le \frac {K_2}{K^N} \mu B (y , T r). $$ Hence $K^N \le K_2$ and thus $N\le \log K_2/ \log K$. \par The remaining part of the argument is a variant of what was done in Stein-Str\"omberg for sparse radii, when considering the contribution of balls with the same radius as the smallest ball. Here we arrange the balls containing $y$ into $N + 2$ ``scales" (instead of just one) depending on whether their radii $R$ are equal to $s$, or $s \Pi _{i=1}^m (1 + h_i) < R \le s \Pi _{i=1}^{m +1} (1 + h_i) $, or $ s \Pi _{i=1}^N (1 + h_i) < R \le T r$. \par For the first scale, consider all balls $B(x_{i_{1,1}}, s), \dots , B(x_{i_{1,k_1}}, s)$ containing $y$. Since for $1\le j \le k_1$, $x_{i_{1,j}} \in B(y, s)$, it follows that the disjoint sets $D_{i_{1,j}}$ are all contained in $Bl(y, s, t s).$ By microblossoming and local comparability we have, for $j = 1, \dots , k_1$, $$ \mu \cup _{j= 1}^{k_1} D_{i_{1,j}}\le \mu Bl(y, s, t s) \le K_1 \mu B(y, s)\le K_1 \ C(\mu ) \ \mu B(x_{i_{1,j}}, s), $$ so $$ \sum _{j= 1}^{k_1} \frac {\mu D_{i_{1,j}}}{\mu B(x_{i_{1,j}}, s_{i_{1,j}})}\mathbf {1}_{B(x_{i_{1,j}}, s_{i_{1,j}})} (y) \le \frac { C(\mu ) \ \mu Bl(y, s, t s)}{\mu B(y, s)} \le C(\mu ) \ K_1. $$ \par The contributions of all the other scales are estimated in the same way as the second one, which is presented next. Again, consider all balls $B(x_{i_{2,1}}, s_{i_{2,1}}), \dots , B(x_{i_{2,k_2}}, s_{i_{2,k_2}})$ containing $y$ and with radii $s_{i_{2,j}}$ in the interval $(s, (1 + h_1) s]$. Then all the sets $D_{i_{2,j}}$ are contained in $$ Bl(y, (1 + h_1) s, t (1 + h_1) s). $$ Using microblossoming, the choice of $h_1$, and the local comparability of $\mu $, for $j = 1, \dots , k_2$ we have \begin {equation}\label {minus} \mu \cup _{j= 1}^{k_2} D_{i_{2,j}} \le \mu Bl(y, (1 + h_1) s, t (1 + h_1) s) \end {equation} $$ \le K_1 \mu B (y, (1 + h_1) s) \le K_1 K \mu B^{cl}(y, s) \le K_1 K \ C(\mu ) \ \mu B(x_{i_{2,j}}, s_{i_{2,j}}), $$ so $$ \sum _{j= 1}^{k_2} \frac {\mu D_{i_{2,j}}}{\mu B(x_{i_{2,j}}, s_{i_{2,j}})}\mathbf {1}_{B(x_{i_{2,j}}, s_{i_{2,j}})} (y) \le \frac { C(\mu ) \ \mu Bl(y, (1 + h_1) s, t (1 + h_1) s)}{\mu B^{cl}(y, s)} \le C(\mu ) \ K_1 K. $$ Adding up over the $N + 2$ scales we get (\ref {sum}).
END Proof
 
BEGIN Theorem 4.5  
 \label {StSt3} {\bf Stein-Str\"omberg covering theorem.} Let $(X, d, \mu )$ be a metric measure space, where $\mu $ satisfies a $C(\mu )$ local comparability condition, and is $(t,K_1)$-microblossoming. Set $K = \max \{K_1 , e\}$, and suppose $K_2:= \sup _{r > 0} mri(r,1/t) <\infty $. Let $\{B(x_i, s_i): s_i \in R, 1 \le i \le M\}$ be a finite collection of balls with positive measure, ordered by non-increasing radii, and let $U:= \cup _{i = 1}^M B(x_i, t s_i)$. Then there exists a subcollection $\{B(x_{i_1}, s_{i_1}), \dots , B(x_{i_N}, s_{i_N})\}, $ such that, denoting by $D_{i_1} = B(x_{i_1}, t s_{i_1}), \dots , D_{i_N} = B(x_{i_N}, t s_{i_N}) \setminus \cup _1^{N-1} B(x_{i_j}, t s_{i_j})$, we have \begin {equation}\label {set2} \mu U \le (K_1 + 1) \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j}), \end {equation} and \begin {equation} \label {bound2} \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})} \le 1 + C(\mu ) \ K_1 K \left (2 + \frac {\log K_2}{\log K}\right ). \end {equation}
END Theorem
 
BEGIN Proof 
 The selection process is the same as in the proof of Theorem \ref {StSt1}, yielding the desired subcollection, with (\ref {set2}) being the same as (\ref {set}). As for the right hand side of (\ref {bound2}) the 1 comes from the contribution of balls with very large radii, as in (\ref {bound}), while $C(\mu ) \ K_1 K \left (2 + \frac {\log K_2}{\log K}\right )$ is the bound from (\ref {sum}).
END Proof
 
BEGIN Corollary 4.6  
 \label {M} Under the assumptions and with the notation of the preceding result, the centered maximal function satisfies the weak type (1,1) bound $$\|M\|_{L^1-L^{1,\infty }} \le (K_1 + 1) \left ( 1 + C(\mu ) \ K_1 K \left (2 + \frac {\log K_2}{\log K}\right )\right ).$$
END Corollary
 
BEGIN Theorem 5.1  
 \label {SSLebesgue} Consider $\mathbb {R}^d$ with Lebesgue measure $\lambda ^d$ and balls defined by an arbitrary norm. Let $R:= \{r_n: n\in \mathbb {Z}\}$ be a $d$-lacunary sequence of radii, and let $M_R$ be the corresponding (sparsified) Hardy-Littlewood maximal operator. Then $\|M_R\|_{L^1-L^{1,\infty }} \le (e^{1/d} + 1) (1 + 2 e^{1/d})$. Furthermore, if the maximal function is defined using the $\ell _\infty $-norm, so balls are cubes with sides perpendicular to the coordinate axes, then $\|M_R\|_{L^1-L^{1,\infty }} \le 6.$
END Theorem
 
BEGIN Proof 
 Suppose, for simplicity in the writing, that $r_{n + 1} = d r_n$ (the case $r_{n + 1} \ge d r_n$ is proven in the same way). We apply the Stein Str\"omberg selection process with $t =1/d^2$ and microdoubling constant $K = (1 + 1/d^2)^{d} < e^{1/d}$. As before, given $0 \le f \in L^1$ and $a >0$, we cover the level set $\{M_R f > a\}$ almost completely, by a finite collection of ``small" balls $\{B(x_i, t s_i): s_i \in R, 1 \le i \le M\}$ ordered by non-increasing radii, and such that $a \mu B(x_i, s_i) < \int _{B(x_i, s_i)} f$. From this collection we extract a subcollection $\{B(x_{i_1}, t s_{i_1}), \dots , B(x_{i_N}, t s_{i_N})\}$ satisfying $$ \mu \cup _{i= 1}^M B(x_i, t s_i) \le (e^{1/d} + 1) \mu \cup _{j=1}^N B(x_{i_j}, t s_{i_j}) = (e^{1/d} + 1) \sum _{j=1}^N \mu D_{i_j}. $$ Next, we obtain the bound $$ \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})} \le 2 e^{1/d} + 1, $$ by considering $z$ such that $\sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})}(z) > 0$. Select the ball $B$ with largest index that contains $z$. Since $B$ belongs to the subcollection obtained by the Stein-Str\"omberg method, all balls containing $z$ and with radii $\ge d^2 r(B)$ (where $r(B)$ denotes the radius of $B$), contribute at most 1 to the sum. Next we have to consider two more scales, all the balls with radius $r(B)$, and all the balls with radius $d r(B)$. By the usual argument (as in the proof of Theorem \ref {StSt1}) each of these scales contributes at most $e^{1/d}$ to the sum, so $\|M_R\|_{L^1-L^{1,\infty }} \le (e^{1/d} + 1) (1 + 2 e^{1/d})$ follows. The result for cubes is obtained by letting $d\to \infty $, since in this case it is known that the weak type (1,1) norms increase with the dimension (cf. \cite [Theorem 2]{AV}).
END Proof
 
BEGIN Theorem 5.2  
 \label {SS2Lebesgue} Consider $\mathbb {R}^d$ with Lebesgue measure $\lambda ^d$ and balls defined by an arbitrary norm. If $\varepsilon > 0$, then $\|M\|_{L^1-L^{1,\infty }} \le (2 + 3 \varepsilon ) d \log d$ for all $d = d(\varepsilon )$ sufficiently large.
END Theorem
 
BEGIN Proof 
 Fix $\varepsilon \in (0,1)$. Since $(1 + d^{-1 - \varepsilon })^d = 1 + d^{ - \varepsilon } + O(d^{ -2 \varepsilon })$, it follows that $\lambda ^d$ is $(d^{-1 - \varepsilon }, 1 + d^{ - \varepsilon } + O(d^{ -2 \varepsilon }))$-microdoubling. Note that if a ball $B$ contains the center of a second ball of radius $1$, and the latter ball is contained in $(1 + d^{-1 - \varepsilon }) B$, then the radius $r_B$ of $B$ must satisfy $r_B \ge d^{ 1 + \varepsilon }$. Let $L$ be any natural number such that $(1 + d^{-1 - \varepsilon })^L \ge d^{1 + \varepsilon }$. Taking logarithms to estimate $L$, and using $\log (1 + x) > x - x^2$ for $x$ sufficiently close to $0$, we see that it is enough, for the preceding inequality to hold, to choose $L$ satisfying $L (d^{-1 - \varepsilon } - d^{-2 - 2\varepsilon }) \ge (1 + \varepsilon ) \log d$, or, $L \ge (1 + o(d^{-1}))(1 + \varepsilon ) d^{1 + \varepsilon } \log d$. For the least such integer we will have $$ L \le 1 + (1 + o(d^{-1}))(1 + \varepsilon ) d^{1 + \varepsilon } \log d. $$ \par Again we apply the Stein Str\"omberg selection process with $t = d^{-1 - \varepsilon }$, covering a given level set $\{M f > a\}$ almost completely (up to a small $\delta > 0$) by a finite collection of small balls $\{B(x_i, t s_i): s_i \in R, 1 \le i \le k\}$ ordered by non-increasing radii, and such that $a \mu B(x_i, t s_i) < \int _{B(x_i, t s_i)} |f|$. Using the Stein Str\"omberg algorithm, we extract a subcollection $$ \{B(x_{i_1}, t s_{i_1}), \dots , B(x_{i_N}, t s_{i_N})\} $$ satisfying \begin {equation} \label {SSsum1} (1 - \delta ) \mu \{M f > a\} \le (2 + d^{ - \varepsilon } + O(d^{ -2 \varepsilon })) \sum _{j=1}^N \mu D_{i_j}, \end {equation} where the sets $D_{i_j}$ denote the disjointifications determined by the above subcollection. To sharpen the usual uniform bound for \begin {equation*} \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})}, \end {equation*} we use the fact that the sets $D_i$ are disjoint across different steps, and not just within the same step. More precisely, let $z$ satisfy \begin {equation} \label {SSsum} \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})}(z) > 0. \end {equation} Select the ball $B$ with largest index that contains $z$. Since $B$ belongs to the subcollection obtained by the Stein-Str\"omberg method, all balls containing $z$ and with radii $\ge d^{ 1 + \varepsilon } r(B)$ contribute at most 1 to the sum. Next we consider the first two scales, since for all the others, the argument is the same as for the second. \par Take all the balls with radii equal to $r_B$. In order to bound (\ref {SSsum}) from above, we suppose that $(1 + d^{ - 1 - \varepsilon }) B$ is completely filled up with the sets $D_i$ associated to balls with radii $r_B$, and hence, no $D_j$ associated to a ball with larger radius intersects $(1 + d^{ -1 - \varepsilon }) B$. When we consider the sum (\ref {SSsum}), but just for the balls with radius $r_B$, we obtain the upper bound $(1 + d^{ - 1 - \varepsilon })^d$. For the second level, we consider all balls in the subcollection with radii in $(r_B, (1 + d^{ - 1 - \varepsilon }) r_B]$, and as before, we suppose that $(1 + d^{ - 1 - \varepsilon })^2 B \setminus (1 + d^{ - 1 - \varepsilon }) B$ is completely filled up with the sets $D_j$ associated to these balls. The estimate we obtain for this second level is $(1 + d^{ - 1 - \varepsilon })^d - 1 = d^{ - \varepsilon } + O(d^{ -2 \varepsilon })$. For balls with radii in $((1 + d^{ - 1 - \varepsilon })^k r_B, (1 + d^{ - 1 - \varepsilon })^{k + 1} r_B]$, $0 \le k < L$, we use the same estimate. Adding up over all scales we obtain $$ \sum _{j=1}^N \frac {\mu D_{i_j}}{\mu B(x_{i_j}, s_{i_j})}\mathbf {1}_{B(x_{i_j}, s_{i_j})}(z) \le 1 + 1 + d^{ - \varepsilon } + O(d^{ -2 \varepsilon }) $$ $$ + (1 + (d^{ - \varepsilon } + O(d^{ -2 \varepsilon })) (1 + o(d^{-1}))(1 + \varepsilon ) d^{1 + \varepsilon } \log d) \le (1 + O(d^{-\varepsilon }))(1 + \varepsilon ) d \log d. $$ Multiplying this bound with the bound from (\ref {SSsum1}) and adding an $\varepsilon $ to absorb the big Oh terms, for $d$ large enough we obtain $\|M\|_{L^1-L^{1,\infty }} \le (2 + 3 \varepsilon ) d \log d$.
END Proof
 
