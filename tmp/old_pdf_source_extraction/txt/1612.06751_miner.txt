***
The Lyons-Peres Conjecture. [ [19, Conjecture 4.6]] For PK-almost every X ∈ Conf(E), we have

spanL2(E,µ){Kx;x ∈ X} = H.

(1.2)

***

Theorem 1.1. [Lyons-Peres conjecture] Let K be a locally trace-class orthogonal projection onto a subspace H of
L2(E, µ). Then for PK-almost every X ∈ Conf(E), the functions Kx deﬁned by (??) satisfy

spanL2(E,µ){Kx;x ∈ X} = H.

***

Remark 1.2. We mention that our assumption on σ-compactness of E is not essential. In fact, all our results are
valid by replacing everywhere “relatively compact” by “with K(x,x)dµ(x)-ﬁnite measure”. Therefore, Lyons-Peres
conjecture holds in full generality.

***
Corollary 1.3. For PK-almost every X ∈ Conf(E), if h ∈ H satisﬁes h(cid:22)X = 0, then h = 0.

***
Theorem 1.4. Let B1 ⊂ ··· ⊂ Bn ⊂ ··· ⊂ E be an increasing exhausting sequence of bounded Borel subsets of E.

n∈N F(E \ Bn) is trivial with respect to PK.

The σ-algebra(cid:84)

***
Corollary 1.5. The point process PK has trivial tail σ-algebra.

***
Deﬁnition 1.6. For any bounded Borel subset B ⊂ E, we deﬁne canonical conditional kernels K[X,B] with respect
to the conditioning on the conﬁguration in B as follows:

• For p ∈ E0, deﬁne a kernel K p, for (x,y) ∈ E0 × E0, by the formula

0

K(p, p)

K p(x,y) :=

 K(x,y)− K(x, p)K(p,y)
 det[K(pi,q j)]0≤i, j≤n
(cid:26) χE\BK p1,...,pl (1− χBK p1,...,pl )−1χE\B

det[K(pi, p j)]1≤i, j≤n

K p1,··· ,pn(x,y) :=

if K(p, p) > 0
if K(p, p) = 0

.

if det[K(pi, p j)]1≤i, j≤n > 0
if det[K(pi, p j)]1≤i, j≤n = 0

0

• For an n-tuple (p1,··· , pn) ∈ En

Takahashi [29, Corollary 6.6]). Given x,y ∈ E0, write p0 = x,q0 = y, qi = pi for 1 ≤ i ≤ n, and set

0, deﬁne a kernel K p1,··· ,pn = (··· (K p1)p2 ··· )pn as follows (cf. Shirai-

• For a bounded Borel subset B ⊂ E and X ∈ Conf(E) such that X ∩ B = {p1, . . . , pl} ⊂ E0, deﬁne

K[X,B] =

0

if 1− χBK p1,...,pl is invertible
if 1− χBK p1,...,pl is not invertible .

(1.5)

(1.6)

***

Remark. We will see in Proposition 2.5 below that K[X,B] is the correlation kernel for the conditional measure of
PK, the condition being that the conﬁguration on B coincides with X ∩ B. In particular, for PK-almost every X, we
have X ∩ B = {p1,··· , pl} ⊂ E0 and 1− χBK p1,...,pl is invertible. The second case K[X,B] = 0 has probability zero.
Note that the range of K[X,B] is contained in L2(E \ B, µ) and we have
K[X,B] = χE\BK[X,B]χE\B.

***
Lemma 1.7. Let W ⊂ E be a Borel subset, let B1 ⊂ ··· ⊂ Bn ⊂ ··· ⊂ W be an increasing exhausting sequence
of bounded Borel subsets of W . For PK-almost every X ∈ Conf(E) there exists a positive self-adjoint contraction
K[X,W ] ∈ L1,loc(L2(E \W, µ)) such that

and

χE\W K[X,Bn]χE\W

n→∞

−−−−−−−−−−−−→
in L1,loc(L2(E \W, µ))

K[X,W ]

PK(·|X,W ) = PK[X,W ].

***
Remark. For ﬁxed W , the kernel-valued function X (cid:55)→ K[X,W ] almost surely does not depend on the choice of the
approximating sequence B1 ⊂ ··· ⊂ Bn ⊂ ··· ⊂ W .

***
Lemma 1.8. [First local property of conditional kernels] Let B ⊂ E be a bounded Borel subset and let Q be an
orthogonal projection, acting in L2(E, µ), such that Ran(Q) ⊂ L2(E \ B, µ) and the operator QKQ is locally trace
class. For PK-almost every X ∈ Conf(E), we have

(Q + χB)K(Q + χB)

= (Q + χB)K[X,B](Q + χB) = QK[X,B]Q.

(1.8)

(cid:16)

(cid:17)[X,B]

***

Remark. The formula (1.8) is a strengthening, on the level of kernels, of the general property of point processes
that conditioning on the restriction to a subset commutes with the forgetting projection onto a larger subset;
see Proposition 2.4 below. The local property can be interpreted in terms of Neretin’s formalism in [21]: a
determinantal measure is viewed as a “determinantal state” on a specially constructed algebra, and in order
that conditional states themselves be determinantal the local property must take place. The local property can thus
be seen as the noncommutative analogue of the fact that the operation of conditioning commutes with the operation
of restriction of a conﬁguration onto a subset.

***

Lemma 1.9. [Second local property of conditional kernels] Let A,B be two disjoint bounded Borel subsets of E.
For PK-almost every X ∈ Conf(E), we have

(K[X,A])[X,B] = (K[X,B])[X,A] = K[X,A∪B].

***
Lemma 1.10. Let W ⊂ E be a Borel subset, let B1 ⊂ ··· ⊂ Bn ⊂ ··· ⊂ W be an increasing exhausting sequence of
bounded Borel subsets of W . The sequence of random variables

(cid:16)

(cid:17)

is an (F(Bn))n∈N-adapted operator-valued martingale deﬁned on the probability space (Conf(E), F(E),PK).

χE\W K[X,Bn]χE\W

n∈N

***

Remark. The proof of Lemma 1.10 below in fact yields a stronger statement: the sequence of exterior power
operators

almost surely convergent to(cid:0)χE\W K[X,W ]χE\W

is an (F(Bn))n∈N-adapted operator-valued martingale, deﬁned on the probability space (Conf(E), F(E),PK) and

(cid:1)∧m(cid:17)

n∈N

(cid:16)(cid:0)χE\W K[X,Bn]χE\W
(cid:1)∧m

.

***
Proposition 2.1. [[24, p. 278]] A function F : Ω → B is Bochner measurable with respect to F if and only if
for any ξ ∈ D, the scalar function ω → ξ (F(ω)) is F -measurable. A sequence (Rn)∞
n=1 in Lp(Ω, F ,P; B) is
n=1-adapted martingale if and only if for any ξ ∈ D, the sequence (ξ (Rn))∞
an (Fn)∞
n=1-adapted
martingale.

n=1 is an (Fn)∞

***

Deﬁnition 2.2. A Banach space B is said to have the Radon-Nikodym property if for any probability space
(Ω, F ,P) and any B-valued measure m on (Ω, F ), with m having ﬁnite total variation and being absolutely
continuous with respect to P, there exists a Bochner integrable function Fm ∈ L1(Ω, F ,P; B) such that

(cid:90)

A

m(A) =

FmdP for any A ∈ F .

***

Proposition 2.3. The space L1(L2(E, µ)) has the Radon-Nikodym property.

***
Proposition 2.4. Let W1,W2 be two disjoint Borel subsets of E. For P-almost every X ∈ Conf(E), we have

(πW1∪W2)∗[P](·|X,W1) = (πW1∪W2)∗[P(·|X,W1)].

(2.1)

***
Proposition 2.5. PK(·|X,B) is a determinantal point process on Bc for PK-almost every X ∈ Conf(E), induced by
a correlation kernel K[X,B] deﬁned in (1.6).

***
Proposition 2.6. If K is the orthogonal projection onto a closed subspace H ⊂ L2(E, µ), then the kernel K p1,··· ,pn
corresponds to the orthogonal projection from L2(E, µ) onto the subspace

H(p1,··· , pn) := {h ∈ H : h(p1) = ··· = h(pn) = 0}.

Moreover, for a bounded Borel subset B ⊂ E, the operator K[X,B] is the orthogonal projection onto the closure of
the subspace

χE\BH(X ∩ B) = {χE\Bh : h ∈ H(X ∩ B)}.

***
Lemma 3.1. Let R be the operator introduced in (??). For any p ∈ B∩ E0, we have Rp = (Q + χB)K p(Q + χB).
More generally, for (p1,··· , pn) ∈ (B∩ E0)n, we have

Rp1,··· ,pn = (Q + χB)K p1,··· ,pn(Q + χB).

In particular,

RX∩B = (Q + χB)KX∩B(Q + χB),

for PK-almost every X ∈ Conf(E).

***
Lemma 3.2. Let B be a bounded Borel subset of E such that PK(#B = 0) > 0. Let R be the operator introduced in
(??). Then

(3.3)

χE\BR(1− χBR)−1χE\B = Q(cid:0)χE\BK(1− χBK)−1χE\B

(cid:1)Q.

***
Proposition 4.1. For any bounded Borel subset B ⊂ E, we have

(cid:90)

EPK (K[X,B]) =

Conf(E)

K[X,B]PK(dX) = χE\BKχE\B.

(4.1)

***

Remark. Extending the argument of Benjamini, Lyons, Peres and Schramm [1] for the case of spanning trees,
Lyons [18, Lemma 7.17] proved (4.1) when E is discrete and K is an orthogonal projection on (cid:96)2(E). Our proof,
based on the local property, is quite different and works both in the continuous and the discrete setting.

***
(cid:1)
Proposition 5.1. Let W ⊂ E be a Borel subset, and let B1 ⊂ B2 ⊂ ···Bn ⊂ ··· ⊂ W be an increasing exhausting
n∈N converges PK-almost surely in the

sequence of bounded Borel subsets of W . The sequence(cid:0)χE\W K[X,Bn]χE\W

space of locally trace class operators.

***
Proposition 5.2. Let W ⊂ E be a Borel subset, and let B1 ⊂ B2 ⊂ ···Bn ⊂ ··· ⊂ W be an increasing exhausting
sequence of bounded Borel subsets of W . Fix any positive function ψ : E \W → (0,1] such that ψ1/2Kψ1/2 is of
trace class and for any bounded subset B ⊂ E, we have infx∈B ψ(x) > 0. Then

(cid:0)ψ1/2K[X,Bn]ψ1/2(cid:1)

(5.6)
is an L1(L2(E \W, µ))-valued martingale which is bounded in L2(Conf(E),P; L1(L2(E \W, µ))). In particular,
the sequence converges in L1(Conf(E),P; L1(L2(E \W, µ))).

n∈N

***

set-indexed family(cid:0)χE\W K[X,B]χE\W

(cid:1)

Remark. Let B(W ) be the directed set of bounded measurable subsets of W , ordered by set-inclusion. Then the
B∈B(W ) is a set-indexed martingale adapted to the ﬁltration (F(B))B∈B(W ).
By virtue of Proposition 5.2, for any positive function ψ : E \W → (0,1] such that ψ1/2Kψ1/2 is of trace class and
for any bounded subset B ⊂ E, we have infx∈B ψ(x) > 0, the set-indexed martingale

(cid:16)
ψ1/2K[X,B]ψ1/2(cid:17)

B∈B(W )

converges in L1(Conf(E),PK; L1(L2(E \W, µ))).

***
Lemma 6.1. For PK-almost every X ∈ Conf(E), we have K[X,E\B](χBh) = χBh for any h ∈ L(X ∩ (E \ B)).

***
Lemma 6.2. Let P be a point process on E. Then for any bounded Borel subset B ⊂ E, we have

P(#B = #(X ∩ B)|X,Bc) > 0

for P-almost every X ∈ Conf(E).

(6.3)

***
Deﬁnition 7.1. Fix any increasing exhausting sequence D1 ⊂ ··· ⊂ Dn ⊂ ··· ⊂ E of bounded Borel subsets fo E.
For any Borel subset W ⊂ E, set

K[X,W ] := lim
n→∞

χE\W K[X,W∩Dn]χE\W .

of Borel subsets. Then(cid:0)χBK[X,Wn]χB

***
Proposition 7.2. Fix a bounded Borel subset B ⊂ E and let E\B ⊃ W1 ⊃ ··· ⊃ Wn ⊃ ··· be any decreasing sequence
n∈N is an (F(Wn))n∈N-adapted reverse martingale deﬁned on the probability
space (Conf(E), F(E),PK).

(cid:1)

***
Lemma 7.3. For any bounded Borel subset B ⊂ E and φ ∈ L2(Bc, µ), we have

VarPK
where (cid:107)·(cid:107)2 is the Hilbert norm on L2(E, µ).

(cid:2)(cid:104)K[X,B]φ ,φ(cid:105)(cid:3) ≤ (cid:107)φ(cid:107)2

2 ·(cid:107)χBKφ(cid:107)2
2,

(7.4)

***

Proposition 7.4. Fix any (cid:96) ∈ N. Then(cid:0)χD(cid:96)K[X,E\Dn+(cid:96)]χD(cid:96)

(cid:1)
n∈N is an (F(E \ Dn+(cid:96)))n∈N-adapted reverse martingale

deﬁned on the probability space (Conf(E), F(E),PK), and we have

χD(cid:96)K[X,E\Dn+(cid:96)]χD(cid:96)

−−−−−−−−−−−−−−−−−−−−−−−−−−−−→
PK-a.s. in L1(L2(E, µ) and in L2(PK; L1(L2(E, µ)))

n→∞

χD(cid:96)KχD(cid:96).

For any (cid:96) ∈ N, we have

EPK

and, for any A ∈ F(D(cid:96)), we have

(cid:12)(cid:12)(cid:12) ∞(cid:92)
(cid:104)PK(·|X,E \ D(cid:96))
(cid:12)(cid:12)(cid:12)EPK

EPK

lim
n→∞

n=1

(cid:105)

F(E \ Dn+(cid:96))

= (πD(cid:96))∗(PK), PK-almost surely

(cid:2)χA

(cid:12)(cid:12)(cid:12) = 0.
(cid:12)(cid:12)F(E \ Dn+(cid:96))(cid:3)− PK(A)

(7.6)

(7.7)

(7.8)

***
Proposition 7.5. [See [19, Section 3.3]] Let m be the counting measure on N. There exists a locally trace class

orthogonal projection operator (cid:101)K ∈ L1,loc(L2(E (cid:116) N, µ ⊕ m)) such that K = χE(cid:101)KχE.

***
Proposition 8.1. Let B ⊂ E be a bounded Borel subset. If P is a simple point process on E admitting correlation
measures of all orders, then P(·|X,B) = PX∩B(cid:22)Conf(Bc) for P-almost every X ∈ Conf(E).

***
Remark. Kallenberg [17, Section 12.3] deﬁned the compound Campbell measure of P on Conf f in(E)× Conf(E)
by

n,P(dp× dX1),
C #

1
n!

C #P (dp× dX1) :=

where Conf f in(E) = (cid:116)∞

n=0Confn(E).

∞
∑

n=0

***

probability space (Conf(E), F(E),P). Moreover, we have

Proposition 8.2. The sequence (cid:0)(πW c)∗[P(·|X,Wn)](cid:1)
(cid:12)(cid:12)(cid:12)F(Wn)
(cid:104)P(·|X,W )
(cid:105)
(cid:17)

(πW c)∗[P(·|X,Wn)] = EP

(cid:16)

(πW c)∗[P(·|X,Wn)]

(A)

(8.4)
In particular, by martingale convergence theorem, for all Borel subsets A ⊂ Conf(W c) and any 1 ≤ p < ∞, we have

,

for P-almost every X ∈ Conf(E).

n∈N is an (F(Wn))n∈N-adapted martingale deﬁned on the

Moreover, for P-almost every X ∈ Conf(E), we have

(πW c)∗[P(·|X,Wn)]

n→∞−−−→

weakly

P(·|X,W ).

n→∞

−−−−−−−−−−−−−−−→
P-a.s. and in Lp(Conf(E),P)

P(A|X,W ).

(8.5)

(8.6)

***
Remark. In general, the statement (8.5) cannot be strengthened to the claim that for P-almost every X ∈ Conf(E),
we have

n→∞−−−→ P(A|X,W ), for all Borel subsets A ⊂ Conf(W c).

(cid:17)

(cid:16)

(πW c)∗[P(·|X,Wn)]

(A)

***

Lemma 8.3. We have

qn(x1,··· ,xn;dz) = E[Q(dz|x1,··· ,xn,t)|x1,··· ,xn].

***
Proposition 8.4. If g(cid:22)W ≡ 0 and EP(S2

g) < ∞, then the sequence

(cid:16)EP(Sg|X,Wn)
(cid:17)

(F(Wn))n∈N-adapted L2(Conf(E),P)-bounded martingale

an

is
(Conf(E), F(E),P).

n∈N

(8.7)

deﬁned

on

the

probability

space

