arXiv:1808.04965v1 [math.CO] 15 Aug 2018

A bilinear Bogolyubov-Ruzsa lemma with
poly-logarithmic bounds
Kaave Hosseini∗
University of California, San Diego
skhossei@ucsd.edu

Shachar Lovett†
University of California, San Diego
slovett@ucsd.edu

August 16, 2018

Abstract
The Bogolyubov-Ruzsa lemma, in particular the quantitative bounds obtained by
Sanders, plays a central role in obtaining effective bounds for the inverse U 3 theorem
for the Gowers norms. Recently, Gowers and Milićević applied a bilinear BogolyubovRuzsa lemma as part of a proof of the inverse U 4 theorem with effective bounds.
The goal of this note is to obtain quantitative bounds for the bilinear BogolyubovRuzsa lemma which are similar to those obtained by Sanders for the Bogolyubov-Ruzsa
lemma.
We show that if a set A ⊂ Fn × Fn has density α, then after a constant number
of horizontal and vertical sums, the set A would contain a bilinear structure of codimension r = logO(1) α−1 . This improves the results of Gowers and Milićević which
obtained similar results with a weaker bound of r = exp(exp(logO(1) α−1 )) and by
Bienvenu and Lê which obtained r = exp(exp(exp(logO(1) α−1 ))).

1

Introduction

One of the key ingredients in the proof of quantitative inverse theorem for Gowers U 3 norm
over finite fields, due to Green and Tao [GT08] and Samorodnitsky [Sam07], is an inverse
theorem on the structure of sumsets. More concretely, the tool that gives the best bounds
is the improved Bogolyubov-Ruzsa lemma due to Sanders [San12]. Before introducing it,
we set some common notation. We assume that F = Fp is a prime field where p is a fixed
constant, and suppress the exact dependence on p in the bounds. Given a subset A ⊂ Fn
its density is α = |A|/|F|n. The sumset of A is 2A = A + A = {a + a′ : a, a′ ∈ A} and its
difference set is A − A = {a − a′ : a, a′ ∈ A}.
∗
†

Supported by NSF grant CCF-1614023.
Supported by NSF grant CCF-1614023.

1

Theorem 1.1. ([San12]) Let A ⊂ Fn be a subset of density α. Then there exists a subspace
V ⊂ 2A − 2A of co-dimension O(log4 α−1 ).
In fact the link between the inverse U 3 theorem and inverse sumset theorems is deeper.
It was shown in [GT10, Lov12] that an inverse U 3 conjecture with polynomial bounds is
equivalent to the polynomial Freiman-Ruzsa conjecture, one of the central open problems in
additive combinatorics. Given this, one can not help but wonder whether there is a more
general inverse sumset phenomena that would naturally correspond to quantitative inverse
theorems for U k norms. In a recent breakthrough, Gowers and Milićević [GM17b] showed
that this is indeed the case, at least for the U 4 norm. They used a bilinear generalization of
Theorem 1.1 to obtain a quantitative inverse U 4 theorem.
To be able to explain this result we need to introduce some notation. Let A ⊂ Fn × Fn .
Define two operators, capturing subtraction on horizontal and vertical fibers as follows:
φh (A) := {(x1 − x2 , y) : (x1 , y), (x2, y) ∈ A},
φv (A) := {(x, y1 − y2 ) : (x, y1 ), (x, y2) ∈ A}.
Given a word w ∈ {h, v}k define φw = φw1 ◦ . . . ◦ φwk to be their composition. A bilinear
variety B ⊂ Fn × Fn of co-dimension r = r1 + r2 + r3 is a set defined as follows:
B = {(x, y) ∈ V × W : b1 (x, y) = . . . = br3 (x, y) = 0},
where V, W ⊂ Fn are subspaces of co-dimension r1 , r2 , respectively, and b1 , . . . , br3 : Fn ×
Fn → F are bilinear forms.
Gowers and Milićević [GM17a] and independently Bienvenu and Lê [BL17] proved the
following, although [BL17] obtained a weaker bound of r = exp(exp(exp(logO(1) α−1 ))).
Theorem 1.2 ([GM17a, BL17]). Let A ⊂ Fn × Fn be of density α and let w = hhvvhh.
Then there exists a bilinear variety B ⊂ φw (A) of co-dimension r = exp(exp(logO(1) α−1 )).
To be fair, it was not Theorem 1.2 directly but a more analytic variant of it that was used
(combined with many other ideas) to prove the inverse U 4 theorem in [GM17b]. However,
we will not discuss that analytical variant here.
The purpose of this note is to improve the bound in Theorem 1.2 to r = logO(1) α−1 . Our
proof is arguably simpler and is obtained only by invoking Theorem 1.1 a few times, without
doing any extra Fourier analysis. The motivation behind this work — other than obtaining
the right form of bound — is to employ this result in a more algebraic framework to obtain
a modular and simpler proof of an inverse U 4 theorem.
One more remark before explaining the result is that Theorem 1.2 generalizes Theorem 1.1
because given a set A ⊂ Fn , one can apply Theorem 1.2 to the set A′ = Fn × A and find
{x} × V ⊂ φw (A′ ) where x is arbitrary, and V a subspace of co-dimension 3r. This implies
V ⊂ 2A − 2A.
Theorem 1.3 (Main theorem). Let A ⊂ Fn × Fn be of density α and let w = hvvhvvvhh.
Then there exists a bilinear variety B ⊂ φw (A) of co-dimension r = O(log80 α−1 ).
2

Note that the choice of the word w in Theorem 1.3 is w = hvvhvvvhh which is slightly
longer than in Theorem 1.2 being hhvvhh. However, for applications this usually does not
matter and any constant length w would do the job. In fact allowing w to be longer is what
enables us to obtain a result with a stronger bound.

1.1

A robust analog of Theorem 1.3

Going back to the theorem of Sanders, there is a more powerful variant of Theorem 1.1
which guarantees that V enjoys a stronger property rather than just being a subset of
2A − 2A. The stronger property is that every element y ∈ V can be written in many ways
as y = a1 + a2 − a3 − a4 , with a1 , a2 , a3 , a4 ∈ A. This stronger property of V has a number
of applications such as obtaining upper bounds for Roth theorem in four variables. We refer
the reader to [SS16] where Theorem 3.2 is similarly obtained from Theorem 1.1 and also for
the noted application.
Theorem 1.4 ([San12, SS16]). Let A ⊂ Fn be a subset of density α. Then there exists a
subspace V ⊂ 2A − 2A of co-dimension O(log4 α−1 ) such that the following holds. Every
y ∈ V can be expressed as y = a1 + a2 − a3 − a4 with a1 , a2 , a3 , a4 ∈ A in at least αO(1) |F|3n
many ways.
In Section 3 we also prove a statistical analog of Theorem 1.4 by slightly modifying the
proof of Theorem 1.3. To explain it, we need just a bit more notation.
Fix an arbitrary (x, y) ∈ Fn × Fn , and note that (x, y) can be written as (x, y) =
φh ((x + x1 , y), (x1, y)) for any x1 ∈ Fn . Moreover, for any fixed x1 , each of the points
(x + x1 , y), (x1 , y) can be written as (x + x1 , y) = φv ((x + x1 , y + y1 ), (x + x1 , y1 )) and
(x1 , y) = φv ((x1 , y + y2 ), (x1 , y2)) for arbitrary y1 , y2 ∈ Fn . So over all, the point (x, y) can
be written using the operation φvh in exactly |Fn |3 many ways, namely, the total number of
two-dimensional parallelograms (x + x1 , y + y1 ), (x + x1 , y1 ), (x1 , y + y2 ), (x1 , y2 ) where (x, y)
is fixed. We can continue this and consider an arbitrary word w ∈ {h, v}k . Then (x, y) can
k
be written using the operation φw in exactly |Fn |2 −1 many ways.
Now, we have a set A ⊂ Fn × Fn and fix a word w ∈ {h, v}k . Define φεw (A) to be the
k
set of all elements (x, y) ∈ Fn × Fn that can be obtained in at least ε|Fn |2 −1 many ways by
applying the operation φw (A).
The following is an extension of Theorem 1.3 similar in spirit to Theorem 1.4.
Theorem 1.5. Let A ⊂ Fn × Fn be of density α and let w = hvvhvvvhh and ε =
exp(−O(log20 α−1 )). Then there exists a bilinear variety B ⊂ φεw (A) of co-dimension
r = O(log80 α−1 ).
As a final comment, we remark that if one keeps track of dependence on the field size in
the proofs, then the bound in Theorem 1.3 and Theorem 1.5 is r = O(log80 α−1 · logO(1) |F|).
Paper organization. We prove Theorem 1.3 in Section 2 and Theorem 1.5 in Section 3.

3

2

Proof of Theorem 1.3

We prove Theorem 1.3 in six steps. It corresponds to applying chain of operators φh ◦ φvv ◦
φh ◦ φv ◦ φvv ◦ φhh to A. In the proof, we invoke Theorem 1.1 (or Theorem 1.4, or the
Freiman-Ruzsa theorem which is a corollary of Theorem 1.1), four times in total, in steps
1,2,4, and 5.
We will assume that A ⊂ Fm × Fn , where initially m = n but where throughout the
proof we update m, n independently when we restrict x or y to large subspaces. It also helps
readability, as we will always have that x and related sets or subspaces are in Fm , while y
and related sets or subspace are in Fn .
We use three variables r1 , r2 , r3 that hold the total number of linear forms on x, linear
forms on y, and bilinear forms on (x, y) that are being fixed throughout the proof, respectively. Initially, r1 = r2 = r3 = 0, but their values will be updated as we go along and at the
end, r = max(r1 , r2 , r3 ) will be the codimension of the final bilinear variety.
Step 1. Decompose A =

S

Ay × {y} with Ay ⊂ Fm . Define A1 := φhh (A), so that
[
(2Ay − 2Ay ) × {y}.
A1 =

y∈Fn

y∈Fn

Let αy denote the density of Ay . By Theorem 1.1, there exists a linear subspace Vy′ ⊂
2Ay − 2Ay of co-dimension O(log4 αy−1 ). Let S := {y : αy ≥ α/2}, where by averaging S has
density ≥ α/2. Note that for every y ∈ S the co-dimension of each Vy′ is O(log4 α−1 ). We
have
[
B 1 :=
Vy′ × {y} ⊂ A1 .
y∈S

Step 2. Consider A2 := φvv (B 1 ). It satisfies
[

A2 =
Vy′1 ∩ Vy′2 ∩ Vy′3 ∩ Vy′4 × {y1 + y2 − y3 − y4 }.
y1 ,y2 ,y3 ,y4 ∈S

By Theorem 1.1, there is a subspace W ′ ⊂ 2S − 2S of co-dimension O(log4 α−1 ). Note that
the co-dimension of W ′ , as well as the co-dimension of each Vy′1 ∩ Vy′2 ∩ Vy′3 ∩ Vy′4 , is at most
O(log4 α−1 ). We thus have
[
B 2 :=
Vy × {y} ⊂ A2 ,
y∈W ′

where Vy = Vy′1 ∩ Vy′2 ∩ Vy′3 ∩ Vy′4 for some y1 , y2 , y3 , y4 ∈ S which satisfy y = y1 + y2 − y3 − y4 .
Update r2 := co-dim(W ′ ), where we restrict y ∈ W ′ . To simplify notations, identify
′
W′ ∼
= Fn−co-dim(W ) and update n := n − co-dim(W ′ ). Thus we assume from now that
[
Vy × {y},
B 2 :=
y∈Fn

where each Vy has co-dimension d = O(log4 α−1 ).
4

Step 3. Consider A3 := φv (B 2 ). It satisfies
[
(Vz ∩ Vy+z ) × {y}.
A3 =
y,z∈Fn

Step 4. Consider A4 := φh (A3 ). It satisfies
[
((Vz ∩ Vy+z ) + (Vw ∩ Vy+w )) × {y}.
A4 =
y,z,w∈Fn

Define Uy := Vy⊥ , so that dim(Uy ) = d and
[

A4 =

((Uz + Uy+z ) ∩ (Uw + Uy+w ))⊥ × {y}.

y,z,w∈Fn

Next, observe that if (Uz + Uy+z )∩(Uw + Uy+w ) = {0} for some z, w, then Fm ×{y} ⊂ A4 .
If this is true for a typical y, then A4 has constant density in Fm × Fn . Our goal is to get to
that situation by fixing a few linear forms on x and bi-linear forms on (x, y).
The following lemma identifies common structure in the subspaces Uy in the case that for
a typical y, z, w, (Uz + Uy+z )∩(Uw + Uy+w ) 6= {0}. We recall that an affine map L : Fn → Fm
is L(y) = My + b where M ∈ Fm×n , b ∈ Fm .
Lemma 2.1. For each y ∈ Fn let Uy ⊂ Fm be a subspace of dimension d. Assume that
Pr

y,z,w∈Fn

1
[(Uz + Uy+z ) ∩ (Uw + Uy+w ) 6= {0}] ≥ .
2

Then there exists an affine function L : Fn → Fm such that
Pr [L(y) ∈ Uy \ {0}] ≥ exp(−O(d4 )).

y∈Fn

To prove Lemma 2.1, we use the Freiman-Ruzsa theorem, being a consequence of Theorem 1.1, which we quote below. We refer the reader to [Gre05] for details on how it is derived
from Theorem 1.1.
Theorem 2.2. Let f : Fn → Fm be a function such that
Pr

y,z,w∈Fn

[f (z) + f (y + z) = f (w) + f (y + w)] ≥ α.

Then there exists an affine map L : Fn → Fm so that
Pr [f (y) = L(y)] ≥ exp(−O(log4 α−1 )).

y∈Fn

5

Proof of Lemma 2.1. First assume that
Pr

y,z,w∈Fn

1
[(Uz \ {0} + Uy+z \ {0}) ∩ (Uw \ {0} + Uy+w \ {0}) 6= {0}] ≥ .
4

(1)

Choose f : Fn → Fm by picking f (y) ∈ Uy \ {0} uniformly and independently for each
y ∈ Fn . Then
Pr n [f (z) + f (y + z) = f (w) + f (y + w)] ≥

y,z,w∈F ,f

1
· |F|−4d .
4

Fix f where the above bound holds. By Theorem 2.2, there exists an affine function L :
Fn → Fm such that
Prn [f (y) = L(y)] ≥ exp(−O(d4 )).
y∈F

This concludes the proof, assuming Equation (1) holds. Otherwise, if Equation (1) does not
hold, then we have
1
Pr n [Uz ∩ (Uw + Uy ) 6= {0}] ≥ .
y,z,w∈F
4
This implies that either
Pr

y,z,w∈Fn

[(Uz \ {0}) ∩ (Uw \ {0} + Uy \ {0}) 6= {0}] ≥

1
8

or that

1
Pr n [(Uz \ {0}) ∩ (Uw \ {0})] ≥ .
y,w∈F
8
In the first case, choose the most popular w, y and then elements of Uw \ {0}, Uy \ {0} to
obtain a constant map L ≡ b that satisfies the lemma. The second case is similar.
Next, we proceed as follows. As long as
Pr

y,z,w∈Fn

1
[(Uz + Uy+z ) ∩ (Uw + Uy+w ) 6= {0}] ≥ ,
2

apply Lemma 2.1 to find an affine function L : Fn → Fm . For each y that satisfies L(y) ∈ Uy
replace Uy with Uy′ = Uy / hL(y)i, which is a subspace of co-dimension 1 in Uy . By Lemma 2.1,
this process needs to stop after t = exp(O(d4)) many steps. Let L1 , . . . , Lt : Fn → Fm be the
affine maps obtained in this process.
We pause for a moment to introduce one useful notation. Given a set of maps F = {fi :
Fn → Fm , i ∈ [k]} and y ∈ Fn , let F (y) = {f1 (y), . . . , fk (y)} ⊂ Fm , and also let F (y) denote
the linear span of F (y).
Using this notation, set F = {L1 , . . . , Lt } and note that F (y) is a subspace of dimension
at most t for each y ∈ Fn . For every subspace Uy there is a set Fy ⊂ F with |Fy | ≤ d such
that the final subspace obtained in the process is Uy /Fy (y). This implies that




1
Pr n Uz /Fz (z) + Uy+z /Fy+z (y + z) ∩ Uw /Fw (w) + Uy+w /Fy+w (y + w) = {0} ≥ .
y,z,w∈F
2
6

Consider the most popular quadruple F1 , F2 , F3 , F4 ⊂ F so that
 −4




t
1
.
Pr n Uz /F1 (z) + Uy+z /F2 (y + z) ∩ Uw /F3 (w) + Uy+w /F4 (y + w) = {0} ≥ ×
y,z,w∈F
2
d

Let L := F1 ∪ F2 ∪ F3 ∪ F4 . Recall that t = exp(O(d4)) so that dt = exp(O(d5)). We have


Pr n (Uz + Uy+z ) ∩ (Uw + Uy+w ) ⊂ L(z) + L(y + z) + L(w) + L(y + w) ≥ exp(−O(d5 )).
y,z,w∈F

By averaging, there is some choice of z, w such that


Prn (Uz + Uy+z ) ∩ (Uw + Uy+w ) ⊂ L(z) + L(y + z) + L(w) + L(y + w) ≥ exp(−O(d5)).
y∈F

Recall that each Li is an affine map and that |L| ≤ 4d. Thus, L(z), L(y+z), L(w), L(y+w) ⊂
L(y) + Q where Q ⊂ Fm is a linear subspace of dimension O(d). We thus have
[
B 4 :=
(L(y) + Q)⊥ × {y} ⊂ A4 ,
y∈T

where T ⊂ Fn has density exp(−O(d5 )).
To simplify the presentation, we would like to assume that the maps in L are linear maps
instead of affine maps, that is, that they do not have a constant term. This can be obtained
by restricting x to the subspace orthogonal to Q and to the constant term in the affine maps
in L. Correspondingly, we update r1 := r1 + dim(Q) + |L| = O(d).
So, from now we assume that L is defined by 4d linear maps, and that
[
⊥
L(y) × {y} ⊂ A4 ,
B 4 :=
y∈T

where T ⊂ Fn has density exp(−O(d5 )).
Step 5. Consider A5 := φvv (B 4 ) so that


[
⊥
⊥
⊥
⊥
L(y1 ) ∩ L(y2 ) ∩ L(y3 ) ∩ L(y4 ) × {y1 + y2 − y3 − y4 }.
A5 =
y1 ,y2 ,y3 ,y4 ∈T

By Theorem 1.1 there exists a subspace W ⊂ 2T −2T with co-dimension O(d20 ). However,
this time, this is not enough for us. We need to use Theorem 1.4 instead. The following
equivalent formulation of Theorem 1.4 will be more convenient for us: there is a subspace
W ⊂ Fn of co-dimension O(log4 α−1 ) such that, for each y ∈ W there is a set Sy ⊂ (Fn )3 of
density αO(1) , for which
∀(a1 , a2 , a3 ) ∈ Sy :

a1 , a2 , a3 , a1 + a2 − a3 − y ∈ A.
7

Apply Theorem 1.4 to the set T to obtain the subspace W and the sets Sy . We have


[
[

⊥

B 5 :=
L(y1 ) + L(y2 ) + L(y3 ) + L(y1 + y2 − y3 − y)  × {y} ⊂ A5 .
y∈W

(y1 ,y2 ,y3 )∈Sy

To simplify the presentation we introduce the notation L(y1 , y2 , y3 ) := L(y1 ) + L(y2 ) + L(y3 ).
Next, observe that for any y, y ′ ∈ Fn , L(y ′) + L(y + y ′ ) ⊂ L(y ′) + L(y). Thus we can simplify
the expression of B 5 to


[
[
⊥

B5 =
L(y1 , y2 , y3 ) + L(y)  × {y},
y∈W

(y1 ,y2 ,y3 )∈Sy

which can be re-written as
B5 =

[

y∈W




[

(y1 ,y2 ,y3 )∈Sy



⊥
L(y1 , y2 , y3 )⊥ ∩ L(y)  × {y}.

Step 6. Consider A6 := φh (B 5 ). It satisfies

A6 =

[ 



y∈W

[

(y1 ,y2 ,y3 )∈Sy
(y1′ ,y2′ ,y3′ )∈Sy






⊥
 × {y}
∩
L(y1 , y2 , y3 )⊥ + L(y1′ , y2′ , y3′ )⊥ 
L(y)



In order to complete the proof, we will find a large subspace V such that for every y ∈ W ,
[
L(y1 , y2 , y3)⊥ + L(y1′ , y2′ , y3′ )⊥ .
V ⊂
(y1 ,y2 ,y3 )∈Sy
(y1′ ,y2′ ,y3′ )∈Sy

In fact, we will prove something stronger: there is a large subspace V such that for each
y ∈ W , there is a choice of (y1 , y2 , y3), (y1′ , y2′ , y3′ ) ∈ Sy for which
V ⊂ L(y1 , y2, y3 )⊥ + L(y1′ , y2′ , y3′ )⊥ .
The following lemma is key. Given a set L of linear maps from Fn to Fm , let dim(L)
denote the dimension of linear span of L as a vector space over F.
Lemma 2.3. Fix δ > 0. Let L be a set of linear maps from Fn to Fm with dim(L) = k.
Then there is a subspace V ⊂ Fm of co-dimension at most (k + 1)2 log δ −1 such that the
following holds. For every subset S ⊂ Fn of density at least δ, at least half the pairs y, y ′ ∈ S
satisfy that
V ⊂ L(y)⊥ + L(y ′ )⊥ .
8

Proof. The proof is by induction on dim(L). Consider first the base case of dim(L) = 1.
Take some M ∈ L \ {0}. If rank(M) ≤ log δ −1 + 3, then set V = Im(M)⊥ and notice that
Im(M)⊥ ⊂ L(y)⊥ for any y ∈ Fn . Otherwise do as follows. Fix arbitrary L, L′ ∈ L \ {0} and
observe that
−1
Pr
[L(y) = L′ (y ′)] ≤ |F|−(log δ +3) δ −1 .
′
y,y ∈S

By applying the union bound over all pairs of L, L′ ∈ L \ {0}, we obtain that

1
−1
L(y) ∩ L(y ′) 6= {0} ≤ |F|2 |F|−(log δ +3) δ −1 ≤ .
y,y ∈S
2
m
The claim then holds for V = F .
Now suppose dim(L) = k. Again, if there is some M ∈ L \ {0} with rank at most
2k + log δ −1 + 1, then project every map down to Im(M)⊥ . That is, consider the new family
of maps
L′ = {ProjIm(M )⊥ L : L ∈ L}.
Pr
′



Note that L′ has dimension k − 1 and so by induction hypothesis, there exists a subspace V ′
of co-dimension at most k 2 log δ −1 such that, for at least half the pairs y, y ′ ∈ S it holds that
V ′ ⊂ L′ (y)⊥ + L′ (y ′ )⊥ .
The claim then holds for V = V ′ ∩ Im(M)⊥ .
Otherwise, similar to the base case, observe that


1
−1
−1
L(y) ∩ L(y ′) 6= {0} ≤ |L|2 |F|−(2k+log δ +1) δ −1 ≤ |F|2k |F|−(2k+log δ +1) δ −1 ≤ .
y,y ∈S
2
Pr
′

In this case the claim holds for V = Fm .

We note that for Theorem 1.3 we only need a weaker form of Lemma 2.3, which states
that at least one pair y, y ′ ∈ S exists; however, we would need the stronger version for
Theorem 1.5.
We apply Lemma 2.3 as follows. Define a new family of linear maps L∗ from F3n to Fm
as follows. For each L ∈ L define three linear maps Li , i ∈ {1, 2, 3} by:
Li : (Fn )3 → Fm , Li (y1 , y2, y3 ) = L(yi )
and let
L∗ := {Li : L ∈ L, i ∈ [3]}.
Apply Lemma 2.3 to the family L∗ with δ = exp(−O(d5 )) and obtain a subspace V ⊂ Fm
of codimension O(d2 log(exp(−O(d5))) = O(d7 ) so that, for every Sy ⊂ (Fn )3 with y ∈ W ,
there exist (y1 , y2 , y3 ), (y1′ , y2′ , y3′ ) ∈ Sy for which
V ⊂ L∗ ((y1 , y2, y3 ))⊥ + L∗ ((y1′ , y2′ , y3′ ))⊥ .
9

This directly implies that
V ⊂ L(y1 , y2, y3 )⊥ + L(y1′ , y2′ , y3′ )⊥ .
Define
B 6 :=

[ 

⊥

V ∩ L(y)

y∈W



× {y} ⊂ A6 .

Observe that B 6 is a bilinear variety defined by co-dim(V ) linear equations on x, co-dim(W )
linear equations on y and |L| bilinear equations on (x, y).
To complete the proof we calculate the quantitative bounds obtained. We have d =
O(log4 α−1 ) where α was the density of the original set A, and
r1 = O(d) + co-dim(V ) = O(d7 ),
r2 = O(d) + co-dim(W ) = O(d20 ),
r3 = |L| = O(d).
Together these give the final bound of r = max(r1 , r2 , r3 ) = O(log80 α−1 ).

3

Proof of Theorem 1.5

In this section we prove Theorem 1.5 by slightly modifying the proof of Theorem 1.3. We
point out the necessary modifications to proof of Theorem 1.3.
Step 1. In this step, we use Theorem 1.4 instead of Theorem 1.1 and directly obtain
B 1 ⊂ φεhh1 (A)

(2)

for ε1 = αO(1) .
Step 2. Similarly in this step as well, using Theorem 1.4 instead of Theorem 1.1 gives
B 2 ⊂ φεvv2 (B 1 )

(3)

O(1)
with
. To recall, we assume for simplicity of exposition from now on that B 2 =
S ε2 = α
y∈Fn Vy × {y}.

Steps 3 and 4. This step is slightly different than steps 1 and 2. Here, we are not able
to directly produce some set B 4 that would satisfy B 4 ⊂ φεhv4 (B 2 ). But what we can do is to
apply the remaining operation φhvvhv altogether to B 2 and obtain the final bilinear structure
B 6 that satisfies what we want, which is
6
B 6 ⊂ φεhvvhv
(B 2 )

10

(4)

for ε6 = exp(−poly log α−1 ). Combining Equations (2) to (4) gives
B 6 ⊂ φεhvvhvvvhh (A)
for ε = exp(−poly log α−1 ).
We establish Equation (4) in the rest of the proof. Recall that previously we showed that
the following holds: there is a set of affine maps L, with |L| = O(d), such that


⊥


⊥
⊥
⊥
⊥
Pr n L(z) + L(y + z) + L(w) + L(y + w) ⊂ Vz ∩ Vy+z + Vw ∩ Vy+w ≥ exp(−O(d5 ))

y,w,z∈F

and consequently


⊥


⊥
⊥
⊥
⊥
Pr n L(y) + L(z) + L(w) ⊂ Vz ∩ Vy+z + Vw ∩ Vy+w ≥ exp(−O(d5 )).
y,w,z∈F

Remember that d = O(log4 α−1 ). Furthermore, we may assume the maps in L are linear
(instead of affine) after we update r1 := r1 + |L| = O(d).
Then what we did in the proof of Theorem 1.3 was to fix one popular choice of w, z.
However, here we can’t do that, as we need many pairs of w, z. Let T be the set of y’s that
satisfy


⊥


⊥
⊥
⊥
⊥
Pr n L(y) + L(z) + L(w) ⊂ Vz ∩ Vy+z + Vw ∩ Vy+w ≥ exp(−O(d5 )),
(5)
w,z∈F

and so T has density exp(−O(d5 )). We deduce something stronger from Equation (5) but
we need to introduce some notation first.
For A, B ⊂ Fn let A −η B denote the set of all elements c ∈ A − B that can be written
in at least η|Fn | many ways as c = a − b for a ∈ A, b ∈ B. To use this notation, note that if
A, B are two subspaces of co-dimension k, then A − B = A −η B for η = exp(−O(k)). This
is because every element c ∈ A − B can be written as c = (a + v) − (b + v) where v is an
arbitrary element in the subspace A ∩ B of codimension at most 2k. So we can improve the
Equation (5) to


⊥


⊥
⊥
⊥
⊥
Pr n L(y) + L(z) + L(w) ⊂ Vz ∩ Vy+z −η Vw ∩ Vy+w ≥ exp(−O(d5 )),
(6)
w,z∈F

for η = exp (−O(d))

Step 5. Similar to before, consider the subspace W ⊂ 2T − 2T of co-dimension O(d20 )
that is given by Theorem 1.4. This subspace W has the following property: fix arbitrary
y ∈ W . Sample y1 , y2, y3 ∈ Fn uniformly and independently, and set y4 = −y + y1 + y2 − y3 .
Then with probability at least exp(−O(d5 )) we have y1 , y2 , y3, y4 ∈ T . This means that if
we furthermore sample w1 , w2 , w3 , w4, z1 , z2 , z3 , z4 ∈ Fn uniformly and independently, then,
with probability at least exp(−O(d5 )), the following four equations simultaneously hold:
⊥


L(yi ) + L(zi ) + L(wi ) ⊂ Vz⊥i ∩ Vy⊥i +zi −η Vw⊥i ∩ Vy⊥i +wi
∀i = 1, . . . , 4.
11

By computing the intersection of the left hand sides and the right hand sides we obtain that
with probability at least exp(−O(d5 )), it holds that
L(y) +

3
X
i=1

L(yi ) +

4
X

L(zi ) +

i=1

4
X

L(wi )

i=1

!⊥

⊂

4
\

i=1



Vz⊥i ∩ Vy⊥i +zi −η Vw⊥i ∩ Vy⊥i +wi . (7)

For a given y ∈ Fn , s = (y1 , y2 , y3, w1 , w2 , w3 , w4 , z1 , z2 , z3 , z4 ) ∈ (Fn )11 , let
Vy,s =

4
\



Vz⊥i ∩ Vy⊥i +zi −η Vw⊥i ∩ Vy⊥i +wi ,

i=1

where to recall y4 = −y + y1 + y2 − y3 . Observe that for any s,
[
Vy,s × {y} ⊂ φvvhv (B 2 ).
y∈W

We rewrite Equation (7) more compactly as
h
i
⊥
Pr L(y) + L(s) ⊂ Vy,s ≥ exp(−O(d5)),
s

where we use the notation L(s) =

P3

i=1

L(yi ) +

P4

i=1

L(zi ) +

P4

i=1

(8)

L(wi ).

Step 6. Now we consider applying the operation hvvhv altogether to B 2 . Only the last
operation h remains to be applied, which after doing so, we will find a subspace V ⊂ Fm
of co-dimension O(d7 ) that satisfies the following: for any y ∈ W , choose s1 , s2 ∈ (Fn )11
uniformly and randomly. Then with probability exp(−O(d5)),
V ∩ L(y)⊥ ⊂ Vy,s1 −η Vy,s2 .
where to recall η = exp(−O(d)).
To do so, fix y ∈ W and let Sy be the set of all tuples s =
(y1 , y2 , y3, w1 , w2 , w3 , w4 , z1 , z2 , z3 , z4 ) ∈ (Fn )11 that satisfy Equation (8). Note that the density of each Sy is at least exp(−O(d5)). To simplify notation denote s = (s1 , . . . , s11 ). We
call up Lemma 2.3 in a similar way as we did before. Define a family L∗ of linear maps,
containing linear maps Li for each L ∈ L and i = 1, . . . , 11, where
Li : (Fn )11 → Fm , Li (s) = L(si ).
Apply Lemma 2.3 to L∗ and density parameter exp(−O(d5 )). So, we obtain a subspace
V ⊂ Fm of co-dimension O(d7 ) such that for each y ∈ W ,
Pr

s1 ,s2 ∈Sy



 1
V ⊂ L(s1 )⊥ + L(s2 )⊥ ≥ ,
2
12

(9)

which implies
Pr n

s1 ,s2 ∈(F )11




V ∩ L(y)⊥ ⊂ Vy,s1 −η Vy,s2 ≥ exp(−O(d5)).

(10)

Define the final bilinear structure as


[ 
⊥
V ∩ L(y) × {y}.

B 6 :=

y∈W

It satisfies
6
B 6 ⊂ φεhvvhv
(B 2 )

for ε6 = exp(−O(d5 )) and so over all
B 6 ⊂ φεhvvhvvvhh (A)
for ε = exp(−O(d5 )).

References
[BL17]

Pierre-Yves Bienvenu and Thái Hoàng Lê. A bilinear Bogolyubov theorem. arXiv
preprint arXiv:1711.05349, 2017.

[GM17a] WT Gowers and Luka Milićević. A bilinear version of Bogolyubov’s theorem. arXiv
preprint arXiv:1712.00248, 2017.
[GM17b] WT Gowers and Luka Milićević. A quantitative inverse theorem for the U 4 norm
over finite fields. arXiv preprint arXiv:1712.00241, 2017.
[Gre05]

B Green. Notes on the polynomial Freiman-Ruzsa conjecture. preprint, 2005.
http://people.maths.ox.ac.uk/greenbj/papers/PFR.pdf.

[GT08]

Ben Green and Terence Tao. An inverse theorem for the Gowers U 3 norm. Proceedings of the Edinburgh Mathematical Society, 51(1):73–153, 2008.

[GT10]

Ben Green and Terence Tao. An equivalence between inverse sumset theorems and
inverse conjectures for the U 3 norm. In Mathematical Proceedings of the Cambridge
Philosophical Society, volume 149, pages 1–19. Cambridge University Press, 2010.

[Lov12]

Shachar Lovett. Equivalence of polynomial conjectures in additive combinatorics.
Combinatorica, 32(5):607–618, 2012.

[Sam07] Alex Samorodnitsky. Low-degree tests at large distances. In Proceedings of the
thirty-ninth annual ACM symposium on Theory of computing, pages 506–515.
ACM, 2007.
[San12]

Tom Sanders. On the Bogolyubov-Ruzsa lemma. Analysis & PDE, 5(3):627–655,
2012.
13

[SS16]

Tomasz Schoen and Olof Sisask. Roth’s theorem for four variables and additive
structures in sums of sparse sets. In Forum of Mathematics, Sigma, volume 4.
Cambridge University Press, 2016.

14

