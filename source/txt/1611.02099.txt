Hereditary quasirandomness without regularity

arXiv:1611.02099v2 [math.CO] 22 Dec 2016

David Conlonâˆ—

Jacob Foxâ€ 

Benny Sudakovâ€¡

Abstract
A result of Simonovits and SoÌs states that for any ï¬xed graph H and any Ç« > 0 there exists
Î´ > 0 such that if G is an n-vertex graph with the property that every S âŠ† V (G) contains
pe(H) |S|v(H) Â± Î´nv(H) labeled copies of H, then G is quasirandom in the sense that every S âŠ† V (G)
contains 12 p|S|2 Â± Ç«n2 edges. The original proof of this result makes heavy use of the regularity
lemma, resulting in a bound on Î´ âˆ’1 which is a tower of twos of height polynomial in Ç«âˆ’1 . We
give an alternative proof of this theorem which avoids the regularity lemma and shows that Î´ may
be taken to be linear in Ç« when H is a clique and polynomial in Ç« for general H. This answers a
problem raised by Simonovits and SoÌs.

1

Introduction

What does it mean to say that a graph is random-like and how does one construct such graphs?
Attempts to answer these questions have played a central role in mathematics over the last forty
years, with connections to combinatorics, probability, number theory, theoretical computer science
and more (see, for example, [8, 12]).
For dense graphs, there is a somewhat surprising answer to the ï¬rst question, in that many of the
possible deï¬nitions for what it means to be random-like turn out to be equivalent, a fact ï¬rst observed
by Chung, Graham and Wilson [1], building on earlier work of Thomason [24, 25]. To be more precise,
let H be a ï¬xed graph with r vertices and m edges, 0 < p < 1 a ï¬xed constant and G an n-vertex
graph. Consider the following properties that G might have:
PH,p (Ç«): The number of labeled copies of H in G is within Ç«nr of pm nr .
âˆ— (Ç«): For every subset S âŠ† V (G), the number of labeled copies of H in the induced subgraph
PH,p
G[S] is within Ç«nr of pm |S|r .

The property PH,p asks that the number of copies of H in G is close to what one would expect in the
âˆ—
binomial random graph G(n, p), while the hereditary property PH,p
asks for a more robust version of
this condition, saying that the copies of H are also uniformly distributed in G, again just as one would
expect in G(n, p).
âˆ—

Mathematical Institute, Oxford OX2 6GG, United Kingdom. Email: david.conlon@maths.ox.ac.uk. Research
supported by a Royal Society University Research Fellowship and by ERC Starting Grant 676632.
â€ 
Department of Mathematics, Stanford University, Stanford, CA 94305. Email: jacobfox@stanford.edu. Research
supported by a Packard Fellowship, by NSF Career Award DMS-1352121 and by an Alfred P. Sloan Fellowship.
â€¡
Department of Mathematics, ETH, 8092 Zurich, Switzerland. Email: benjamin.sudakov@math.ethz.ch. Research
supported by SNSF grant 200021-149111.

1

A sequence of graphs (Gn )âˆ
n=1 with |Gn | = n is said to be p-quasirandom if it satisï¬es the property
âˆ— (Ç«) with Ç« = o(1), where, here and throughout the paper, we write P
âˆ—
P2,p
r,p and Pr,p for PH,p and
âˆ—
PH,p
when H is the complete graph Kr . That is, a sequence of graphs is p-quasirandom if the density
of Gn is asymptotic to p and the edges are uniformly distributed across subsets. Of the equivalent
formulations discovered by Chung, Graham and Wilson [1], the most striking is perhaps the following.
Theorem (Chungâ€“Grahamâ€“Wilson). For any Ç« > 0, there exists Î´ > 0 such that
âˆ— (Ç«);
(a) if a graph satisfies P2,p (Î´) and PC4 ,p (Î´), then it also satisfies P2,p
âˆ— (Î´), then it also satisfies P (Ç«) and P
(b) if a graph satisfies P2,p
2,p
C4 ,p (Ç«).

It follows from part (a) that if the number of edges and the number of cycles of length four in a sequence
of graphs (Gn )âˆ
n=1 are both asymptotic to their expected values in the random graph G(n, p), then the
sequence is p-quasirandom. What is striking about this conclusion is that a purely global property,
that of having certain counts of edges and cycles of length four, is suï¬ƒcient to imply a local property
about the distribution of edges on small subsets. Moreover, by part (b), the converse also holds.
A similar result is conjectured [4, 21] to hold when C4 is replaced by any bipartite graph H with at
least one cycle. Known as the forcing conjecture, this conclusion is now known to hold for a wide range
of bipartite graphs, with progress on the conjecture closely paralleling recent progress [4, 5, 11, 14, 22]
on Sidorenkoâ€™s conjecture. On the other hand, part (a) does not hold when C4 is replaced by a nonbipartite H. To see this for triangles, consider the graph G on n vertices consisting of four disjoint sets
V1 , V2 , V3 and V4 , each of order n/4, with V1 and V2 complete, V3 and V4 empty, a complete bipartite
graph between V3 and V4 and a random bipartite graph with edge probability 1/2 between V1 âˆª V2 and
V3 âˆª V4 . This graph has density 1/2 and asymptotically n3 /8 labeled triangles. However, it is clearly
not 1/2-quasirandom.
A key result about quasirandom graphs, proved by Simonovits and SoÌs [20], says that such counterexamples can be avoided if we strengthen our assumption, asking that G satisï¬es the hereditary property
âˆ—
PH,p
rather than just PH,p . That is, a sequence of graphs (Gn )âˆ
n=1 with |Gn | = n is p-quasirandom
if every subset S âŠ† V (Gn ) contains roughly the same number of copies of H as one would expect to
ï¬nd in G(n, p).
âˆ— (Î´),
Theorem (Simonovitsâ€“SoÌs). For any Ç« > 0, there exists Î´ > 0 such that if a graph satisfies PH,p
âˆ—
then it also satisfies P2,p (Ç«).

The original proof of this result makes heavy use of the regularity lemma [23], resulting in a bound
on Î´âˆ’1 which is a tower of twos of height polynomial in Ç«âˆ’1 . The main aim of this paper is to give an
alternative proof of this theorem which avoids the use of the regularity lemma, giving a much better
bound for Î´ in terms of Ç«. This answers a problem raised by Simonovits and SoÌs in their paper. In
reality, we prove two theorems, the ï¬rst showing that Î´ may be taken to be linear in Ç« when H is
a clique, a result which is clearly optimal (consider the random graph with density p + Ç«), and the
second showing that Î´ may be taken to be polynomial in Ç« for general H.
Theorem 1.1. For every natural number r â‰¥ 3, there is a constant c(r) such that if p and Ç« are
constants with 0 < Ç«, p < 1 and n is sufficiently large depending on r, p and Ç«, then any n-vertex graph
âˆ— (Î´) with Î´ = c(r)p2r 2 Ç« also satisfies P âˆ— (Ç«).
G that satisfies Pr,p
2,p

2

Theorem 1.2. For every 0 < p < 1 and natural number r â‰¥ 3, there are constants c = c(p, r) and
âˆ— (Î´) with
câ€² (p, r) such that if H is a graph with r vertices, 0 < Ç« < 1/2 and a graph G satisfies PH,p
âˆ— (Ç«).
Î´ = câ€² (p, r)Ç«c(p,r) , then it also satisfies P2,p
We note that another alternative proof for a variant of the Simonovitsâ€“SoÌs theorem, also avoiding
regularity, was found independently by Reiher and Schacht [18]. However, their result uses slightly
stronger assumptions and gives weaker quantitative control than ours. As well as being interesting in
its own right, our close attention to quantitative aspects was motivated by the possibility of application
in extremal combinatorics. Indeed, the best bounds for a number of well-known theorems in this area,
including Ramseyâ€™s theorem [2] and SzemereÌdiâ€™s theorem [7], rely crucially on the interplay between
diï¬€erent notions of quasirandomness. Our results bring the Simonovitsâ€“SoÌs theorem into a range
where it could also be proï¬tably applied in this manner.
The rest of the paper will be laid out as follows: we study complete graphs in the next section,
proving Theorem 1.1; we treat the general case in Section 3, proving Theorem 1.2; and we conclude
with some further remarks and open problems in Section 4. For the sake of clarity of presentation, we
systematically omit ï¬‚oor and ceiling signs whenever they are not crucial.

2

Complete graphs

In this section, we prove Theorem 1.1. We will need several lemmas about graphs G that satisfy
âˆ— (Î´), the ï¬rst of which estimates the number of r-cliques with exactly i vertices in one set X and
Pr,p
r âˆ’ i vertices in another set Y . The proof draws on ideas used by Shapira [19] when studying a
related problem. Here and throughout this section, we will use big O notation, allowing the hidden
constants to depend on the clique size r but not on the edge density p. In keeping with the statement
of Theorem 1.1, we will always assume that n is taken suï¬ƒciently large.
âˆ— (Î´). Then, for all disjoint subsets X, Y of
Lemma 2.1. Let G be an n-vertex graph that satisfies Pr,p
V (G), the number of labeled r-cliques with exactly i vertices in X and r âˆ’ i vertices in Y deviates from
r  (r2)
|X|i |Y |râˆ’i by at most O(Î´nr ).
i p

 r
Proof. Let xi = ri p(2) |X|i |Y |râˆ’i and let xâ€²i be the number of labeled r-cliques with exactly i vertices
in X and r âˆ’ i vertices in Y . Pick a random subset X â€² âŠ† X of order q|X|. The expected number of
P
labeled cliques of order r in X â€² âˆª Y is (up to lower order terms) i q i xâ€²i and this deviates from
 
X
X
r
r
i (r2) r
(
)
2
p (q|X| + |Y |) =
qp
|X|i |Y |râˆ’i =
q i xi
i
i

i

by at most O(Î´nr ).
For j = 1, 2, . . . , r + 1, let qj = j/(r + 1) and let A be the (r + 1) Ã— (r + 1) matrix with aji = qji .
The matrix A is not singular, since it is a Vandermonde matrix and the qj are distinct. Let a be a
maximum in absolute value entry of Aâˆ’1 , noting that this depends only on r. Let x = (x0 , x1 , . . . , xr )
and xâ€² = (xâ€²0 , xâ€²1 , . . . , xâ€²r ). By the above discussion, we know that the coordinates of the vectors z = Ax
and z â€² = Axâ€² diï¬€er by at most O(Î´nr ). Since x âˆ’ xâ€² = Aâˆ’1 (z âˆ’ z â€² ), it follows that the coordinates of
the vectors x and xâ€² diï¬€er by at most O(r Â· |a| Â· Î´nr ) = O(Î´nr ), completing the proof.
âœ·

3

We will need a corollary of this lemma saying that for any subset U âŠ† V (G), most u âˆˆ U are
contained in approximately the same number of r-cliques in U . The following deï¬nition helps capture
this condition.
Definition. Given a subset U âŠ† V (G) and a vertex u âˆˆ U , let cU (u) denote the number of r-cliques


r
in U containing u and discU (u) = cU (u) âˆ’ p(2) |U |râˆ’1 /(r âˆ’ 1)!.
P
r
âˆ— (Î´). Then
Corollary 2.1. Let G be an n-vertex graph that satisfies Pr,p
uâˆˆU discU (u) = O(Î´n ).

Proof. Partition U into two sets U â€² , U â€²â€² such that U â€² is the set of all vertices u âˆˆ U satisfying cU (u) â‰¥
r
P
P
P
P
P
p(2) |U |râˆ’1 /(r âˆ’ 1)!. Then we can write uâˆˆU discU (u) = 1 + 2 , where 1 = uâˆˆU â€² cU (u) âˆ’

r
P
P
(r) râˆ’1 /(r âˆ’ 1)!. Note that P can be written
p(2) |U |râˆ’1 /(r âˆ’ 1)! and
=âˆ’
â€²â€² c (u) âˆ’ p 2 |U |
2

uâˆˆU

U

1

as a sum of r terms, each estimating the deviation of i times the number of r-cliques in G[U ] with
exactly i vertices in U â€² and r âˆ’ i vertices in U â€²â€² . By Lemma 2.1, all these terms are bounded by O(Î´nr )
P
P
âœ·
and, therefore, 1 = O(Î´nr ). A similar argument shows that 2 = O(Î´nr ).
Definition. Given two vertices u, v âˆˆ V (G), let c(u, v) denote the number of subsets S âŠ‚ V (G) of
order r âˆ’ 1 such that both {u} âˆª S and {v} âˆª S form an r-clique in G and write


r


râˆ’1
(
)
2
disc(u, v) = c(u, v) âˆ’ p d (v)/(r âˆ’ 1)! ,

where d(v) is the order of the neighborhood of v.

Note that by deï¬nition c(u, v) = c(v, u). Therefore, by the triangle inequality, we have

r 
disc(u, v) + disc(v, u) â‰¥ p(2) drâˆ’1 (v) âˆ’ drâˆ’1 (u)/(r âˆ’ 1)! .

Using this inequality, we can prove the following lemma which shows that most pairs of vertices in G
have comparable degree.
âˆ— (Î´). Then
Lemma 2.2. Let G be an n-vertex graph that satisfies Pr,p
X
r
|drâˆ’1 (v) âˆ’ drâˆ’1 (u)| = O(pâˆ’(2) Î´nr+1 ).
u,vâˆˆV (G)

Proof. By the above discussion, we have that
XX
X

r X 
drâˆ’1 (v) âˆ’ drâˆ’1 (u)/(r âˆ’ 1)! .
disc(v, u) =
(disc(u, v) + disc(v, u)) â‰¥ p(2)
u v6=u

{u,v}

{u,v}

Therefore, to prove the statement, it is enough to show that

P

v6=u

disc(v, u) = O(Î´nr ) for each u.

Let U be the set of neighbors of u in G and let W be the complement of U . Partition W further
r
into W â€² , W â€²â€² , where W â€² is the set of all vertices v such that c(v, u) â‰¥ p(2) drâˆ’1 (u)/(r âˆ’ 1)!. Then

r
P
P
P
P
P
P
we can write v6=u disc(v, u) = 1 + 2 + 3 , where 1 = vâˆˆW â€² c(v, u) âˆ’ p(2) drâˆ’1 (u)/(r âˆ’ 1)! ,
P
P
(r2) drâˆ’1 (u)/(r âˆ’ 1)! and P = P
2 = âˆ’
vâˆˆW â€²â€² c(v, u) âˆ’ p
3
vâˆˆU discU (v). The ï¬rst (resp., second)
sum estimates the deviation of the number of r-cliques with one vertex in W â€² (resp., W â€²â€² ) and the
remaining r âˆ’ 1 vertices in U . Thus, by Lemma 2.1, it is bounded by O(Î´nr ). The third sum is
bounded by O(Î´nr ) by Corollary 2.1.
âœ·
4

We also need an elementary inequality, which follows as an easy corollary of the next result.
Proposition 2.1. Let a1 , . . . , an and b1 , . . . , bn be two sets of n non-negative numbers. Then, for any
positive integer s,
X
X
X
X
|bsj âˆ’ asi | â‰¥ n
bsj âˆ’
bjsâˆ’1 Â·
ai .
i,j

j

j

i

Proof. This follows since
X
X
X
|bsj âˆ’ asi | =
|bj âˆ’ ai ||bjsâˆ’1 + Â· Â· Â· + aisâˆ’1 | â‰¥
|bj âˆ’ ai |bjsâˆ’1
i,j

i,j

i,j

X
X
X
X
â‰¥
(bj âˆ’ ai )bjsâˆ’1 = n
bsj âˆ’
bjsâˆ’1 Â·
ai ,
i,j

j

j

i

where in both inequalities we used the fact that the ai and bj are non-negative and in the second
inequality we also used the reverse triangle inequality |x âˆ’ y| â‰¥ |x| âˆ’ |y|.
âœ·
Corollary 2.2. Let a1 , . . . , an and b1 , . . . , bn be two sets of n non-negative numbers. Then, for any
P
P
P
P
positive integer s, i,j |bsj âˆ’ asi | â‰¥ j bjsâˆ’1 Â· ( j bj âˆ’ i ai ).

Proof. Applying Jensenâ€™s inequality twice, ï¬rst with the function xs/(sâˆ’1) and then with the function
s/(sâˆ’1)
1/(sâˆ’1)
 P
 P
P
P
xsâˆ’1 , we obtain that n1 j bsj â‰¥ n1 j bjsâˆ’1
and n1 j bjsâˆ’1
â‰¥ n1 j bj . Therefore,
1 P sâˆ’1 1 P
1 P s
Â· n j bj . Together with Proposition 2.1, this proves the corollary.
âœ·
j bj â‰¥ n
j bj
n

âˆ— (Î³), then it
We now consider a converse to our intended theorem, saying that if a graph satisï¬es P2,p
âˆ— (r 2 Î³). Versions of this counting lemma already appear in the literature, for example,
also satisï¬es Pr,p
in Section 10.5 of LovaÌszâ€™ book on graph limits [16]. However, because this result is central to our
estimates and not as well known as it should be, we include the proof.
âˆ— (Î³), then it also satisfies P âˆ— (r 2 Î³).
Lemma 2.3. If a graph G satisfies P2,p
r,p

P
Proof. Given S, T âŠ† V (G), write e(S, T ) = sâˆˆS,tâˆˆT 1G (s, t), where 1G is the indicator function for
edges of G. In particular, when S = T , this counts the number of labeled edges in S. By assumption,
e(S, S) = p|S|2 Â± Î³n2 for all S âŠ† V (G). Therefore, using the identity
2e(S, T ) = e(S âˆª T, S âˆª T ) + e(S âˆ© T, S âˆ© T ) âˆ’ e(S \ T, S \ T ) âˆ’ e(T \ S, T \ S),
we see that e(S, T ) = p|S||T | Â± 2Î³n2 for all S, T âŠ† V (G). Rewriting this conclusion, we see that
X
|
(1G (s, t) âˆ’ p)| â‰¤ 2Î³n2
sâˆˆS,tâˆˆT

for all S, T âŠ† V (G). In turn, this implies that for any functions u, v : V (G) â†’ [0, 1],
X
|
(1G (x, y) âˆ’ p)u(x)v(y)| â‰¤ 2Î³n2 .
x,yâˆˆV (G)

Indeed, since the function we wish to estimate is linear in u(x) and v(y) for each x and y, the value
of the function is maximised when u and v take values in {0, 1}. In this case, u and v correspond to
indicator functions, so the inequality reduces to the previous special case.
5

For ease of notation, we spell out the rest of the proof for the case of triangles. By telescoping, the
deviation between the number of labeled triangles in a set S âŠ† V (G) and its expected value is
X
X
(1G (x,y)1G (y, z)1G (z, x) âˆ’ p3 ) =
(1G (x, y) âˆ’ p)1G (y, z)1G (z, x)+
x,y,zâˆˆS

x,y,zâˆˆS

X

p(1G (y, z) âˆ’ p)1G (z, x) +

x,y,zâˆˆS

X

p2 (1G (z, x) âˆ’ p).

x,y,zâˆˆS

Each term on the right-hand side of this equation may be written as a sum over terms of the form
P
that the deviation we
x,yâˆˆV (G) (1G (x, y) âˆ’ p)u(x)v(y) for some appropriate u and v, thus implying

r
are interested in is at most 6Î³n3 . In general,
we
will
be
telescoping
over
terms,
one for each edge
2
r
r
2
r
in Kr , so the resulting deviation is 2 2Î³n â‰¤ r Î³n , as required.
âœ·

We will also use some simple ingredients from other papers. The ï¬rst, taken from a paper of ErdoÌ‹s,
Goldberg, Pach and Spencer [6], says that if an n-vertex graph contains a set which deviates from the
expected density, then there is also a set of order n/2 which deviates from this density.

Lemma 2.4.
density q. If there is a subset S âŠ† V (G) for which
 Let G be an n-vertex graph of

â€² of order n/2 such that |e(S â€² ) âˆ’ q |S â€² | | â‰¥ 1 + o(1) D.
|
â‰¥
D,
then
there
exists
a
set
S
|e(S) âˆ’ q |S|
2
2
4

We also need a special case of the Kruskalâ€“Katona theorem [10, 13] giving an upper bound for the
number of r-cliques in a graph with given density. The result we use is given as Exercise 31b in
Chapter 13 of LovaÌszâ€™ problem book [15]. Here the binomial coeï¬ƒcient xr is extended to all real x in
the obvious way.

Lemma 2.5. Let râ‰¥ 3 be an integer and x â‰¥ r a real number. Then a graph with exactly x2 edges
contains at most xr cliques of order r.
Finally, we need the standard Azumaâ€“Hoeï¬€ding inequality, which we apply in the following form (see
Corollary 2.27 in [9]).

Lemma 2.6. Given positive real numbers Î», c1 , . . . , ck , let f : {0, 1}k â†’ R be a function satisfying the
following Lipschitz condition: whenever two vectors z, z â€² âˆˆ {0, 1}k differ only in the ith coordinate,
|f (z)âˆ’f (z â€² )| â‰¤ ci . Then, if X1 , . . . , Xk are independent random variables, each taking values in {0, 1},
the random variable Y = f (X1 , . . . , Xk ) satisfies


Î»2
P
.
P[|Y âˆ’ E[Y ]| â‰¥ Î»] â‰¤ 2 exp âˆ’
2 i c2i

We are now ready to prove Theorem 1.1. We will do this by showing that if a suï¬ƒciently large graph
âˆ— (Î´), then it also satisï¬es P âˆ— (Ç«) with Ç« = O(pâˆ’2r 2 Î´).
G satisï¬es Pr,p
2,p
Proof of Theorem
1.1: Let G be an n-vertex graph satisfying the assertion of the theorem and
n
let q = e(G)/ 2 be the edge density of G. By the Kruskalâ€“Katona theorem, Lemma 2.5, G contains
r
O(q r/2 nr ) labeled r-cliques. Since the number of labeled r-cliques in G is also at least 1 p(2) nr , this
2

implies that q = â„¦(prâˆ’1 ).
r
âˆ— (Î³), then
Let Î³ = cq âˆ’(râˆ’2) pâˆ’(2) Î´ for some constant c which we choose later. If G does not satisfy P2,q

2
it contains a subset of vertices S such that e(S) deviates from q |S|
2 by at least Î³n . Using Lemma 2.4,
6

we can assume that S has order n/2, allowing for the possibility that Î³ may change by a small constant
factor.
Let A be a random subset of G, obtained by choosing every vertex independently with probability
1/2. Let X = S âˆ© A and let Y be a random subset of G \ A, obtained by further choosing every vertex
with probability 1/2. By linearity, the expected number of vertices in X is n/4 and the expected
number of edges in X is e(S)/4. Moreover, both of these quantities are highly concentrated by the
Azumaâ€“Hoeï¬€ding inequality. Indeed, changing the choice for one vertex can change the number of
vertices in X by at most one and the number of edges by at most n, so the sum of squares of these
changes is at most O(n) for the number of vertices and O(n3 ) for the number of edges. These are much
smaller than the square of the corresponding expectations. Similarly, the expected number of vertices
and edges in Y are n/4 and e(G)/16, respectively, and they are also both concentrated. Therefore,
we can ï¬nd two disjoint subsets X and Y , each of order n/4 + o(n), such
+ o(n2 )
 that e(X) = e(S)/4
2
2
and e(Y ) = e(G)/16 + o(n ). Thus, by the discussion above, we have e(X) âˆ’ e(Y ) = â„¦(Î³n ) and we
can delete o(n) vertices to make the orders of X and Y equal without changing this inequality.

Let U = X âˆª Y and let H = G[U ] be the subgraph of G induced by U . Without loss of generality, we
P
will assume that e(X) â‰¥ e(Y ). In particular, the edge density in X is at least q. Since xâˆˆX dH (x) =
P
P
P
2e(X) + e(X, Y ) and yâˆˆY dH (y) = 2e(Y ) + e(X, Y ), we have xâˆˆX dH (x) âˆ’ yâˆˆY dH (y) = â„¦(Î³n2 ).
Therefore, using Corollary 2.2 (with s = r âˆ’ 1) and |X| = n/4 + o(n), we deduce that
ï£«
ï£¶
X
X
X
X 
X 


râˆ’2
drâˆ’1 (x) âˆ’ drâˆ’1 (y) â‰¥
drâˆ’1 (u) âˆ’ drâˆ’1 (v) â‰¥
(x) ï£­
dH
dH (x) âˆ’
dH (y)ï£¸
H
H
H
H
xâˆˆX

xâˆˆX,yâˆˆY

u,vâˆˆH

â‰¥ |X|

X

!râˆ’2

dH (x)/|X|

xâˆˆX

xâˆˆX

yâˆˆY


â„¦(Î³n2 ) = â„¦ q râˆ’2 Î³nr+1 .

For a suï¬ƒciently large constant c (in the deï¬nition of Î³), this contradicts Lemma 2.2 and implies that
âˆ— (Î³). Finally, by Lemma 2.3, we have that any graph satisfying P âˆ— (Î³) also satisï¬es
G satisï¬es P2,q
2,q
r
2
r
âˆ—
(
)
2
Pr,q (r Î³). Therefore, the number of labeled r-cliques in G deviates from q n by at most r 2 Î³nr . On

r
r
r
the other hand, the diï¬€erence between (p Â± Ç«)(2) and p(2) has order of magnitude â„¦ p(2)âˆ’1 Ç« . Thus, if
r
q diï¬€ers from p by Ç« = câ€² pâˆ’(2)+1 Î³ for suï¬ƒciently large câ€² , we obtain the wrong count of r-cliques in G,
r
âˆ— (Î´). Therefore, G must satisfy P âˆ— (Ç«). Since q = â„¦(prâˆ’1 ), Ç« = ccâ€² q âˆ’(râˆ’2) pâˆ’2(2)+1 Î´ =
contradicting Pr,p
2,p
2 
âœ·
O pâˆ’2r Î´ , completing the proof.

3

General graphs

In this section, we prove Theorem 1.2. We will assume throughout that H does not have isolated
vertices, as deleting such a vertex from H simply scales the number of labeled copies in S by a factor
of |S| âˆ’ r + 1.
We say that an n-vertex graph G has property QH,p (Ç«) if, for every r disjoint subsets V1 , . . . , Vr âŠ† V (G),
Q
the number of labeled copies of H with one vertex in each Vi is pm r! ri=1 |Vi | Â± Ç«nr . In other words,
property QH,p (Ç«) says that if we average over all possible permutations Ï€ of [r] the number of copies
Q
of H with the copy of vertex i in VÏ€(i) , the result is at most Ç«nr /r! from pm ri=1 |Vi |.
For a subset U âŠ† V (G), let NH (U ) denote the number of labeled copies of H in G whose vertices lie
in U . Let NH (V1 , . . . , Vr ) denote the number of labeled copies of H in G with one vertex in each Vi .
7

For S âŠ† [r], let US =

S

iâˆˆS

Vi . By the inclusion-exclusion principle, we have
X
NH (V1 , . . . , Vr ) =
(âˆ’1)râˆ’|S| NH (US ).
SâŠ†[r]

âˆ— (Ç«), it follows that N (U ) is within Ç«nr of pm |U |r . Applying this to each of
If G has property PH,p
H
S
S
Q
r
the 2 âˆ’ 1 choices of S, we get that NH (V1 , . . . , Vr ) is within (2r âˆ’ 1)Ç«nr of pm r! ri=1 |Vi |. Hence, we
have the following lemma.
âˆ— (Ç«), then it also satisfies Q
r
Lemma 3.1. If G satisfies PH,p
H,p ((2 âˆ’ 1)Ç«).

We remark that the property studied by Reiher and Schacht [18] is a variant of QH,p . We say that
a graph G on n vertices has property RH,p (Ç«) if for any r disjoint vertex subsets V1 , . . . , Vr of G and
every one-to-one mapping Ï€ : V (H) â†’ [r], the number of copies of H where the image of v is in VÏ€(v)
Q
for each vertex v of H is within Ç«nr of pm ri=1 |Vi |. Note that R is a stronger property than Q, since if
a graph satisï¬es RH,p (Ç«), then it also satisï¬es QH,p (r!Ç«). It remains an open problem to ï¬nd a simple
proof (i.e., without going through the methods developed here or through regularity methods) that
shows the other direction, that Q implies R.
We say that a pair (A, B) of vertex subsets of a graph G is lower-(q, Ç«)-regular if, for all Aâ€² âŠ† A and
B â€² âŠ† B,
e(Aâ€² , B â€² ) â‰¥ q|Aâ€² ||B â€² | âˆ’ Ç«|A||B|.
That is, the density between all pairs of large subsets is at least q, up to an error depending on Ç«.
As in the proof of Lemma 2.3, this is equivalent to saying that for all functions u : A â†’ [0, 1] and
v : B â†’ [0, 1],
X
X
1G (a, b)u(a)v(b) â‰¥ q
u(a)v(b) âˆ’ Ç«|A||B|.
aâˆˆA,bâˆˆB

aâˆˆA,bâˆˆB

Similarly, we say that (A, B) is upper-(q, Ç«)-regular if, for all subsets Aâ€² âŠ† A and B â€² âŠ† B,
e(Aâ€² , B â€² ) â‰¤ q|Aâ€² ||B â€² | + Ç«|A||B|.
We note that if a pair of subsets is both lower-(q, Ç«)-regular and upper-(q, Ç«)-regular, it satisï¬es a
notion of regularity introduced by LovaÌsz and Szegedy [17] (though equivalent up to a polynomial
change in Ç« to the original notion of regularity introduced by SzemereÌdi [23]).
The following counting lemma gives a lower bound for the number of copies of a graph H between a
collection of sets with lower-regular pairs. We omit the proof, which follows by the same telescoping
argument used for Lemma 2.3.
Lemma 3.2. Let H be a graph on vertex set {1, 2, . . . , r}. Let G be a graph with vertex subsets
V1 , . . . , Vr such that (Vi , Vj ) is lower-(pij , Ç«)-regular for each edge (i, j) of H. Then the number of
homomorphisms from H to G with the copy of vertex i in Vi is at least
ï£¶
ï£«
r
Y
Y
ï£­
|Vi |.
pij âˆ’ e(H)Ç«ï£¸
i=1

(i,j)âˆˆE(H)

Note that a similar lemma also holds if lower is replaced by upper and âˆ’ by +. It is also worth
noting that we have not insisted that the vertex sets V1 , . . . , Vr be disjoint. In particular, we may take
V1 = Â· Â· Â· = Vr to obtain a non-partite version of the lemma.
The next lemma shows that lower regularity implies upper regularity and vice versa.
8

Lemma 3.3. If a pair (A, B) of vertex subsets of a graph is not lower-(d(A, B), Ç«)-regular, then it is
also not upper-(d(A, B), Ç«/2)-regular. The same holds if lower and upper are switched.
Proof. By assumption, there are subsets Aâ€² âŠ‚ A and B â€² âŠ‚ B such that e(Aâ€² , B â€² ) âˆ’ d(A, B)|Aâ€² ||B â€² | <
âˆ’Ç«|A||B|. As
e(Aâ€² , B â€² ) + e(A \ Aâ€² , B) + e(Aâ€² , B \ B â€² ) = e(A, B)
= d(A, B)|A||B|
= d(A, B)|Aâ€² ||B â€² | + d(A, B)|A \ Aâ€² ||B| + d(A, B)|Aâ€² ||B \ B â€² |,
it follows that at least one of the pairs (A \ Aâ€² , B) and (Aâ€² , B \ B â€² ) demonstrates that (A, B) is not
upper-(d(A, B), Ç«/2)-regular. The proof when lower and upper are switched is the same.
âœ·
We also need a simple lemma saying that we can always ï¬nd a pair of subsets of equal size which bear
witness to irregularity.
Lemma 3.4. Suppose (A, B) is a pair of vertex subsets of a graph which is not upper-(q, Î³)-regular.
|A| |B|
Then there are subsets Aâ€² âŠ† A and B â€² âŠ† B with |Aâ€² | = |B â€² | and d(Aâ€² , B â€² ) â‰¥ q + Î³ min{ |A
â€² | , |B â€² | }. The
same holds with upper replaced by lower, + by âˆ’ and the inequality reversed.
Proof. As (A, B) is not upper-(q, Î³)-regular, there are subsets A0 âŠ† A and B0 âŠ† B such that
e(A0 , B0 ) â‰¥ q|A0 ||B0 | + Î³|A||B|. Without loss of generality, we may assume that |A0 | â‰¤ |B0 |. Let
B â€² âŠ† B0 be the subset of |A0 | vertices with the most neighbors in A0 and Aâ€² = A0 . Then
d(Aâ€² , B â€² ) â‰¥ d(A0 , B0 ) =

e(A0 , B0 )
|A||B|
|A|
â‰¥q+Î³
â‰¥q+Î³ â€² ,
|A0 ||B0 |
|A0 ||B0 |
|A |

as required.

âœ·

The next lemma shows that if a graph satisï¬es QH,p but there are sets A and B for which the density
d(A, B) deviates signiï¬cantly from the expected density, then there are sets Aâ€² and B â€² such that the
density d(Aâ€² , B â€² ) deviates by even more. This observation will allow us to run a density-increment
argument in the proof of Theorem 1.2.
Lemma 3.5. Let H be a graph with r vertices and m edges. Suppose G is a graph on n vertices that
1
satisfies QH,p (Î´) and has disjoint subsets A and B with |A| = |B| such that Î´ â‰¤ 4r
Î±mpm r âˆ’r (|A|/n)r
1
and d(A, B) â‰¥ (1 + Î±)p or d(A, B) â‰¤ (1 âˆ’ Î±)p with Î± â‰¤ 16mr . Then there are also disjoint subsets
Aâ€² and B â€² with |Aâ€² | = |B â€² | and d(Aâ€² , B â€² ) â‰¥ (1 + (1 + Î²)Î±)p or d(Aâ€² , B â€² ) â‰¤ (1 âˆ’ (1 + Î²)Î±)p where
mâˆ’1 |A|
Î² = p4r3 |A
â€²| .
Proof. Suppose that we are in the case where d(A, B) â‰¥ (1 + Î±)p. Let q = (1 âˆ’ Î±)p and Ï… = pm Î±/(4r).
Take an arbitrary equitable partition of A into âŒŠr/2âŒ‹ subsets A1 , . . . , AâŒŠr/2âŒ‹ and B into âŒˆr/2âŒ‰ subsets
AâŒŠr/2âŒ‹+1 , . . . , Ar .
First suppose that there is a pair (Ai , Aj ) with 1 â‰¤ i â‰¤ âŒŠr/2âŒ‹ < j â‰¤ r which is not lower-(d(A, B), Ï…)|Ai |||Aj |
regular. As Ai âŠ‚ A and Aj âŠ‚ B, (A, B) is not lower-(d(A, B), Ï… â€² )-regular, where Ï… â€² = Ï… |A||B|
â‰¥ r22 Ï….
By Lemma 3.3, (A, B) is also not upper-(d(A, B), Ï… â€² /2)-regular. Therefore, by Lemma 3.4, there are
â€² |A|
Ï… |A|
subsets Aâ€² âŠ† A and B â€² âŠ† B such that |Aâ€² | = |B â€² | and d(Aâ€² , B â€² ) â‰¥ d(A, B) + Ï…2 |A
â€² | â‰¥ d(A, B) + r 2 |Aâ€² | .
9

|A|
Hence, since rÏ…2 |A
â€² | = Î±Î²p, we may suppose all pairs (Ai , Aj ) with 1 â‰¤ i â‰¤ âŒŠr/2âŒ‹ < j â‰¤ r are
lower-(d(A, B), Ï…)-regular.

Now suppose there is a pair (Ai , Aj ) with 1 < i < j â‰¤ âŒŠr/2âŒ‹ which is not lower-(q, Ï…)-regular.
By Lemma 3.4, there are subsets Aâ€² âŠ† Ai and B â€² âŠ† Aj with |Aâ€² | = |B â€² | and d(Aâ€² , B â€² ) â‰¤ q âˆ’
Ï… |A|
i | |Aj |
Ï… min{ |A
|Aâ€² | , |B â€² | } â‰¤ q âˆ’ r |Aâ€² | â‰¤ (1 âˆ’ (1 + Î²)Î±)p. Hence, we may suppose all pairs (Ai , Aj ) with 1 < i <
j â‰¤ âŒŠr/2âŒ‹ are lower-(q, Ï…)-regular. Similarly, we may suppose all pairs (Ai , Aj ) with âŒŠr/2âŒ‹ < i < j â‰¤ r
are lower-(q, Ï…)-regular.
Consider a bijection Ï† : V (H) â†’ [r]. Let m1 denote the number of edges (v, w) of H for which
Ï†(v), Ï†(w) â‰¤ âŒŠr/2âŒ‹ or Ï†(v), Ï†(w) > âŒŠr/2âŒ‹ and m2 denote the number of edges (v, w) of H for which
Ï†(v) â‰¤ âŒŠr/2âŒ‹ < Ï†(w), so m = m1 + m2 . By Lemma 3.2, the number of copies of H where v maps to
AÏ†(v) for each vertex v âˆˆ H is at least

(q

m1

m2

d(A, B)

âˆ’ mÏ…)

r
Y

m1

|Ai | â‰¥ ((1 âˆ’ Î±)

m2 m

(1 + Î±)

p âˆ’ mÏ…)

r
Y

|Ai |

i=1
r
Y

i=1

â‰¥ ((1 âˆ’ Î±m1 )(1 + Î±m2 )pm âˆ’ mÏ…)

|Ai |

i=1

2

m

= (1 âˆ’ Î±m1 + Î±m2 âˆ’ Î± m1 m2 )p âˆ’ mÏ…

r
Y

â‰¥ ((1 âˆ’ Î±m1 + Î±m2 âˆ’ Î±m/64r)pm âˆ’ mÏ…)

(1)
|Ai |

i=1
r
Y

|Ai |,

i=1

where in the last inequality we used m1 m2 â‰¤ m2 /4, which follows from m1 +m2 = m and the AMâ€“GM
inequality, and Î± â‰¤ 1/16mr.
We average this lower bound over all choices of Ï†. Each edge (v, w) maps
to a pair (i,j) with i < j

and the probability this pair satisï¬es i â‰¤ âŒŠr/2âŒ‹ < j is âŒŠr/2âŒ‹âŒˆr/2âŒ‰/ 2r â‰¥ 14 (r 2 âˆ’ 1)/ 2r = 21 1 + 1r .
Thus, by linearity of expectation, E[m2 âˆ’ m1 ] â‰¥ m/r. Hence, the average value of (1) is at least
m

((1 + Î±E[m2 âˆ’ m1 ] âˆ’ Î±m/64r) p âˆ’ mÏ…)

r
Y

|Ai |

i=1

which is at least
m

((1 + Î±m/r âˆ’ Î±m/64r) p âˆ’ mÏ…)

r
Y

|Ai | â‰¥

i=1




Y
r
63
m
1 + Î±m/r p âˆ’ mÏ…
|Ai |.
64
i=1

This in turn is equal to
pm

r
Y
i=1

|Ai | +

r

r

r

i=1

i=1

i=1

Y
Y
Y
1
47
|Ai | + Î±mpm r âˆ’r (|A|/n)r nr â‰¥ pm
|Ai | > pm
|Ai | + Î´nr ,
Î±mpm
64r
4r

contradicting the assumption that G satisï¬es QH,p (Î´) and completing the proof in this case. The case
d(A, B) â‰¤ (1 âˆ’ Î±)p follows similarly.
âœ·

10

A single vertex subset U of a graph is called Ç«-regular if, for each pair of subsets Aâ€² , B â€² âŠ‚ U , we have
|e(Aâ€² , B â€² ) âˆ’ d(U )|Aâ€² ||B â€² || â‰¤ Ç«|U |2 . In [3], the ï¬rst two authors proved the following lemma with Î´âˆ’1
having a double-exponential dependence on Ç«âˆ’1 .
Lemma 3.6. For each Ç« > 0, there is Î´ > 0 such that every graph on n vertices has an Ç«-regular subset
on at least Î´n vertices.
âˆ— (Î´) with
We are now ready to prove Theorem 1.2. That is, we will show that if G satisï¬es PH,p
âˆ— (Ç«), where r is the number of vertices in H.
Î´ = câ€² (p, r)Ç«c(p,r) , then it also satisï¬es P2,p

Proof of Theorem 1.2: Suppose for contradiction that G is a graph on n vertices which satisï¬es
âˆ— (Î´), but does not satisfy property P âˆ— (Ç«), where Î´ = câ€² (p, r)Ç«c(p,r) with c(p, r) = 10r 4 p1âˆ’m
property PH,p
2,p
and câ€² (p, r) > 0 will be chosen suï¬ƒciently small depending only on p and r. By Lemma 3.1, G also
âˆ— (Ç«), there is S âŠ† V (G) with
has
property QH,p ((2r âˆ’ 1)Î´). As G does not satisfy property P2,p

2e(S) âˆ’ p|S|2  > Ç«n2 . Averaging over all equitable partitions S = A âˆª B, we obtain that there are
disjoint vertex subsets A0 and B0 with |A0 | = |B0 | and |e(A0 , B0 ) âˆ’ p|A0 ||B0 || > Ç«n2 /4. We have
|A0 |2 = |A0 ||B0 | > Ç«n2 /4, so that |A0 | â‰¥ Ç«1/2 n/2 and also |d(A0 , B0 ) âˆ’ p| > Ç«n2 /(4|A0 ||B0 |) â‰¥ Ç«.
We repeatedly apply Lemma 3.5, starting with A0 and B0 , until we arrive at a pair of subsets (Aâ€² , B â€² )
1
with |Aâ€² | = |B â€² | and d(Aâ€² , B â€² ) = (1 + Î±)p or d(Aâ€² , B â€² ) = (1 âˆ’ Î±)p, for some Î± â‰¥ 16mr
. As we
will see below, the sets deï¬ned during this process will always be suï¬ƒciently large that we may
Lemma 3.5 until this happens. Having already found disjoint sets Ai and Bi with

continue applying

 d(Ai ,Bi )
â€²
:=
Î±
âˆ’
1

 p
i (so, in particular, Î±0 > Ç«/p), we apply Lemma 3.5 to obtain disjoint sets Ai and
Biâ€² with |Aâ€²i | = |Biâ€² | and |

d(Aâ€²i ,Biâ€² )
p

âˆ’ 1| â‰¥ (1 + Î²i )Î±i , where Î²i =

pmâˆ’1 |Ai |
.
4r 3 |Aâ€²i |

Let Ai+1 and Bi+1 be disjoint



 d(Ai+1 ,Bi+1 )
â€²
âˆ’ 1 â‰¥
sets with |Ai+1 | as large as possible such that |Ai+1 | = |Bi+1 | â‰¥ |Ai | and Î±i+1 := 
p
 â€² â€²

 d(Ai ,Bi )

âˆ’ 1 is as large as possible (such sets exist because Aâ€²i and Biâ€² have the desired properties).
 p

Let ai = |Aiâˆ’1 |/|Ai |. Note that ai â‰¥ 1, as otherwise we would have taken Ai and Bi for Aiâˆ’1 and
mâˆ’1
Biâˆ’1 , respectively. Let Î³ = p4r3 , so that Î±i+1 â‰¥ (1 + Î³ai+1 )Î±i . Let i0 be the last i for which we
1
obtain an Ai and Bi , so that either Î±i0 â‰¥ 16mr
or the sets Aâ€² = Ai0 and B â€² = Bi0 are too small for
the hypotheses of Lemma 3.5 to hold. We have
i0
i0
Y
Y
Î±j
(1 + Î³aj ).
â‰¥ Î±0
Î±i0 = Î±0
Î±jâˆ’1
j=1

j=1

Qi0

As also Î±i0 â‰¤ 1/p and Î±0 â‰¥ Ç«/p, we get j=1 (1 + Î³aj ) â‰¤ 1Ç« . Given this inequality, the maximum of
Q i0
j=1 aj is attained when all the aj are equal; call this equal value a. Thus, we are interested in the
ln a
maximum of ai0 given that (1 + Î³a)i0 â‰¤ 1Ç« . This is equivalent to maximizing ln(1+Î³a)
. Let x = Î³a.
For x â‰¤ 1.5, we have ln(1 + x) â‰¥ x/2 and so
ln a
ln(1+Î³a)

ln a
ln(1+Î³a)

â‰¤ 2 lnxa =

2 ln a
Î³ a

â‰¤

2
eÎ³ .

For x > 1.5, we have

ln Î³ âˆ’1

ln a
â‰¤ ln(Î³a)
= 1 + ln x â‰¤ 3 ln Î³ âˆ’1 . As we may assume r â‰¥ 3 and m â‰¥ 2, Î³ is small enough that
the ï¬rst bound is larger, so we have
â€²

|A | = |A0 |/

i0
Y

j=1

1
aj â‰¥ Ç«2/(eÎ³) |A0 | â‰¥ Ç«1/2+2/(eÎ³) n.
2

By the choice of c(p, r), |Aâ€² | = |Ai0 | is large enough that Lemma 3.5 still applies at the next step if
1
1
Î± := Î±i0 â‰¤ 16mr
. Therefore, we must have Î± > 16mr
.
11

3 1âˆ’m

1
n. Suppose that d(Aâ€² , B â€² ) = (1 + Î±)p with Î± > 16mr
The sets Aâ€² and B â€² have order at least Ç«5r p
.
â€²
â€²
â€²
The other case when d(A , B ) < (1 âˆ’ Î±)p is handled similarly. Let C be the subset of A with at
least (1 + Î±/2)p|B â€² | neighbors in B â€² , so |C| â‰¥ |Aâ€² |Î±p/2. Let Î· := 10âˆ’5 Î±2 p2m mâˆ’2 and Îº = 2mÎ·p1âˆ’m .
Apply Lemma 3.6 to the subgraph of G induced by C. We get a subset C1 âŠ‚ C which is Î·-regular
with |C1 | â‰¥ Ï„ |C|, where Ï„ only depends on p and r. If d(C1 ) < p âˆ’ Îº, then by the counting lemma,
Lemma 3.2, the number of homomorphisms from H to C1 is at most

Îº
4 1âˆ’m r
(p âˆ’ Îº)m |C1 |r + mÎ·|C1 |r â‰¤ (1âˆ’ )pm |C1 |r + mÎ·|C|r = pm |C1 |r âˆ’ mÎ·|C1 |r â‰¤ pm |C1 |r âˆ’ a(p, r)Ç«8r p
n
p
âˆ— (Î´) when câ€² (p, r) is suï¬ƒciently small. Hence,
for an appropriate constant a(p, r). This contradicts PH,p
â€²
d(C1 ) â‰¥ pâˆ’Îº. Let D be the subset of B with at least (1+Î±/4)p|C1 | neighbors in C1 , so |D| â‰¥ |B â€² |Î±p/4.
mâˆ’1
Let D1 âŠ‚ D be a subset of order Î±p40r |C1 |.
âˆ— (Î´) as this subset contains
The rest of the proof is in showing that C1 âˆª D1 violates the property PH,p
too many labeled copies of H. Indeed, by Lemma 3.2, the number of homomorphisms from H to C1
is at least (p âˆ’ Îº)m |C1 |r âˆ’ mÎ·|C1 |r â‰¥ pm |C1 |r âˆ’ (mpmâˆ’1 Îº + mÎ·)|C1 |r . The number of homomorphisms
from H to C1 which fail to be copies of H is at most the number of non-injective mappings from H
to C1 , which is less than r 2 |C1 |râˆ’1 . Thus, we get at least pm |C1 |r âˆ’ (mpmâˆ’1 Îº + mÎ· + r 2 |C1 |âˆ’1 )|C1 |r
copies of H in C1 .

We next give a lower bound on the number of copies of H in C1 âˆª D1 with the copy of vertex i in D1
and the remaining r âˆ’ 1 vertices in C1 . Suppose vertex i has degree t in H. We have t â‰¥ 1 as H has
no isolated vertices. Fix a vertex v âˆˆ D1 to map i to, and let C2 be the neighborhood of i in C1 , so
|C2 | â‰¥ (1 + Î±/4)p|C1 |. Since |C2 | â‰¥ p|C1 | and C1 is Î·-regular, we get that each of the pairs (C1 , C1 ),
(C1 , C2 ), (C2 , C2 ) is 2pâˆ’2 Î·-regular. The number of homomorphisms of H with the copy of vertex i
mapping to v and the remaining vertices of H mapping to C1 (so each of the t neighbors of i has to
map to C2 ) is, by Lemma 3.2, at least


(p âˆ’ Îº)mâˆ’t âˆ’ (m âˆ’ t)2pâˆ’2 Î· |C1 |râˆ’tâˆ’1 |C2 |t â‰¥ pmâˆ’t âˆ’ (m âˆ’ t)Îºpmâˆ’tâˆ’1 âˆ’ (m âˆ’ t)2pâˆ’2 Î· |C1 |râˆ’tâˆ’1 |C2 |t
â‰¥ (pmâˆ’t âˆ’ Î±pmâˆ’t /8)|C1 |râˆ’tâˆ’1 |C2 |t
â‰¥ (pmâˆ’1 âˆ’ Î±pmâˆ’1 /8)|C1 |râˆ’2 |C2 |1
â‰¥ (pmâˆ’1 âˆ’ Î±pmâˆ’1 /8)(1 + Î±/4)p|C1 |râˆ’1
â‰¥ (1 + Î±/10) pm |C1 |râˆ’1 .
The number of mappings from H to C1 âˆª D1 with vertex i going to v and the other r âˆ’ 1 vertices going
to C1 which are not one-to-one is at most r 2 |C1 |râˆ’2 . As |C1 | â‰¥ 20r 2 Î±âˆ’1 pâˆ’m , then we get at least
(1 + Î±/20) pm |C1 |râˆ’1 labeled copies of H with vertex i mapping to v and the remaining vertices mapping to C1 . Summing over all choices of v in D1 , we get that there are at least (1 + Î±/20) pm |C1 |râˆ’1 |D1 |
labeled copies of H with vertex i mapping to D1 and the remaining r âˆ’ 1 vertices mapping to C1 .
Finally, summing over all r choices of i, we get at least r (1 + Î±/20) pm |C1 |râˆ’1 |D1 | labeled copies of
H with one vertex mapping to D1 and the remaining r âˆ’ 1 vertices mapping to C1 .
Finally, the number
of possible mappings from H to C1 âˆª D1 with at least two vertices in D1 is at

P
most jâ‰¥2 rj |D1 |j |C1 |râˆ’j â‰¤ r 2 |D1 |2 |C1 |râˆ’2 . Putting the bounds together, we get that the number
of labeled copies of H in C1 âˆª D1 is pm |C1 âˆª D1 |r (this is the sum of the contributions of the main
terms) plus at least
r

Î± m
p |C1 |râˆ’1 |D1 | âˆ’ (mpmâˆ’1 Îº + mÎ· + r 2 |C1 |âˆ’1 )|C1 |r âˆ’ r 2 |D1 |2 |C1 |râˆ’2 ,
20
12

which, substituting in |D1 | =

Î±pm
40r |C1 |,

is equal to

Î±2 2m
p |C1 |r âˆ’ (mpmâˆ’1 Îº + mÎ· + r 2 |C1 |âˆ’1 )|C1 |r .
1600
Using |C1 | â‰¥ r 2 Î· âˆ’1 (recall that Î· = 10âˆ’5 Î±2 p2m mâˆ’2 ) and substituting in Îº = 2mÎ·p1âˆ’m , we get that
this is at least
Î±2 2m
p |C1 |r âˆ’ 4m2 Î·|C1 |r â‰¥ 10âˆ’5 Î±2 p2m |C1 |r â‰¥ Î´nr ,
1600
provided câ€² (p, r) is chosen suï¬ƒciently small. This completes the proof.
âœ·

4

Concluding remarks

It is plausible that Theorem 1.1 can be extended to all H, that is, that a graph G which satisï¬es
âˆ— (Î´) also satisï¬es P âˆ— (Ç«) with Ç« â‰¤ c(p, r)Î´, where r is the number of vertices in H. However, it
PH,p
2,p
seems that new ideas will be needed to prove this in full generality. It would already be interesting to
obtain a linear dependence in the special case H = C4 .
One might also ask about the quantitative aspects of other quasirandom equivalences. For example,
we know that for any Ç« > 0, there exists Î´ > 0 such that if a graph G has density p and satisï¬es
âˆ— (Ç«). The forcing conjecture, which was already mentioned in the
PC4 ,p (Î´), then it also satisï¬es P2,p
introduction, states that a similar result should hold when C4 is replaced by any bipartite graph H
which contains a cycle. Somewhat tentatively, we are willing to venture that the following stronger
quantitative version of this conjecture holds.
Conjecture 4.1. Let H be a fixed bipartite graph of girth g and 0 < p < 1 a fixed constant. For each
Ç« > 0, there is Î´ = â„¦(Ç«g ) such that any graph G with density p which satisfies PH,p (Î´) also satisfies
âˆ— (Ç«).
P2,p
To see that the girth dependence would be tight, consider a random graph with n vertices whose vertex
set is partitioned into two parts V1 and V2 , each of order n/2, with density p âˆ’ Ç« inside parts and
density p + Ç« between parts. Equivalently, consider the generalized random graph G on two vertices,
where loops have weight p âˆ’ Ç« and the edge between the two vertices has weight p + Ç«. By picking one
âˆ— (Ç«/2).
vertex from G, we see that it does not satisfy P2,p
Consider now a random mapping of the vertices of H to the two vertices of G. For an edge e of H,
let Xe = âˆ’1 if both vertices of e map to the same vertex of G and Xe = 1 if the vertices of e map to
diï¬€erent vertices of G. The homomorphism density of H in G is then
Y
E[ (p + Xe Ç«)].
e

Suppose that e1 , . . . , ek are edges of H with k < g. Since these edges form a forest, it follows that
E[Xe1 Xe2 . . . Xek ] = E[Xe1 ] Â· Â· Â· E[Xek ].
In particular, since E[Xe ] = 0, this implies that the coeï¬ƒcient of Ç«i is zero for i = 1, . . . , g âˆ’ 1 and,
therefore, G satisï¬es PH,p (Î´) with Î´ = O(Ç«g ).
It is not hard to verify that Conjecture 4.1 holds when H is an even cycle. Combining this observation
with other known results allows us to prove the conjecture for some reasonably broad classes of graphs.
13

For example, Theorem 1.1 in [4] implies that if H is a bipartite graph with m edges which has two
vertices in one part complete to the other part and minimum degree at least two in the ï¬rst part, then
the homomorphism density tH (G) satisï¬es tH (G) â‰¥ tC4 (G)m/4 . Therefore, if tH (G) â‰¤ pm (1 + Ç«4 ), we
8 4
have tC4 (G) â‰¤ p4 (1 + Ç«4 )4/m â‰¤ p4 (1 + m
Ç« ) and the required result for H follows from the C4 case. As
with the forcing conjecture, similar arguments can likely prove Conjecture 4.1 for many of the graphs
for which Sidorenkoâ€™s conjecture is known to hold. On the other hand, our second-order Sidorenko
conjecture may be easier to disprove than the conjecture itself.

References
[1] F. R. K. Chung, R. L. Graham and R. M. Wilson, Quasi-random graphs, Combinatorica 9 (1989),
345â€“362.
[2] D. Conlon, A new upper bound for diagonal Ramsey numbers, Ann. of Math. 170 (2009), 941â€“960.
[3] D. Conlon and J. Fox, Bounds for graph regularity and removal lemmas, Geom. Funct. Anal. 22
(2012), 1191â€“1256.
[4] D. Conlon, J. Fox, and B. Sudakov, An approximate version of Sidorenkoâ€™s conjecture, Geom.
Funct. Anal. 20 (2010), 1354â€“1366.
[5] D. Conlon, J. H. Kim, C. Lee, and J. Lee, Some advances on Sidorenkoâ€™s conjecture,
arXiv:1510.06533 [math.CO].
[6] P. ErdoÌ‹s, M. Goldberg, J. Pach and J. Spencer, Cutting a graph into two dissimilar halves, J.
Graph Theory 12 (1988), 121â€“131.
[7] W. T. Gowers, A new proof of SzemereÌdiâ€™s theorem, Geom. Funct. Anal. 11 (2001), 465â€“588.
[8] S. Hoory, N. Linial and A. Wigderson, Expander graphs and their applications, Bull. Amer. Math.
Soc. 43 (2006), 439â€“561.
[9] S. Janson, T. Luczak and A. RucinÌski, Random graphs, Wiley, New York, 2000.
[10] G. Katona, A theorem of ï¬nite sets, in Theory of graphs (Proc. Colloq., Tihany, 1966), 187â€“207,
Academic Press, New York, 1968.
[11] J. H. Kim, C. Lee and J. Lee, Two approaches to Sidorenkoâ€™s conjecture, Trans. Amer. Math.
Soc. 368 (2016), 5057â€“5074.
[12] M. Krivelevich and B. Sudakov, Pseudo-random graphs, in More sets, graphs and numbers, 199â€“
262, Bolyai Soc. Math. Stud. 15, Springer, Berlin, 2006.
[13] J. B. Kruskal, The number of simplices in a complex, in Mathematical optimization techniques,
251â€“278, Univ. of California Press, Berkeley, Calif., 1963.
[14] J. X. Li and B. Szegedy, On the logarithmic calculus and Sidorenkoâ€™s conjecture, to appear in
Combinatorica.
[15] L. LovaÌsz, Combinatorial problems and exercises, 2nd edition. AMS Chelsea Publishing,
Providence, RI, 2007.
14

[16] L. LovaÌsz, Large networks and graph limits, Amer. Math. Soc. Colloq. Publ., Vol. 60, Amer.
Math. Soc., Providence, RI, 2012.
[17] L. LovaÌsz and B. Szegedy, SzemereÌdiâ€™s lemma for the analyst, Geom. Funct. Anal. 17 (2007),
252â€“270.
[18] C. Reiher and M. Schacht, in preparation.
[19] A. Shapira, Quasi-randomness and the distribution of copies of a ï¬xed graph, Combinatorica 28
(2008), 735â€“745.
[20] M. Simonovits and V. T. SoÌs, Hereditarily extended properties, quasi-random graphs and not
necessarily induced subgraphs, Combinatorica 17 (1997), 577â€“596.
[21] J. Skokan and L. Thoma, Bipartite subgraphs and quasi-randomness, Graphs Combin. 20 (2004),
255â€“262.
[22] B. Szegedy, An information theoretic approach to Sidorenkoâ€™s conjecture, arXiv:1406.6738v3
[math.CO].
[23] E. SzemereÌdi, Regular partitions of graphs, in ProbleÌ€mes combinatoires et theÌorie des graphes
(Colloq. Internat. CNRS, Univ. Orsay, Orsay, 1976), 399â€“401, Colloq. Internat. CNRS, Vol. 260,
CNRS, Paris, 1978.
[24] A. Thomason, Pseudorandom graphs, in Random graphs â€™85 (PoznanÌ, 1985), 307â€“331, NorthHolland Math. Stud. 144, North-Holland, Amsterdam, 1987.
[25] A. Thomason, Random graphs, strongly regular graphs and pseudorandom graphs, in Surveys
in combinatorics 1987 (New Cross, 1987), 173â€“195, London Math. Soc. Lecture Note Ser. 123,
Cambridge Univ. Press, Cambridge, 1987.

15

