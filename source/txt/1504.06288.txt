arXiv:1504.06288v2 [math.LO] 12 May 2015

The stable regularity lemma revisited
Maryanthe Malliaris∗
University of Chicago

Anand Pillay†
University of Notre Dame

August 20, 2018

Abstract
We prove a regularity lemma with respect to arbitrary Keisler measures µ on V , ν on W where the bipartite graph (V, W, R) is definable
in a saturated structure M̄ and the formula R(x, y) is stable. The
proof is rather quick, making use of local stability theory. The special
case where (V, W, R) is pseudofinite, µ, ν are the counting measures,
and M̄ is suitably chosen (for example a nonstandard model of set
theory), yields the stable regularity theorem of [3], though without
explicit bounds or equitability.

1

Introduction

We refer to [3] for a discussion of Szemerédi’s Regularity Lemma and various
elaborations on it. Our context is a saturated model M̄ of an arbitrary
theory, and a definable (with parameters) bipartite graph (V, W, R) where
the edge relation R(x, y) is stable. Stability of R means that for some k
there do not exist ai ∈ V , bi ∈ W for i ≤ k such that R(ai , bj ) holds iff i ≤ j.
We also have global Keisler measures µx on V and νy on W (i.e. finitely
additive probability measures on the Boolean algebras of definable subsets of
V, W respectively). By a ∆-formula we mean a finite Boolean combination
of things like R(x, b) and x = a, and by a ∆∗ (x, y)-formula we mean a finite
Boolean combination of things like R(a, y) and y = b. We don’t actually
∗
†

Partially supported by NSF grant DMS-1300634 and a Sloan fellowship
Partially supported by NSF grant DMS-1360702

1

need the = formulas but it is convenient to include them. By convention the
x variable is restricted to V and y variable to W so by definition a ∆-formula
(∆∗ -formula) defines a subset of V (W ).
Theorem 1.1. In the context above, namely a definable graph (V, W, R) in
a saturated structure M̄ , where R(x, y) is stable, and Keisler measures µ on
V , ν on W , we have the following: Given ǫ > 0, we can partition V into
finitely many definable sets V1 , .., Vm each defined by a ∆-formula, and also
partition W into finitely many W1 , .., Wm each defined by a ∆∗ -formula, such
that for each Vi , Wj exactly one of the following holds:
(i) for all a ∈ Vi outside a set of µ measure ≤ ǫµ(Vi ), for all b ∈ Wj outside
a set of ν measure ≤ ǫν(Wj ), we have R(a, b), AND DUALLY for all b ∈ Wj
outside a set of ν measure ≤ ǫν(Wj ), for all a ∈ Vi outside a set of µ measure
≤ ǫµ(Vi ), we have R(a, b) holds, or
(ii) for all a ∈ Vi outside a set of µ measure ≤ ǫµ(Vi ), for all b ∈ Wj outside
a subset of ν measure ≤ ǫν(Wj ), we have ¬R(a, b), AND DUALLY for all
b ∈ Wj outside a subset of ν measure ≤ ǫν(Wj ), for all a ∈ Vi outside a set
of µ measure ≤ ǫµ(Vi ), ¬R(a, b).
Remark 1.2. We obtain δ-regularity for suitable δ and in a suitable sense,
of each
√ of the (Vi , Wj , R|(Vi ×Wj )) (as essentially in Claim 5.17 of [3]): Take
δ = 2ǫ, and suppose we are in case (i) of the conclusion of the theorem.
Suppose A ⊆ Vi is definable (not necessarily by a ∆-formula), and B ⊆ Wj is
definable (not necessarily by a ∆∗ -formula), with µ(A) ≥ δµ(Vi ) and ν(B) ≥
δν(Wj ). Then for all a ∈ A outside a set of µ-measure ≤ δµ(A), for all
b ∈ B outside a set of ν-measure ≤ δν(B) we have R(a, b).
Remark 1.3. We also recover the regularity lemma for finite stable graphs in
the sense of [3] by considering the counting measure on pseudofinite graphs.
(But without explicit bounds or equitability of the partition.)
Explanation. Let (Vi , Wi , Ri ) be a family of finite graphs where the relation Ri
does not have the k-order property for fixed k. Take an infinite ultraproduct,
to obtain a definable nonstandard finite graph (V, W, R) in a (saturated)
nonstandard model of set theory M̄ . Then R(x, y) is stable. Let µ be the
counting measure on V , namely for definable (in M̄) A ⊆ V , define µ(A)
to be the standard part of |A|/|V |, and likewise for ν on W . Then µ, ν
are global Keisler measures and we can apply the theorem. Note that the
definable sets in M̄ are the internal sets in the sense of nonstandard analysis,
2

so the standard compactness arguments give regularity in the finite situation
with respect to arbitrary subsets (remembering the parenthesis).
Our model theory notation is standard. Stability theory is due to Shelah
and the basic reference is [5]. For the purposes of the current paper it is
convenient to refer to Chapter 1 of [4]. We will be in particular making use
of “local stability theory” namely the theory of forking for complete ∆-type
p(x) where ∆ is a finite set of stable formulas φ(x, y), and where a complete
∆-type over a model M is given (axiomatized) by a maximal consistent set of
formulas of the form φ(x, b), ¬φ(x, b) for φ(x, y) ∈ ∆ and b ∈ M. The ∆-rank
refers to R∆ (−) as in Section 1.3 of [4], which is denoted R(−, ∆, ω) in [5].
By a ∆-formula we mean a finite Boolean combination of formulas φ(x, b) for
φ ∈ ∆. Recall that a formula φ(x, b) divides over A if there an A-indiscernible
sequence b = b0 , b1 , b2 ... such that {φ(x, bi ) : i < ω} is inconsistent. As in
this context we will be concerned with stable formulas, we use the expression
“forking” to mean dividing.
Keisler measures are of course important in this paper. If M̄ is a saturated
model and V a sort, a Keisler measure µ on V is a finitely additive probability
measure on the Boolean algebra of definable (with parameters) subsets of V .
If we are only concerned with subsets definable over M we call µ a Keisler
measure on V over M. If ∆ is a collection of L-formulas φ(x, y) (x fixed of
sort V , y arbitrary), we can restrict µ to ∆ formulas and call it µ|∆. Likewise
µ|(∆, M) is the restriction of µ to ∆-formulas over M. We will use freely facts
(from [2]) such that if µ is a global Keisler measure on V say, then for any
type-definable subset X of V , type-defined over a small set of parameters
(equivalently any partial type Σ over a small set of parameters), µ(X) is
defined and is approximated from above by the µ- measure of definable sets
(formulas in Σ).
We depend somewhat on Keisler’s seminal paper [2], which is very much
concerned with Keisler measures µ|∆ for ∆ a finite set of stable formulas. A
key observation (Lemma 1.7 of [2]), is that such µ|∆ is a weighted sum of
complete ∆-types (the proof of which is more or less repeated in Lemma 2.1
in the next section).
We will need the following, which after a suitable translation is Proposition 1.20 of [2]:
Fact 1.4. Suppose ∆ is a finite set of stable formulas and µx is a global
Keisler measure. Then there is a small model M such that µ|∆ does not fork
over M in the sense that each ∆-formula ψ(x) of positive µ-measure does
3

not fork over M.
In fact µ|∆ will be the unique nonforking extension of µ|(∆, M), so µ|∆
will be a “generically stable” measure in the sense of [1]. But all we will
really need is the
Fact 1.5. A complete ∆-type over a model M has a unique nonforking extension to a global complete ∆-type.
As in the statement of the theorem we will take ∆ to be {R(x, y), x = z}
and likewise for ∆∗ .
Acknowledgement. Thanks to Sergei Starchenko for comments on a first draft
of the paper.

2

Proof of Theorem 1.1

First by Fact 1.4, let M be a small model such that (V, W, R) is definable
over M, and both µ|∆, ν|∆∗ do not fork over M.
Lemma 2.1. Given ǫ > 0, we can write V as a disjoint union of ∆-formulas
(restricted to V ) over M, V = V1 ∪ ... ∪ Vm , such that for each i there is a
complete ∆-type pi over M such that µ(pi ) > 0, Vi ∈ pi (or pi ⊆ Vi ) and
µ(Vi \ pi ) ≤ ǫµ(Vi ).
Proof. By induction on R∆ (V ) (which is a finite number). If it is 0, then
V is finite and consists of finitely many types, all realized in M, so there
is nothing to do. Suppose R∆ (V ) = n > 0. Let p1 , .., pk be the complete
∆-types over M of R∆ = n. Let µ(pi ) = αi . We divide into cases.
Case (i). αi > 0 for i = 1, .., k.
Then we can find Vi ∈ pi for i = 1, .., k such that µ(Vi ) ≤ αi /(1 − ǫ) whereby
µ(Vi \ pi ) ≤ ǫµ(Vi ). We may assume that the Vi are disjoint. Let U =
V1 ∪ .. ∪ Vk . Then V \ U has ∆-rank < n so we can apply the induction
hypothesis to it, to obtain the lemma for V . (Noting that if µ(V \ U) = 0
we can just adjoin it to one of the Vi .)
Case (ii). Some but not all of the αi are 0.
Without loss α1 , ..αℓ > 0 and αj = 0 for j = ℓ + 1, .., k where 1 ≤ ℓ <
k. As in Case (i), find pairwise disjoint Vi ∈ pi for i = 1, .., ℓ, such that
4

µ(Vi \ pi ) ≤ µ(Vi ). Now as µ(Vj ) = 0 for j = ℓ + 1, .., k we can find a ∆definable over M set V ′ containing pℓ+1 ∪ ... ∪ pk and disjoint from V1 ∪ .. ∪ Vℓ
such that µ(V ′ ) ≤ (ǫµ(V1 ) − µ(V1 \ p1 ))/(1 − ǫ). Put V1′ = V1 ∪ V ′ . Then
µ(V1′ \ p1 ) ≤ ǫµ(V1′ ). Put again U = V1′ ∪ V2 ∪ ... ∪ Vℓ . Then V \ U has ∆-rank
< n and we can apply induction.
Case (iii). All αi are 0.
By Lemma 1.7 of [2], let p be a complete ∆-type over M with µ(p) > 0. So
by our case hypothesis, the ∆-rank of p equals m < n. Let W be a formula in
p of ∆-rank m. So µ(W ) > 0 and by induction hypothesis we find complete
∆-types q1 , .., qr over M of µ-measure > 0, and pairwise disjoint Wi ∈ qi such
that W = W1 ∪ .. ∪ Wr and µ(Wi \ qi ) ≤ µ(Wi ) for i = 1, .., r. From our case
hypothesis we can find a ∆-formula over M, V ′ which contains p1 ∪....∪pk and
is disjoint from W such that µ(V ′ ) ≤ (ǫµ(W1 )−µ(W1 \q1 ))/(1−ǫ). Put W1′ =
W1 ∪ V ′ and as above µ(W1′ \ q1 ) ≤ ǫµ(W1′ ). Again let U = W1′ ∪ W2 ∪ .. ∪ Wr .
Then the ∆-rank of V \ U is < n so we can apply induction to complete the
proof in case (iii).
We can do the same thing for W to write W as a disjoint union of ∆∗ definable (over M) sets such that for each j there is a complete ∆∗ -type qj
over M such that ν(Wj \ qj ) ≤ ǫν(Wj ).
Lemma 2.2. For each i = 1, .., m and j = 1, .., n, we have (i) or (ii) of
Theorem 1.1
Proof. Fix i, j and we have complete ∆-type pi (x) over M and complete
∆∗ -type qj over M. Now pi is definable, and its R-definition is given by a
∆∗ -formula (1.27 of [4]). Namely there is a ∆∗ -formula ψ(y) over M such
that for b ∈ W (M), R(x, b) ∈ pi (x) iff |= ψ(b). Likewise if p′i is the unique
nonforking extension of pi to a complete global ∆-type, ψ(y) is the R(x, y)definition of p′i . We have two cases:
Case (i): ψ(y) ∈ qj .
Hence for all b ∈ Wj other than a set a set of ν-measure ≤ ǫν(Wj ) we
have |= ψ(b). Now suppose that |= ψ(b), hence R(x, b) ∈ p′ , whereby p ∪
{¬R(x, b)} divides over M (by Fact 1.5) so as µ does not divide over M,
µ(p ∪ {¬(R(x, b)}) = 0, so for all a ∈ Vj outside a set of µ-measure ≤ ǫµ(Vi ),
we have |= R(a, b). We have actually proved the second clause of (i) of the
theorem. To obtain the first clause, let χ(x) be the ∆∗ -definition of qj , so by
5

Lemma 2.8 of [4], and our case hypothesis, χ(x) (a ∆-formula over M) is in
pi . Continue as above.
Case (ii): ¬ψ(y) ∈ qj . In which case we obtain as in Case (i) that for all
a ∈ Vi outside a set of µ-measure ≤ ǫµ(Vi ), for all b ∈ Wj outside a set of
ν-measure ≤ ǫν(Wj ) we have ¬R(a, b).
This completes the proof.
Theorem 1.1 follows directly from Lemmas 2.1 and 2.2.

References
[1] E. Hrushovski, A. Pillay, P. Simon, Generically stable and smooth measures in NIP theories, 365(2013),2341-2366.
[2] H. J. Keisler, Measures and forking, Annals of Pure and Applied Logic
34 (1987), 119-169.
[3] M. Malliaris and S. Shelah, Regularity lemmas for stable graphs, Trans.
Amer. Math Soc, 366 (2014), 1551-1585.
[4] A. Pillay, Geometric Stability Theory, OUP, 1996.
[5] S. Shelah, Classification Theory and the number of nonisomorphic models, North Holland, 1990.

6

