SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

arXiv:1708.02436v1 [math.CO] 8 Aug 2017

WOJCIECH SAMOTIJ

Abstract. A well-known theorem of Sperner describes the largest collections of subsets of an nelement set none of which contains another set from the collection. Generalising this result, Erdős
characterised the largest families of subsets of an n-element set that do not contain a chain of sets
A1 ⊂ . . . ⊂ Ak of an arbitrary length k. The extremal families contain all subsets whose cardinalities
belong to an interval of length k − 1 centred at n/2. In a far-reaching extension of Sperner’s theorem,
Kleitman determined the smallest number of chains of length two that have to appear in a collection
of a given number a of subsets of an n-element set. For every a, this minimum is achieved by the
collection comprising a sets whose cardinalities are as close to n/2 + 1/4 as possible. We show that the
same is true about chains of an arbitrary length k, for all a and n, confirming the prediction Kleitman
made fifty years ago. We also characterise all families of a subsets with the smallest number of chains
of length k for all a for which this smallest number is positive. Our argument is inspired by an elegant
probabilistic lemma from a recent paper of Noel, Scott, and Sudakov, which in turn can be traced back
to Lubell’s proof of Sperner’s theorem.

1. Introduction
The classical theorem of Sperner [10] describes the largest families of subsets of a finite set none of
which contains another set from the family. Originally a result in extremal set theory, it reached a
broader mathematical audience as the key lemma in Erdős’ beautiful solution [5] to the Littlewood–
Offord problem [7]. In the same paper [5], generalising the theorem of Sperner, Erdős described the
largest families of sets not containing a chain of sets A1 ⊂ . . . ⊂ Ak of an arbitrary length k. Among
families of subsets of a set of cardinality n, the largest such families are those containing all subsets
whose sizes belong to an interval of length k − 1 centred at n/2. In particular, the largest size of a
family of subsets of an n-element set that does not contain a k-chain (chain of length k) is equal to
the sum of the k − 1 largest binomial coefficients.
It is natural to ask how many k-chains must appear in a family of subsets of an n-element set that
is larger than Erdős’ bound.
This problem was first considered by Erdős and Katona, who conjectured
n 
that a family with ⌊n/2⌋ + t sets must contain at least t · ⌈ n+1
2 ⌉ chains of length 2. This conjecture
was confirmed by Kleitman [6], who in fact determined the smallest number of 2-chains in a family
of any given size. For every a with 0 6 a 6 2n , one such extremal family consists of a sets whose
cardinalities are as close to n/2 as possible. Kleitman went on to conjecture that the same families
minimise the number of k-chains for every k.
Made almost fifty years ago, Kleitman’s conjecture had laid dormant until his result was rediscovered
several years ago by Das, Gan, and Sudakov [3] and, independently, by Dove, Griggs, Kang, and
Sereni [4]. Apart from confirming the conjecture for every k and all a belonging to a small range
above the sum of the k − 1 largest binomial coefficients, the two papers [3, 4] aroused renewed interest
in the problem, as witnessed by [1, 2, 9]. In particular, Balogh and Wagner [2] proved the conjecture
for all k and a 6 (1 − ε)2n , provided that n is sufficiently large with respect to k and ε.
The main result of this paper is a resolution of Kleitman’s conjecture for all k and n. Additionally,
for each a larger than the sum of the k − 1 largest binomial coefficients, we characterise all families
of a sets that contain the smallest number of k-chains among all families of this size. In the case
k = 2, such characterisation was obtained by Das, Gan, and Sudakov [3]. In order to state our result
Research supported in part by the Israel Science Foundation grant 1147/14.
1

2

WOJCIECH SAMOTIJ

formally, we need one definition. We shall say that a family A of subsets of an n-element set Ω is
centred if it satisfies the following:

 

(i) If A ∈ A and B ⊆ Ω satisfy |B| − n/2 < |A| − n/2, then B ∈ A.

(ii) If for some i < n/2, the family A contains some but not all subsets of Ω of size i and some but
not all subsets of Ω of size n − i, then either there are no A, B ∈ A with |A| = i and |B| = n − i
such that A ⊂ B or there are no A, B 6∈ A with |A| = i and |B| = n − i such that A ⊂ B.

We now state the main result of this paper. The case k = 2 of the theorem, which is a strengthening
of Kleitman’s result because it characterises all extremal families, was already proved by Das, Gan,
and Sudakov [3].
Theorem 1. For all positive integers a, k, and n, every centred family of a subsets of an n-element
set contains the smallest number of chains of length k among all families of this size. Moreover, if
k > 2 and a centred family of a subsets contains at least one chain of length k, then every non-centred
family of this size contains strictly more such chains.
In fact, the argument we use to prove Theorem 1 is sufficiently flexible to establish analogous
statements in a wider class of partially ordered sets that includes the boolean lattice (the family of all
subsets of a given finite set). We shall defer the precise technical statement, Theorem 6, to Section 3
and state here only one additional corollary of it in the setting of finite vector spaces. Generalising
the definition given above, we shall say that a family A of subspaces of an n-dimensional vector space
Ω is centred if A satisfies (i) and (ii) above with ⊆ (⊂) denoting ‘is a (proper) subspace of’ and |A|
denoting the dimension of A.
Theorem 2. For all positive integers a and k, every centred family of a subspaces of a finite vector
space contains the smallest number of chains of length k among all families of this size. Moreover,
if k > 2 and a centred family of a subspaces contains at least one chain of length k, then every
non-centred family of this size contains strictly more such chains.
The posets of subspaces of finite vector spaces were first studied in this context by Noel, Scott, and
Sudakov [9]. The first assertion of Theorem 2 with k = 2 was proved earlier by Balogh, Petřı́čková,
and Wagner [1].
The remainder of this paper is organised as follows. In order to highlight the main ideas to the
reader, we start with a detailed sketch of our proof of Kleitman’s conjecture, the first assertion of
Theorem 1, which we give in Section 2. The sketch is a completely rigorous argument, but it uses
two important technical lemmas that we prove only later in the paper, in a more general form. Our
method is based on and inspired by an elegant probabilistic lemma due to Noel, Scott, and Sudakov [9,
Lemma 2.2], which can be traced back to Lubell’s proof [8] of Sperner’s theorem. Section 3 reviews
basic notions related to partially ordered sets in preparation for the statement of Theorem 6. It is
concluded with a short derivation of both Theorems 1 and 2 from Theorem 6 – we simply verify that
the boolean lattice and the family of subspaces of a finite vector space (ordered by inclusion) belong
to the class of partially ordered sets covered by Theorem 6. In Section 4, we state the aforementioned
two important technical lemmas, as well as a discrete analogue of Jensen’s inequality, and use them
to derive Theorem 6. Finally, we prove the two lemmas in Section 5, thus completing the proofs of
Theorems 1, 2, and 6.
2. A sketch of the proof of Kleitman’s conjecture
Let P be the family of all subset of {1, . . . , n} ordered by inclusion. List all sets in P as A1 , . . . , A2n
ordered by the difference of their cardinality from the number n/2 − 1/4. For example, if n is even,
then the above sequence first lists all sets of size n/2, then all sets of size n/2 − 1, then all sets of
size n/2 + 1, etc. For 0 6 a 6 2n , let Aa = {A1 , . . . , Aa } and note that Aa is centred. Kleitman
conjectured that for each a, k, and n, the family Aa has the smallest number of k-chains among all

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

3

a-element subsets of P . More formally, letting ck (A) denote the number of k-chains formed by the
sets in A ⊆ P and mk (a) = ck (Aa ), the conjecture states that ck (A) > mk (|A|) for every A ⊆ P .
We first observe that the function a 7→ mk (a) is convex. Indeed, its discrete derivative, the function
a 7→ mk (a) − mk (a − 1), is nondecreasing. (It takes n + 2 − k different values.) The much less obvious
property of mk that our proof requires is that
!
!
[ [n]
X n 
for all I ⊆ {0, . . . , n}.
(1)
6 ck
mk
i
i
i∈I

i∈I

In other words, (1) states that the union of any collection of rank levels of P contains at least as
many k-chains as the centred family Aa of the same cardinality. In other words, inequality (1) states
that Kleitman’s conjecture holds for each A that is a union of full rank levels of P . (That is, for A
that contain either all of or none of the sets of every given cardinality.) In order to prove (1), we

S
will generalise it by replacing i∈I [n]
with a random subfamily of P that contains each set with
i
probability depending
only on its cardinality, independently of all sets of different cardinalities, and

P
replacing i∈I ni with the expected size of this random family. Our proof of this generalisation is
elementary, but not particularly exciting, and thus we defer it to the main body of the paper. Instead,
we just show how these two properties of mk , convexity and (1), imply Kleitman’s conjecture.
Define the following integer-valued function f on subsets of P . For every X ⊆ P ,
!
!
[  [n] 
Xn
.
− ck
f (X ) = mk
|A|
|A|
A∈X

A∈X

Observe that (1) is equivalent to f (C) being nonpositive for every chain C of P . Now, fix an arbitrary
A ⊆ P and let C be a uniformly selected random chain of (maximum) length n + 1. Since A ∩ C is
also a chain, we have f (A ∩ C) 6 0. On the other hand, as for each I ⊆ {0, . . . , n},


!

k 
[
X
[ [n]
[n]
,
ck 
=
ck
ij
i
j=1

i1 ,...,ik ∈I
i1 <...<ik

i∈I

then
"

0 > E[f (A ∩ C)] = E mk

X n
|A|

A∈A∩C

!#




− E


X

A1 ,...,Ak ∈A∩C
A1 ⊂...⊂Ak




k 
[
[n] 
.
ck 

|Aj |


j=1

The random chain C contains exactly one set with cardinality i for each i ∈ {0,. . . , n}. By symmetry,
n
each such set is equally likely to appear in C. It follows that Pr(A ∈ C) · |A|
= 1 for each A ∈ P .
Since mk is convex, then Jensen’s inequality gives
#!
!#
"
"
 !
X
X n
X n
n
Pr(A ∈ C) ·
= mk (|A|),
= mk
> mk E
E mk
|A|
|A|
|A|
A∈A∩C

A∈A∩C

A∈A

Generalising the above, if 0 6 i1 < . . . < ik 6 n, then the random chain C contains exactly one
k-chain of sets with cardinalities i1 , . . . , ik . Moreover, by symmetry, each
such chain is equally likely

Sk
[n] 
= 1 whenever A1 ⊂ . . . ⊂ Ak .
to appear in C. It follows that Pr({A1 , . . . , Ak } ⊆ C) · ck
j=1 |Aj |
Consequently,









k
k 
X
[ [n]
X
[


[n] 
 =
E
ck 
Pr({A1 , . . . , Ak } ⊆ C) · ck 
= ck (A).


|Aj |
|Aj |
A1 ,...,Ak ∈A∩C
A1 ⊂...⊂Ak

j=1

We conclude that ck (A) > mk (|A|).

A1 ,...,Ak ∈A
A1 ⊂...⊂Ak

j=1

4

WOJCIECH SAMOTIJ

3. Definitions and the main result
3.1. Posets. Let P be a finite poset, that is, a finite set equipped with a partial order . A set L of
elements of P is called a chain if the elements of L are pairwise comparable. The length of a chain is
the number of its elements. For the sake of brevity, we shall refer to chains of length k as k-chains.
The height of P , which we shall denote by h(P ), is the largest length of a chain in P . We shall say
that P is homogeneous if for every two maximal chains L and L′ in P , there exists an automorphism
of P that maps L to L′ . (In particular, all maximal chains in a homogenous poset have the same
length, and therefore every homogeneous finite poset is graded.) We shall say that P is symmetric if
it is isomorphic to the reverse of P , that is, if (P, ) is order-isomorphic to (P, ).
The ranking function r : P → N maps each x ∈ P to the length of the longest chain in P whose
all elements are strictly smaller than x. This way, the elements of P with zero rank are precisely the
minimal elements of P and the largest rank of an element of P is h(P ) − 1. It will be convenient to
denote by Pi the set of all elements of P with rank i, which we refer to as the ith rank level (or simply
rank ) of P , that is,
Pi = r −1 (i) = {x ∈ P : r(x) = i}.
The following definition generalises the two notions of centred families defined in the introduction.
Definition 3. A set A of elements of a finite poset P of height n + 1 with ranking function r : P → N
is centred if it satisfies the following:
(i) If x ∈ A and y ∈ P satisfy |r(y) − n/2| < |r(x) − n/2|, then y ∈ A.
(ii) If for some i < n/2, the set A contains some but not all elements of Pi and some but not all
elements of Pn−i , then either there are no x, y ∈ A with r(x) = i and r(y) = n − i such that
x ≺ y or there are no x, y 6∈ A with r(x) = i x ≺ y for all such x, y ∈ A.
For a positive integer k and a set A of elements of P , denote by Ck (A) the set of all chains of length
k and let ck (A) denote the cardinality of this set. For a chain L ⊆ P of length at most k, and a set
J ⊆ N, let Ck′ (L, J) be the set of all k-chains in P that contain L and whose remaining elements have
ranks belonging to the set J, that is,
Ck′ (L, J) = {M ∈ Ck (P ) : L ⊆ M and r(M \ L) ⊆ J}.
Moreover, denote by c′k (L, J) the cardinality of the above set.
Fact 4. Let k be a positive integer, let P be a homogeneous poset with ranking function r : P → N,
and let J ⊆ N. If chains L1 and L2 satisfy r(L1 ) = r(L2 ), then
c′k (L1 , J) = c′k (L2 , J).
Proof. Since P is homogeneous and r(L1 ) = r(L2 ), there is an automorphism ϕ of P that maps L1
to L2 . To see this, consider arbitrary maximal chains M1 ⊇ L1 and M2 ⊇ L2 and observe that every
automorphism of P must preserve the rank. It is easy to see that ϕ is a bijection between Ck′ (L1 , J)
and Ck′ (L2 , J).

Since in homogeneous posets, for every k and every J ⊆ N, the function L 7→ c′k (L, I) depends only
on r(L), abusing the notation slightly, given an I ⊆ N, we shall write c′k (I, J) to denote c′k (L, J) for
some (every) chain L with r(L) = I. (For the sake of brevity, we shall from now on often write x in
place of {x} to denote the one-element set containing x.)
Definition 5. A homogenous poset P with height n + 1 is descending if for every 0 < i < j 6 n,
c′2 (i, j) 6 c′2 (i − 1, j − 1).
We shall say that P is strictly descending if the above inequality is strict for all such i and j.

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

5

3.2. The main result. With all definitions in place, we are finally ready to state the main technical
result of this paper.
Theorem 6. Suppose that P is a descending, homogeneous, and symmetric finite poset. For all
positive integers a and k, every centred set of a elements of P has the smallest number of k-chains
among subsets of P of this size. Moreover, if k > 2, P is strictly descending, and a centred family
of a subsets contains at least one k-chain, then every non-centred family of this size contains strictly
more k-chains.
In order to deduce Theorems 1 and 2, it now suffices to check here that the boolean lattice and
the poset of subspaces of a finite vector space are strictly descending, homogeneous, and symmetric.
The ranking function of the boolean lattice is simply the cardinality. The homogeneity and symmetry
properties are straightforward to verify. This poset is strictly descending as if 0 < i < j 6 n, then

 

n−i
n−i+1
′
c2 (i, j) =
<
= c′2 (i − 1, j − 1).
j−i
j−i

The ranking function of the poset of subspaces of a finite vector space is simply the dimension. To see
that it is homogeneous, take any two chains of maximal length. Each of them gives rise to a sequence
of vectors that form a basis of the entire vector space. The linear operator that maps one of these
sequences to the other induces an isomorphism of the entire vector space that maps one of the chains
to the other. The function mapping each subspace of the vector space to its orthogonal complement
is an isomorphism between the poset and its reverse; this proves that this poset is symmetric. To see
that this poset is also strictly descending, note first that every finite vector space is isomorphic to Fnq
for some integer n and prime power q. By elementary linear algebra, the number of subspaces of Fnq
of dimension i is
i−1 n
Y
q − qℓ
qi − qℓ
ℓ=0

and if 0 6 i < j 6 n, then c2 (i, j) equals the number of subspaces of dimension j − i of the space Fqn−i .
Therefore, if 0 < i < j 6 n, then
c2 (i, j) =

j−i−1
Y
ℓ=0

j−i−1
Y q n+1−i − q ℓ
q n−i − q ℓ
<
= c2 (i − 1, j − 1).
q j−i − q ℓ
q j−i − q ℓ
ℓ=0

In particular, the poset of subspaces of every finite vector space is strictly descending.
4. Lemmata and the derivation of Theorem 6
4.1. Key lemmata. The proof of Theorem 6 will employ a discrete version of Jensen’s inequality,
which we present below. Suppose that a and b are integers with a < b and consider a function
f : {a, . . . , b} → R. The (backward) discrete derivative of f is the function ∆f : {a + 1, . . . , b} defined
by
∆f (x) = f (x) − f (x − 1).
We shall say that f is convex if ∆f is nondecreasing. The following statement is a discrete version of
Jensen’s inequality.
Lemma 7. Let a and b be integers satisfying a < b and suppose that f : {a, . . . , b} → R is convex. If X
is an random variable taking values in {a, . . . , b} such that E[X] is an integer, then E[f (X)] > f (E[X]).
Moreover, this inequality is strict unless there are integers c and d such that Pr(c 6 X 6 d) = 1 and
∆f is constant on {c + 1, . . . , d}.
One may easily prove Lemma 7 by invoking the standard version of Jensen’s inequality for any
convex function g : [a, b] → R that extends f . One such function g is defined by letting
g(x) = (⌈x⌉ − x) · f (⌊x⌋) + (x − ⌊x⌋) · f (⌈x⌉)

for x ∈ [a, b] \ Z.

6

WOJCIECH SAMOTIJ

We shall say that a set I ⊆ {0, . . . , n} is centred if I is centred in the sense of Definition 3 with P
being the standard ordering 6 of the set {0, . . . , n}. The following easy fact will be needed to derive
the second part of Theorem 6, that is, the characterisation of subsets that minimise the number of
chains.
Fact 8. Suppose that P is a homogeneous, symmetric, and descending poset of height n + 1. Then P
is rank-unimodal. In particular, if i, j ∈ [0, n] satisfy |i − n/2| 6 |j − n/2|, then |Pi | > |Pj |. Moreover,
if P is strictly descending and |i − n/2| < |j − n/2|, then |Pi | < |Pj |.
Suppose that P is a homogeneous, symmetric, and descending poset of height n + 1. It follows from
Fact 8 that for every ℓ ∈ {1, . . . , n + 1} sets of ℓ largest ranks of P are formed by ranks whose indices
fall into (one of at most two) centred sets I ⊆ {0, . . . , n} of cardinality ℓ. Moreover, if P is strictly
descending, then the centred ℓ-element sets are the only sets of ℓ largest ranks. Keeping this in mind,
for every ℓ as above, let Iℓ be one of the at most two centred subsets of {0, . . . , n} with ℓ elements
(the other centred set of the same size is n − Iℓ ) and define
X
aℓ =
|Pi |.
i∈Iℓ

In other words, aℓ is the number of elements in the ℓ largest ranks of P . (If P is the boolean lattice,
then aℓ is the sum of the ℓ largest binomial coefficients.) For every integer a with 0 6 a 6 |P |, let
mk (a) denote the number of k-chains in some centred a-element subset of P . It is not very difficult to
see that this definition does not depend on a particular choice of the a-element subset, as long as P
is homogeneous and symmetric. Our first key lemma states that the function mk is convex and that
its discrete derivative ∆mk increases at each aℓ with ℓ > k − 1.
Lemma 9. Suppose that P is a homogeneous, symmetric, and descending finite poset. For each k > 1,
the function mk : {0, . . . , |P |} → N is convex. Moreover, ∆mk (aℓ ) < ∆mk (aℓ + 1) for every ℓ > k − 1.
Our second key lemma states that the union of any collection of rank levels of P contains at least
as many k-chains as a centred set of the same cardinality.
Lemma 10. Suppose that P is a homogeneous, symmetric, and descending poset with height n + 1.
For every I ⊆ {0, . . . , n} and every k > 2,
!
!
X
[
|Pi | .
ck
Pi > mk
i∈I

i∈I

Moreover, if P is strictly descending and |I| > k, then the above inequality is strict unless I is centred.

We postpone the proofs of both lemmas to the next section and show first how to use them to prove
Theorem 6. We only mention here that while proving Lemma 9 is rather easy and straightforward,
establishing Lemma 10 requires work. The main idea behind our proof of the latter is to first generalise
S
its statement by replacing i∈I Pi with a random subset of P that is uniform in each rank level and
independent between different rank level. We then show that for every a, the expected number of kchains in such a random set with expected cardinality a is minimised when the probabilities assigned to
the elements of P are the largest for elements whose ranks are the closest to n/2; one such distribution
is supported on centred families with a elements. We achieve this by defining an operator on the set
of all such distributions that pushes the support of a distribution towards the middle rank levels, at
the same time decreasing the expected number of k-chains.
4.2. Derivation of Theorem 6. The derivation of the first assertion of Theorem 6 is simply a
reiteration of the argument that we already presented in Section 2. We mention here again that our
argument draws inspiration from [9, Lemma 2.2]. The second assertion of the theorem is obtained by
the means of a careful analysis of the cases of equality in the two crucial inequalities appearing in the
proof of the first assertion.

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

7

Proof of Theorem 6. Suppose that P is a homogeneous, symmetric, and descending poset of height
n + 1. Define the following integer-valued function f on subsets of P . For every X ⊆ P , let
!
!
X
[
f (X) = mk
|Pr(x) | − ck
Pr(x) .
x∈X

x∈X

It follows from Lemma 10 that f (C) is nonpositive for every chain C of P . Indeed, every chain of C
contains at most one element of each rank. Now, fix an arbitrary A ⊆ P and let C be a uniformly
selected random chain of maximum length. Since A ∩ C is also a chain, we have f (A ∩ C) 6 0. On
the other hand, as for each I ⊆ {0, . . . , n},


!
k
[
X
[
Pij  ,
ck 
Pi =
ck
i1 ,...,ik ∈I
i1 <...<ik

i∈I

j=1

the,

"

0 > E[f (A ∩ C)] = E mk

X

!#

|Pr(x) |

x∈A∩C




− E


X

x1 ,...,xk ∈A∩C
x1 ≺...≺xk



ck 

k
[

j=1






Pr(xj ) 
.

(2)

The random chain C contains exactly one element of rank i for each i ∈ {0, . . . , n}. Since P is
homogeneous, each such element is equally likely to appear in C. It follows that Pr(x ∈ C) · |Pr(x) | = 1
for each x ∈ P . Since mk is convex, it follows from Jensen’s inequality (Lemma 7) that
!
#!
!#
"
"
X
X
X
Pr(x ∈ C) · |Pr(x) | = mk (|A|), (3)
|Pr(x) |
= mk
|Pr(x) |
> mk E
E mk
x∈A∩C

x∈A∩C

x∈A

Generalising the above, if 0 6 i1 < . . . < ik 6 n, then the random chain C contains exactly one
k-chain of elements with ranks i1 , . . . , ik . Since P is homogeneous,
each
 such chain is equally likely
S
k
to appear in C. It follows that Pr({x1 , . . . , xk } ⊆ C) · ck
j=1 Pr(xj ) = 1 whenever x1 ≺ . . . ≺ xk .
Consequently,






k
k
X
[
X
[


E
ck 
Pr(xj ) 
Pr({x1 , . . . , xk } ⊆ C) · ck 
Pr(xj )  = ck (A).

=
x1 ,...,xk ∈A∩C
x1 ≺...≺xk

j=1

x1 ,...,xk ∈A
x1 ≺...≺xk

j=1

We conclude that ck (A) > mk (|A|).
For the second assertion of the theorem, assume that P is strictly descending, that k > 2, and that
A ⊆ P is an a-element set that satisfies ck (A) = mk (a) > 0. We need to show that A is centred. Since
mk (a) > 0 = mk (ak−1 ), it must be that a > ak−1 . Crucially, since ck (A) = mk (a), both (2) and (3)
must hold with equality. The former implies that f (A ∩ C) = 0 for every chain C of maximum length,
whereas the latter and Lemma 7 imply that, as C ranges over all chains of maximum length, the sum
P
x∈A∩C |Pr(x) | takes values between some integers c and d for which ∆mk (c + 1) = ∆mk (d). Since
the expected value of this sum is a, the second part of Lemma 9 implies that aℓ 6 c 6 a 6 d 6 aℓ+1
for some ℓ > k − 1. As aℓ is the sum of the ℓ largest ranks of P , then for every longest chain C, the
set A ∩ C has at least ℓ elements. Moroever, |A ∩ C| > ℓ unless r(A ∩ C) comprises some ℓ largest
ranks of P , that is, unless r(A ∩ C) is centred, see the discussion following the statement of Fact 8.
Furthermore, if |A ∩ C| > ℓ > k − 1, then r(A ∩ C) is also centred, as f (A ∩ C) = 0, by the second
P
part of Lemma 10. Consequently, for every chain C of maximum length, the sum x∈A∩C |Pr(x) |
is the sum of the |A ∩ C| largest ranks of P . Since this sum is bounded from above by aℓ+1 , then
|A ∩ C| 6 ℓ + 1. To summarise, for each maximum chain C, the set r(A ∩ C) is centred and has either
ℓ or ℓ + 1 elements. We claim that this property forces the set A to be centred. Indeed, suppose
first that x ∈ A and y ∈ P satisfy |r(y) − n/2| < |r(x) − n/2|. Since x is contained in some longest
chain, then r(x) is among some ℓ + 1 largest ranks. As r(y) is closer to n/2 than r(x) is and P is

8

WOJCIECH SAMOTIJ

strictly descending, then r(y) must belong to every set of largest ℓ ranks, see the discussion following
the statement of Fact 8. As y belongs to some longest chain C and r(A ∩ C) contains some ℓ largest
ranks of P , then y ∈ A. Finally, suppose that there is an i < n/2 such that A contains some but
not all elements of both Pi and Pn−i . We claim that there cannot simultaneously be x ∈ A ∩ Pi ,
x′ ∈ Pi \ A, y ∈ A ∩ Pn−i , and y ′ ∈ Pn−i \ A such that x ≺ y and x′ ≺ y ′ , which is precisely saying
that A satisfies (ii) in Definition 3. Suppose that there were such x, x′ , y, and y ′ and let C and C ′ be
two chains of maximum length that contain {x, y} and {x′ , y ′ }, respectively. Since both r(A ∩ C) and
r(A ∩ C ′ ) are centred, then r(A ∩ C) ⊇ {i, . . . , n − i} and r(A ∩ C ′ ) ⊆ {i + 1, . . . , n − i − 1}. But this
contradicts the fact that |r(A ∩ C)| 6 ℓ + 1 6 |r(A ∩ C ′ )| + 1, completing the proof of the theorem. 
5. The proofs
In this section, we give proofs of the three key auxiliary results stated in Section 4.1: Fact 8 and
Lemmas 9 and 10. For the sake of brevity, given an integer i, we shall write [i] to denote the set
{1, . . . , i}. Moreover, for integers i and j, we shall denote by [i, j] the set of all integers k with
i 6 k 6 j, that is,
[i, j] = {k ∈ Z : i 6 k 6 j}.
We first give a proof of Fact 8, establishing two properties of the function c′k along the way.
Fact 11. Let k be a positive integer, let P be a homogeneous and symmetric poset of height n + 1.
For every I, J ⊆ [0, n],
c′k (I, J) = c′k (n − I, n − J).
Proof. Let L be an arbitrary chain with r(L) = I and let ϕ be an arbitrary isomorphism between
(P, ) and (P, ). Clearly, the same sets form chains in both (P, ) and (P, ). Moreover, since P
is homogeneous of height n + 1, then for each x ∈ P , we have r(ϕ(x)) = n − r(x). Thus, ϕ is a
bijection between Ck′ (L, J) and Ck′ (ϕ(L), n − J) and hence c′k (I, J) = c′k (L, J) = c′k (ϕ(L), n − J) =

c′k (n − I, n − J).
Fact 12. Let P be a descending homogeneous poset of height n + 1. For every k > 2, every i ∈ [n],
every 1 6 s 6 i, and each J ⊆ [i + 1, n], we have
c′k (i, J) 6 c′k (i − s, J − s).
Moreover, if P is strictly descending and |J| > k − 1, then the above inequality is strict.
Proof. It is clearly enough to prove the statement for s = 1. Moreover, we may assume that |J| = k−1,
as
X
c′k (i, J) =
c′k (i, J ′ ).
J ′ ⊆J
|J ′ |=k−1

Suppose that J = {i + s1 , . . . , i + sk−1 } for some 0 < s1 < . . . < sk−1 . Letting s0 = 0, we may write
c′k (i, J) =

k−1
Y

c′2 (i + sj−1 , i + sj ) 6

k−1
Y

c′2 (i + sj−1 − 1, i + sj − 1) = c′k (i − 1, J − 1),

j=1

j=1

where the above inequality is strict if P is strictly descending.



Proof of Fact 8. Since P is homogeneous and symmetric, then |Pi | = |Pn−i | for each i ∈ [0, n]. We
may thus assume that j < i 6 n/2. Counting comparable pairs (x, y) ∈ Pi × Pj in two different ways,
we obtain
|Pi | · c′2 (i, j) = c2 (∅, {i, j}) = |Pj | · c′2 (j, i).
(4)
By Facts 11 and 12 with s = n − i − j,
c′2 (i, j) = c′2 (n − i, n − j) 6 c′2 (j, i),

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

9

which together with (4) implies that |Pi | > |Pj | and that this inequality is strict if P is strictly
descending.

Let P be a homogenous and symmetric poset of height n + 1. Centred sets of elements of P admit
a somewhat more explicit description (as compared to Definition 3) using orderings µ : [n + 1] → [0, n]
of the ranks P0 , . . . , Pn of P as Pµ(1) , . . . , Pµ(n+1) that are nondecreasing in the distance from the
middle, that is, such that |µ(ℓ) − n/2| is nondecreasing in ℓ. One can easily see that there are as
many as 2⌈n/2⌉ such orderings. We shall distinguish two of them, denoted µ− and µ+ , which we now
define. The sequence µ− is the ordering of the elements of [0, n] by their growing distance from the
number n/2 − 1/4. Similarly, µ+ is the ordering of the elements of [0, n] by their growing distance
from n/2 + 1/4. In other words, for each ℓ ∈ [n + 1],
j
k
ℓ
 n+(−1) ℓ
if n is odd,
2
and
µ+ (ℓ) = n − µ− (ℓ).
µ− (ℓ) = l n+(−1)ℓ ℓ m

if n is even,
2

Observe that for each ℓ ∈ [n + 1], the sets µ− ([ℓ]) and µ+ ([ℓ]) are the only centred ℓ-element subsets
of [0, n]. We may now explicitly describe a nested sequence of centred subsets of P . To this end, let
N = |P | and let µ be any ordering of the ranks of P that is nondecreasing in the distance from n/2,
e.g., µ ∈ {µ− , µ+ }. We order the elements of P as x1 , . . . xN by exhaustively listing the elements of
levels Pµ(1) , . . . , Pµ(n+1) , in this order, one-by-one. Formally, for every a ∈ [N ], we let ℓ be the largest
integer such that a > aℓ−1 = |Pµ(1) | + . . . + |Pµ(ℓ−1) | and let xa be an arbitrary element of Pµ(ℓ) that
is not yet among x1 , . . . , xa−1 . For each a ∈ [N ], let Xa = {x1 , . . . , xa } and let mk (a) = ck (Xa ). It is
not very difficult to see that mk does not depend on the choice of µ or on the particular ordering of
the xa within the rank levels. Moreover, for each ℓ ∈ [n + 1],
Pµ(ℓ) = {xa : aℓ−1 < a 6 aℓ }.
Let us point out that not all centred subsets of P may be described in this fashion, but nonetheless
each a-element centred A ⊆ P does satisfy ck (A) = ck (Xa ).
Proof of Lemma 9. Suppose that P is a homogeneous, symmetric, and descending finite poset of height
n + 1. Our aim is to show that for each a ∈ [1, |P | − 1], the inequality
∆mk (a) 6 ∆mk (a + 1)

(5)

holds and that (5) is strict whenever a = aℓ for some ℓ > k. The left-hand and the right-hand sides
of (5) are c′k (xa , r(Xa )) and c′k (xa+1 , r(Xa+1 )), respectively. Since



c′k xa+1 , r(Xa+1 ) = c′k xa+1 , r(Xa+1 \ {xa+1 }) = c′k xa+1 , r(Xa ) ,
then Fact 4 implies that (5) holds with equality unless xa and xa+1 have different ranks or, equivalently,
unless a = aℓ for some ℓ. In particular, we have Xa = Pµ(1) ∪ . . . ∪ Pµ(ℓ) and xa+1 ∈ Pµ(ℓ+1) . We split
the remainder of the proof into two cases, depending on whether or not µ(ℓ + 1) is farther away from
n/2 than µ(ℓ).
Case 1. |µ(ℓ + 1) − n/2| = |µ(ℓ) − n/2|.
In this case, µ(ℓ + 1) = n − µ(ℓ) and µ([ℓ + 1]) = n − µ([ℓ + 1]). Therefore by Facts 4 and 11,



c′k xa+1 , r(Xa+1 ) = c′k µ(ℓ + 1), µ([ℓ + 1]) = c′k µ(ℓ), µ([ℓ + 1])


= c′k µ(ℓ), µ([ℓ]) + c′k {µ(ℓ), µ(ℓ + 1)}, µ([ℓ − 1])


= c′k xa , r(Xa ) + c′k {µ(ℓ), µ(ℓ + 1)}, µ([ℓ − 1]) .



Thus, c′k xa+1 , r(Xa+1 ) > c′k xa , r(Xa ) and the inequality is strict when c′k {µ(ℓ), µ(ℓ+1)}, µ([ℓ−1])
is nonzero, which happens if an only if ℓ + 1 > k.

10

WOJCIECH SAMOTIJ

Case 2. |µ(ℓ + 1) − n/2| > |µ(ℓ) − n/2|.
In this case, µ([ℓ]) = n − µ([ℓ]) and µ(ℓ + 1) ∈ {min µ([ℓ]) − 1, max µ([ℓ]) + 1}. In particular, letting
i = min µ([ℓ]), by Facts 4 and 11,




c′k xa+1 , r(Xa+1 ) = c′k µ(ℓ + 1), µ([ℓ + 1]) = c′k µ(ℓ + 1), µ([ℓ]) = c′k i − 1, µ([ℓ])
and




c′k xa , r(Xa ) = c′k µ(ℓ), µ([ℓ]) = c′k i, µ([ℓ]) .


Thus, it suffices to verify that c′k i, µ([ℓ]) 6 c′k i − 1, µ([ℓ]) and that the inequality is strict when
ℓ > k − 1. To this end, let x and y be two elements of P satisfying x ≺ y with r(x) = i − 1 and r(y) = i
and observe that for each I ⊆ [i, n], there is a canonical injection from Ck′ (y, I) to Ck′ (x, I), defined
by replacing y by x in each k-chain. Note moreover, that the image of Ck′ (y, µ[ℓ]) via this injection
cannot contain any k-chain passing through both x and y and that there is at least one such chain
when ℓ > k − 1.

Proof of Lemma 10. Fix an I ⊆ [0, n], let q = (q0 , . . . , qn ) ∈ {0, 1}n+1 be its characteristic vector, that
is, qi = 1 if i ∈ I and qi = 0 otherwise, and let
a=

X
i∈I

|Pi | =

n
X

qi |Pi |.

i=0

Define
D=

(

(p0 , . . . , pn ) ∈ [0, 1]n+1 : pi |Pi | ∈ N for all i and

n
X
i=0

pi |Pi | = a

)

and note that q ∈ D. Given a p = (p0 , . . . , pn ) ∈ D, let R be the random set of elements of P formed
by including each x ∈ P with probability pr(x) , independently of other elements. Observe that the
expected size of R is precisely a and define
X
Y
wk (p) = E[ck (R)] =
c′k (∅, J) ·
pj .
(6)
|J|=k

j∈J

Claim 12.1. The function wk : D → R achieves its minimum at a vector p for which there exist
ℓ ∈ [n + 1] and µ ∈ {µ− , µ+ } such that pµ(m) = 1 for all m < ℓ and pµ(m) = 0 for all m > ℓ. Moreover,
if P is strictly descending and |I| > k, then wk (q) > wk (p) unless I = µ− ([|I|]) or I = µ+ ([|I|]), that
is, unless I is centred.
Let us first argue that Claim 12.1 implies the assertion of the lemma. To this end, let p ∈ D be a
vector minimising wk on D of the form described in the claim. Since
!
[
Pi = wk (q) > wk (p),
ck
i∈I

and the above inequality is strict unless |I| < k, I = µ− ([|I|]), or I = µ+ ([|I|]), it is clearly enough
Sℓ−1
to show that wk (p) = mk (a). Let M = pµ(ℓ) |Pµ(ℓ) | and let R′ be the union of m=0
Pµ(m) and the
uniformly chosen random M -element subset of Pµ(ℓ) . Since every chain contains at most one element
of each rank,
E[ck (R′ )] = E[ck (R)] = wk (p).
On the other hand, it is not hard to see that ck (R′ ) is constant. Indeed, since R′ \ Pµ(ℓ) is a union of
full ranks, Fact 4 implies that
X




ck (R′ ) = ck R′ \Pµ(ℓ) +
c′k x, r(R′ \Pµ(j) ) = c′k ∅, µ([ℓ−1]) +|R′ ∩Pµ(ℓ) |·c′k µ(ℓ), µ([ℓ−1])
x∈R′ ∩Pµ(ℓ)



= c′k ∅, µ([ℓ − 1]) + M · c′k µ(ℓ), µ([0, ℓ − 1]) . (7)

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS
|Pµ(j) |
M

Finally, it is clear that Pr(R′ = Xa ) = 1/

11

> 0 and thus

wk (p) = E[ck (R′ )] = ck (Xa ) = mk (a).
We now prove the claim. To this end, we shall define a compression operator Φ : D → D that,
roughly speaking, pushes the mass of every distribution p towards the middle rank levels. We shall
then verify that Φ has the following three properties:
(P1) For every p ∈ D, we have wk (Φ(p)) 6 wk (p).
(P2) For every p ∈ D, there is a K such that Φ(K) (p) has the form described in Claim 12.1.
(P3) If |I| > k but I 6= µ− ([|I|]) and I 6= µ+ ([|I|]), then wk (Φ(q)) < wk (q).
It is not hard to see that the existence of such a Φ would establish the claim. Indeed, since D is finite,
wk achieves its minimum on some p′ ∈ D. By property (P2), applying Φ to p′ some number of times
produces a vector p of the form described in the statement of the claim. By property (P1), we have
wk (p) 6 wk (p′ ) = min wk (D). Finally, property (P3) implies the last assertion of the claim. It thus
suffices to construct such a compression operator Φ.
Fix some p ∈ D, let p̄ = (pn , . . . , p0 ) and note that p̄ ∈ D, as P is symmetric. Fact 11 implies that
X
Y
X
Y
pn−j =
pn−j = wk (p).
(8)
wk (p̄) =
c′k (∅, J) ·
c′k (∅, n − J) ·
j∈J

|J|=k

|J|=k

j∈J

Furthermore, p has the form described in Claim 12.1 if and only if p̄ has such form, with µ+ playing
the role of µ− and vice-versa. Let i be the smallest index such that max{pi , pn−i } > 0. By (8), we
may assume that pi > 0, as otherwise we replace p with p̄. Now, let i′ be the smallest index greater
than i such that pi′ 6= 1. (If such i′ does not exist, then p = (1, . . . , 1) and p is the only element of
D.) Clearly, i + 1 6 i′ 6 n − i + 1. If i′ = n − i + 1, then p has the required form, with µ = µ+ and
ℓ = (µ+ )−1 (i), and we let Φ(p) = p. Thus, we may assume that i′ 6 n − i. If i′ = n − i and pi′ = 0,
then p has the required form, with µ = µ− and ℓ = (µ− )−1 (i), and we again let Φ(p) = p. Thus, we
may assume that either i′ < n − i or that i′ = n − i but 0 < pi′ < 1. By (8), we may assume that in
the latter case pi 6 pn−i , as otherwise we may replace p with p̄. (Note also for future reference that
the latter case is impossible if p = q, as all coordinates of q are either 0 or 1.) Let


|Pi |
|Pi′ |
.
and
δ′ = δ ·
δ = min pi , (1 − pi′ ) ·
|Pi |
|Pi′ |
Define Φ(p) = (p′0 , . . . , p′n ) by
p′j

=




pi − δ
p i′ +


p
j

δ′

if j = i,
if j = i′ ,
if j 6∈ {i, i′ },

and observe that Φ(p) ∈ D. Informally speaking, Φ moves as much mass as possible from pi to pi′
subject to pi and pi′ remaining in the interval [0, 1]; in particular, either p′i = 0 or p′i′ = 1. It is not
difficult to see that for large enough K, the vector Φ(K) (p) has the special form described in the claim.
Indeed, if i′ = n − i, then already Φ(p) has this form. Otherwise, letting h : D → N be the function
defined by
n
X
|2i − n| · pi |Pi |,
h(p) =
i=0

one sees that h(Φ(p)) < h(p).
We claim that wk (Φ(p)) 6 wk (p) and that if P is strictly descending and |I| > k, then this
inequality is strict. To this end, let
J1 = {J ⊆ [0, n] : |J| = k − 1 and i, i′ 6∈ J},
J2 = {J ⊆ [0, n] : |J| = k − 2 and i, i′ 6∈ J}

12

WOJCIECH SAMOTIJ

and observe that
wk (p) − wk (Φ(p)) =

X

c′k (∅, J ∪ {i}) · δ

Y

j∈J

J∈J1

+

X

pj −

X

c′k (∅, J ∪ {i′ }) · δ′

Y

pj

j∈J

J∈J1

c′k (∅, J ∪ {i, i′ }) · (pi pi′ − (pi − δ)(pi′ + δ′ ))

Y

pj . (9)

j∈J

J∈J2

We first claim that each summand in the third sum in (9) is nonnegative. Clearly, it suffices to show
that
(10)
pi pi′ − (pi − δ)(pi′ + δ′ ) > 0.
By our choice of δ and δ′ , either pi − δ = 0 or pi′ + δ′ = 1. In the former case, inequality (10) holds
trivially. Assume that the latter case holds. If i′ = n − i, then δ = δ′ , as |Pi | = |Pi′ | by Fact 8, and
pi 6 pi′ by the assumption we made above. Thus,
pi pi′ − (pi − δ)(pi′ + δ′ ) = δ(pi′ − pi ) + δ2 > 0.
Finally, if i′ < n − i, then |Pi′ | > |Pi | by Fact 8. In particular, δ = (1 − pi′ )|Pi′ |/|Pi | > 1 − pi′ and
consequently,
pi pi′ − (pi − δ)(pi′ + δ′ ) = pi pi′ − pi + δ > pi pi′ − pi + 1 − pi′ = (1 − pi )(1 − pi′ ) > 0.
We now move to the heart of the matter, which is comparing the first two sums.
Let σ : [0, n] → [0, n] be the function that reverses the interval [i + 1, i′ − 1], that is, let
(
i + i′ − j if i < j < i′ ,
σ(j) =
j
otherwise.
It is easy to see that σ induces an involution in J1 . Indeed, σ is an involution in P([0, n]) and σ(J) ∈ J1
for each J ∈ J1 .
Claim 12.2. For each J ∈ J1 with J ⊆ [i + 1, n − i − 1],
δ · c′k (∅, J ∪ {i}) > δ′ · c′k (∅, σ(J) ∪ {i′ }).

(11)

Moreover, if P is strictly descending and i′ < n − i, then the above inequality is strict.
We first argue that Claim 12.2 implies that the right-hand side of (9) is nonnegative. Indeed, if
Q
Q
there was a j ′ ∈ J with j ′ < i or j ′ > n − i, then j∈J pj = j∈σ(J) pj = 0 as pj ′ = pσ(j ′ ) = 0 by our
choice of i. Crucially, since pj = 1 for all j ∈ [i + 1, i′ − 1], then for each J as in the claim,
Y
Y
Y
Y
pj =
pj =
pj =
pj .
j∈J

j∈J\[i+1,i′ −1]

j∈σ(J\[i+1,i′ −1])

j∈σ(J)

Therefore, summing (11) over all J implies that the first line of the right-hand side of (9) is nonnegative,
and we have already shown above that the second line is also nonnegative. Moreover, if P is strictly
descending, then inequality (11) is strict. Since if |I| > k and p = q, then i′ 6= n − i and there is a
Q
J ∈ J1 such that j∈J pj > 0 and consequently, the right-hand side of (9) is positive.
It suffices to prove Claim 12.2. To this end, fix a J ∈ J1 and suppose that
J ∩ [i + 1, i′ − 1] = {i + s1 , . . . , i + sr }

for some r > 0 and 0 < s1 < . . . < sr < i′ − i. Since i < min J, then
c′k (∅, J ∪ {i}) = |Pi | · c′k (i, J) = |Pi | · c′r+1 (i, {i + s1 , . . . , i + sr }) · ck−r (i + sr , J ∩ [i′ + 1, n]).
Similarly, as σ(J) ∩ [0, i′ − 1] = σ({i + s1 , . . . , i + sr }) = {i′ − s1 , . . . , i′ − sr }, then
c′k (∅, σ(J) ∪ {i′ }) = |Pi′ | · c′r+1 (i′ , σ(J)) = |Pi′ | · cr+1 (i′ , {i′ − s1 , . . . , i′ − sr }) · c′k−r (i′ , J ∩ [i′ + 1, n]).
By Fact 11,
cr+1 (i′ , . . . , {i′ − s1 , . . . , i′ − sr }) = cr+1 (n − i′ , {n − i′ + s1 , . . . , n − i′ + sr }).

SUBSETS OF POSETS MINIMISING THE NUMBER OF CHAINS

13

Finally, note three facts. First, δ|Pi | = δ′ |Pi′ |. Second, since i + sr < i′ , then
c′k−r (i + sr , J ∩ [i′ + 1, n]) > c′k−r (i′ , J ∩ [i′ + 1, n]).
Indeed, letting x ∈ Pi+sr and y ∈ Pi′ be arbitrary elements with x ≺ y, there is a natural injection
′
′
(x, J ∩ [i′ + 1, n]), simply replacing y with x. Finally, as i 6 n − i′ ,
(y, J ∩ [i′ + 1, n]) to Ck−r
from Ck−r
then by Fact 12, we have
c′r+1 (i, {i + s1 , . . . , i + sr }) > c′r+1 (n − i′ , {n − i′ + s1 , . . . , n − i′ + sr }).
Moreover, if P is strictly descending and i′ < n − i, then the above inequality is strict. This proves
Claim 12.2, thus completing the proof of Lemma 10.

References
[1] J. Balogh, S. Petřı́čková, and A. Z. Wagner, Families in posets minimizing the number of comparable pairs,
arXiv:1703.05427 [math.CO].
[2] J. Balogh and A. Z. Wagner, Kleitman’s conjecture about families of given size minimizing the number of k-chains,
arXiv:1609.02262 [math.CO].
[3] S. Das, W. Gan, and B. Sudakov, Sperner’s theorem and a problem of Erdős, Katona and Kleitman, Combin.
Probab. Comput. 24 (2015), 585–608.
[4] A. P. Dove, J. R. Griggs, R. J. Kang, and J.-S. Sereni, Supersaturation in the Boolean lattice, Integers 14A (2014),
Paper No. A4, 7.
[5] P. Erdős, On a lemma of Littlewood and Offord, Bull. Amer. Math. Soc. 51 (1945), 898–902.
[6] D. J. Kleitman, A conjecture of Erdős-Katona on commensurable pairs among subsets of an n-set, Theory of Graphs
(Proc. Colloq., Tihany, 1966), Academic Press, New York, 1968, pp. 215–218.
[7] J. E. Littlewood and A. C. Offord, On the number of real roots of a random algebraic equation. III, Rec. Math.
[Mat. Sbornik] N.S. 12 (1943), 277–286.
[8] D. Lubell, A short proof of Sperner’s lemma, J. Combinatorial Theory 1 (1966), 299.
[9] J. A. Noel, A. Scott, and B. Sudakov, Supersaturation in posets and applications involving the container method,
arXiv:1610.01521 [math.CO].
[10] E. Sperner, Ein Satz über Untermengen einer endlichen Menge, Math. Z. 27 (1928), 544–548.
School of Mathematical Sciences, Tel Aviv University, Tel Aviv 6997801, Israel
E-mail address: samotij@post.tau.ac.il

