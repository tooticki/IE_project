NEARBY CYCLES OF PARAHORIC SHTUKAS,
AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

arXiv:1711.02243v2 [math.NT] 21 Feb 2018

TONY FENG
Abstract. Following the paradigm initiated by Kottwitz, we compute the trace of Frobenius composed
with Hecke operators on the cohomology of nearby cycles, at places of parahoric reduction, of perverse
sheaves on certain moduli stacks of shtukas. Inspired by an argument of Ng√¥, we then use this to give
a geometric proof of a base change fundamental lemma for parahoric Hecke algebras for GLn over local
function Ô¨Åelds. This generalizes a theorem of Ng√¥, who proved the base change fundamental lemma for
spherical Hecke algebras for GLn over local function Ô¨Åelds, and extends to positive characteristic (for GLn )
a fundamental lemma originally introduced and proved by Haines for p-adic local Ô¨Åelds.

Contents
1. Introduction
2. Statement of results and overview of the paper
3. Notation
4. Moduli of shtukas
5. The Kottwitz Conjecture for shtukas
6. Counting parahoric shtukas
7. Geometrization of base change for Hecke algebras
8. Comparison of two moduli problems
9. Calculation of traces on the cohomology of nearby cycles
References

1
4
8
9
16
20
25
32
34
39

1. Introduction
There are two main goals of this paper:
(1) To compute the trace of Frobenius composed with Hecke operators on the cohomology of nearby
cycles at places of parahoric reduction for certain moduli stacks of shtukas, and
(2) To parlay the resulting formulas into a geometric proof of a fundamental lemma for base change for
central elements in parahoric Hecke algebras over local function fields.
The first goal is accomplished by using the Grothendieck-Lefschetz trace formula to break up the computation
of the trace into two pieces: (1) counting points on certain moduli spaces, and (2) understanding the stalks
of the nearby cycles sheaves. These pieces are then each resolved by a sequence of technical steps whose
overall strategy is rather well-known, and which would require a considerable amount of notation to describe.
Therefore, in this introduction we will focus on informally explaining the idea of the second goal.
The fundamental lemma of interest was proposed and proved by Haines [Hai09] for p-adic (i.e. mixed
characteristic) local fields, and generalizes the fundamental lemma for base change for spherical Hecke algebras proved (independently) in the p-adic case by Clozel [Clo90] and Labesse [Lab90], building on work of
Kottwitz [Kot86a], and in the function field case (for GLn ) by Ng√¥ [Ngo06].
The original motivation for this fundamental lemma was to study the cohomology of a Shimura variety with
parahoric level structure, and in particular to determine the semisimple zeta factor at a place of parahoric
reduction. The fundamental lemma enters in comparing the trace of Frobenius and Hecke operators on this
cohomology with the geometric side of the Arthur-Selberg trace formula. We refer the interested reader to
[Hai09], especially p. 573, for more details.
1

2

TONY FENG

The same applications are available in the function field setting, with Shimura varieties replaced by the
moduli stacks of shtukas, which have been utilized by Drinfeld ([Dri87], for GL2 ), L. Lafforgue ([Laf02], for
GLn ), and V. Lafforgue ([Laf12], for general reductive groups) to spectacular success towards the global
Langlands correspondence over function fields.
However, in this paper we have chosen to emphasize the geometric aspect of the fundamental lemma,
rather than its applications to the Langlands program. In contrast to the proof of [Hai09] for p-adic case,
which following in the tradition of [Clo90] and [Lab90] is via p-adic harmonic analysis, our proof works by
exploiting additional geometry and structure which is available in the function field setting. Our strategy is
very much based on that of [Ngo06], and indeed specializes to it in the case of spherical Hecke algebras. We
think it would be useful to give an impressionistic preview of the strategy now. A more detailed overview
will be given in ¬ß2.1 and ¬ß2.2.
Broadly speaking, the base change fundamental lemma compares an orbital integral with a twisted orbital
integral. To elaborate, let F be a local field, G a reductive group over F , Œ≥ ‚àà G(F ), and f a function on
G(F ). The orbital integral corresponding to this data is
Z
f (g ‚àí1 Œ≥g) dg
(1.1)
OŒ≥ (f ) :=
G(F )/GŒ≥ (F )

where GŒ≥ (F ) is the centralizer of Œ≥ in G(F ). We will take f to be in an appropriate Hecke algebra HG (F ).
(Of course we also need to discuss the normalization of Haar measures, but let us leave that for ¬ß2.1.)
Let E/F be an unramified extension of degree r, Œ¥ ‚àà G(E), and fE a function on G(E). The twisted
orbital integral corresponding to this data is
Z
fE (g ‚àí1 Œ¥œÉ(g)) dg
(1.2)
TOŒ¥œÉ (fE ) :=
G(E)/GŒ¥œÉ (F )

where œÉ ‚àà Gal(E/F ) is the lift of (arithmetic) Frobenius, and
GŒ¥œÉ (F ) := {g ‚àà G(E) : g ‚àí1 Œ¥œÉ(g) = Œ¥}
is the twisted centralizer of Œ≥ in GŒ¥œÉ (E). Again, we will take fE to be in an appropriate Hecke algebra
HG (E).
If HG(E),J and HG(F ),J are corresponding parahoric Hecke algebras, then there is a base change homomorphism for their centers
b : Z(HG(E),J ) ‚Üí Z(HG(F ),J ).
There is also a norm map N from stable twisted conjugacy classes in G(E) to stable conjugacy classes in
G(F ).
In the special case G = GLn , the base change fundamental lemma for the center of parahoric Hecke
algebras predicts that for œÉ-regular, œÉ-semisimple Œ¥ ‚àà G(E) and fE ‚àà Z(HG(E),J ), we have
TOŒ¥œÉ (fE ) = ON (Œ¥) (b(fE )).

(1.3)

This is almost what we will prove. (For more general G, the formulation is more complicated; see [Hai09],
Theorem 1.0.3 and ¬ß5.)
Now we can describe our strategy of proof of (1.3). The starting point is the seminal work of Kottwitz on
counting points of Shimura varieties over finite fields. In [Kot92] Kottwitz proves a formula expressing the
trace of Frobenius composed with a Hecke operator on the cohomology of certain PEL Shimura varieties as
a sum of a product of (twisted) orbital integrals:
X
(. . .)OŒ≥ (hp )TOŒ¥œÉ (hp )
(1.4)
Tr(h ‚ó¶ Frobp , H ‚àó (ShK , Q‚Ñì )) =

where ShK is an appropriate Shimura variety and h is a Hecke operator. In fact the purpose of the fundamental lemma is to re-express the twisted orbital integrals in (1.4), so as to be able to compare the expression
with the geometric side of the Arthur-Selberg trace formula. But in this paper we adopt an opposite perspective, instead viewing (1.4) as giving a geometric interpretation of (twisted) orbital integrals (in the p-adic
case) in terms of the cohomology of Shimura varieties.
In the function field setting, which is the one of interest to this paper, one can prove an analogous formula
of the form
X
(. . .)OŒ≥ (hxA0 )TOŒ¥œÉ (hA,x0 )
(1.5)
Tr(hA ‚ó¶ Frobx0 ‚ó¶œÑ, H ‚àó (ShtA , A)) =

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

3

for an appropriate moduli stack ShtA , an appropriate sheaf A, an appropriate Hecke operator hA , and an
additional symmetry œÑ . (Roughly, œÑ is a ‚Äúrotation‚Äù symmetry that arises from the moduli problem.)
However, it turns out that we can also construct a moduli stack ShtB such that
Tr(hB ‚ó¶ Frobx0 ‚ó¶œÑ, H ‚àó (ShtB , B)) =

X

(. . .)OŒ≥ (hxB0 )OŒ¥œÉ (b(hB,x0 ))

(1.6)

for an appropriate sheaf B, an appropriate Hecke operator hB , and an additional symmetry œÑ similar to that
from (1.5). The crucial point is that in (1.6) the twisted orbital integral is replaced with the orbital integral
of a base changed function.
We remark that the computations (1.5) and (1.6) were obtained in [Ngo06] for places of good (hyperspecial)
reduction, in which case one finds a spherical Hecke operator. In the present work, which concerns places
of parahoric bad reduction, the analogous computations (1.5) and (1.6) are of independent interest, and
actually form the main content of this paper. They require several nontrivial inputs, including, for the
parahoric setting that we study here, a version of the Kottwitz Conjecture for shtukas, as well as a geometric
interpretation of the base change homomorphism for Hecke algebras. Nevertheless, let us elide these points
for now.
The upshot is that (1.5) and (1.6) translate the problem of comparing orbital integrals and twisted orbital
integrals into comparing (the cohomology of) two different moduli problems ShtA and ShtB . (We remark
that the relationship we seek turns out to be subtler than equality, but again we elide this issue for now.)
At this point the particular the choice of ShtA and ShtB becomes crucial. Therefore, to proceed with the
discussion we will need to give some idea of what these moduli problems look like. In (1.4) the Shimura
variety ShK is defined over an open subset of the ring of integers of a number field, whereas in (1.5) and
(1.6) the moduli stacks ShtA and ShtB are defined over an open subset X ‚ó¶ of a curve over a finite field Fq .
The moduli stack ShtA parametrizes ‚Äúindependent‚Äù modifications of vector bundles Ei over X ‚ó¶ , with the
modifications occuring over the point x:
Ô£±
Ô£º
x ‚àà X‚ó¶ Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
x
Ô£¥
œÉ
Ô£¥
Ô£¥
E1 99K E1 Ô£¥
Ô£¥
Ô£¥
Ô£≤
Ô£Ω
x
œÉ
E
99K
E
2
2
ShtA ‚Äú = ‚Äù
.
Ô£¥
Ô£¥
..
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
.
Ô£¥
Ô£¥
Ô£¥
Ô£¥
x
Ô£≥œÉ
Ô£æ
Er 99K Er

(Here the superscript œÉ refers to a Frobenius twist, which has not been explained but is a standard part of
the definition of shtukas.) On the other hand, the moduli stack ShtB parametrizes ‚Äúiterated‚Äù modifications
of G-bundles Ei over X ‚ó¶ :


x ‚àà X‚ó¶
ShtB ‚Äú = ‚Äù œÉ
.
x
x
x
Er 99K E1 99K . . . 99K Er
Forgetting everything except x defines maps
ShtA

ShtB

X‚ó¶

X‚ó¶

Now the key point is that we can deform these moduli problems by allowing the points of modification to
vary over X ‚ó¶ (which of course is a trick only available in the function field setting). More precisely, we can
construct extended moduli stacks
gA
Sht

œÄA

(X ‚ó¶ )r

gB
Sht

œÄB

(X ‚ó¶ )r

4

TONY FENG

gA |‚àÜ(X ‚ó¶ ) and ShtB = Sht
gB |‚àÜ(X ‚ó¶ ) , by setting
such that ShtA = Sht
Ô£±
Ô£º
x1 , . . . , xr ‚àà X ‚ó¶ Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
x
1
Ô£¥
œÉ
Ô£¥
Ô£¥
E1 99K E1 Ô£¥
Ô£¥
Ô£¥
Ô£≤
Ô£Ω
x2
œÉ
g
E2 99K E2
ShtA ‚Äú = ‚Äù
Ô£¥
Ô£¥
..
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
.
Ô£¥
Ô£¥
Ô£¥
Ô£¥
xr
Ô£≥ œÉ
Ô£æ
Er 99K Er

and

gB ‚Äú = ‚Äù
Sht


x1 , . . . , xr ‚àà X ‚ó¶
.
x
x
x
2
1
r
œÉ
Er 99K E1 99K . . . 99K Er



If the sheaves RœÄA! A and RœÄB! B are sufficiently well-behaved, then we may hope that by a ‚Äúcontinuation
principle‚Äù we can deduce a comparison theorem for the cohomology of these two moduli problems over a
diagonal point xr0 ‚àà ‚àÜ(X ‚ó¶ ) ‚äÇ (X ‚ó¶ )r by proving such a comparison on a dense open subset of (X ‚ó¶ )r where
the points x1 , . . . , xr are distinct. This latter comparison works by computing analogues of (1.5) and (1.6)
gA and Sht
gB over such points, away from ‚àÜ(X ‚ó¶ ), which turn out to both involve only orbital integrals
for Sht
and can therefore be matched directly.
2. Statement of results and overview of the paper
2.1. Statement of the fundamental lemma. We now give a precise formulation of the fundamental
lemma of interest. It is an exact analogue for local function fields of the fundamental lemma studied in
[Hai09]. We will impose several assumptions that simplify the formulation, referring the general case to
[Hai09]. In particular we assume that Gder is simply connected.
2.1.1. Normalization of Haar measures. Recall the notation of ¬ß1. To give a well-defined meaning to the
orbital integral (1.1) and twisted orbital integral (1.2), we need to specify Haar measures on G, GŒ≥ and GŒ¥œÉ .
We assume that Œ≥ is regular semisimple.
We fix a hyperspecial vertex and an alcove containing it in the Bruhat-Tits building for G over Ft . By
Bruhat-Tits theory this induces maximal compact subgroups KF ‚äÇ G(F ) and KE ‚äÇ G(E).
‚Ä¢ We pick the left-invariant Haar measures dg on G(F ) and G(E) such that dg(KF ) = 1 and dg(KE ) =
1.
‚Ä¢ We pick the left-invariant Haar measures dh on GŒ≥ (F ) and GŒ¥œÉ (F ) such that dg(KF ‚à© GŒ≥ (F )) = 1
and dh on GŒ¥œÉ (E) is the canonical transfer of Haar measure from GŒ≥ to its inner form GŒ¥œÉ .
Taking the quotient measure
defined.

dg
dh

on G(F )/GŒ≥ (F ) and G(E)/GŒ¥œÉ (E), now (1.1) and (1.2) have been fully

2.1.2. Parahoric Hecke algebras. We fix a facet in the given alcove, which induces corresponding (compact open) parahoric groups JF ‚äÇ G(F ) and JE ‚äÇ G(E). Let HG(F ),J = Func (JF \G(F )/JF , Q‚Ñì ) and
HG(E),J = Func (JE \G(E)/JE , Q‚Ñì ) be the corresponding parahoric Hecke algebras. (Parahoric Hecke algebras are discussed in more detail in ¬ß5.1.)
2.1.3. The base change homomorphism. Let Z(HG(F ),J ) be the center of HG(F ),J , and define Z(HG(E),J )
similarly. There is a base change homomorphism
b : Z(HG(E),J ) ‚Üí Z(HG(F ),J )
which is defined in ¬ß7.1. To give a brief characterization of the base change homomorphism: under the
Bernstein isomorphism
‚àº

‚àí ‚àóJ IK : Z(HG(F ),J ) ‚àí
‚Üí HG(F ),K

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

5

obtained by convolving with the indicator function IK , it corresponds to the usual base change homomorphism for spherical Hecke algebras.
Z(HG(E),J )

b

‚àº ‚àí‚àóJ IK

HG(E),K

Z(HG(F ),J )
‚àº ‚àí‚àóJ IK

b

HG(F ),K

2.1.4. The norm map. Let œÉ ‚àà Gal(E/F ) be a lift of (arithmetic) Frobenius. The ‚Äúconcrete norm‚Äù
NmE/F : G(E) ‚Üí G(F )
defined by
NmE/F (Œ¥) := Œ¥ ¬∑ œÉ(Œ¥) ¬∑ . . . œÉ r‚àí1 (Œ¥)
descends to a norm map
N : G(E)/stable œÉ-conjugacy ‚Üí G(F )/stable conjugacy.
2.1.5. Formulation of the fundamental lemma. The following fundamental lemma was proved by Haines in
the p-adic setting ([Hai09], Theorem 1.0.3.)
Theorem 2.1 (Haines). Let E/F be an unramified extension of p-adic local fields of degree r and residue
characteristic p. Let œà ‚àà Z(HG(E),J ) and Œ¥ ‚àà G(E) such that N (Œ¥) is semisimple. Then we have
G(E)

SOŒ¥œÉ

(œà) = SOG
N (Œ¥) (b(œà)).

Here SO are stable (twisted) orbital integrals, for whose definition we refer to [Hai09] ¬ß5.1. Since our
eventual result will be for G = GLn , where stable conjugacy coincides with conjugacy, we can ignore the
issue of stabilization.
Remark 2.2. Haines has informed us that his proof, which is based on the global simple trace formula and
Kottwitz‚Äôs stabilization of the twisted trace formula, does not carry over (at least, not without nontrivial
additional work) to the positive characteristic setting. 1
We now formulate our main result, which is an extension (in a special case) of Theorem 2.1 to positive
characteristic.
By the Bernstein isomorphism, a basis for Z(HG(E),J ) is given by the functions œà¬µ for ¬µ a dominant
coweight of G, which correspond under ‚àí‚àóJ IK to the indicator functions of the double coset in KE \G(E)/KE
indexed by ¬µ.
Example/Definition 2.3. If G = GLn , and T ‚äÇ GLn is the usual (diagonal) maximal torus, then we
may identify X‚àó (T ) ‚àº
= Zn in the standard way. The dominant weights coweights X‚àó (T )+ are those ¬µ =
(¬µ1 , . . . , ¬µn ) with ¬µ1 ‚â• ¬µ2 ‚â• . . . ‚â• ¬µn . We define
|¬µ| := ¬µ1 + . . . + ¬µn .
In this paper we prove:
Theorem 2.4. Let E/F be an unramified degree r extension of characteristic p local fields. If Œ¥ ‚àà GLn (E)
is such that N (Œ¥) is regular semisimple and separable, and œà ‚àà Z(HGLn (E),J ) is a linear combination of œà¬µ
with |¬µ| = 0, then we have
TOŒ¥œÉ (œà) = ON (Œ¥) (b(œà)).
Remark 2.5. Let us make some remarks on the hypotheses. The hypothesis |¬µ| = 0 arises geometrically as
a condition for the non-emptiness of moduli stacks of shtukas.
The restriction to GLn comes from a need to obtain a proper moduli stack, in order to have enough control
over the cohomology of the relevant moduli stacks of shtukas. In general the moduli stacks of shtukas are of
infinite type, and their cohomology not constructible. However, for GLn we can use the trick of globalizing
to a division algebra in order to create a proper global space with the right local behavior.
1However, we note that W. Ray Dulany proved the base change fundamental lemma for GL by hand in the function Ô¨Åeld
2
case [RD]. We thank Tom Haines for informing us about Ray Dulany‚Äôs work.

6

TONY FENG

Remark 2.6. It seems likely that the theorem can be extended to prove Conjecture 2.1 in full for G = GLn
using methods that are by now considered ‚Äústandard‚Äù, as in [Clo90]. One reason we have not bothered to
do this is that the constraint |¬µ| = 0 is necessary in order to make the geometric objects non-trivial, and so
is satisfied in applications of the fundamental lemma to study the cohomology of moduli stacks of shtukas
via the Arthur-Selberg trace formula. Therefore, Theorem 2.4 should be adequate for applications to the
Langlands program.
Remark 2.7. As T. Haines pointed out to us, another key aspect of the fundamental lemma is the assertion
that OŒ≥ (b(œà)) = 0 if Œ≥ is not a norm. Our strategy does not seem to naturally give access to this statement.
On the other hand, since Labesse gave a purely local proof of this statement for the spherical case in mixed
characteristic, which was extended to the center of parahoric Hecke algebras in [Hai09] ¬ß5.2, it should
generalize to positive characteristic. We intend to include this in a future work, when it becomes necessary.
2.1.6. Related work. The fundamental lemma for base change for spherical Hecke algebras, which arises from
Theorem 2.1 in the special case where J = K is a hyperspecial maximal compact subgroup, was proved in
the p-adic case by Clozel [Clo90] and Labesse [Lab90], using key input from Kottwitz [Kot86a] who checked
it for the unit element. These arguments were generalized by Haines to proved the base change fundamental
lemma for centers of parahoric Hecke algebras, as has been discussed.2
For local function fields (i.e. positive characteristic), the spherical case J = K of Theorem 2.4 was
established by Ng√¥ [Ngo06], also for GLn and also for |¬µ| = 0 (with the same reasons for the restrictions).
Indeed, our strategy as described in ¬ß1 is the one pioneered by [Ngo06]. Similar results were obtained
independently and simultaneously by Lau [Lau04]. The key to our generalization is that in the parahoric
case, we know enough about the nearby cycles sheaf at a place of bad reduction, thanks to the proof of a
‚ÄúKottwitz Conjecture for shtukas‚Äù due to Gaitsgory [Gai01], to carry out the geometric argument.
2.2. Overview of the proof. Let us now give a more detailed overview of the proof of Theorem 2.4. We
are trying to prove a local result, but we will immediately shift to a global setting. Therefore, we change
notation from before. Let Fx0 be a local function field of characteristic p, so we have non-canonically
Fx ‚àº
= Fq ((t)).
0

As the notation suggests, we view Fx0 as the completion of a global function field F at a place x0 , and we
view F as the global function field of a smooth projective curve X/Fq . (Note that we have implicitly taken
x0 to be a point of degree one on X, which is actually important.)
Let G be a reductive group over F and J ‚äÇ G(Fx0 ) a parahoric subgroup. We choose any extension of
bX,x0 ), we have
G to parahoric group scheme G ‚Üí X such that over the completed local ring Spec (Ox0 := O
G(Ox0 ) = J. We assume that G ‚äóF Fx is split at all x where G(Ox ) is not hyperspecial.
Following [Ngo06], in ¬ß8 we define two moduli stacks of G-shtukas which we call ShtA and ShtB . (We have
included a background section summarizing the essential constructions and facts about shtukas in ¬ß4.) Let
E/F be the unramified extension of degree r. As outlined in ¬ß1, the goal is threefold:
(1) Obtain an expression relating the trace of Frobenius composed with Hecke operators on the cohomology of ShtA to the twisted orbital integral of œà ‚àà Z(HG(Ex0 ),J ).
(2) Obtain an expression relating trace of Frobenius composed with Hecke operators on the cohomology
of ShtB to the orbital integral of the base changed function b(œà).
(3) Relate the two cohomology groups in question in some other way.
Let us discuss each of these tasks in turn. For (1), we need a geometric interpretation of the center of the
parahoric Hecke algebra HG(Fx0 ),J . It is well-known that the spherical Hecke algebra is geometrized, under
the function-sheaf dictionary, by perverse sheaves on the affine Grassmannian. Similarly, the parahoric Hecke
algebra is geometrized by a partial affine flag variety.
This story is globalized by the Beilinson-Drinfeld Grassmanian GrG ‚Üí X. Over a general point of X
the fiber of GrG is an affine Grassmannian, but because G is a parahoric group at x0 , the fiber over x0 is
actually a partial affine flag variety. It is essentially a result of Gaitsgory, although the formulation in [Gai01]
2See the last paragraph of the introduction to [Hai09] for a discussion of to what extent Conjecture 2.1 follows from the

fundamental lemma for twisted endoscopy. Although base change is a special case of twisted endoscopy, the fundamental lemma
for twisted endoscopy should imply that there is a matching function for œà, but does not identify it in terms of the base change
homomorphism.

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

7

is slightly different, that the nearby cycles functor takes perverse sheaves on GrG |X‚àíx0 to central perverse
sheaves on GrG |x0 ‚àº
= FlG,J .
Using this, in ¬ß5 we relate the trace function associated to the nearby cycles sheaf at x0 of perverse sheaves
on ShtG to central elements of HG,J . This is the desired geometrization of Z(HG(Ex0 ),J ). The key point is
that the Beilinson-Drinfeld Grassmannian is a smooth (even √©tale) local model for ShtG .
In ¬ß6 we give a counting formula for points of ShtA , in the style of Kottwitz [Kot92]. This formula is based
on [Ngo06] and [NND08]; however we must note that it only gives a ‚Äúpartial formula‚Äù, counting only those
points indexed by an elliptic Kottwitz triple. Indeed, since the moduli stacks of shtukas are of infinite type
in general (even with full level structure and bounded modifications), they can have infinitely many points
over finite fields in general, which makes it somewhat subtle to give a meaningful formula. This issue can
be bypassed altogether for GLn by taking G to be the group associated to a sufficiently ramified division
algebra over X, with G(Fx0 ) ‚àº
= GLn (Fx0 ). This trick is one major reason for the restriction to GLn ; another
(which is morally of the same nature) will arise in the discussion of (3).
These ingredients are put together in ¬ß9.1, obtaining a formula
Ô£´
Ô£∂
X
Y
‚Ä≤
(. . .) Ô£≠
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr )) =
OŒ≥v (fŒ≤v )Ô£∏ ¬∑ TOŒ¥x0 œÉ (œàr,¬µ
).
(2.1)
v6=x0

See Theorem 9.2 for the precise statement.

Now we turn our attention to (2). All the same ingredients and steps are required as in (1), but now we
additionally need a geometric interpretation of the base change homomorphism
b : Z(HG(Ex0 ),J ) ‚Üí Z(HG(Fx0 ),J ).
This problem is studied in ¬ß7 for split reductive G, generalizing results of Ng√¥ for GLn [Ngo99]. First,
by a local study of the affine Grassmannian we prove the following fact. Let SatGrG (¬µ) be the perverse
sheaf on GrG corresponding, under Geometric Satake, to the dominant coweight ¬µ ‚àà X‚àó (T )+ , and let œàr,¬µ
be the trace function of Frobr on SatGrG (¬µ); thus œàr,¬µ ‚àà HG,K (Ex0 ). Then b(œàr,¬µ ) is the trace function
associated to Frob ‚ó¶Œ∫‚Ä≤ on SatGrG (¬µ)‚àór , where SatGrG (¬µ)‚àór is the r-fold convolution of SatGrG (¬µ) and Œ∫‚Ä≤ is
a cyclic permutation of order r using from the commutativity constraint on perverse sheaves on the affine
Grassmannian [MV07]. See Theorem 7.15 for the precise statement. We emphasize again that this was
obtained already by Ng√¥ for GLn , which is really the only situation where we can currently prove Conjecture
2.1; we prove the more general statement here in anticipation of future generalizations.
Using the global degeneration from a Beilinson-Drinfeld Grassmanian, we prove an analogous generalization to the center of parahoric Hecke algebras in terms of nearby cycles sheaves; see Theorem 7.17 for the
precise statement. This result is used as a local model to understand sheaves on ShtB , and is assembled in
¬ß9.2 in conjunction with the ingredients mentioned in the discussion of (1) to obtain a formula
Ô£´
Ô£∂
X
Y
‚Ä≤
(. . .) Ô£≠
Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ )) =
OŒ≥v (fŒ≤v )Ô£∏ ¬∑ OŒ≥x0 (b(œàr,¬µ
)).
(2.2)
v6=x0

See Theorem 9.3 for the precise statement.

Finally, we address (3). As discussed in ¬ß1 the moduli problems ShtA and ShtB are actually defined over
(X ‚ó¶ )r . By analogous but easier arguments we can prove that
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx ‚ó¶œÑ, A¬µr ) = Tr(hŒ≤ ‚ó¶ Frobx ‚ó¶œÑ, Br¬µ )
for x ‚àà (X ‚ó¶ )r consisting of r pairwise-distinct points. (We caution that the relationship between A¬µr and Br¬µ
is not one of equality. Rather, the former is more like the rth tensor power of the latter, and the equality of
traces is the nonobvious linear algebraic identity in Lemma 7.13.) In other words, we can obtain analogues
of (2.1) and (2.2) which are manifestly equal at sufficiently many (by Chebotarev density) x. In fact since
ShtA and ShtB have good (hyperspecial) reduction at almost all such x this already follows from [Ngo06] ¬ß5,
where the proof is exactly as was just indicated; we give a more detailed sketch of Ng√¥‚Äôs proof in ¬ß8.4.
However, knowing the equality for x ‚àà U := (X ‚ó¶ )r ‚àí ‚àÜ(X ‚ó¶ ) is not itself sufficient for deducing an
equality at a point of ‚àÜ(X ‚ó¶ ). It would be sufficient if the sheaves A¬µr and Br¬µ were local systems in a

8

TONY FENG

neighborhood of a point of ‚àÜ(X ‚ó¶ ) ‚äÇ (X ‚ó¶ )r . In fact, since they are equipped with a partial Frobenius
structure, by ‚ÄúDrinfeld‚Äôs Lemma‚Äù ([Dri87] Proposition 6.1, [Lau04] Lemma 9.2.1) if they were even merely
constructible then they would automatically be local systems in a neighborhood of the generic point of
‚àÜ(X ‚ó¶ ) ‚äÇ (X ‚ó¶ )r . Unfortunately, as has already been discussed, the moduli stacks of shtukas are of infinite
type in general, and their cohomology is not even constructible on (X ‚ó¶ )r . Here again we invoke the trick of
using a sufficiently ramified division algebra in order to enforce the properness of the global moduli stack,
and thus the constructibility; of course the cost is that this only gives results for GLn .
2.3. Summary of the paper. Although we discussed in ¬ß2.2 why our current argument does not work
beyond GLn , we hope that after future technical improvements in the theory of shtukas it can be generalized
to a much wider class of reductive groups. For this reason, for the individual steps we have tried to work
with more general groups when possible. It seems worthwhile to give a brief outline of the organization of
the paper, pointing out exactly where we can be more general.
In ¬ß4 we review the theory of shtukas for nonconstant reductive group schemes, summarizing the essential
background facts. Also, a key point is to define an ‚Äúintegral model‚Äù for the moduli stack of shtukas, extending
over points of parahoric bad reduction.
In ¬ß5 we establish an analogue of the Kottwitz Conjecture for moduli of shtukas. This works even for
fairly general (not necessarily constant) reductive groups G ‚Üí X: Gaitsgory originally proved it for constant
groups, and his argument was generalized by Zhu in [Zhu14] Theorem 7.3 and Pappas-Zhu in [PZ13].
In ¬ß6 we establish some counting formulas for points of shtukas over finite fields. This is a minor variant
of the work of Ng√¥ B.C. and Ng√¥ Dac T., which was previously only formulated at places hyperspecial level
structure. Our contribution is to write it out for the case of parahoric bad reduction that we require.
In ¬ß7 we provide a geometric interpretation of the base change homomorphism for spherical Hecke algebras
and the center of parahoric Hecke algebras for general split reductive groups G over a local field. For GLn
this was proved by Ng√¥, in a formulation that was rather specific to GLn . We generalize the argument to
spherical Hecke algebras for arbitrary split reductive groups, and then use that to deduce a result for (central
elements in) parahoric Hecke algebras.
In ¬ß8 we introduce the two moduli problems ShtA and ShtB which are to be compared, and recall Ng√¥‚Äôs
theorem stating the precise comparison. Using this we deduce an equality of traces on the nearby cycles
sheaves at the point of parahoric reduction. Here we also crucially use that the moduli of shtukas associated
to a sufficiently ramified division algebra is proper, which implies that the cohomology is a local system.
In ¬ß9 we compute these traces in terms of (twisted) orbital integrals, giving formulas in the paradigm of
Kottwitz, and then use them in ¬ß9.3 to deduce the cases of the base change fundamental lemma claimed in
Theorem 2.4.
2.4. Acknowledgments. I am indebted to Zhiwei Yun for teaching me basically everything that I know
about shtukas, and in particular for directing me to [Ngo06]. I would also like to thank Zhiwei, Laurent
Clozel, Gurbir Dhillon, Tom Haines, Jochen Heinloth, Urs Hartl, Bao Le Hung, and Rong Zhou for helpful
conversations related to this work. This document benefited enormously from comments, corrections, and
suggestions by Brian Conrad, Tom Haines, and Timo Richarz.
This project was conceived at the 2017 Arbeitsgemeinschaft in Oberwolfach, and completed while I was
a guest at the Institute for Advanced Study, and under the support of an NSF Graduate Fellowship. I am
grateful to these institutions for their support.
3. Notation
We collect some notation that will be used frequently throughout the paper.
‚Ä¢ Let X be a smooth projective curve over a finite field k = Fq , and let F = k(X) be its global function
field. We fix a point x0 ‚àà X(Fq ).
‚Ä¢ We will let X ‚ó¶ be an open subset of X, usually the complement of some points for ramification and
possibly also x0 .
‚Ä¢ We denote by |X| the set of closed points of X, and for x ‚àà X we write k(x) for the residue field of
x.
‚Ä¢ For x ‚àà X, we let Ox be the completion of OX,x at its maximal, and Fx be the fraction field of Ox .
We set Dx := Spec Ox .

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

9

‚Ä¢ We let G be a connected reductive group over F , whose derived group is simply connected. We
assume that G extends to a parahoric group scheme G ‚Üí X, and that G ‚äó Fx is split at all points
x ‚àà X where G(Ox ) is not hyperspecial.
‚Ä¢ We denote by E 0 the trivial (fppf) G-torsor over X.
4. Moduli of shtukas
In this section we recall material concerning shtukas and their perverse sheaves. This is mostly background,
but we emphasize that it is important for us to work at the generality of nonconstant groups. This allows
us to define an ‚Äúintegral model‚Äù for parahoric shtukas, which is much easier than the corresponding problem
for Shimura varieties. References for this section are [Zhu14] ¬ß3 and [Laf12] ¬ß12.
4.1. G-bundles. Let G ‚Üí X be a smooth affine group scheme with (connected) reductive generic fiber G,
such that G|Ox is a parahoric group scheme for each x ‚àà X. We assume that G|Fx is split at all points x ‚àà X
where G(Ox ) is not hyperspecial.
4.1.1. We recall the notion of G-bundles and affine Grassmannians, the study of which seems to have been
initiated by [PR10].
Definition 4.1. A G-bundle E is a G-torsor for the fppf topology. We define BunG to be the (Artin) stack3
representing the functor
BunG : S 7‚Üí {G-bundles on X √ó S} .
Definition 4.2. We define the global affine Grassmannian GrG to be the (Artin) stack representing the
functor
Ô£±
Ô£º
x ‚àà X(S)
Ô£≤
Ô£Ω
GrG : S 7‚Üí (x, E, Œ≤) :
E ‚àà BunG (S)
Ô£≥
Ô£æ
Œ≤ : E|XS ‚àíŒìx ‚àº
= E 0 |XS ‚àíŒìx
where here and throughout E 0 denotes the trivial G-torsor.
We have a map

œÄ : GrG ‚Üí X
sending (x, E, Œ≤) 7‚Üí x.
Example 4.3. Let Gx = G|Dx . Then
GrG |x := œÄ ‚àí1 (x) ‚àº
= GrGx
is the usual affine Grassmannian for Gx . On the other hand if G|Dx is an Iwahori group scheme, then
GrG,x ‚àº
= FlGx is the usual affine flag variety.
4.1.2. Arc and loop groups. We now give a different perspective on BunG in terms of ‚Äúloop groups‚Äù. (The
objects introduced here will also be important later.)
Let BunG,‚àûŒì be the moduli stack of G-bundles with ‚Äúinfinite level structure‚Äù, i.e.
Ô£±
Ô£º
x ‚àà X(S)
Ô£≤
Ô£Ω
BunG,‚àûŒì : S 7‚Üí (x, E, œà) : E ‚àà BunG (S)
‚àº
Ô£≥
Ô£æ
‚Üí E 0 |Œìbx
œà : E|Œìbx ‚àí

b x is the completion of X √ó S along Œìx . One can also think of œà as a compatible family of level
where Œì
b ‚ó¶x := Œì
b x ‚àí Œìx (the meaning is as in [Laf12] Notation 1.7).
structures over nŒìx as n ‚Üí ‚àû. We set Œì
+
Let L G be the global ‚Äúarc group‚Äù, defined by


x ‚àà X(S)
+
L G : S 7‚Üí (x, Œ≤) :
bx ) .
Œ≤ ‚àà G(Œì

Let LG be the ‚Äúloop group‚Äù



x ‚àà X(S)
LG : S 7‚Üí (x, Œ≤) :
b ‚ó¶x ) .
Œ≤ ‚àà G(Œì

Remark 4.4. There is an action of L+ G on GrG by changing the level structure œà.
3For the fact that this is really an Artin stack in the generality required here, see [Bro13]. We thank Brian Conrad for
bringing this reference to our attention.

10

TONY FENG

4.1.3. Global Schubert varieties. Let T ‚äÇ G be a maximal torus. In [Ric16] ¬ß2 (generalizing work in the
tamely ramified case of [Zhu14] ¬ß3.3) it is shown how to associate to ¬µ ‚àà X‚àó (TF ) a global Schubert variety
Gr‚â§¬µ
G . Of course, this is well-known in the split case.
4.1.4. Geometric Satake. We fix some notation pertaining to the Geometric Satake correspondence ([MV07]).
Definition 4.5. Given a finite-dimensional representation W of L G, we let SatGrG (W ) be the associated perverse sheaf on GrG furnished by Geometric Satake. Note that SatGrG (W ) is automatically L+ G-equivariant.
(For a statement of Geometric Satake for non-constant groups, see [Laf12] Theorem 12.16.)
b are indexed by dominant
If G is split then irreducible finite-dimensional representations W of L G = G
coweights ¬µ ‚àà X‚àó (T )+ for a maximal split torus T ‚äÇ G, and we denote by SatGrG (¬µ) := SatGrG (W¬µ ) the
corresponding perverse sheaf.
This is the primal source for constructing perverse sheaves on a plethora of objects, which will all be
denoted Sat... (W ) or Sat... (¬µ).
Remark 4.6. The sheaves SatGrG (W ) are L+ G-equivariant for the action of Remark 4.4.
4.2. Hecke stacks.
4.2.1. We now define objects that geometrize the Hecke operators.
Definition 4.7. We define the Hecke stack HeckeG by the functor of points
Ô£º
Ô£±
x ‚àà X(S)
Ô£Ω
Ô£≤
E, E ‚Ä≤ ‚àà BunG (S)
.
HeckeG : S 7‚Üí (x, E, E ‚Ä≤ , , œï) :
Ô£æ
Ô£≥
‚àº
‚Üí E|X√óS‚àíŒìx
œï : E ‚Ä≤ |X√óS‚àíŒìx ‚àí
We have structure maps

HeckeG
‚ñ†‚ñ†
‚úâ
‚ñ†‚ñ† h‚Üí
‚úâ
h ‚úâ‚úâ
‚ñ†‚ñ†
œÄ
‚úâ
‚ñ†‚ñ†
‚úâ
‚úâ
‚ñ†$
‚úâ
z‚úâ

BunG
X
BunG
‚Üê

where the map h‚Üê takes (E, E ‚Ä≤ ) 7‚Üí E, and the map h‚Üí takes (E, E ‚Ä≤ ) 7‚Üí E ‚Ä≤ .
One can think of the HeckeG as looking locally, in the smooth topology, like BunG √óX GrG . To make this
precise, recall that there is an action of L+ G on BunG,‚àûŒì , by changing the level structure.
Proposition 4.8. There is an isomorphism
‚àº

‚Üí (GrG √óX BunG,‚àûŒì )/L+ G
Œæ : HeckeG ‚àí
where the quotient is for the diagonal action of L+ G.
This is actually taken as the definition of the Hecke stack in [Laf12] ¬ß12.3.1. Although it is well-known
we have not found the statement formulated in quite this way, so we give a proof for completeness.
‚àº

‚Üí (GrG √óX BunG,‚àûŒì )/L+ G is equivalent to giving an L+ G-equivariant
Proof. Giving an isomorphism HeckeG ‚àí
+
isomorphism from an L G-torsor over HeckeG to GrG √óX BunG,‚àûŒì , so we will construct the latter.
^ G ‚Üí HeckeG be the L+ G-torsor representing (x, œï : E ‚Ä≤ 99K E) ‚àà HeckeG plus a choice of trivialLet Hecke
ization œà : E|Œìbx ‚àº
= E 0 |Œìbx .
There is a map
^ G ‚Üí GrG √óX I BunG,‚àûŒì
Hecke
sending
(x, œï : E ‚Ä≤ 99K E, œà) 7‚Üí (x, E ‚Ä≤ , œà ‚ó¶ œï), (x, E, œà)
where we have implicitly used the Beauville-Laszlo theorem ([Zhu14], Lemma 3.1) to extend œï ‚ó¶ œà, which
b ‚ó¶ , to X ‚àí Œìx . It is easily checked that this is an isomorphism, by defining an
is a priori only defined on Œì
x
inverse directly, and that is L+ G-equivariant.

Remark 4.9. In practice, we can always translate these statements into ones about finite type Artin stacks,
by bounding the type of the modification. On any finite type substack the action of L+ G factors through a
finite √©tale quotient.

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

11

4.2.2. Geometric Satake for Hecke.
Definition 4.10. We define a functor
SatHeckeG : RepL G ‚Üí Perv(HeckeG )
as follows. If W ‚àà RepL G , then
SatGrG (W ) ‚ä† Q‚Ñì,BunG,‚àûŒì ‚àà Dcb (GrG √óX BunG,‚àûŒì )
descends to the quotient by L+ G by the fact that SatGrG (W ) is L+ G-equivariant. We set SatHeckeG (W ) to
be the pullback of this descent via the isomorphism Œæ ‚àó from Proposition 4.8.
4.2.3. Hecke stacks with bounded modification. For ¬µ ‚àà X‚àó (TF ) we define Hecke¬µG as follows. First, we have
the Schubert variety GrG‚â§¬µ ‚Üí GrG , which has an L+ G-action. This induces a substack of (GrG √óX BunG,‚àûŒì )/L+ G,
and we define Hecke¬µG to be the pullback via Œæ ‚àó of Proposition 4.8.
If G = G√óX is constant and split over X, then Hecke‚â§¬µ
G admits a very concrete definition as ‚Äúmodifications
of G-bundles with invariant bounded by ¬µ‚Äù. In ¬ß4.5 we explicate this for GLn -bundles, which may be an
enlightening example.
4.3. Shtukas.
4.3.1. We now define the moduli stack of G-shtukas. At places x ‚àà X where G|Dx is a parahoric group
scheme, this should be thought of as an ‚Äúintegral model‚Äù of the usual moduli stacks in which the legs are
demanded to be disjoint from the level structure.
Definition 4.11. We define the moduli stack of G-shtukas by the following cartesian diagram
ShtG

BunG
Id √ó Frob

HeckeG

h‚Üê √óh‚Üí

BunG √ó BunG

More explicitly, ShtG represents the following moduli problem:
Ô£º
Ô£±
x ‚àà X(S)
Ô£Ω
Ô£≤
E ‚àà BunG (S)
ShtG : S 7‚Üí (x, E, œï) :
Ô£æ
Ô£≥
‚àº
‚Üí E|X√óS‚àíŒìx
œï : œÉ E|X√óS‚àíŒìx ‚àí

where œÉ is the Frobenius on the S factor in X √ó S, and œÉ E is the pullback of E under the map 1 √ó œÉ : X √ó S ‚Üí
X √ó S.
We have an evident map
œÄ : ShtG ‚Üí X
sending (x, E, E ‚Ä≤ , œï) 7‚Üí x.
4.3.2. Perverse sheaves on shtukas. From Definition 4.11 we have a tautological map
Œπ : ShtG ‚Üí HeckeG .
Definition 4.12. For W ‚àà Rep(L G), we define SatShtG (W ) to be Œπ‚àó (SatHeckeG (W )) shifted to be perverse
along the fibers of œÄ : ShtG ‚Üí X. This is a perverse sheaf up to shift on ShtG .
4.3.3. Schubert varieties of shtukas. For ¬µ ‚àà X‚àó (TbF ), we define Sht‚â§¬µ
= Œπ‚àó Hecke‚â§¬µ
G
G . This is a closed
substack of ShtG which is the support of SatShtG (¬µ) We call these ‚ÄúSchubert varieties of shtukas‚Äù even though
they are, of course, not varieties but (Deligne-Mumford) stacks.

12

TONY FENG

4.3.4. Hecke operators on shtukas. There are Hecke correspondences of shtukas that induce Hecke operators
on ShtG , hence on their cohomology.
Definition 4.13. We define Hecke(ShtG ) to be the moduli stack parametrizing x, y ‚àà X(S) along with a
diagram
œÉ

x

E

Œ≤ y

œÉ(Œ≤) œÉ(y)
x

œÉ ‚Ä≤

E

E
E‚Ä≤

Here we note:
‚Ä¢ E and E ‚Ä≤ are G-torsors on X √ó S, and œÉ E and œÉ E ‚Ä≤ are their twists by 1 √ó œÉ.
‚Ä¢ The x above the horizontal arrows mean an isomorphism on the complement of Œìx .
‚Ä¢ The y (resp. œÉ(y)) next to the vertical arrows means an isomorphism on the complement of Œìy (resp.
ŒìœÉ(y) ).
‚Ä¢ The map œÉ(Œ≤) is the twist of Œ≤. We emphasize that it is determined by Œ≤, rather than being an
additional datum.
We evidently have a diagram
Hecke(ShtG )

HeckeG
œÄ

œÄ2

X
where the horizontal arrow sends this data to (y, E, E ‚Ä≤ , Œ≤), which allows us to define Hecke(ShtG )‚â§¬µ for
¬µ ‚àà X‚àó (TF ), and SatHecke(ShtG ) (W ) for W ‚àà Rep(L G).
We also evidently have a diagram
Hecke(ShtG )
h

‚Üê

h‚Üí

ShtG

ShtG

where the arrows h‚Üê and h‚Üí send this data to (x, œÉ E 99K E) and (x, œÉ E ‚Ä≤ 99K E ‚Ä≤ ) respectively. For v ‚àà X, let
‚àí1
Hecke(ShtG )‚â§¬µ
v := œÄ2 (v).

A choice of v ‚àà X and ¬µ ‚àà X‚àó (TF ) induces a correspondence
Hecke(ShtG )‚â§¬µ
v
h

‚Üê

h‚Üí

ShtG

ShtG
œÄ

(4.1)

œÄ

X
which is the analogue of the classical Hecke correspondences.
Definition 4.14. Since œÄ ‚ó¶ h‚Üê = œÄ ‚ó¶ h‚Üí and h‚Üê‚àó (SatShtG (W )) ‚àº
= h‚Üí‚àó (SatShtG (W )), from Hecke(ShtG )v‚â§¬µ
b
we get a corresponding Hecke operator on RœÄ! SatShtG (W ) ‚àà Dc (X).
4.4. Iterated shtukas and factorization. This entire discussion carries through to ‚Äúiterated‚Äù versions of
GrG , HeckeG and ShtG . We will content ourselves with stating the essentials, leaving the reader to generalize
the preceding discussion. (A reference is [Laf12] ¬ß1,2.)

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

13

4.4.1. Iterated affine Grassmannian. The iterated global affine Grassmannian

is defined by the functor of points
Ô£±
Ô£¥
Ô£¥
Ô£≤

e GrG ‚Üí X 2
œÄ : GrG √ó

Ô£º
x1 , x2 ‚àà X(S)
Ô£¥
Ô£¥
Ô£Ω
E1 , E2 ‚àà BunG (S)
e GrG : S ‚Üí
‚àº
(x1 , x2 , E1 , E2 , œï, Œ≤) :
GrG √ó
7
‚Üí E2 |XS ‚àíŒìx1 Ô£¥
œï : E1 |XS ‚àíŒìx1 ‚àí
Ô£¥
Ô£¥
Ô£¥
Ô£≥
Ô£æ
‚àº
‚Üí E 0 |XS ‚àíŒìx2
Œ≤ : E2 |XS ‚àíŒìx2 ‚àí

e ...√ó
e GrG (r times), although the reader should be warned that this
We may denote GrG,X r = GrG √ó
notation is sometimes used elsewhere in the literature to denote a different object. We also have Schubert
‚â§(¬µ ,...,¬µr )
in a way that is by now obvious.
cells: given ¬µ1 , . . . , ¬µr ‚àà X‚àó (TF ), we can define GrG,X1r
4.4.2. Iterated shtukas. We now define the iterated shtukas.
Definition 4.15. We define the moduli stack ShtG,X r by the functor of points:
Ô£±
Ô£º
x1 , . . . , xr ‚àà X(S)
Ô£≤
Ô£Ω
‚àº œÉ
‚Üí E0 ‚àà BunG (S)
E0 , E1 , . . . , Er ‚àí
ShtG,X r : S 7‚Üí
Ô£≥
Ô£æ
‚àº
‚Üí Ei+1 |X√óS‚àíŒìxi+1
œïi : Ei |X√óS‚àíŒìxi+1 ‚àí

Remark 4.16. The stack of iterated shtukas ShtG,X r can also be defined as a repeated fibered product of
ShtG over BunG , which is more analogous to how we defined ShtG .
We have an evident map
œÄ : ShtG,X r ‚Üí X r
projecting to the datum of (x1 , . . . , xr ).
We can similarly define HeckeG,X r and Hecke(ShtG,X r ). For a tuple W1 , . . . , Wr ‚àà Rep(L G) we can define
a shifted perverse sheaf SatShtG,X r (W1 , . . . , Wr ) using Geometric Satake.
‚â§(¬µ ,...,¬µr )
We also have Schubert cells for ShtG,X r : given ¬µ1 , . . . , ¬µr ‚àà X‚àó (TbF ), we can define ShtG,X1r
in a way
that is by now obvious.

4.5. D-shtukas. As explained in ¬ß2.2, one difficulty with ShtG is that it is of infinite type in general. To
study the fundamental lemma for GLn , we can globalize to a division algebra instead of the constant group
GLn , which gives us a proper moduli problem. We now explain the salient facts about this special case.
Since the literature already contains several excellent expositions of the theory of D-shtukas, we will content
ourselves with a brief summary. A reference for everything here is [Ngo06] ¬ß1; see [Laf97] or [Lau04] for more
extensive treatments.
Let D be a division algebra F of dimension n2 , ramified over a (necessarily finite) set of points Z ‚äÇ X.
We assume that our fixed (rational) point x0 ‚àà
/ Z, so Dx0 := D ‚äóF Fx0 ‚àº
= gln (Fx0 ). Later we will need to
assume that #Z is sufficiently large.
We extend D to an OX -algebra D such that Dx is a maximal order in Dx for all x, and we let G ‚Üí X
be the associated group scheme of units. Let G ‚Üí X be a corresponding parahoric group scheme; we will be
most interested in the case where G is not hyperspecial at x0 .
4.5.1. Modification types. Let T ‚äÇ GLn be the standard maximal torus. The dominant coweights are
X‚àó (T )+ ‚àº
= Zn+ := {¬µ = (¬µ1 , . . . , ¬µn ) : ¬µ1 ‚â• ¬µ2 ‚â• . . . ¬µn }.

The relative position of lattices in k[[t]]n is a ¬µ ‚àà X‚àó (T )+ determined by the Cartan decomposition
[
GLn (k[[t]])t¬µ GLn (k[[t]]).
GLn (k((t))) =
¬µ‚ààX‚àó (T )+

‚àº

‚Üí
Let X ‚ó¶ := X ‚àíZ ‚àí{x0}. For x ‚àà X ‚ó¶ , a modification of G-bundles outside x is an isomorphism œï : E ‚Ä≤ |X ‚ó¶ ‚àíx ‚àí
‚äïn
E|X ‚ó¶ ‚àíx . We can view E ‚Ä≤ |Spec F x and E|Spec F x as two lattices in F x by using œï ‚äó Fx to identify their generic
fibers. The relative position ¬µ of these two lattices will be called the modification type of œï.

14

TONY FENG

4.5.2. The global affine Grassmannian. We can interpret Gr‚â§¬µ
G |X ‚ó¶ as the substack of GrG |X ‚ó¶ parametrizing
Œ≤ : E|XS ‚àíŒìx ‚àº
= E 0 |XS ‚àíŒìx
such that for each geometric point of S, the modification type of Œ≤ is ‚â§ ¬µ. The sheaf SatGrG (¬µ) is the IC
sheaf of Gr‚â§¬µ
G , i.e. the middle extension of the constant sheaf on the open cell.
Proposition 4.17. The sheaf SatGrG (¬µ) is universally locally acyclic with respect to the morphism GrG |X ‚ó¶ ‚Üí
X ‚ó¶.
Proof. This is [Ngo06] ¬ß1.1 Corollaire 6. Note that Ng√¥‚Äôs formulation is slightly different, but is actually
deduced from the version that we state, which is the usual formulation in Geometric Satake.

‚ó¶
4.5.3. The Hecke stack. The Hecke stack Hecke‚â§¬µ
G |X ‚ó¶ parametrizes modifications of G-torsors over X
‚àº

‚Üí E|X√óS‚àíŒìx )
(x, œï : E ‚Ä≤ |X√óS‚àíŒìx ‚àí
with modification type ‚â§ ¬µ at all geometric points of S.
4.5.4. Shtukas and iterated shtukas. The moduli stack ShtG,(X‚àíZ)r parametrizes
Ô£±
Ô£º
x1 , . . . , xr ‚àà (X ‚àí Z)(S)
Ô£≤
Ô£Ω
E0 , E1 , . . . , Er ‚àº
= œÉ E0 ‚àà BunG (S)
‚àº
Ô£≥
Ô£æ
‚Üí Ei+1 |X√óS‚àíŒìxi+1
œïi : Ei |X√óS‚àíŒìxi+1 ‚àí
‚â§(¬µ ,...,¬µ )

1
r
The Schubert ‚Äúvariety‚Äù ShtG,(X‚àíZ)
associated to (¬µ1 , . . . , ¬µr ) ‚àà (X‚àó (T )+ )r is the substack where the
r
modification type of œïi is bounded by ¬µi at all geometric points of S. For such a tuple we can also form
‚â§(¬µ1 ,...,¬µr )
SatShtG ,(X‚àíZ)r (¬µ1 , . . . , ¬µr ) on ShtG,(X‚àíZ)r , which is perverse up to shift and supported on ShtG,(X‚àíZ)
r .

Proposition 4.18. The (shifted) perverse sheaf SatShtG ,(X‚àíZ)r (¬µ1 , . . . , ¬µr )|(X ‚ó¶ )r is locally acylic with respect
to the morphism œÄ : SatShtG ,(X‚àíZ)r |(X ‚ó¶ )r ‚Üí (X ‚ó¶ )r .
Proof. This [Ngo06] ¬ß1.4 Corollaire 2, but with the same remark as in the proof of Proposition 4.17.



4.5.5. Global geometry. The stack ShtG has infinitely many connected components owing to the positivedimensional center of G. We wish to and can rectify this in the usual way: let a ‚àà A√ó
F be a non-trivial idele
Z
of degree 1, and let ShtG /a be the quotient obtained by formally adjoining an isomorphism E ‚àº
= E ‚äó O(a).
Similarly define ShtG,(X‚àíZ)r /aZ . We still have the map
œÄ : ShtG,(X‚àíZ)r /aZ ‚Üí (X ‚àí Z)r
and the Geometric Satake sheaves descend to ShtG,(X‚àíZ)r /aZ , which in an effort to curtail increasingly
monstrous notation we continue to denote by SatShtG,(X‚àíZ)r (¬µ1 , . . . , ¬µr ). Furthermore, we still have:
Proposition 4.19 ([Ngo06] ¬ß1.4 Corollaire 2). The shifted perverse sheaf SatShtG ,(X‚àíZ)r (¬µ1 , . . . , ¬µr ) restricted to ShtG,(X ‚ó¶ )r /aZ is locally acyclic with respect to the map
œÄ : ShtG,(X ‚ó¶ )r /aZ ‚Üí (X ‚ó¶ )r .
We now prepare to state the properness result for the morphism ShtG,(X ‚ó¶ )r /aZ ‚Üí (X ‚ó¶ )r . We can write
any ¬µ ‚àà X‚àó (T )+ as
¬µ = ¬µ+ ‚àí ¬µ‚àí
where
+
¬µ+ := (¬µ+
1 ‚â• . . . ‚â• ¬µr ‚â• 0)
‚àí
¬µ‚àí := (0 ‚â• ¬µ‚àí
1 ‚â• . . . ‚â• ¬µr )

We define
||¬µ|| := max(|¬µ+ |, |¬µ‚àí |).

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

15

Proposition 4.20 ([Ngo06] ¬ß1.6 Proposition 2). Let (¬µ1 , . . . , ¬µr ) ‚àà (X‚àó (T )+ )r . Suppose that the locus Z of
ramification points of D satisfies
#Z ‚â• n2 (||¬µ1 || + . . . + ||¬µr ||).
Then the morphism
‚â§(¬µ ,...,¬µr )

œÄ ‚ó¶ : ShtG,(X1‚ó¶ )r

/aZ ‚Üí (X ‚ó¶ )r

is proper.
We need to extend this result to our integral model X ‚àí Z = X ‚ó¶ ‚à™ {x0 }.
Proposition 4.21. Let (¬µ1 , . . . , ¬µr ) ‚àà (X‚àó (T )+ )r . Suppose that the locus Z of ramification points of D
satisfies
#Z ‚â• n2 (||¬µ1 || + . . . + ||¬µr ||).
Then the morphism
‚â§(¬µ ,...,¬µ )

1
r
œÄ : ShtG,(X‚àíZ)
/aZ ‚Üí (X ‚àí Z)r
r

is proper.
Proof. Let G be the group scheme isomorphic to G at places away from x0 but hyperspecial at x0 . Then
Proposition 4.20 applied to ShtG shows that
‚â§(¬µ ,...,¬µ )

1
r
Z
œÄ ‚Ä≤ : ShtG,(X‚àíZ)
‚Üí (X ‚àí Z)r
r /a

is proper. The map G ‚Üí G induces a projection
‚â§(¬µ ,...,¬µ )

‚â§(¬µ ,...,¬µ )

1
r
1
r
Z
pr : ShtG,(X‚àíZ)
/aZ ‚Üí ShtG,(X‚àíZ)
r
r /a

which we claim is proper. It obviously suffices to prove the claim. For that we consider the commutative
diagram below, omitting some subscripts and superscripts, etc. for clarity of presentation.
ShtG

BunG
Id √ó Frob

HeckeG

h‚Üê √óh‚Üí

BunG √ó BunG
ShtG

BunG
Id √ó Frob

HeckeG

h‚Üê √óh‚Üí

BunG √ó BunG

In this diagram the squares with solid arrows are cartesian. Let Hecke‚Ä≤G and Sht‚Ä≤G denote the fibered products
h‚Üê √óh‚Üí

Hecke‚Ä≤G
HeckeG

h‚Üê √óh‚Üí

BunG √ó BunG
BunG √ó BunG

and
Sht‚Ä≤G

BunG
Id √ó Frob

Hecke‚Ä≤G

h

‚Üê

√óh

.

‚Üí

BunG √ó BunG
‚â§(¬µ1 ,...,¬µr )

The map BunG ‚Üí BunG is proper, hence so is pullback Hecke‚Ä≤G ‚Üí‚Üí HeckeG . Since the map HeckeG
‚â§(¬µ ,...,¬µ )

‚Üí

‚Ä≤‚â§(¬µ ,...,¬µ )

r
r
is also proper, hence so is the compo‚Üí ShtG 1
(Hecke‚Ä≤G )‚â§(¬µ1 ,...,¬µr ) is proper, the map ShtG 1
sition
‚â§(¬µ1 ,...,¬µr )
‚â§(¬µ1 ,...,¬µr ) pr
‚â§(¬µ ,...,¬µr )
‚àí‚Üí ShtG
.
‚Üí (Sht‚Ä≤G )
ShtG 1



16

TONY FENG

5. The Kottwitz Conjecture for shtukas
5.1. Parahoric Hecke algebras. Let G be a split reductive group over a non-archimedean local field Ft
with uniformizer t. (The splitness assumption is not necessary, but is certainly adequate for our eventual
purposes and simplifies the notation significantly.)
5.1.1. Spherical Hecke algebra. Let K be a hyperspecial maximal compact subgroup of G(Ft ). By BruhatTits theory we may extend G to an integral model over the valuation subring Ot ‚äÇ Ft such that G(Ot ) = K.
Let HG,K = Func (K\G(Ft )/K, Q‚Ñì ) be the corresponding spherical Hecke algebra. This has several
canonical bases, so we fix notation for them. Let T ‚äÇ G be a maximal split torus. As is well known, we have
a Cartan decomposition
[
Kt¬µ K
(5.1)
G(Ft ) =
¬µ‚ààX‚àó (T )+

indexed by the dominant coweights X‚àó (T )+
œá ‚àà X ‚àó (T ), we have œá(t¬µ ) = thœá,¬µi .

‚àº
= Zn , where t¬µ is the character such that for a character

Definition 5.1. For ¬µ ‚àà X‚àó (T )+ , we denote by f¬µ ‚àà HG,K the indicator function of Kt¬µ K.
5.1.2. Geometrization of spherical Hecke algebra. A second basis is obtained by interpreting categorifying
the Hecke algebra in terms of L+ G-equivariant perverse sheaves on the affine Grassmannian GrG . Recall
that GrG (kt ) = G(Ft )/G(Ot ) where kt is the residue field of Ft . Geometric Satake furnishes a symmetric
monoidal equivalence
b
PervG(Ot ) (GrG ) ‚àº
= Rep(G).
b are indexed by ¬µ ‚àà X‚àó (T )+ , and we denote by SatGr (¬µ) the corresponding
The simple objects in Rep(G)
G

perverse sheaf on GrG , which is the IC sheaf of the Schubert variety Gr‚â§¬µ
G .
For any F ‚àà PervG(Ot ) (GrG ), we have under the function-sheaf dictionary ([KW01] ¬ßIII.12) a trace
function fF on G(Ot )\G(Ft )/G(Ot ) given by
fF (x) = Tr(Frob, Fx ).

(5.2)

Definition 5.2. We define œà¬µ to be the trace function associated to SatGrG (¬µ).
Definition 5.3. Since SatGrG (¬µ) is a G(Ox0 )-equivariant sheaf on GrG,x0 , its stalks are the same on any
open Schubert cell Gr=ŒΩ corresponding to KtŒΩ K in the Cartan decomposition (5.1). We denote this common
stalk by SatGrG (¬µ)ŒΩ .
Lemma 5.4. We have
œà¬µ =

X

Tr(Frob, SatGrG (¬µ)ŒΩ )fŒΩ

ŒΩ‚â§u

Proof. This is immediate from the fact that SatGr (¬µ)ŒΩ is supported on Gr‚â§¬µ , which is the union of the Gr=ŒΩ
for ŒΩ ‚â§ ¬µ, and the definition of fŒΩ as the characteristic function on KtŒΩ K.

We have a Satake isomorphism
‚àº
b ‚àº
HG (K) ‚àí
‚Üí R(G)
= Q‚Ñì [X‚àó (T )]W

b is the represenwhere W is the Weyl group of T . (The Satake isomorphism is reviewed in ¬ß7.2.) Here R(G)
b which is generated by the classes of the highest weight representations V¬µ .
tation ring of G,

5.1.3. Parahoric Hecke algebras. Let J be a parahoric subgroup of G stabilizing a facet in the dominant alcove
of the vertex corresponding to K in the Bruhat-Tits building of G(Ft ). Let HG,J = Func (J\G(Ft )/J, Q‚Ñì )
be the corresponding parahoric Hecke algebra.
Theorem 5.5 (Bernstein, [Hai09] Theorem 3.1.1.). Convolution with f0 = IK (the identity of HG,K ) induces
an isomorphism
‚àº
‚àí ‚àóJ IK : Z(HG,J ) ‚àí
‚Üí HG,K .
Definition 5.6. For ¬µ ‚àà X‚àó (T )+ ,
‚Ä¢ We denote by f¬µ‚Ä≤ the unique element of Z(HG,J ) such that f¬µ‚Ä≤ ‚àó IK = f¬µ .
‚Ä¢ We denote by œà¬µ‚Ä≤ ‚àà Z(HG,J ) the unique element such that œà¬µ‚Ä≤ ‚àó IK = œà¬µ ‚àà HG,K .

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

17

5.1.4. Geometrization of parahoric Hecke algebras. There is a geometrization of the parahoric Hecke algebra
completely analogous to ¬ß5.1.2. Let G be the parahoric group scheme corresponding to J by Bruhat-Tits
theory. Then the Hecke algebra HG,J is categorified by PervG(O) (GrG ).
Note that if J = I is an Iwahori subgroup (the stabilizer of full alcove), then GrG is the affine flag variety
FlG . In general one can think of GrG as a kind of affine partial flag variety.
One might ask which sheaves the functions œà¬µ‚Ä≤ correspond to. The answer is that they can be realized as
nearby cycles of certain global degenerations, and it is the key point underlying this section.
5.2. Nearby cycles. We recall the definition and essential (for us) properties of the nearby cycles functor.
For a reference, see [Del73] Expos√© XIII.
A Henselian trait is a triple (S, s, Œ∑) where S is a the spectrum of a discrete valuation ring, s is the special
point of S and Œ∑ is the generic point of S. Choose geometric points s and Œ∑ lying over s and Œ∑, respectively.
Let S be the normalization of S in Œ∑. We denote by
i : s ÷í‚Üí S
j : Œ∑ ÷í‚Üí S
i: s ‚Üí S
j: Œ∑ ‚Üí S
the obvious maps.
Let f : Y ‚Üí S be a finite type scheme over S. One defines a topos Y √ós Œ∑ as in [Del73] Expos√© XIII
¬ß1.2, so that the category Dcb (Y √ós Œ∑, Q‚Ñì ) is the category of F ‚àà Dcb (Y √ós s, Q‚Ñì ) together with a continuous
Gal(Œ∑/Œ∑)-action compatible with the Gal(s/s)-action on Ys via the natural map Gal(Œ∑/Œ∑) ‚Üí Gal(s/s).
Definition 5.7. Given F ‚àà Dcb (YŒ∑ , Q‚Ñì ) we define the nearby cycles RŒ®(F ) ‚àà Dcb (Y √ós s, Q‚Ñì ) by
‚àó

RŒ®(F ) := i Rj ‚àó (FŒ∑ )
with the Gal(Œ∑/Œ∑)-action obtained by transport of structure from that on FŒ∑ .
Remark 5.8. When the nearby cycles construction is performed with S = Spec Fq [[t]], the sheaf RŒ®(F )
is a priori only defined over YFq , but can be descended to YFq by choosing a splitting Gal(Fq /Fq ) ‚Üí
Gal(Fq ((t))/Fq ((t))). When dealing with nearby cycles on affine Grassmannians (or related objects) this is
often what we mean (see [Gai01], Footnote 4 on page 8). Only after such a descent one can associate a trace
function to RŒ®(F ). We shall point out when this descent is being used, but as a blanket rule it is necessary
every time we wish to talk about a trace function.
Lemma 5.9. If f : Y ‚Üí S is proper, then the base change homomorphism
RŒ®f‚àó ‚Üí f‚àó RŒ®
is an isomorphism.
Proof. This is [Del73], Expos√© XIII (2.1.7.1).



Corollary 5.10. If f : Y ‚Üí S is proper, then the natural map
Hci (YŒ∑ , Q‚Ñì ) ‚Üí Hci (Ys , RŒ®(Q‚Ñì )).
is an isomorphism.
Lemma 5.11. If f : Y ‚Üí S is lisse, then the base change homomorphism
f ‚àó RŒ® ‚Üí RŒ®f ‚àó
is an isomorphism.
Proof. This is [Del73], Expos√© XIII (2.1.7.2).



18

TONY FENG

5.3. Degeneration to affine flag varieties. Let X be a smooth curve (not necessarily projective) over Fq
and let G ‚Üí X be a parahoric group scheme, with parahoric level structure at x0 . We consider the global
affine Grassmannian for G as in ¬ß4.1:
œÄ : GrG ‚Üí X.
Consider the restriction GrG |Dx0 , where Dx0 := Spec Ox0 is the spectrum of the completed local ring at x0 .
We apply the nearby cycles construction of ¬ß5.2 and in the form of Remark 5.8, to
‚Ä¢ S = Dx0 , Y = GrG |Dx0 , and
‚Ä¢ F = SatGrG (¬µ)|Dx‚àó0 , where Dx‚àó0 = Spec Fx0 is thought of as a local ‚Äúpunctured disk‚Äù around x0 .
This produces a G(Ox0 )-equivariant perverse sheaf RŒ®(SatGrG (¬µ)|Dx‚ó¶0 ) on GrG |x0 , which we will abbreviate
by RŒ®(SatGrG (¬µ)).
Theorem 5.12 (Gaitsgory [Gai01], Zhu [Zhu14]). The sheaf RŒ®(SatGrG (¬µ))) is central.
Remark 5.13. In the present formulation and level of generality, this theorem is actually due to X. Zhu in
[Zhu14] Theorem 7.3. Gaitsgory worked with constant group schemes G, and a slightly different degeneration.
Corollary 5.14. Assume that G := G|Fx0 is split. Then the trace function (in the sense of (5.2)) associated
to RŒ®(SatGrG (¬µ))) is œà¬µ‚Ä≤ (Definition 5.6).
Remark 5.15. Note that we need to use Remark 5.8 to descend RŒ®(SatGrG (¬µ))) to GrG |x0 , so that it
makes sense to speak of the trace function.
Proof. Since RŒ®(SatGrG (¬µ)) is a G(Ox )-equivariant perverse sheaf on GrG |x0 , which is central by Theorem
5.12, we have a priori that its trace function
Tr(Frob, RŒ®(SatGrG (¬µ)))
lies in Z(HG,G(Ox0 ) (Fx )). Since G is split we can extend it to a constant group scheme over Dx0 , which we
continue to denote G, such that G0 (Ox0 ) =: K is a hyperspecial maximal compact subgroup of G(Fx ). Write
also J := G(Ox0 ) for the parahoric subgroup. By the Bernstein isomorphism (Theorem 5.5)
‚àº

‚àí ‚àó IK : Z(HG,J ) ‚àí
‚Üí HG,K
it suffices to check that
Tr(Frob, RŒ®(SatGrG (¬µ))) ‚àó IK = œà¬µ .
(5.3)
By [Gai01] Theorem 1 (d) the map (5.3) is realized sheaf-theoretically by the pushforward via the proper
map
pr : GrG ‚Üí GrG
or in other words,
Tr(Frob, RŒ®(SatGrG (¬µ))) ‚àó IK = Tr(Frob, pr! RŒ®(SatGrG (¬µ))).
Now, by Lemma 5.9 and the fact that pr is an isomorphism over Dx‚àó0 (since G|Dx‚àó0 ‚àº
= G|Dx‚àó0 ) we have
pr! RŒ®(SatGrG (¬µ)) = RŒ®(SatGrG (¬µ))
but since G0 |Dx ‚Üí Dx is smooth with constant fiber GrG , we simply have
RŒ®(SatGrG (¬µ)) = SatGrG (¬µ)|x0 ,
whose trace function is œà¬µ by definition.



Schubert stratification. Let GrG,x0 be the fiber of GrG over x0 . We discuss the stratification induced by the
G(Ox0 )-action on GrG,x0 .
The analogue of the Cartan decomposition (5.1) is
fJ \W
f /W
fJ
G(Ox0 )\G(Fx0 )/G(Ox0 ) ‚àº
=W

f is the extended affine Weyl group, and W
fJ is the subgroup corresponding to the parahoric subgroup
where W
J := G(Ox0 ). We refer to [Hai09] ¬ß2.6 for the notation and definitions; all that we require are the following
abstract facts:
fJ \W
f /W
fJ . We denote the open orbit corresponding
‚Ä¢ The G(Ox0 )-orbits on GrG,x0 are indexed by ŒΩ ‚àà W
‚â§ŒΩ
=ŒΩ
fJ \W
f /W
fJ by GrG,x and its closure by Gr
to ŒΩ ‚àà W
G,x0 .
0

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

19

fJ \W
f /W
fJ such that ¬µ ‚â• ŒΩ if and only if Gr‚â§¬µ ‚äÉ Gr=ŒΩ .
‚Ä¢ There is a partial order on W
G,x0
G,x0

Definition 5.16. Since RŒ®(SatGrG (¬µ)) is a J-equivariant perverse sheaf on GrG,x0 ([Gai01] Theorem 1), its
stalks are the same on any open Schubert cell Gr=ŒΩ
G . We denote this common stalk by RŒ®(SatGr (¬µ))ŒΩ .
Lemma 5.17. We have
œà¬µ‚Ä≤ =

X

Tr(Frob, RŒ®(SatGrG (¬µ))ŒΩ )fŒΩ

ŒΩ‚â§¬µ

Proof. The argument is the same as for Lemma 5.4.



5.4. Local models for shtukas.
Definition 5.18. Let X and Y be Artin stacks. We say that Y is an √©tale local model for X if there exists
an Artin stack W and a diagram
W
√©tale

√©tale
g

f

X

Y

A diagram as above is called a local model diagram.
‚â§(¬µ ,...,¬µr )

Theorem 5.19 (Varshavsky, V. Lafforgue). The stack GrG,X1r

‚â§(¬µ1 ,...,¬µr )

is an √©tale local model for ShtG

.

Remark 5.20. This is a variation on well-known results, which are not quite stated in the literature at
the level of generality needed here. Varshavsky proved this ([Var04] Theorem 2.20) for a constant group
G = G √ó X, while the general case is essentially implicit in [Laf12], so we credit it to both of them.
Proof. For ease of presentation, we assume that r = 1 in the proof; the argument for the general case is
a completely straightforward generalization. Since for any given ¬µ the L+ G-action on Hecke‚â§¬µ
and Gr‚â§¬µ
G
G
factors through a finite √©tale quotient, Proposition 4.8 implies that there is an √©tale cover Hecke‚â§¬µ
G,N ‚Üí
‚â§¬µ
‚â§¬µ
‚â§¬µ
HeckeG , obtained by adding a finite level structure, equipped with an √©tale map HeckeG,N ‚Üí GrG √ó BunG .
‚â§¬µ
Define ShtG,N
by the cartesian diagram
Sht‚â§¬µ
G,N

BunG
Id √ó Frob

h‚Üê √óh‚Üí
Hecke‚â§¬µ
BunG
G,N

√ó BunG

‚â§¬µ
Then we have a finite √©tale cover Sht‚â§¬µ
G,N ‚Üí ShtG , which concretely is the covering map for a finite level
structure. This fits into a diagram

Sht‚â§¬µ
G,N

BunG

√©tale

Sht‚â§¬µ
G

Id √ó Frob

Hecke‚â§¬µ
G,N

h

‚Üê

√óh

‚Üí

BunG √ó BunG

(5.4)

√©tale

BunG √ó Gr‚â§¬µ
G
‚â§¬µ
It is a general fact that in this situation that the vertical composition Sht‚â§¬µ
G,N ‚Üí GrG is √©tale. Indeed, since
the claim is local in the smooth topology, we may perform a base change to make everything into a scheme,
‚â§¬µ
and apply [Laf12] Lemma 2.13 to W = Hecke‚â§¬µ

G,N , T = GrG , and Z = BunG .

20

TONY FENG

Corollary 5.21. Let ¬µ ‚àà X‚àó (T )r . There is an √©tale local model diagram
W ‚â§¬µ
√©tale

√©tale
g

f
‚â§¬µ

‚â§¬µ

ShtG

GrG
Xr

with
f ‚àó SatShtG (¬µ) = g ‚àó SatGrG (¬µ).
‚â§¬µ

Proof. This follows from the diagram (5.4) and the definition of the Satake sheaves, taking W ‚â§¬µ = ShtG,N .

Let ¬µ ‚àà X‚àó (T )r . By Corollary 5.21, we may set
SatW (¬µ) := f ‚àó SatShtG (¬µ) = g ‚àó SatGrG (¬µ).
We write RŒ®x0 to emphasize that we are taking nearby cycles over the point x0 . By Lemma 5.11, and
implicitly using Corollary 5.21, we have
f ‚àó RŒ®x0 (SatShtG (¬µ)) = RŒ®x0 (SatW (¬µ)) = g ‚àó RŒ®x0 (SatGrG (¬µ)).
Thus, for w ‚àà W(k) lying over y ‚àà ShtG (k) and z ‚àà GrG (k), we have
Tr(Frob, RŒ®x0 (SatShtG (¬µ))y ) = Tr(Frob, RŒ®x0 (SatW (¬µ))w ) = Tr(Frob, RŒ®x0 (SatGrG (¬µ))z ).
Therefore, the stalks of RŒ®x0 (SatShtG (¬µ)) are constant along the stratification
a
‚â§¬µ
=ŒΩ
ShtG =
ShtG ,
ŒΩ‚â§¬µ

and we deduce:
Corollary 5.22. For ŒΩ ‚àà X‚àó (T )+ , we have
Tr(Frob, RŒ®x0 (SatShtG (¬µ))ŒΩ ) = Tr(Frob, RŒ®x0 (SatGrG (¬µ))ŒΩ ).
Remark 5.23. We will actually need to work with ShtG /aZ instead. Since this is obtained from ShtG by
gluing isomorphic components, the result is exactly the same.
6. Counting parahoric shtukas
Our eventual goal is establish a formula for the trace of an operator, formed as a composition of Hecke
operators and Frobenius, on the cohomology of the nearby cycles sheaf of (a variant of) ShtG /aZ ‚Üí X, at
a place of parahoric bad reduction. The mold for such calculations was set by Kottwitz in [Kot92], who
computed this sort of trace for certain PEL Shimura varieties, at places of good (hyperspecial) reduction. It
has since been extended vastly by work of many authors; we note that in particular that Kisin and Pappas
constructed integral models for Shimura varieties with parahoric level structure and computed the trace of
Frobenius on nearby cycles in [KP]. Our result is a function field analogue of this computation.
In this section we carry out one step of this calculation, which deals with counting the number of fixed
points of Frobenius composed with Hecke correspondences. (The precise setup will be explained in ¬ß6.1.) In
fact most of the work has already been done by B.C. Ng√¥ and T. Ng√¥ Dac, who studied the case of moduli
of shtukas with hyperspecial reduction in the series of papers [Ngo06], [NND08], [ND13], and [ND15]. The
only new element here is that we are considering parahoric reduction. We note also that our results should
follow from work of Hartl and Arasteh Rad proving the analogue of the Langlands-Rapoport Conjecture for
shtukas [HRb].

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

21

6.1. Setup. Throughout this section X ‚ó¶ is an unspecified open subset X, which in the case of D-shtukas
will be X ‚àí Z where Z is the set of ramification places of D. We let G be a quasi-split, connected reductive
group over F with simply-connected derived group, or the group attached to a division algebra D as in ¬ß4.5.
(This unwieldy hypothesis is in place because the statements of [NND08] and [ND13] use the first general
hypothesis, but apply also D-shtukas, cf. [Ngo06] ¬ß4, and we are also interested in the latter.) Let G ‚Üí X a
parahoric group scheme, with parahoric reduction at x0 .
Let Kv = G(Ov ). Let Kv tŒ≤v Kv ‚àà Kv \G(Fv )/Kv be a choice of double coset for all v, trivial for almost
all v. Let T ‚Ä≤ ‚äÇ X ‚ó¶ be the set of all v where Œ≤v 6= 0, i.e. where the corresponding Hecke operator hŒ≤v is not
the identity. We assume that Kv is hyperspecial for all v ‚àà T ‚Ä≤ .
There is a Hecke correspondence (¬ß4.3.4)
v
/aZ
Hecke(ShtG )‚â§Œ≤
v

h

‚Üê

h‚Üí

ShtG /aZ

ShtG /aZ
œÄ

(6.1)

œÄ

X
for each Œ≤v . This induces a Hecke operator hŒ≤v on the cohomology of ShtG /aZ (Definition 4.14). See [NND08]
¬ß3 for more discussion about the Hecke correspondences.
Q
We abbreviate Œ≤ := (Œ≤v )v‚ààT ‚Ä≤ and denote the corresponding Hecke operator hŒ≤v by hŒ≤,T ‚Ä≤ . We want to
compute (a variant of)
Tr(hŒ≤,T ‚Ä≤ ‚ó¶ Frob, œÄ! RŒ®x0 (SatShtG (¬µ)))
where x0 is our fixed place of parahoric reduction. By the Grothendieck-Lefschetz trace formula, we have
Tr(hŒ≤,T ‚Ä≤ ‚ó¶ Frob, RŒ®x0 (SatShtG (¬µ)))
X
=

Œû‚ààFix(hŒ≤,T ‚Ä≤ ‚ó¶Frob)

1
Tr(hŒ≤,T ‚Ä≤ ‚ó¶ FrobŒû , RŒ®x0 (SatShtG (¬µ))Œû ).
# Aut Œû

We will compute this by focusing first on counting Fix(Œ¶Œ≤,T ‚ó¶ Frob). This was done by [Ngo06] for Dshtukas at points of with no level structure (good reduction), and extended by [NND08] for general reductive
groups and [ND13] for more complicated setups; however, these counts only account for the contribution
from the ‚Äúelliptic part‚Äù.
In the case where GF is anisotropic mod center, the elliptic part will obviously compose everything. This
is one of the reasons why it is convenient to work with division algebras, and one of the difficulties in carrying
out the strategy for general groups. Since ShtG is of infinite type in general, it will have infinitely many
points even over finite fields, although the sum can still converge because of the weighting of automorphisms.
6.2. The groupoid of fixed points. We consider a slightly more general situation. We‚Äôll define a groupoid
C(Œ±, Œ≤; T, T ‚Ä≤ ; d) which occurs as the fixed points of a composition of Hecke and Frobenius operators on a
certain moduli stack of shtukas. Then we will count its mass in the sense of groupoids.
Definition 6.1. If C is a finite groupoid with finite automorphism groups then we define
X
1
#C :=
.
# Aut(c)
c‚ààC

Note that the Fq -points of a finite type Deligne-Mumford stack, which includes any Schubert cell in a moduli
stack of shtukas, satisfies this assumption.
Definition 6.2 ([NND08] ¬ß4). Let T, T ‚Ä≤ ‚äÇ |X| ‚àí I. Let
Œ± = (Œ±v ‚àà Kv \G(Fv )/Kv )v‚ààT
Œ≤ = (Œ≤v ‚àà Kv \G(Fv )/Kv )v‚ààT ‚Ä≤

(In terms of the notation of ¬ß6.1, we are identifying Œ≤v with Kv tŒ≤v Kv .) We define the groupoid of fixed
points C(Œ±, Œ≤; T, T ‚Ä≤ ; d) as follows: its objects are triples (E, t, t‚Ä≤ ) with
‚àº
‚Üí E|X‚àíT , with modification type Œ± on T , and
(1) t : E œÉ |X‚àíT ‚àí

22

TONY FENG
d

‚àº

‚Üí E|X‚àíT ‚Ä≤ , with modification type Œ≤ on T ‚Ä≤ ,
(2) t‚Ä≤ : E œÉ |X‚àíT ‚Ä≤ ‚àí
(3) satisfying the following compatibility:
EœÉ

d+1

œÉd (t)

|X‚àíT ‚àíT ‚Ä≤

d

E œÉ |X‚àíT ‚àíT ‚Ä≤

œÉ(t‚Ä≤ )

t‚Ä≤
t

E œÉ |X‚àíT ‚àíT ‚Ä≤

E|X‚àíT ‚àíT ‚Ä≤

The automorphisms of (E, t, t‚Ä≤ ) are defined to be automorphisms of E commuting with t and t‚Ä≤ .
The relation to our initial problem is given by the following.
Lemma 6.3. Suppose x ‚àà |X| is a point of degree d. Then we have an isomorphism of groupoids
Fix(hŒ≤,T ‚Ä≤ ‚ó¶ Frob, Sht=¬µ |x ) ‚àº
= C(¬µ, Œ≤; {x}, T ‚Ä≤ ; d).
G

Proof. This is immediate upon writing down the definitions.



Sht=¬µ
G

We actually want to study the truncated space
/aZ , so we modify the discussion accordingly. Let
J ‚äÇ Z(G)(A) be a cocompact lattice. Then J acts on Sht=¬µ
via Hecke correspondences, and we define
G
‚Ä≤
Sht=¬µ
G /J to be the quotient. Similarly we define C(¬µ, Œ≤; {x}, T ; d)J to be the quotient by the J-action. (See
[NND08], near the end of ¬ß4, for more details.)
Lemma 6.4. Suppose x ‚àà |X| is a point of degree d. Then we have an isomorphism of groupoids
‚àº C(¬µ, Œ≤; {x}, T ‚Ä≤; d)J .
Fix(hŒ≤,T ‚Ä≤ ‚ó¶ Frobx , Sht=¬µ /J|x ) =
G

‚Ä≤

Hence we want to study #C(¬µ, Œ≤; {x}, T ; d)J . The strategy for these counts goes back to Kottwitz‚Äôs study
of points of Shimura varieties (with hyperspecial level structure) over finite fields [Kot92].
(1) We first show that there is a cohomological invariant, the Kottwitz invariant, which controls the
possible ‚Äúgeneric fibers‚Äù of members of C(Œ±, Œ≤; T, T ‚Ä≤ ; d).
(2) We then express the size of an isogeny class as a product of (twisted) orbital integrals.
(3) We then express the number of isogeny classes associated to each Kottwitz invariant in terms of
certain cohomology groups.
These steps have been carried out in papers of B.C. Ng√¥ and T. Ng√¥ Dac, as already mentioned, but not
quite in the generality required here. In particular, these previous papers avoid the case where T meets a
point with non-trivial level structure (because the moduli problem was not defined over such points), which
is exactly the situation that we are interested in. So we will describe the modifications needed to extend
the argument to our setting, and only briefly summarize the parts that are already covered in the papers of
B.C. Ng√¥ and T. Ng√¥ Dac.
6.3. Kottwitz triples and classification of generic fibers. Our first step is to define a category that
looks like the category of ‚Äúgeneric fibers of C(Œ±, Œ≤; T, T ‚Ä≤ ; d)‚Äù.
Definition 6.5 ([NND08] ¬ß5). Let T, T ‚Ä≤ ‚äÇ |X| ‚àí I. We define the groupoid C(T, T ‚Ä≤ ; d) as follows: its objects
are triples (V, œÑ, œÑ ‚Ä≤ ) with
(1) V a G-torsor over Fk := F ‚äók k,
‚àº
(2) an isomorphism œÑ : V œÉ ‚àí
‚Üí V , where V œÉ = V ‚äóFk ,œÉ Fk ,
d ‚àº
‚ÜíV,
(3) œÑ ‚Ä≤ : V œÉ ‚àí
satisfying the following conditions:
(1) (‚Äúcommutativity‚Äù) The following diagram commutes:
VœÉ

d+1

œÉd (œÑ )

œÉ(œÑ ‚Ä≤ )

VœÉ

VœÉ

d

œÑ‚Ä≤
œÑ

E

b Fq œÉ).
b Fq Fq ), Id ‚äó
(2) For x ‚àà
/ T , (Vx , œÑx ) is isomorphic to the trivial isocrystal (G(Fx ‚äó
b Fq Fq ), Id ‚äó
b F d œÉ d ).
(3) For x ‚àà T , (Vx , œÑx‚Ä≤ ) is isomorphic to the trivial isocrystal (G(Fx ‚äó
q

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

23

The automorphisms of (V, œÑ, œÑ ‚Ä≤ ) are automorphisms of E commuting with œÑ and œÑ ‚Ä≤ .
The operation of ‚Äútaking the generic fiber‚Äù defines a functor ([NND08] ¬ß5.2)
C(Œ±, Œ≤; T, T ‚Ä≤ ; d) ‚Üí C(T, T ‚Ä≤ ; d).
6.3.1. Kottwitz triples. Recall that a Kottwitz triple is a datum (Œ≥0 , (Œ≥x )x‚ààT
/ , (Œ¥x )x‚ààT ) where:
‚Ä¢ Œ≥0 is a stable conjugacy class of G(F ),
‚Ä¢ Œ≥x is a conjugacy class of G(Fx ) for each x ‚àà
/ T , and is stably conjugate to Œ≥0 ,
b Fq Fqd ), whose norm
‚Ä¢ Œ¥x is a œÉ-conjugacy class of G(Fx ‚äó
N (Œ¥x ) := Œ¥x ¬∑ œÉ(Œ¥x ) ¬∑ . . . ¬∑ œÉ d‚àí1 (Œ¥x )

is stably conjugate to Œ≥0 .

Construction 6.6. We now recall from [NND08] ¬ß6.1 how to attach to each (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d) a
Kottwitz triple (Œ≥0 , (Œ≥x )x‚ààT
/ , (Œ¥x )x‚ààT ).
n
First a remark on notation: for a map œÑ : V œÉ ‚Üí V , we denote by œÑ n : V œÉ ‚Üí V the map œÑ ‚ó¶ œÉ(œÑ ) ‚ó¶ . . . ‚ó¶
œÉ n‚àí1 (œÑ ).
(1) Definition of Œ≥0 . Since Fk has cohomological dimension 1, the G-torsor V is split over Fk . Consider
Œ≥ = œÑ d (œÑ ‚Ä≤ )‚àí1 , which is a linear automorphism of V . Using the ‚Äúcommutativity‚Äù axiom we find that
œÉ(Œ≥) = œÉ(œÑ ) ‚ó¶ œÉ 2 (œÑ ) ‚ó¶ . . . ‚ó¶ œÉ d (œÑ ) ‚ó¶ œÉ(œÑ ‚Ä≤ )‚àí1 = œÑ ‚àí1 Œ≥œÑ.
This shows that the conjugacy class of Œ≥ is stable under œÉ, hence defined over F . Since G was
assumed to be quasi-split with simply connected derived subgroup, this conjugacy class must then
contain an F -point. Thus, we have an element Œ≥0 ‚àà G(F ) with a well-defined stable conjugacy class.
(2) Definition of Œ≥x , x ‚àà
/ T . By assumption, we can pick an isomorphism
b F œÉ).
b F Fq ), Id ‚äó
(Vx , œÑx ) ‚àº
= (G(Fx ‚äó
q

q

b Fq Fq ), Id ‚äó
b Fq œÉ).
Since œÑ and œÑ commute, so do œÑx and
so that defines an automorphism of (G(Fx ‚äó
We can then write œÑx‚Ä≤ = Œ≥x‚àí1 ‚äó œÉ d , for some Œ≥x ‚àà G(Fx ) which is stably conjugate to Œ≥0 . (The point
is that picking this trivialization of œÑx amounts to setting ‚ÄúœÑx = Id‚Äù in the equation Œ≥x = œÑxd (œÑx‚Ä≤ )‚àí1 .)
(3) Definition of Œ¥x , x ‚àà T . By assumption, we can pick an isomorphism
b Fd œÉ d ).
b F Fq ), Id ‚äó
(Vx , œÑ ‚Ä≤ ) ‚àº
= (G(Fx ‚äó
‚Ä≤

œÑx‚Ä≤ ,

x

œÑx‚Ä≤

q

q

b Fq Fq ), Id ‚äó
b Fq œÉ).
Since œÑ and œÑ ‚Ä≤ commute, so do œÑx and œÑx‚Ä≤ , so that œÑx defines an automorphism of (G(Fx ‚äó
We can then write œÑx = Œ¥x ‚äó œÉ, for some Œ¥x ‚àà G(Fx ), well-defined up to œÉ-conjugacy, whose norm
N (Œ¥x ) = Œ¥x ¬∑ œÉ(Œ¥x ) ¬∑ . . . ¬∑ œÉ r‚àí1 (Œ¥x ) is stably conjugate to Œ≥0 .

Definition 6.7. We say that (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d) is semisimple if Œ≥0 is semisimple, and elliptic if Œ≥0 is
elliptic.
We say (E, t, t‚Ä≤ ) ‚àà C(Œ±, Œ≤; T, T ‚Ä≤ ; d) is semisimple (resp. elliptic) if the associated (V, œÑ, œÑ ‚Ä≤ ) is semisimple
(resp. elliptic).
6.3.2. The Kottwitz invariant. Following [NND08] ¬ß6.2 we can attach to the Kottwitz triple (Œ≥0 , (Œ≥x ), (Œ¥x ))
b Œ≥0 )Œì ). Briefly, this is done as follows.
a character inv(Œ≥0 , (Œ≥x ), (Œ¥x )) ‚àà X ‚àó (Z(G
b k k)
‚Ä¢ For x ‚àà
/ T , since Œ≥x and Œ≥0 are stably conjugate, by a theorem of Steinberg we can find g ‚àà G(Fx ‚äó
such that
gŒ≥0 g ‚àí1 = Œ≥x .
Then (using that Œ≥0 ‚àà G(F )) we have
gŒ≥0 g ‚àí1 = Œ≥x = œÉ(Œ≥x ) = œÉ(g)Œ≥0 œÉ(g)‚àí1 .
b k k), hence defines a class in B(GŒ≥0 ,x ) =
This shows that g ‚àí1 œÉ(g) is in the centralizer of Œ≥0 in G(Fx ‚äó
b k k)/œÉ-conjugacy.
G(Fx ‚äó
b k k) and
b k k) such that N Œ¥x = gŒ≥0 g ‚àí1 . Then g ‚àí1 Œ¥x œÉ(g) is in GŒ≥0 (Fx ‚äó
‚Ä¢ For x ‚àà T , we have g ‚àà G(Fx ‚äó
defines a class in B(GŒ≥0 ,x ).

24

TONY FENG

bŒ≥0 )Œìx ) of [Kot90] ¬ß6 to get a local character invx (Œ≥0 , (Œ≥x ), (Œ¥x )) ‚àà
For each x, we apply the map B(GŒ≥0 ,x ) ‚Üí X ‚àó (Z(G
Œì
‚àó
bŒ≥0 ) x ). Almost all of the resulting characters are trivial, so that it makes sense to sum the restrictions
X (Z(G
b Œ≥0 )Œì , and we define this sum to be inv(Œ≥0 , (Œ≥x ), (Œ¥x )).
of all these characters to Z(G
Proposition 6.8. [NND08] For elliptic (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d), and (Œ≥0 , (Œ≥x ), (Œ¥x )) the associated Kottwitz
triple, if Œ≥0 is semisimple then we have inv(Œ≥0 , (Œ≥x ), (Œ¥x )) = 0.

Proposition 6.9. There exists (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d) having a given elliptic Kottwitz triple (Œ≥0 , (Œ≥x ), (Œ¥x ))
if and only if inv(Œ≥0 , (Œ≥x ), (Œ¥x )) = 0. If the set of such is non-empty, then the number of isogeny classes
within C(T, T ‚Ä≤ ; d) having the same Kottwitz triple is the cardinality of
Y
ker1 (F, GŒ≥0 ) := ker(H 1 (F, GŒ≥0 ) ‚Üí
H 1 (Fx , GŒ≥0 )).
x

Proof. This follows from the proof of [NND08] Proposition 11.1 combined with [ND13] Proposition 4.3. 
6.3.3. Automorphisms of the generic fiber. Let (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d) with elliptic Kottwitz triple (Œ≥0 , (Œ≥x ), (Œ¥x )).
By [ND13] ¬ß3.9, the automorphisms of (V, œÑ, œÑ ‚Ä≤ ) are the Fx -points of an inner form JŒ≥0 of GŒ≥0 defined over
F.
Remark 6.10. As pointed out in [ND13] ¬ß3.9, the Hasse principle implies that JŒ≥0 is determined by its
local components:
‚Ä¢ For x ‚àà
/ T , JŒ≥0 ,x is the centralizer of Œ≥x in G(Fx ),
‚Ä¢ For x ‚àà T , JŒ≥0 ,x is the twisted centralizer of Œ¥x in G(Fx ‚äóFq Fqd ).
6.4. Counting lattices. We now study the fibers of the functor C(Œ±, Œ≤; T, T ‚Ä≤ ; d) ‚Üí C(T, T ‚Ä≤ ; d).
Proposition 6.11. Fix an elliptic (V, œÑ, œÑ ‚Ä≤ ) ‚àà C(T, T ‚Ä≤ ; d). Suppose (E, t, t‚Ä≤ ) ‚àà C(Œ±, Œ≤; T, T ‚Ä≤ ; d) lies over
(V, œÑ, œÑ ‚Ä≤ ). The size of the isogeny class of (E, t, t‚Ä≤ ) is
Y
Y
OŒ≥x (œÜŒ≤x )
TOŒ¥x œÉ (œÜŒ±x ).
vol(J ¬∑ JŒ≥0 (F )\GŒ≥0 (A)) ¬∑
x‚ààT

x‚ààT
/

Here we normalize Haar measures as in ¬ß2.1.1.
b k k-bundle over Spec Ox for all x ‚àà X, plus
Proof. Promoting (V, œÑ, œÑ ‚Ä≤ ) to (E, t, t‚Ä≤ ) amounts to choosing a Gx ‚äó
an I-level structure, such that
‚Ä¢
‚Ä¢
‚Ä¢
‚Ä¢

for
for
for
for

v‚àà
/ |T |, Ex is fixed by œÑ ,
v‚àà
/ |T |‚Ä≤ , Ex is fixed by œÑ ‚Ä≤ ,
x ‚àà |T |, the relative position of Ex and œÑ (Ex ) is given by Œ±x ,
v ‚àà |T |‚Ä≤ (hence outside |T |), the relative position of Ev and œÑ ‚Ä≤ (Ev ) is given by Œ≤v .

As is well-known (cf. [NND08] ¬ß9 or [ND13] ¬ß5 for the present situation; the earliest reference we know is
[Kot80]), this is counted by
Z
O
O
œÜŒ≤x (h‚àí1
œÜŒ±x (h‚àí1
x Œ≥x hx ) dh.
x Œ¥x œÉ(hx ))
Q
J¬∑JŒ≥0 (F )\

x‚ààT

G(Fx ‚äóFq Fqd )√óG(AT ) x‚ààT

x‚ààT
/

Here we use Remark 6.10 to view JŒ≥0 (F ) as a subset of G(Fx ). The statement of the proposition is a
straightforward rewriting of this formula.

6.5. Count of elliptic elements. Define
#C(Œ±, Œ≤; T, T ‚Ä≤ ; d)ell :=

X

(E,t,t‚Ä≤ ) elliptic

1
.
# Aut(E, t, t‚Ä≤ )

Combining Proposition 6.9, ¬ß6.3.3, and Proposition 6.11, we obtain:

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

Theorem 6.12. We have
#C(Œ±, Œ≤; T, T ‚Ä≤ ; d)ell =

X

25

ker1 (F, GŒ≥0 ) ¬∑ vol(J ¬∑ JŒ≥0 (F )\JŒ≥0 (AF )) ¬∑ dg(K)‚àí1

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0
Œ≥0 elliptic

¬∑

Y

!

OŒ≥x (fŒ≤v )

x‚ààT
/

Y

TOŒ¥x œÉ (fŒ±x )

x‚àà|T |

Remark 6.13. This is the analogue of [ND13] Th√©or√®me 5.1. The expressions look almost the same, but
one should keep in mind that in our applications T = {x0 }, and fŒ±x0 should be thought of as an indicator
function on a partial affine flag variety rather than an affine Grassmannian. In addition, the measure of Kx0
is adapted accordingly.
Z
Corollary 6.14. Let Sht‚â§¬µ
G /a be the moduli stack of D-shtukas with parahoric level structure at x0 , as in
¬ß4.5. Then
X
Z
ker1 (F, GŒ≥0 ) ¬∑ vol(aZ ¬∑ JŒ≥0 (F )\JŒ≥0 (AF ))¬∑
# Fix(hŒ≤,T ‚Ä≤ ‚ó¶ Frob, Sht=¬µ
G /a |x0 ) =
(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

‚àí1

¬∑ dg(K)

¬∑

Y

x‚ààT
/

!

OŒ≥x (fŒ≤v )

¬∑ TOŒ¥x0 œÉ (f¬µ ).

Proof. This is immediate from Lemma 6.4 and the observation that every non-zero element of a division
algebra is elliptic, since the associated group of units is anisotropic mod center. (As mentioned at the
beginning of ¬ß6, the results used from [NND08] and [ND13] also apply to D-shtukas, and in fact were
originally proved for this case in [Ngo06] ¬ß4.)

7. Geometrization of base change for Hecke algebras
In this section we present a geometric interpretation of the base change homomorphism for spherical
Hecke algebras, and then for the center of parahoric Hecke algebras. The results here are a generalization
to arbitrary split reductive groups G of results from [Ngo99], which proved the result for GLn .
Using the work of Gaitsgory on realizing central sheaves on the affine flag variety as nearby cycles, we
then deduce a geometric interpretation of base change for the center of the parahoric Hecke algebra.
7.1. Definition of base change homomorphism. For this section only, we let F be a local field and G
be a reductive group over F . Given a compact open subgroup H ‚äÇ G(F ), we have the Hecke algebra
HG,H := Func (H\G(F )/H, Q‚Ñì ).
We begin by defining base change homomorphisms for some Hecke algebras with respect to a degree r
unramified extension of local fields E/F .
For simplicity we assume that G is split over F . (Our results should extend at least to quasi-split G
without much difficulty.) We let E/F be the unramified extension of degree r.
Definition 7.1 ([Hai09] ¬ß1). Let K ‚äÇ G(F ) be a hyperspecial maximal compact subgroup. The base change
homomorphism for spherical Hecke algebras (with respect to E/F ) is the homomorphism of C-algebras
HG(E),K ‚Üí HG(F ),K
characterized by the following property. Let WF be the Weil group of F . For an admissible unramified
homomorphism œà : WF ‚Üí L G let œà ‚Ä≤ : WE ‚Üí L G denote the restriction to WE ‚äÇ WF . Let œÄœà and œÄœà‚Ä≤ denote
the corresponding representations of G(E) and G(F ) under the Local Langlands Correspondence. Then for
any œÜ ‚àà HG(E),K we have
htrace œÄœà‚Ä≤ , œÜi = htrace œÄœà , b(œÜ)i
Definition 7.2 ([Hai09] ¬ß1). Let J ‚äÇ K be a parahoric subgroup and IK denote the characteristic function
of K ‚äÇ G(F ). By a theorem of Bernstein (cf. [Hai09] Theorem 3.1.1), convolution with IK defines an
isomorphism
‚àº
‚àí ‚àóJ IK : Z(HG,J ) ‚àí
‚Üí HG,K .

26

TONY FENG

We define the base change homomorphism for parahoric Hecke algebras to be the homomorphism
b : HG(E),J ‚Üí HG(F ),J
making the following diagram commute:
b

Z(HG(E),J )

Z(HG(F ),J )

‚àº ‚àí‚àóJ IK

‚àº ‚àí‚àóJ IK
b

HG(E),K

(7.1)

HG(F ),K

7.1.1. Interpretation under Satake isomorphism. Let T ‚äÇ G be a maximal torus. We have the Satake
isomorphism
‚àº
‚Üí Q‚Ñì [X‚àó (T )]W
S : HG,K ‚àí
where W is the Weyl group of G relative to T . We also have the Bernstein isomorphism
‚àº

B : Z(HG,J ) ‚àí
‚Üí HG,K .
We can define the base change homomorphism on the Satake side as follows. We define the norm homomorphism
N : Q‚Ñì [X‚àó (TE )]W ‚Üí Q‚Ñì [X‚àó (TF )]W
to be that induced by the norm TE ‚Üí TF . Since we are working in the split setting, this simply corresponds
‚àº
to multiplication by r on X‚àó (TE ) ‚àí
‚Üí Zn .
Then b : HG(E),J ‚Üí HG(F ),J is determined by the commutativity of the following diagram ([Hai09], ¬ß3.2)
Z(HG(E),J )

b

Z(HG(F ),J )

‚àº ‚àí‚àóJ IK

HG(E),K

‚àº ‚àí‚àóJ IK
b

HG(F ),K
‚àº S

‚àº S

C[X‚àó (TE )]W

(7.2)

N

C[X‚àó (TF )]W (F )

For more on the base change homomorphism, see [Hai09] ¬ß3.
7.2. Geometrization of the Satake transform. In this section we will recall a geometric interpretation
of the Satake transform.
7.2.1. The classical Satake transform. We first review the Satake transform (cf. [Gro98]). Let HG,K be
the spherical Hecke algebra of G(F ) with respect to a hyperspecial maximal compact subgroup K. Let
HT = Q‚Ñì [X‚àó (T )].
We choose a Borel subgroup B containing T and let N be its unipotent radical. There is a Satake
transform S : HG,K ‚Üí HT given by
Z
1/2
Sf (t) = Œ¥(t)
f (tx)dx,
N

where the Haar measure dx is normalized to assign volume 1 to N (Ot ).

Theorem 7.3 (Satake). The Satake transform gives a ring isomorphism
b ‚àº
S : HG,K ‚àº
= R(G)
= HTW

b is the representation ring of G
b with Q‚Ñì -coefficients.
where R(G)
We have an isomorphism

HT ‚àº
= Q‚Ñì [X‚àó (T )].
Œª
For Œª ‚àà X‚àó (T ), write t for the corresponding element of HT . Then we may write
Z
Sf (tŒª ) = Œ¥(tŒª )1/2
f (tŒª x)dx.
N

(7.3)

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

27

7.2.2. Interpretation via semi-infinite orbits. We will interpret the function (7.3) geometrically, as the trace
function associated to a certain subscheme SŒª , studied by Mirkovic-Vilonen in [MV07] ¬ß3, in the sense that
if fF is the trace function associated to F , then
SfF (tŒª ) = q ‚àíœÅ(Œª) Tr(Frob, RŒìc (SŒª ‚äók k, F ))
where œÅ is the usual half sum of the positive roots.
Following the notation of [MV07], for Œª ‚àà X‚àó (T ) we let LŒª = tŒª G(O) denote the image of Œª in the affine
Grassmannian GrG , and SŒª be its orbit under NF .
Lemma 7.4. Let F be a sheaf on GrG defined over k, and fF its associated trace function (cf. (5.2)). Then
we have
SfF (tŒª ) = q ‚àíœÅ(Œª) Tr(Frob, RŒìc (SŒª ‚äók k, F )).
Proof. We study the rational points SŒª (k), in preparation for an application of the Grothendieck-Lefschetz
trace formula. The stabilizer of tŒª is
StabN (F ) (LŒª ) = {n ‚àà N (F ) : ntŒª G(O) = tŒª G(O)}
= {n ‚àà N (F ) : t‚àíŒª ntŒª ‚àà G(O)}.
This says that the map n 7‚Üí t‚àíŒª ntŒª defines a bijection between StabN (F ) (LŒª ) and N (O). Therefore the map
n 7‚Üí tŒª n defines a bijection between SŒª = [N (F )/ StabN (F ) (LŒª )] ¬∑ LŒª and N (F )/N (O). An application of
the Grothendieck-Lefschetz trace formula then yields
X
fF (n)
Tr(Frob, RŒìc (SŒª ‚äók k, F )) =
n‚ààSŒª (k)

=

X

fF (tŒª ¬∑ n)

n‚ààN (F )/N (O)

which is exactly what was claimed upon recalling that Œ¥(tŒª ) = q œÅ(Œª) .



Theorem 7.5 (Mirkovic-Vilonen). There is a natural equivalence of functors
M
Hc2œÅ(Œª) (SŒª , ‚àí) : PGO (GrG , Q‚Ñì ) ‚Üí ModQ‚Ñì .
H ‚àó (‚àí) ‚àº
=
Œª‚ààX‚àó (T )

Proof. This is a result of Mirkovic-Vilonen for the affine Grassmannian over C ([MV07], Theorem 3.6). For
the generality we require, namely GrG over k = Fq , see [Zhu] Theorem 5.3.9 and the references indicated in
[Zhu] Remark 5.3.10.

Proposition 7.6. We have
Hc‚àó (SŒª , F¬µ ‚àó F¬µ‚Ä≤ ) ‚àº
=

M

Hc‚àó (SŒª1 , F¬µ ) ‚äó Hc‚àó (SŒª2 , F¬µ‚Ä≤ )

Œª1 +Œª2 =Œª

Proof. This statement is proved implicitly in [MV07] Proposition 6.4. In fact, in view of Theorem 7.5 it is
equivalent to [MV07] Proposition 6.4.
Although the paper [MV07] works with the affine Grassmannian over C, this result is valid in general; it
is formulated in the general setting in [Zhu] Proposition 5.3.14, and a proof is sketched there.

Remark 7.7. We thank Timo Richarz for informing us that both Theorem 7.5 and Proposition 7.6 are now
formally written up in full generality in [HRa] Theorem 3.16 (proof of part ii).
7.3. Base change for spherical Hecke algebras. For r ‚àà N, let kr be the (unique) extension of k of
degree r and Fr denote the unique unramified field extension of F of degree r. For each ¬µ ‚àà X‚àó (T ), we let
SatGrG ,r (¬µ) be the associated perverse sheaf on GrG,kr and we let œàr,¬µ be the trace function on GrG (kr )
associated to SatGrG ,r (¬µ). We will give a geometric interpretation for b(œàr,¬µ ).

28

TONY FENG

7.3.1. Weil restriction. It will be useful to adopt a different perspective on the Hecke algebra HG(Fr ),K . As
is usual, we can think of HG(Fr ),K as functions on GrG (kr ) ‚Üí Q‚Ñì which are invariant with respect to the
left K-action. (We are abusing notation here by using K to denote both the maximal compact subgroups of
G(Fr ) and G(F ) corresponding to our chosen hyperspecial vertex.) However, using the identification
GrG (kr ) = (Reskr /k GrG,kr )(k)
we can instead consider HG(Fr ),K as functions on (Reskr /k GrG,kr )(k). Let œÑ be the cyclic permutation on
GrrG,X given by
œÑ (y1 , . . . , yr ) = (yr , y1 , . . . , yr‚àí1 ).
By the definition of Weil restriction, we have a canonical bijection
‚àº

GrG (kr ) ‚àí
‚Üí Fix(Frob ‚ó¶œÑ, GrrG )
sending

y 7‚Üí (y, Frob(y), . . . , Frobr‚àí1 (y)).

Definition 7.8. For each ¬µ ‚àà X‚àó (T ), we let F¬µ := SatGrG (¬µ) be the perverse sheaf on GrG . Consider the
perverse sheaf
F¬µ(1) ‚ä† . . . ‚ä† F¬µ(r) ‚àà Dcb (GrrG )
(1)
where F¬µ ‚àº
= F¬µ ; the superscripts are just labellings. The endomorphism œÑ on GrrG lifts to an endomorphism
(1)
(r)
œÑe of F¬µ ‚ä† . . . ‚ä† F¬µ in an obvious way. Define a function
Œ∂r,¬µ : Fix(Frob ‚ó¶œÑ, GrrG ) ‚Üí Q‚Ñì

by

Œ∂r,¬µ (y) := Tr(Frob ‚ó¶e
œÑ , (F¬µ(1) ‚ä† . . . ‚ä† F¬µ(r) )y ).
Proposition 7.9. The Œ∂r,¬µ form a basis for HG(Fr ),K .
Proof. This is well-known. It amounts to the fact that the change-of-basis matrix between the standard
(double coset) basis of the Hecke algebra and the basis consisting of the Œ∂r,¬µ is upper-triangular for the
Bruhat order.

7.3.2. Convolution product. Recall that there is a convolution product ‚àó on PervG(O) (GrG ) ([Zhu] ¬ß5).
Definition 7.10. Consider rth convolution product
F¬µ‚àór := F¬µ(1) ‚àó . . . ‚àó F¬µ(r)
as a perverse sheaf on GrG . This has an automorphism Œ∫‚Ä≤ of order r given by the composition
Œπ

Œ∫

‚Üí F¬µ(1) ‚àó . . . ‚àó F¬µ(r)
‚Üí F¬µ(r) ‚àó F¬µ(1) ‚àó . . . ‚àó F¬µ(r‚àí1) ‚àí
F¬µ(1) ‚àó . . . ‚àó F¬µ(r) ‚àí
where Œ∫ is the cyclic permutation obtained from the commutativity constraint F ‚àó B ‚àº
= B ‚àó F of Geometric
(i+1 mod r)
(i mod r) ‚àº
coming
Satake ([Zhu] Proposition 5.2.6), and Œπ is the tautological isomorphism F¬µ
= F¬µ
(i)
from the fact that all the F¬µ are defined to be the same perverse sheaf.
(1)
(r)
Define œÜr,¬µ : Fix(Frob ‚ó¶Œ∫‚Ä≤ , F¬µ ‚àó . . . ‚àó F¬µ ) ‚Üí Q‚Ñì by
œÜr,¬µ (y) = Tr(Frob ‚ó¶Œ∫‚Ä≤ , (F¬µ(1) ‚àó . . . ‚àó F¬µ(r) )y ).
7.3.3. The base change identity. We now explain the relationship between these functions and the base
change homomorphism.
Proposition 7.11. We have b(Œ∂r,¬µ ) = œÜr,¬µ .
Proof. By Theorem 7.3 it suffices to equate the Satake transforms of both sides. In other words, we must
prove the following identity:
Z
Z
Œª
b(Œ∂r,¬µ )(t x) dx =
œÜr,¬µ (tŒª x) dx for all Œª ‚àà X‚àó (T ).
N (F )

N (F )

By (7.2), this is equivalent to showing that
Z
Z
Œª
Œ∂r,¬µ (t xr ) dxr =
N (Fr )

œÜr,¬µ (trŒª x) dx
N (F )

(7.4)

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

and that

Z

œÜr,¬µ (tŒª x) dx = 0

if r ‚à§ Œª .

29

(7.5)

N (F )

To do this we use the Lefschetz trace formula4:
X
Tr(Frob ‚ó¶e
œÑ , Fy ) = Tr(Frob ‚ó¶e
œÑ , RŒìc (Y ‚äók k, F )).

(7.6)

y‚ààFix(Frob ‚ó¶œÑ,Y (k))

X

Tr(Frob ‚ó¶Œ∫‚Ä≤ , Fy ) = Tr(Frob ‚ó¶Œ∫‚Ä≤ , RŒìc (Y ‚äók k, F )).

(7.7)

y‚ààFix(Frob ‚ó¶Œ∫‚Ä≤ ,Y (k))
(1)

(r)

Applying (7.6) to Y := SŒª √ó . . . √ó SŒª and F := F¬µ ‚ä† . . . ‚ä† F¬µ and using Lemma 7.4 plus the K√ºnneth
theorem gives
Z
Œ∂r,¬µ (tŒª xr )dxr = q ‚àíœÅ(Œª) Tr(Frob ‚ó¶e
œÑ , RŒìc (SŒª ‚äók k, F¬µ )‚äór ).
N (Fr )

We note that here œÑe acts by cyclically permuting the tensor factors RŒìc (SŒª ‚äók k, F¬µ )‚äór , and Frob acts
factorwise.
(r)
(1)
Applying (7.7) to Y = SŒª and F = F¬µ‚àór = F¬µ ‚àó . . . ‚àó F¬µ and using Lemma 7.4 gives
Z
œÜr,¬µ (tŒª x)dx = q ‚àíœÅ(Œª) Tr(Frob ‚ó¶Œ∫‚Ä≤ , RŒìc (SŒª ‚äók k, F¬µ‚àór )).
(7.8)
N (F )

We first digest the expression (7.8). By Proposition 7.6 we have
RŒìc (SŒª ‚äók k, F¬µ(1) ‚àó . . . ‚àó F¬µ(r) ) ‚àº
=

M

r
O

RŒìc (SŒªi ‚äók k, F¬µ ).

Œª1 +...+Œªr =Œª i=1

Let‚Äôs try to understand the action of Œ∫‚Ä≤ , which is a composition Œ∫‚Ä≤ = Œπ ‚ó¶ Œ∫. The map Œ∫ acts by cyclic
permutation of both the spaces and sheaves, so it induces the permutation
Œ∫‚àó : Hc‚àó (SŒª1 ‚äók k, F¬µ(1) ) ‚äó Hc‚àó (SŒª2 ‚äók k, F¬µ(2) ) ‚äó . . . ‚äó RŒìc (SŒªr ‚äók k, F¬µ(r) )
‚Üí Hc‚àó (SŒªr ‚äók k, F¬µ(r) ) ‚äó Hc‚àó (SŒª1 ‚äók k, F¬µ(1) ) ‚äó . . . ‚äó RŒìc (SŒªr‚àí1 ‚äók k, F¬µ(r‚àí1) ).
Next, the map Œπ relabels the sheaves only, so the conclusion is that Œ∫‚Ä≤ induces
(Œ∫‚Ä≤ )‚àó : Hc‚àó (SŒª1 ‚äók k, F¬µ(1) ) ‚äó Hc‚àó (SŒª2 ‚äók k, F¬µ(2) ) ‚äó . . . ‚äó RŒìc (SŒªr ‚äók k, F¬µ(r) )
‚Üí Hc‚àó (SŒªr ‚äók k, F¬µ(1) ) ‚äó Hc‚àó (SŒª1 ‚äók k, F (2) ) ‚äó . . . ‚äó RŒìc (SŒªr‚àí1 ‚äók k, F¬µ(r) ).
In particular, we emphasize that the composition, at the level of cohomology, effects a permutation of the
spaces. Now, Frobenius preserves each tensor and summand. Therefore, Frob ‚ó¶Œ∫‚Ä≤ acts on the summands of
the form
r‚àí1 O
r
M
Hc‚àó (SŒªi+j (mod r) ‚äók k, F¬µ )
j=0 i=1

by a cyclic permutation followed by a factorwise endomorphism. From this form we see that if Œª1 , . . . , Œªr
are not all equal then Frob ‚ó¶Œ∫‚Ä≤ permutes the summands freely, so Frob ‚ó¶Œ∫‚Ä≤ has trace 0. In particular, if Œª is
not divisible by r then the Œªi cannot be all equal, so that the trace is 0. This establishes (7.5).
On the other hand, our analysis above implies that if Œª = rŒª‚Ä≤ then the contribution to Tr(Frob ‚ó¶Œ∫‚Ä≤ ) all
comes from the terms with all Œª1 = . . . = Œªr = Œª‚Ä≤ , and we have
Frob ‚ó¶Œ∫‚Ä≤ |H ‚àó (SŒª‚Ä≤ ‚äók k,F¬µ )‚äór = Frob ‚ó¶e
œÑ |H ‚àó (SŒª‚Ä≤ ‚äók k,F¬µ )‚äór
c

so that

Z

N (Fr,t )

which establishes (7.4).

c

‚Ä≤

œàr,¬µ (tŒª xr )dxr =

Z

œÜr,¬µ (tŒª x) dx
N (Ft )



Lemma 7.12. We have Œ∂r,¬µ = œàr,¬µ .
4Note that this is applicable because Frob ‚ó¶œÑ is the Frobenius for a twisted form of Y : see the discussion beginning in the
last sentence of [Ngo99] p. 651.

30

TONY FENG

Proof. By Theorem 7.3 it suffices to check equality of the Satake transforms of both sides. Using Lemma
7.4, this amounts to showing
Tr(Frobr , RŒìc (SŒª ‚äók k, F¬µ )) = Tr(Frob ‚ó¶e
œÑ , RŒìc (SŒª ‚äók k, F¬µ )‚äór ).
This follows from the general linear algebra fact asserted in Lemma 7.13 below.



Lemma 7.13 (Saito-Shintani5). Let V be a finite-dimensional representation over a field k. Let œÑ be the
endomorphism of V ‚äór defined by
v1 ‚äó . . . ‚äó vr 7‚Üí vr ‚äó v1 ‚äó . . . ‚äó vr‚àí1 .
Then for all T1 , . . . , Tr ‚àà End(V ), we have
Tr(T1 . . . Tr , V ) = Tr((T1 ‚äó . . . ‚äó Tr )œÑ, V ‚äór ).
Proof. If {ei } is a basis for V , then
(T1 ‚äó . . . ‚äó Tr )œÑ (ei1 ‚äó . . . ‚äó eir ) = T1 (eir ) ‚äó . . . ‚äó Tr (eir‚àí1 ).
We expand out both sides of the desired equality:
X
hei1 ‚äó . . . ‚äó eir , T1 (eir ) ‚äó . . . ‚äó Tr (eir‚àí1 )i
Tr((T1 ‚äó . . . ‚äó Tr )œÑ ) =
i1 ,...,ir

=

X

hei1 , T1 (eir )i . . . heir , Tr (eir‚àí1 )i

i1 ...,ir

and

Tr(T1 . . . Tr ) =

X

hei , T1 ¬∑ ¬∑ ¬∑ Tr ei i.

i

Thus want to show that

X

hei1 , T1 (eir )i . . . heir , Tr (eir‚àí1 )i =

X

hei , T1 ¬∑ ¬∑ ¬∑ Tr ei i.

i

i1 ,...,ir

This follows by repeated iteration of the following more general identity.



Lemma 7.14. Let V be a finite-dimensional vector space with basis {ei }. For any T ‚àà End(V ), we have
X
hx, T ej ihej , yi = hx, T yi.
(7.9)
j

Proof. It suffices to establish the equation for y ranging over a basis of V ; taking y = ei the left hand side
is hx, T ei i, and so is the right hand side.

Combining these results, we obtain the main formula of interest:
Theorem 7.15. We have b(œàr,¬µ ) = œÜr,¬µ .
Proof. This follows immediately upon combining Proposition 7.11 and Lemma 7.12.



7.4. Base change for the centers of parahoric Hecke algebras. We now establish an identity for
central functions of parahoric Hecke algebras analogous to Theorem 7.15. Not surprisingly, this will involve
globalizing to a degeneration from the spherical case.
7.4.1. Setup. We first set some notation. Pick a smooth global curve X/Fq (not necessarily projective) with
a rational point x0 ‚àà X(Fq ). Let G ‚Üí X be a parahoric group scheme, such that G|X‚àíx0 ‚àº
= G √ó X and
G(Ox0 ) = J is a parahoric subgroup. We form the affine Grassmannian
œÄ : GrG ‚Üí X.
Note that for x ‚àà X ‚àí x0 we have

GrG |x ‚àº
= GrG √ók k(x).
For each ¬µ ‚àà X‚àó (T ), we let F¬µ := SatGrG (¬µ) be the (shifted) perverse sheaf on GrG and F¬µ,x0 be the re‚Ä≤
‚àà HG(Fx0 ‚äóFq Fqr ),J
striction to GrG,x0 . (We have normalized our shifts so that F¬µ,x0 is perverse.) We let œàr,¬µ
be the function as in Definition 5.6.
5We Ô¨Årst found this explicitly stated, without proof, in [Ngo06], where it is said to be implicit in the work of Saito and
Shintani on base change.

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

31

7.4.2. Convolution product. By Theorem 5.12, RŒ®(F¬µ ) := RŒ®x0 (F¬µ ) is a central sheaf on GrG,x0 . We
therefore have, as in Definition 7.10, a map
Œ∫‚Ä≤ : RŒ®(F¬µ )(1) ‚àó . . . ‚àó RŒ®(F¬µ )(r)
Œ∫

‚àí
‚Üí RŒ®(F¬µ )(r) ‚àó RŒ®(F¬µ )(1) ‚àó . . . ‚àó RŒ®(F¬µ )(r‚àí1)
Œπ

‚Üí RŒ®(F¬µ )(1) ‚àó . . . ‚àó RŒ®(F¬µ )(r) .
‚àí
Definition 7.16. Let
RŒ®(F¬µ )‚àór := RŒ®(F¬µ )(1) ‚àó . . . ‚àó RŒ®(F¬µ )(r) .
{z
}
|
r times

Define

œÜ‚Ä≤¬µ :

‚Ä≤

‚àór

Fix(Frob ‚ó¶Œ∫ , RŒ®(F¬µ ) ) ‚Üí Q‚Ñì by

œÜ‚Ä≤¬µ (y) = Tr(Frob ‚ó¶Œ∫‚Ä≤ , (RŒ®(F¬µ )‚àór )y ).
‚Ä≤
Theorem 7.17. We have b(œàr,¬µ
) = œÜ‚Ä≤¬µ .

Proof. By Theorem 5.12, œÜ‚Ä≤r,¬µ (y) is in the center of the Iwahori-Hecke algebra. (Since RŒ®(F¬µ ) is central by
Theorem 5.12, œÜ‚Ä≤r,¬µ (y) clearly commutes with all the other functions of the form œÜ‚Ä≤r,ŒΩ (y); then use that such
things form a basis for the Iwahori Hecke algebra as ŒΩ runs over the extended affine Weyl group.)
Now the argument is essentially the same as for Corollary 5.14. Consider the map
‚â§¬µ
pr : Gr‚â§¬µ
G ‚Üí GrG√óX

induced by forgetting the level structure at x0 . Since pr is proper, by Lemma 5.9 and the fact that pr is an
isomorphism away from x0 we have
GrG√óX
G
(SatGrG√óX (¬µ)).
pr! RŒ®Gr
x0 (F¬µ ) = RŒ®x0

By Lemma 5.11 and the fact that GrG√óX ‚Üí X is smooth, we have
G√óX
(SatGrG√óX (¬µ)) ‚àº
RŒ®Gr
= SatGrG√óX (¬µ).
x0

Since pr! corresponds to ‚àí ‚àóJ IK at the level functions, this implies
œÜ‚Ä≤¬µ ‚àóJ IK = œÜ¬µ .
Thus by Theorem 7.15 and (7.1), we have that
‚Ä≤
œÜ‚Ä≤¬µ ‚àóJ IK = œÜ¬µ = b(œàr,¬µ ) = b(œàr,¬µ
) ‚àóJ IK .

(7.10)

‚Ä≤
In view of the Bernstein isomorphism (Theorem 5.5), the fact that œÜ‚Ä≤¬µ and b(œàr,¬µ
) are central plus (7.10)
implies that they are equal.


7.4.3. A global reformulation. We now recast Theorem 7.17 into a form that will be more suitable for our
eventual needs.
Let G and GrG be as in ¬ß7.4.1. We first recall a construction of the convolution product F¬µ ‚àó F¬µ‚Ä≤ .
Recall the iterated global affine Grassmannian GrG,X 2 from ¬ß4.4.1. We can form the twisted tensor product
‚Ä≤
e ¬µ‚Ä≤ := SatGr 2 (¬µ, ¬µ‚Ä≤ ) on GrG,X 2 ([Zhu] ¬ßA), which is supported on the Schubert variety Gr‚â§(¬µ,¬µ ) .
F¬µ ‚ä†F
G,X

G,X

Restricting to the diagonal X ‚äÇ X 2 , we have the multiplication map
‚â§(¬µ,¬µ‚Ä≤ )

m : GrG,X 2

‚Ä≤

|‚àÜ ‚Üí GrG‚â§¬µ+¬µ

defined on points by
œï

Œ≤

Œ≤‚ó¶œï

(x, x, E1 99K E2 99K E 0 ) 7‚Üí (x, E1 99K E 0 ).
Then the convolution product is defined by (cf. [MV07] ¬ß4 or [Zhu] ¬ß5.1)
‚Ä≤

e ¬µ‚Ä≤ ) ‚àà PervL+ G (Gr‚â§¬µ+¬µ ).
F¬µ ‚àó F¬µ‚Ä≤ := Rm! (F¬µ ‚ä†F
G

(7.11)

32

TONY FENG

Let us now write down our particular situation of interest. Consider the diagram
‚â§(¬µ ,...,¬µr )

GrG,X1r

|‚àÜ

‚àÜ(X) ‚äÇ X r

m
‚â§¬µ1 +...+¬µr
GrG,X

X

Then by (7.11) we have
F (¬µ1 ) ‚àó . . . ‚àó F (¬µr ) = Rm! (SatGrG ,X r (¬µ1 , . . . , ¬µr ))
Now Theorem 7.17 can be reformulated as follows, using Corollary 5.9 to commute Rm! and nearby cycles.
Proposition 7.18. Let r.¬µ := (¬µ, . . . , ¬µ) ‚àà X‚àó (T )r+ . Let fŒΩ,x0 ‚àà HG(Fx0 ),J be the function fŒΩ viewed in the
‚Ä≤
‚àà Z(HG(Fx0 ),J ) similarly. Then we have
parahoric Hecke algebra of Fx0 , and define œàr¬µ,x
0
X
‚Ä≤
)=
b(œàr,r¬µ,x
Tr(œÉ ‚ó¶ Œ∫‚Ä≤ , RŒ®X
x0 (Rm! SatGr‚â§r.¬µ ,X r (r.¬µ))ŒΩ )fŒΩ,x0 .
0
G

ŒΩ‚â§r¬µ

8. Comparison of two moduli problems
8.1. Setup. We now let G be the group scheme of units of a global algebra D as in ¬ß4.5 and G a parahoric
group scheme corresponding to some choice of level structure at x0 , so ShtG are the D-shtukas studied in
¬ß4.5.
Let Z ‚äÇ X be the set of places of ramification for D. We assume throughout that #Z ‚â• n2 (||¬µ1 || + . . . +
||¬µr ||), so as to be able to apply Proposition 4.20.
Let X ‚ó¶ := (X ‚àí Z ‚àí {x0 }). We will now define and compare two different moduli stacks of shtukas.
8.2. Situation A. Let
Z r
Sht¬µA := (Sht‚â§¬µ
G,X /a ) .

We have a map
œÄA : Sht¬µA |(X‚àíZ)r ‚Üí (X ‚àí Z)r .
‚ó¶
By Proposition 4.20 the restriction œÄA
:= œÄA |(X ‚ó¶ )r is proper.

Definition 8.1. Let r.¬µ = (¬µ, . . . , ¬µ). We define the following ‚Äúsheaf‚Äù A¬µr ‚àà Dcb ((X ‚ó¶ )r ):
| {z }
r times

‚ó¶
A¬µr := RœÄA‚àó
(SatSht¬µA (r.¬µ)).

We have the following easy but crucial property.
‚ó¶
Proposition 8.2. The complex A¬µr ‚àà is locally constant on (X ‚ó¶ )r , in the sense that each Ri œÄA‚àó
(SatSht¬µA (r.¬µ))
is a local system.
‚ó¶
‚ó¶
Proof. By the properness of œÄA‚àó
we know that Ri œÄA‚àó
(SatSht¬µA (r.¬µ)) is constructible, and the local acyclicity
(Proposition 4.19) then implies that it is locally constant.


Note that by the K√ºnneth formula, we have
¬µ
A¬µr ‚àº
= (A1 )‚ä†r

Choose a basepoint x ‚àà X ‚ó¶ , and let xr ‚àà (X ‚ó¶ )r denote the diagonal point (x, . . . , x). Then the symmetric
group Sr acts on (X ‚ó¶ )r , hence also œÄ1 ((X ‚ó¶ )r , xr ). This lifts to an Sr -equivariant structure on the local
system A¬µr , i.e. an action of œÄ1 ((X ‚ó¶ )r , xr ) ‚ãä Sr on (A¬µr )xr , commuting with the action of the global Hecke
algebra H‚äór .

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

8.3. Situation B. Let

33

Z
Sht¬µB := Sht‚â§r.¬µ
G,X r /a

where r.¬µ = (¬µ, . . . , ¬µ). We have a map
| {z }
r times

œÄB : Sht¬µB |(X‚àíZ)r ‚Üí (X ‚àí Z)r .

‚ó¶
By the assumption that D is totally ramified at sufficiently many places, the map œÄB
:= œÄB |(X ‚ó¶ )r is proper
by Proposition 4.20.

Definition 8.3. We define the sheaf Br¬µ on (X ‚ó¶ )r :
‚ó¶
Br¬µ := RœÄB‚àó
(SatSht¬µB (r.¬µ)).

Proposition 8.4. The complex Br¬µ ‚àà Dcb ((X ‚ó¶ )r ) is locally constant on (X ‚ó¶ )r , in the sense that each
‚ó¶
Ri œÄB‚àó
(SatSht¬µB (r.¬µ)) is a local system.
Proof. The proof is the same as for Proposition 8.2.



Again, we have commuting actions of the Hecke algebra H and œÄ1 ((X ) , x ) ‚ãä Sr on
‚ó¶ r

r

Br¬µ .

8.4. The comparison theorem.
Theorem 8.5 ([Ngo06]). Let œÑ ‚àà Sr be an r-cycle, i.e. hœÑ i ‚àº
= Z/rZ. For g ‚àà œÄ1 ((X ‚ó¶ )r , xr ) and h ‚àà H we
have
Tr((h ‚äó 1 . . . ‚äó 1)gœÑ, (A¬µr )xr ) = Tr(hgœÑ, (Br¬µ )xr ).
Proof. This is [Ngo06] ¬ß3.3 Theorem 1. Since this is really crucial for us, we outline for the sake of exposition
how the proof goes. Keep in mind that A¬µr and Br¬µ are both local systems.
By an application of the Cebotarev density theorem, it suffices to prove the equality for g = Frob(x1 ,...,xr )
for a dense open subset of X r , and in particular on the locus (x1 , . . . , xr ) where the xi are pairwise distinct.
On this locus (and under a certain further restriction on the points (x1 , . . . , xr )) Ng√¥ independently computes
both sides of the equation, and verifies that they are equal by direct comparison.
Let us say a little more about this computation, which is carried out in [Ngo06] ¬ß5. Using the GrothendieckLefschetz trace formula to re-express both sides, there are two main inputs: (1) a count of fixed points, and
(2) a computation of the trace of Frobenius on the stalks of the relevant sheaves. The counting step is
done as in ¬ß6, and the analysis of the stalks enters via results as in ¬ß7.3. The interesting feature is that the
pairwise distinctness of the points (x1 , . . . , xr ), plus the extra restriction that we have omitted, turns out to
imply that the point counting formulas involve no twisted orbital integrals. Thus, no fundamental lemma is
required to prove the desired equality.

Remark 8.6. For a heuristic that underlies the theorem, coming from a conjectural description of the cohomology of shtukas, see [Ngo06] ¬ß2.2, 3.3. The punchline is that after admitting this conjectural description,
the identity in Theorem 8.5 reduces to Lemma 7.13.
Definition 8.7. Let
RŒ®xr0 (A¬µr ) := RœÄA! RŒ®xr0 (SatSht¬µA (r.¬µ)|‚àÜ(X ‚ó¶ ) ) ‚àà Dcb (x0 )
be the cohomology of nearby cycles at xr0 ‚àà ‚àÜ(X ‚àí Z), and let
RŒ®xr0 (Br¬µ ) := RœÄB! RŒ®xr0 (SatSht¬µB (r.¬µ)|‚àÜ(X ‚ó¶ ) ) ‚àà Dcb (x0 )
be the cohomology of nearby cycles at xr0 ‚àà ‚àÜ(X ‚àí Z).6 Again we apply Remark 5.8 to equip RŒ®xr0 (A¬µr )
and RŒ®xr0 (Br¬µ ) with Fq -structures.
Thanks to Proposition 8.2 and Proposition 8.4, the complex RŒ®xr0 (A¬µr ) is equipped with commuting actions of œÄ1 ((X ‚ó¶ )r , xr )‚ãäSr and (H)‚äór , while RŒ®xr0 (Br¬µ ) is equipped with commuting actions of œÄ1 ((X ‚ó¶ )r , xr )‚ãä
Sr and H.
Corollary 8.8. For g ‚àà œÄ1 ((X ‚ó¶ )r , xr ) and h ‚àà H we have
Tr((h ‚äó 1 . . . ‚äó 1) ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (A¬µr )) = Tr(h ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (Br¬µ )).
6This is a small abuse of the notation used in ¬ß5.2.

(8.1)

34

TONY FENG

Proof. This immediate from Theorem 8.5, Proposition 4.21 plus Corollary 5.10, and the Cebotarev density
theorem.

9. Calculation of traces on the cohomology of nearby cycles
Our next step is to combine the work of ¬ß5, ¬ß6 and ¬ß7 to prove Kottwitz-style formulas for both sides of
(8.1). We maintain the notation of those preceding sections.
9.1. Calculating the trace in situation A.
Definition 9.1. For a Kottwitz triple (Œ≥0 , (Œ≥x ), (Œ¥x )) write
c(Œ≥0 , (Œ≥x ), (Œ¥x )) := ker1 (F, GŒ≥0 ) ¬∑ vol(J ¬∑ JŒ≥0 (F )\JŒ≥0 (AF )) ¬∑ dg(K)‚àí1
where the notation is as in ¬ß6.
Theorem 9.2. Let T ‚Ä≤ ‚äÇ |X ‚ó¶ |. Assume that Kv := G(Ov ) is spherical at all v ‚àà T ‚Ä≤ . Let
Œ≤ = (Œ≤v ‚àà Kv \G(Fv )/Kv )v‚ààT ‚Ä≤
and hŒ≤ ‚àà H be the corresponding Hecke operator. Let RŒ®xr0 (A¬µr ) be as in Definition 8.7, let œÑ be as in
Theorem 8.5, let fŒ≤v be as in Definition 5.1, and let œàr,¬µ‚Ä≤ be as in ¬ß7.4.1. Then we have
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr ))
Ô£´
Ô£∂
X
Y
‚Ä≤
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠
OŒ≥v (fŒ≤v )Ô£∏ TOŒ¥x0 œÉ (œàr,¬µ
)
=
v6=x0

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

Proof. We‚Äôll use the Lefschetz trace formula to rewrite the trace in terms of a sum of traces over fixed points.
The effect of œÉœÑ on a point of ShtA is illustrated below:
Ô£±
Ô£º
Ô£±
Ô£º
‚â§¬µ
‚â§¬µ œÉ
œÉ
œÉ2
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
‚àí
‚àí
‚Üí
E
|
E
|
‚àí
‚àí
‚Üí
E
|
E
|
1
X‚àíx
1
X‚àíx
r
X‚àíx
r
X‚àíx
0
0
0
0
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
2
‚â§¬µ
‚â§¬µ
Ô£≤œÉ E |
Ô£Ω
Ô£≤
œÉ
œÉ
‚àí‚Üí E2 |X‚àíx0
E1 |X‚àíx0 ‚àí‚àí‚Üí E1 |X‚àíx0 Ô£Ω
2 X‚àíx0 ‚àí
œÉœÑ
‚àí‚àí‚Üí
.
..
..
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
.
.
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
Ô£¥
‚â§¬µ
‚â§¬µ
Ô£≥œÉ
Ô£æ
Ô£≥œÉ 2
Ô£æ
Er |X‚àíx0 ‚àí‚àí‚Üí Er |X‚àíx0
Er‚àí1 |X‚àíx0 ‚àí‚àí‚Üí œÉ Er‚àí1 |X‚àíx0 .

Therefore, a fixed point of the correspondence (hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ corresponds to a point as above
such that
E2 = œÉ E1
..
.
Er = œÉ Er‚àí1
=Œ≤

E1 ‚àí‚àí‚Üí œÉ Er .
Hence a fixed point is equivalent to the data of commuting modifications
‚â§¬µ

t : œÉ E1 |X‚àíx0 ‚àí‚àí‚Üí E1 |X‚àíx0
t‚Ä≤ :

œÉr

=Œ≤

E1 |X‚àíT ‚Ä≤ ‚àí‚àí‚Üí E1 |X‚àíT ‚Ä≤ .

Hence in the notation of ¬ß6 we see that
Fix((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ ) =

[

C(ŒΩx0 , Œ≤; x0 , T ‚Ä≤ ; r).

ŒΩ‚â§¬µ

By Lemma 5.9 plus Proposition 4.21, we have
RŒ®xr0 (A¬µr ) ‚àº
= RœÄA! (RŒ®xr0 (SatShtA (r.¬µ))).

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

35

Now invoking the Grothendieck-Lefschetz trace formula, we have
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr ))
X
X
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (SatShtA (r.¬µ))Œû ).
=
ŒΩ‚â§¬µ Œû‚ààC(ŒΩx0 ,Œ≤;x0 ,T ‚Ä≤ ;r)

By Corollary 5.22, for all Œû ‚àà C(ŒΩx0 , Œ≤; x0 , T ‚Ä≤ ; r) we have
RŒ®xr0 (SatShtA (r.¬µ))Œû = RŒ®xr0 (SatGrrG (r.¬µ))ŒΩ .
Now using Corollary 6.14, we can rewrite our formula as
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr ))
Y
X
OŒ≥v (fŒ≤v )
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑
=
v6=x0

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

¬∑

X

TOŒ¥x0 œÉ (fŒΩ ) ¬∑ Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (SatGrrG (r.¬µ))ŒΩ ).

(9.1)

ŒΩ‚â§¬µ

Since the Hecke operator hŒ≤ supports a modification at T ‚Ä≤ , which is disjoint from x0 , it acts trivially on all
the stalks lying over xr0 , so we may ignore it when computing the trace in (9.1). Since
RŒ®xr0 (SatGrrG (r.¬µ)) ‚àº
= RŒ®x0 (SatGrG (¬µ))‚ä†r ,

(9.2)

the trace of Frob ‚ó¶œÑ coincides with the trace of Frobenius for the Satake sheaf on the Weil restriction
7
Reskr /k (Gr‚â§¬µ
G ‚äóFq Fqr ). Therefore, by [Ngo06] ¬ß5.2 Proposition 3, we have
Tr(Frob ‚ó¶œÑ, RŒ®xr0 (SatGrrG (r.¬µ))ŒΩ ) = Tr(Frobr , RŒ®xr0 (SatGrG (¬µ))ŒΩ ).

(9.3)

Substituting (9.3) into (9.1) we arrive at
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr ))
Y
X
OŒ≥v (fŒ≤v )
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑
=
(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

¬∑

X

v6=x0

TOŒ¥x0 œÉ (fŒΩ ) ¬∑ Tr(Frobr , RŒ®xr0 (SatGrG (¬µ))ŒΩ ).

(9.4)

ŒΩ‚â§¬µ

By Lemma 5.17 we have the following identity:
X
‚Ä≤
œàr,¬µ
=
Tr(Frobr , RŒ®xr0 (SatGrG (¬µ))ŒΩ )fŒΩ .
ŒΩ‚â§¬µ

Substituting this in (9.4), we finally find
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (A¬µr ))
Ô£´
Ô£∂
X
Y
‚Ä≤
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠
=
OŒ≥v (fŒ≤v )Ô£∏ ¬∑ TOŒ¥x0 œÉ (œàr,¬µ
)
(Œ≥0 ,(Œ≥x ),(Œ¥x0 ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

v6=x0

which is what we wanted to show.



7The proof of this formula, which is not explicitly written in [Ngo06], goes as follows. By (9.2) we have

Tr(Frob ‚ó¶œÑ, RŒ®xr0 (SatGrrG (r.¬µ))ŒΩ ) = Tr(Frob ‚ó¶œÑ, RŒ®x0 (SatGrG (¬µ))‚ä†r
ŒΩ )
= Tr(Frobr , RŒ®x0 (SatGrG (¬µ))ŒΩ ),
where in the last equality we used Lemma 7.13.

36

TONY FENG

9.2. Calculating the trace in situation B. We now want to prove an analogous formula for the trace in
situation B. The computation in this case is a little more involved. The main reason is that the action of Sr
on Bxr0 is difficult to understand explicitly. Recall that is was obtained from the fact that B|U was a local
system, so that we could extend it over X. However, this process obfuscates the geometric meaning of this
action, and we will need to use the results of ¬ß7, particularly the geometric model of base change studied in
¬ß7.4.3, in order to understand it.
Theorem 9.3. Let T ‚Ä≤ ‚äÇ |X ‚ó¶ |. Assume that Kv := G(Ov ) is spherical at all v ‚àà T ‚Ä≤ . Let
Œ≤ = (Œ≤v ‚àà Kv \G(Fv )/Kv )v‚ààT ‚Ä≤
and hŒ≤ ‚àà H be the corresponding Hecke operator. Let RŒ®xr0 (Br¬µ ) be as in Definition 8.7, let œÑ be as in
Theorem 8.5, and let œàr,¬µ‚Ä≤ be as in ¬ß7.4.1. Then we have
Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ ))
=

X

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

Ô£´

c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠

Y

v6=x0

Ô£∂

‚Ä≤
OŒ≥v (fŒ≤v )Ô£∏ ¬∑ OŒ≥x0 (b(œàr,¬µ
)).

Proof. Let X (r) = Symr (X) by the rth symmetric power of X, and
Sht¬µB,X (r) := Sht‚â§r.¬µ
/aZ .
G,X (r)
The idea here is to push down the computation from X r to X (r) , which trivializes the Sr action on the fiber
ShtB,X (r) over a point, transferring the effect of this action completely to the sheaf theory, where it was
studied in ¬ß7. Consider the following commutative diagram, in which the front cartesian square is the fiber
of the back cartesian square over the diagonal copy of X in X (r) .
Sht¬µB
m

Sht¬µB,X (r)

Xr
add

X (r)
(9.5)

‚â§r.¬µ
|‚àÜ
ShtB

‚àÜ(X)

m

add

Z
Sht‚â§r¬µ
G,X /a

œÄ

‚àÜ(X)

The map add : X r ‚Üí X (r) is totally ramified over the diagonal ‚àÜ(X) ‚äÇ X r , so for any √©tale sheaf F on X r
the stalk of F at xr ‚àà X r is canonically identified with the stalk of add‚àó F at add(xr ) ‚àà X (r) . Therefore,
from the front cartesian square we have
Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ )) = Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (RœÄ!‚ó¶ Rm! SatSht¬µB (r.¬µ)))
where œÄ ‚ó¶ is the restriction of œÄ to the fiber over (the diagonal embedding of) X ‚ó¶ . We now proceeding as
before, using the Grothendieck-Lefschetz trace formula to rewrite the trace in terms of a sum of traces over
Z
fixed points. We begin by describing the fixed points of hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ on Sht‚â§r¬µ
G,X /a .
¬µ
Now, on ShtB,X (r) the permutation œÑ evidently acts trivially. A point of ShtG,X /aZ |x0 is a modification
œÉ

‚â§r¬µ

E1 |X‚àíx0 ‚àí‚àí‚àí‚Üí E1 |X‚àíx0

occurring over x0 . The map œÉ takes this to
œÉ2

‚â§r¬µ

E1 |X‚àíx0 ‚àí‚àí‚àí‚Üí œÉ E1 |X‚àíx0 .

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

37

Therefore, a fixed point of the correspondence hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ is equivalent to the data of commuting modifications
‚â§r¬µ

t : œÉ E1 |X‚àíx0 ‚àí‚àí‚àí‚Üí E1 |X‚àíx0
=Œ≤

t‚Ä≤ : œÉ E1 |X‚àíT ‚Ä≤ ‚àí‚àí‚Üí E1 |X‚àíT ‚Ä≤ .
Hence we see that (remember that x0 is assumed to have degree 1)
[
Fix(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ ) =
C(ŒΩx0 , Œ≤; x0 , T ‚Ä≤ ; 1)
ŒΩ‚â§r¬µ

so by the Grothendieck-Lefschetz trace and arguing as in ¬ß9.1 for situation A,
X
Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ )) =
#C(ŒΩx0 , Œ≤; x0 , T ‚Ä≤ ; 1)
ŒΩ‚â§r¬µ

¬∑ Tr(hŒ≤ ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (Rm! SatSht¬µB (r.¬µ))ŒΩ ).

Using Theorem 6.14, we rewrite this as
Tr(hŒ≤ ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ ))
Y
X
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑
OŒ≥v (fŒ≤v )
=
v6=x0

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

¬∑

X

TOŒ¥x0 (fŒΩ ) ¬∑ Tr(hŒ≤ ‚ó¶ Frob ‚ó¶œÑ, RŒ®xr0 (Rm! SatSht¬µB (r.¬µ))ŒΩ ).

(9.6)

ŒΩ‚â§¬µ

As in the previous calculation for situation A, the Hecke operator acts trivially on the stalk at x0 because
is supported on a disjoint set of points. We use the affine Grassmannian as a local model to calculate
Tr(Frobx0 ‚ó¶œÑ, RŒ®xr0 (Rm! SatShtB (r.¬µ))ŒΩ ). By Theorem 5.19, we have
Tr(Frobx0 ‚ó¶œÑ, RŒ®xr0 (Rm! SatSht¬µB (r.¬µ))ŒΩ ) = Tr(Frobx0 ‚ó¶Œ∫‚Ä≤ , RŒ®xr0 (Rm! SatGr‚â§r.¬µr (r.¬µ))ŒΩ ),

(9.7)

G,X

where the notation on the right hand side is as in Corollary 7.18, if we can show that the permutation œÑ on
the left side is carried by Theorem 5.19 to the permutation Œ∫‚Ä≤ studied in ¬ß7.4.3. (The same issue is raised
and explained in [Ngo06] ¬ß5.6 Proposition 3.) To prove it, consider the diagram
f ‚â§r.¬µ
W
Xr
m

f ‚â§r¬µ
W
X (r)

Gr‚â§r.¬µ
G,X r
m

Gr‚â§r¬µ
G,X (r)

√©tale

Sht¬µB
√©tale

m

Sht¬µB,X (r)

Xr
add

X (r)

‚â§r.¬µ
f ‚â§r.¬µ
f ‚â§r¬µ
Here W
expresses Gr‚â§r.¬µ
|‚àÜ and W
expresses Gr‚â§r¬µ
as a local model
Xr
G,X r as a local model for ShtB
X (r)
G,X (r)
¬µ
for ShtB,X (r) . The existence of such a commutive diagram is immediate from the proof of Theorem 5.19.
The claim is then that the permutation actions on RŒ®xr0 (Rm! SatGrG,X r (r.¬µ)) and RŒ®xr0 (Rm! SatShtB (r.¬µ)),
induced by middle extension from (X ‚ó¶ )r to (X ‚àí Z)r , are compatible. This is clear from the diagram and
the fact that the identity can be checked on the locus where the points (x1 , . . . , xr ) are distinct, where it is
evidently given by the same geometric permutation action in both cases.
Now combining Proposition 7.18, Corollary 5.22, and Lemma 5.17, we have
X
‚Ä≤
b(œàr,¬µ
)=
Tr(Frob ‚ó¶Œ∫‚Ä≤ , RŒ®xr0 (Rm! SatGrG (¬µ))ŒΩ )fŒΩ .
(9.8)
ŒΩ‚â§r¬µ

38

TONY FENG

Putting together (9.6), (9.7), and (9.8) gives
Tr((hŒ≤ ‚äó 1 . . . ‚äó 1) ‚ó¶ Frobx0 ‚ó¶œÑ, RŒ®xr0 (Br¬µ ))
X

=

(Œ≥0 ,(Œ≥x ),(Œ¥x0 ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

Ô£´

c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠

Y

v6=x0

Ô£∂

‚Ä≤
OŒ≥v (fŒ≤v )Ô£∏ TOŒ¥x0 (b(œàr,¬µ
))

which is what we wanted to show.



9.3. The base change fundamental lemma for parahoric Hecke algebras. We can now deduce some
cases of the base change fundamental lemma.
Corollary 9.4. Let T ‚Ä≤ ‚äÇ |X ‚ó¶ |. Assume that Kv := G(Ov ) is spherical at all v ‚àà T ‚Ä≤ . Let
Œ≤ = (Œ≤v ‚àà Kv \G(Fv )/Kv )v‚ààT ‚Ä≤
and hŒ≤ ‚àà H be the corresponding Hecke operator. Let œàr,¬µ‚Ä≤ be as in ¬ß7.4.1 and the base change homomorphim
œàr,¬µ‚Ä≤ 7‚Üí b(œàr,¬µ‚Ä≤ ) be as in ¬ß7.1. Then we have
Ô£´
Ô£∂
Y
X
‚Ä≤
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠
OŒ≥0 (fŒ≤v )Ô£∏ ¬∑ TOŒ¥x0 œÉ (œàr,¬µ
)
v6=x0

(Œ≥0 ,(Œ≥x ),(Œ¥x ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

=

X

(Œ≥0 ,(Œ≥x ),(Œ¥x0 ))
inv(Œ≥0 ,(Œ≥x ),(Œ¥x ))=0

Ô£´

c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠

Y

v6=x0

Ô£∂

‚Ä≤
OŒ≥0 (fŒ≤v )Ô£∏ ¬∑ OŒ≥0 (b(œàr,¬µ
))

Proof. This follows immediately from substituting Theorem 9.2 and Theorem 9.3 into Corollary 8.8, and the
following comment about changing the Œ≥v to Œ≥0 : since by definition of X ‚àí Z we have that G(Fx ) ‚àº
= GLn (Fx )
for all x ‚àà X ‚àí Z, the notion of stable conjugacy coincides with the notion of conjugacy.

It seems to be ‚Äúwell-known‚Äù how to deduce a fundamental lemma from a statement such as Corollary 9.4.8
Nevertheless, let us give a proof for completeness, following [Ngo06] ¬ß5.7 Th√©or√®me 1. First we introduce a
piece of notation.
Definition 9.5. For ¬µ = (¬µ1 , . . . , ¬µn ) ‚àà X‚àó (GLn ) ‚àº
= Zn , we define
|¬µ| := ¬µ1 + . . . + ¬µn .
Sht‚â§¬µ
G

is non-empty if and only if |¬µ| = 0, because a G-bundle has the notion of degree on X,
The stack
which is preserved by the Frobenius twist œÉ on S. Let
Z(HG(Fx0 ,r ),J )0 ‚äÇ Z(HG(Fx0 ),J )
‚Ä≤
be the subspace generated by the œàr,¬µ
with |¬µ| = 0, which is the same as the subspace generated by the œàr,¬µ
with |¬µ| = 0.

Theorem 9.6. Let Fx0 be a local field of characteristic p, and Fx0 ,r /Fx0 the unramified extension of degree
r. Let Œ¥ be a œÉ-conjugacy class in GLn (Fx0 ,r ), with norm N Œ¥x0 = Œ≥x0 ‚àà GLn (Fx0 ). Assume Œ≥x0 is regular
semisimple and separable. If œÜ ‚àà Z(HG(Fx0 ,r ),J )0 , then we have
TOŒ¥x0 œÉ (œÜ) = OŒ≥x0 (b(œÜ)).
Proof. Choose a global curve X with function field F , and write Fx0 ‚àº
= Fq ((t)). Choose a division algebra
D as in ¬ß8.1, and define G and G as in ¬ß4.5. We can then apply Corollary 9.4.
For a fixed function h ‚àà HG,K (A) the orbital integrals and twisted orbital integrals are locally constant
near regular semisimple separable elements. Therefore, by weak approximation we can choose e
Œ≥ ‚àà G(F )
8It is remarked on p.84 of the Arxiv version 2 of [Ngo06] that this is ‚Äústandard‚Äù, and a reference is given to [Clo90].

NEARBY CYCLES OF PARAHORIC SHTUKAS, AND A FUNDAMENTAL LEMMA FOR BASE CHANGE

39

close enough to Œ≥t in the t-adic topology so that Œ≥
e = N (Œ¥ex0 ) ‚àà G(Ft ‚äóFq Fqr ) for some Œ¥ex0 ‚àà G(Ft ‚äóFq Fqr ),
and such that
OŒ≥x0 (b(œà¬µ )) = OeŒ≥ (b(œà¬µ ))

TOŒ¥x0 œÉx0 (œà¬µ ) = TOŒ¥ex

0 œÉx0

(œà¬µ ).

We can choose an appropriate Hecke operator h = (hv ) ‚àà HG (A) so that OeŒ≥ (hv ) 6= 0 for v 6= x.
Because a fixed choice of h is the identity at all but finitely many places, any Kottwitz triple for which
the product of orbital integrals is non-zero forces the Œ≥v to be in Kv at all but finitely many v. Then by
[Kot86b] Proposition 7.1 there are only finitely many possibilities for the Kottwitz triple, as all Œ≥v outside a
fixed finite set must be (rationally) conjugate to Œ≥. (Technically this discussion is unnecessary here because
we are only dealing with GLn at this point.) Therefore, since the support of any adelic Hecke operator is
compact open in G(A), while G(F ) is discrete, for any fixed h ‚àà HG,K (A) there are only finitely many
non-zero summands in Corollary 9.4.
Again by the discreteness of G(F ) in G(A), we may shrink the support of the chosen Hecke operator
appropriately so that all the terms
Ô£´
Ô£∂
Ô£´
Ô£∂
Y
Y
‚Ä≤
‚Ä≤
Ô£≠
OŒ≥0 (hv )Ô£∏ ¬∑ TOŒ¥x0 œÉ (œàr,¬µ
) and Ô£≠
OŒ≥0 (hv )Ô£∏ ¬∑ OŒ≥0 (b(œàr,¬µ
))
v6=x0

v6=x0

vanish except for the chosen Œ≥x0 . Then we have
Ô£´
Ô£∂
Y
‚Ä≤
c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠
OŒ≥0 (hv )Ô£∏ ¬∑ TOŒ¥x0 œÉ (œàr,¬µ
)
v6=x0

Ô£´

= c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑ Ô£≠

Y

v6=x0

Ô£∂

‚Ä≤
OŒ≥0 (hv )Ô£∏ ¬∑ OŒ≥0 (b(œàr,¬µ
))

is non-empty
Since |¬µ| = 0, Sht‚â§¬µ
G
 are not 0. Dividing out by the common (necessarily
Q so these terms
‚Ä≤
non-zero) factor c(Œ≥0 , (Œ≥x ), (Œ¥x )) ¬∑
v6=x0 OŒ≥0 (hv ) then yields the desired equality for all œàr,¬µ with |¬µ| = 0.
We conclude by observing that these span Z(HG(Fx0 ,r ),J )0 .

References
[Bro13]
[Clo90]
[Del73]

Michael Broshi, G-torsors over a Dedekind scheme, J. Pure Appl. Algebra 217 (2013), no. 1, 11‚Äì19. MR 2965898
Laurent Clozel, The fundamental lemma for stable base change, Duke Math. J. 61 (1990), no. 1, 255‚Äì302. MR 1068388
P. Deligne, S√©minaire de g√©om√©trie alg√©brique du Bois Marie: Groupes de Monodromie en G√©ometrie Alg√©brique
(SGA 7 II)., Lecture Notes in Mathematics, vol. 569, Springer-Verlag, 1973.
[Dri87] V. G. Drinfel‚Äôd, Cohomology of compactified moduli varieties of F -sheaves of rank 2, Zap. Nauchn. Sem. Leningrad.
Otdel. Mat. Inst. Steklov. (LOMI) 162 (1987), no. Avtomorfn. Funkts. i Teor. Chisel. III, 107‚Äì158, 189. MR 918745
[Gai01] D. Gaitsgory, Construction of central elements in the affine Hecke algebra via nearby cycles, Invent. Math. 144
(2001), no. 2, 253‚Äì280. MR 1826370
[Gro98] Benedict H. Gross, On the Satake isomorphism, Galois representations in arithmetic algebraic geometry (Durham,
1996), London Math. Soc. Lecture Note Ser., vol. 254, Cambridge Univ. Press, Cambridge, 1998, pp. 223‚Äì237.
MR 1696481
[Hai09] Thomas J. Haines, The base change fundamental lemma for central elements in parahoric Hecke algebras, Duke Math.
J. 149 (2009), no. 3, 569‚Äì643. MR 2553880
[HRa]
Thomas Haines and Timo Richarz, The test function conjecture for parahoric local models, Preprint available at
https://arxiv.org/pdf/1801.07094.pdf.
[HRb]
Urs Hartl and Esmail Arasteh Rad, Langlands-rapoport conjecture over function fields, Preprint available at
https://arxiv.org/pdf/1605.01575.pdf.
[Kot80] Robert Edward Kottwitz, Orbital integrals on GL3 , Amer. J. Math. 102 (1980), no. 2, 327‚Äì384. MR 564478
[Kot86a] Robert E. Kottwitz, Base change for unit elements of Hecke algebras, Compositio Math. 60 (1986), no. 2, 237‚Äì250.
MR 868140
, Stable trace formula: elliptic singular terms, Math. Ann. 275 (1986), no. 3, 365‚Äì399. MR 858284
[Kot86b]
, Shimura varieties and Œª-adic representations, Automorphic forms, Shimura varieties, and L-functions, Vol.
[Kot90]
I (Ann Arbor, MI, 1988), Perspect. Math., vol. 10, Academic Press, Boston, MA, 1990, pp. 161‚Äì209. MR 1044820
, Points on some Shimura varieties over finite fields, J. Amer. Math. Soc. 5 (1992), no. 2, 373‚Äì444. MR 1124982
[Kot92]

40

[KP]

TONY FENG

Mark Kisin and Georgios Pappas, Integral models of Shimura varieties with parahoric level structure, Preprint available at https://arxiv.org/pdf/1512.01149.pdf .
[KW01] Reinhardt Kiehl and Rainer Weissauer, Weil conjectures, perverse sheaves and l‚Äôadic Fourier transform, Ergebnisse
der Mathematik und ihrer Grenzgebiete. 3. Folge. A Series of Modern Surveys in Mathematics [Results in Mathematics
and Related Areas. 3rd Series. A Series of Modern Surveys in Mathematics], vol. 42, Springer-Verlag, Berlin, 2001.
MR 1855066
[Lab90] J.-P. Labesse, Fonctions √©l√©mentaires et lemme fondamental pour le changement de base stable, Duke Math. J. 61
(1990), no. 2, 519‚Äì530. MR 1074306
[Laf97] Laurent LaÔ¨Äorgue, Chtoucas de Drinfeld et conjecture de Ramanujan-Petersson, Ast√©risque (1997), no. 243, ii+329.
MR 1600006
, Chtoucas de Drinfeld et correspondance de Langlands, Invent. Math. 147 (2002), no. 1, 1‚Äì241. MR 1875184
[Laf02]
[Laf12] Vincent LaÔ¨Äorgue, Chtoucas pour les groupes r√©ductifs et param√©trisation de Langlands globale, preprint,
https://arxiv.org/pdf/1209.5352.pdf (2012).
[Lau04] Eike S√∂ren Lau, On generalised D-shtukas, Bonner Mathematische Schriften [Bonn Mathematical Publications], vol.
369, Universit√§t Bonn, Mathematisches Institut, Bonn, 2004, Dissertation, Rheinische Friedrich-Wilhelms-Universit√§t
Bonn, Bonn, 2004. MR 2206061
[MV07] I. Mirkoviƒá and K. Vilonen, Geometric Langlands duality and representations of algebraic groups over commutative
rings, Ann. of Math. (2) 166 (2007), no. 1, 95‚Äì143. MR 2342692
[ND13] Tuan Ngo Dac, Comptage des G-chtoucas: la partie elliptique, Compos. Math. 149 (2013), no. 12, 2169‚Äì2183.
MR 3143709
[ND15]
, On a counting problem for G-shtukas, Arithmetic and geometry, London Math. Soc. Lecture Note Ser., vol.
420, Cambridge Univ. Press, Cambridge, 2015, pp. 318‚Äì350. MR 3467129
[Ngo99] Bao Ch√¢u Ngo, Faisceaux pervers, homomorphisme de changement de base et lemme fondamental de Jacquet et Ye,
Ann. Sci. √âcole Norm. Sup. (4) 32 (1999), no. 5, 619‚Äì679. MR 1710755
, D-chtoucas de Drinfeld √† modifications sym√©triques et identit√© de changement de base, Ann. Sci. √âcole Norm.
[Ngo06]
Sup. (4) 39 (2006), no. 2, 197‚Äì243. MR 2245532
[NND08] Bao Ch√¢u Ng√¥ and Tu√¢n Ng√¥ Dac, Comptage de G-chtoucas: la partie r√©guli√®re elliptique, J. Inst. Math. Jussieu 7
(2008), no. 1, 181‚Äì203. MR 2398149
[PR10] Georgios Pappas and Michael Rapoport, Some questions about G-bundles on curves, Algebraic and arithmetic structures of moduli spaces (Sapporo 2007), Adv. Stud. Pure Math., vol. 58, Math. Soc. Japan, Tokyo, 2010, pp. 159‚Äì171.
MR 2676160
[PZ13]
G. Pappas and X. Zhu, Local models of Shimura varieties and a conjecture of Kottwitz, Invent. Math. 194 (2013),
no. 1, 147‚Äì254. MR 3103258
[RD]
Walter Randolph Ray-Dulany, Base change for the iwahori-hecke algebra of gl2 , Ph.D. thesis. Available at
https://drum.lib.umd.edu/bitstream/handle/1903/10963/RayDulany_umd_0117E_11632.pdf?sequence=1&isAllowed=y .
[Ric16] Timo Richarz, Affine Grassmannians and geometric Satake equivalences, Int. Math. Res. Not. IMRN (2016), no. 12,
3717‚Äì3767. MR 3544618
[Var04] Yakov Varshavsky, Moduli spaces of principal F -bundles, Selecta Math. (N.S.) 10 (2004), no. 1, 131‚Äì166. MR 2061225
[Zhu]
Xinwen Zhu, An introduction to affine Grassmannians and the geometric Satake equivalence, To appear in Proceedings
of the IAS/Park City Mathematics Series. Preprint available at https://arxiv.org/pdf/1603.05593.pdf .
, On the coherence conjecture of Pappas and Rapoport, Ann. of Math. (2) 180 (2014), no. 1, 1‚Äì85. MR 3194811
[Zhu14]

