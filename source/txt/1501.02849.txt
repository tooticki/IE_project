The typical structure of maximal triangle-free graphs
József Balogh

∗

Hong Liu

†

Šárka Petřı́čková

‡

Maryam Sharifzadeh

§

arXiv:1501.02849v1 [math.CO] 12 Jan 2015

September 3, 2018

Abstract
Recently, settling a question of Erdős, Balogh and Petřı́čková showed that there
2
2
are at most 2n /8+o(n ) n-vertex maximal triangle-free graphs, matching the previously
known lower bound. Here we characterize the typical structure of maximal trianglefree graphs. We show that almost every maximal triangle-free graph G admits a vertex
partition X ∪ Y such that G[X] is a perfect matching and Y is an independent set.
Our proof uses the Ruzsa-Szemerédi removal lemma, the Erdős-Simonovits stability
theorem, and recent results of Balogh-Morris-Samotij and Saxton-Thomason on characterization of the structure of independent sets in hypergraphs. The proof also relies
on a new bound on the number of maximal independent sets in triangle-free graphs
with many vertex-disjoint P3 ’s, which is of independent interest.

1

Introduction

Given a family of combinatorial objects with certain properties, a fundamental problem
in extremal combinatorics is to describe the typical structure of these objects. This was
initiated in a seminal work of Erdős, Kleitman, and Rothschild [13] in 1976. They proved
that almost all triangle-free graphs on n vertices are bipartite, that is, the proportion of nvertex triangle-free graphs that are not bipartite goes to zero as n → ∞. Since then, various
extensions of this theorem have been established. The typical structure of H-free graphs
has been studied when H is a large clique [3, 19], H is a fixed color-critical subgraph [23],
H is a finite family of subgraphs [2], and H is an induced subgraph [4]. For sparse H-free
∗

Department of Mathematical Sciences, University of Illinois at Urbana-Champaign, Urbana, Illinois
61801, USA jobal@math.uiuc.edu. Research is partially supported by Simons Fellowship, NSF CAREER
Grant DMS-0745185, Marie Curie FP7-PEOPLE-2012-IIF 327763 and Arnold O. Beckmann Research Award
RB15006.
†
Department of Mathematical Sciences, University of Illinois at Urbana-Champaign, Urbana, Illinois
61801, USA hliu36@illinois.edu.
‡
Department of Mathematical Sciences, University of Illinois at Urbana-Champaign, Urbana, Illinois
61801, USA petrckv2@illinois.edu.
§
Department of Mathematical Sciences, University of Illinois at Urbana-Champaign, Urbana, Illinois
61801, USA sharifz2@illinois.edu.

1

x1

y
X1

x2

X

Y
Add 1 edge

Add 1
edge
for
every
pair
(x1 x2 , y)

Add 3 edges
X2

Y

(a) r = 2

(b) r = 3

Figure 1: Lower bound contruction for maximal Kr+1 -free graphs.
graphs, analogous problems were examined in [9, 21]. In the context of other combinatorial
objects, the typical structure of hypergraphs with a fixed forbidden subgraph is investigated
for example in [10, 22]; the typical structure of intersecting families of discrete structures is
studied in [6]; see also [1] for a description of the typical sum-free set in finite abelian groups.
In contrast to the family of all n-vertex triangle-free graphs, which has been well-studied,
very little was known about the subfamily consisting of all those that are maximal (under
graph inclusion) triangle-free. Note that the size of the family of triangle-free graphs on
2
[n] is at least 2n /4 (all subgraphs of a complete balanced bipartite graph), and at most
2
2
2n /4+o(n ) by the result of Erdős, Kleitman, and Rothschild from 1976. Until recently, it
was not even known if the subfamily of maximal triangle-free graphs is significantly smaller.
As a first step, Erdős suggested the following problem (as stated in [26]): determine or
estimate the number of maximal triangle-free graphs on n vertices. The following folklore
2
construction shows that there are at least 2n /8 maximal triangle-free graphs on the vertex
set [n] := {1, . . . , n}.

Lower bound construction. Assume that n is a multiple of 4. Start with a graph on a
vertex set X ∪ Y with |X| = |Y | = n/2 such that X induces a perfect matching and Y is an
independent set (see Figure 1a). For each pair of a matching edge x1 x2 in X and a vertex
y ∈ Y , add exactly one of the edges x1 y or x2 y. Since there are n/4 matching edges in X and
2
n/2 vertices in Y , we obtain 2n /8 triangle-free graphs. These graphs may not be maximal
2
triangle-free, but since no further edges can be added between X and Y , all of these 2n /8
graphs extend to distinct maximal ones.
Balogh and Petřı́čková [11] recently proved a matching upper bound, that the number of
2
2
maximal triangle-free graphs on vertex set [n] is at most 2n /8+o(n ) . Now that the counting
problem is resolved, one would naturally ask how do most of the maximal triangle-free graphs
look, i.e. what is their typical structure. Our main result provides an answer to this question.
Theorem 1.1. For almost every maximal triangle-free graph G on [n], there is a vertex
partition X ∪ Y such that G[X] is a perfect matching and Y is an independent set.
It is worth mentioning that once a maximal triangle-free graph has the above partition
2

X ∪ Y , then there has to be exactly one edge between every matching edge of X and every
vertex of Y . Thus Theorem 1.1 implies that almost all maximal triangle-free graphs have
the same structure as the graphs in the lower bound construction above. Furthermore, our
proof yields that the number of maximal triangle-free graphs without the desired structure is
exponentially smaller than the number of maximal triangle-free graphs: Let M3 (n) denote
the set of all maximal triangle-free graphs on [n], and G(n) denote the family of graphs from
M3 (n) that admit a vertex partition such that one part induces a perfect matching and the
other is an independent set. Then there exists an absolute constant c > 0 such that for n
sufficiently large, |M3 (n) − G(n)| ≤ 2−cn |M3 (n)|.

It would be interesting to have similar results for Mr (n), the number of maximal Kr -free
2
2
graphs on [n]. Alon pointed out that if the number of maximal Kr -free graphs is 2cr n +o(n ) ,
then cr is monotone increasing in r, though not necessarily strictly monotone. For the
lower bound, a discussion with Alon and Luczak led to the following construction that gives
2
2(1−1/r+o(1))n /4 maximal Kr+1 -free graphs: Assume that n is a multiple of 2r. Partition
the vertex set [n] into r equal classes X1 , . . . , Xr−1 , Y , and place a perfect matching into
each of X1 , . . . , Xr−1 (see Figure 1b). Between the classes we have the following connection
rule: between the vertices of two matching edges from different classes Xi and Xj place
exactly three edges, and between a vertex in Y and a matching edge in Xi put exactly one
2
edge. For the upper bound, by Erdős, Frankl and Rödl [12], Mr+1 (n) ≤ 2(1−1/r+o(1))n /2 . A
slightly improved bound is given in [11]: For every r there is ε(r) > 0 such that |Mr+1 (n)| ≤
2
2(1−1/r−ε(r))n /2 for n sufficiently large. We suspect that the lower bound is the “correct
2
value”, i.e. that |Mr+1 (n)| = 2(1−1/r+o(1))n /4 .
Related problem. There is a surprising connection between the family of maximal trianglefree graphs and the family of maximal sum-free sets in [n]. More recently, Balogh, Liu,
Sharifzadeh and Treglown [7] proved that the number of maximal sum-free sets in [n] is
2(1+o(1))n/4 , settling a conjecture of Cameron and Erdős. Although neither of the results
imply one another, the methods in both of the papers fall in the same general framework,
in which a rough structure of the family is obtained first using appropriate container lemma
and removal lemma. These are Theorems 2.1 and 2.2 in this paper, and a group removal
lemma of Green [16] and a granular theorem of Green and Ruzsa [17] in the sum-free case.
Both problems can then be translated into bounding the number of maximal independent
sets in some auxiliary link graphs. In particular, one of the tools here (Lemma 2.4) is also
utilized in [8] to give an asymptotic of the number of maximal sum-free sets in [n].
Organization. We first introduce all the tools in Section 2, then we prove Lemma 3.1,
the asymptotic version of Theorem 1.1, in Section 3. Using this asymptotic result we prove
Theorem 1.1 in Section 4.
Notation. For a graph G, denote by |G| the number of vertices in G. An n-vertex graph G
is t-close to bipartite if G can be made bipartite by removing at most t edges. Denote by Pk
the path on k vertices. Write MIS(G) for the number of maximal independent sets in G. The
Cartesian product GH of graphs G and H is a graph with vertex set V (G) × V (H) such
that two vertices (u, u0 ) and (v, v 0 ) are adjacent if and only if either u = v and u0 v 0 ∈ E(H),
3

or u0 = v 0 and uv ∈ E(G). For a fixed graph G, let N (v) be the set of neighbors of a vertex
v in G, and let d(v) := |NG (v)| and Γ(v) := N (v) ∪ {v}. For v ∈ V (G) and X ⊆ V (G),
denote by NX (v) the set of all neighbors of v in X (i.e. NX (v) = N (v) ∩ X), and let
dX (v) := |NX (v)|. Denote by ∆(X) the maximum degree of the induced subgraph G[X].
Given a vertex partition V = X1 ∪X2 , edges with one endpoint in X1 and the other endpoint
in X2 are [X1 , X2 ]-edges. A vertex cut V = X ∪ Y is a max-cut if the number of [X, Y ]-edges
is not smaller than the size of any other cut. The inner neighbors of a vertex v are its
neighbors in the same partite set as v (i.e. NXi (v) if v ∈ Xi ). The inner degree of a vertex is
the number of its inner neighbors. We say that a family F of maximal triangle-free graphs
is negligible if there exists an absolute constant C > 0 such that |F| < 2−Cn |M3 (n)|.

2

Tools

Our first tool is a corollary of recent powerful counting theorems of Balogh-Morris-Samotij [5,
Theorem 2.2.], and Saxton-Thomason [25].
Theorem 2.1. For all δ > 0 there is c = c(δ) > 0 such that there is a family F of at
3/2
most 2c·log n·n graphs on [n], each containing at most δn3 triangles, such that for every
triangle-free graph G on [n] there is an F ∈ F such that G ⊆ F , where n is sufficiently large.
The graphs in F in the above theorem will be referred to as containers. A weaker version of
Theorem 2.1, which can be concluded from the Szemerédi Regularity Lemma, could be used
instead of Theorem 2.1 here. The only difference is that the upper bound on the size of F
2
is 2o(n ) .
We need two well-known results. The first is the Ruzsa-Szemerédi triangle-removal
lemma [24] and the second is the Erdős-Simonovits stability theorem [14]:
Theorem 2.2. For every ε > 0 there exists δ = δ(ε) > 0 and n0 (ε) > 0 such that any graph
G on n > n0 (ε) vertices with at most δn3 triangles can be made triangle-free by removing at
most εn2 edges.
Theorem 2.3. For every ε > 0 there exists δ = δ(ε) > 0 and n0 (ε) > 0 such that every
2
triangle-free graph G on n > n0 (ε) vertices with at least n4 − δn2 edges can be made bipartite
by removing at most εn2 edges.
We also need the following lemma, which is an extension of results of Moon-Moser [20]
and Hujter-Tuza [18].
Lemma 2.4. Let G be an n-vertex triangle-free graph. If G contains at least k vertex-disjoint
P3 ’s, then
n

k

MIS(G) ≤ 2 2 − 25 .

4

(1)

Proof. The proof is by induction on n. The base case of the induction is n = 1 with k = 0,
1
0
for which MIS(G) = 1 ≤ 2 2 − 25 .
For the inductive step, let G be a triangle-free graph on n ≥ 2 vertices with k vertexdisjoint P3 ’s, and let v be any vertex in G. Observe that MIS(G − Γ(v)) is the number
of maximal independent sets containing v, and that MIS(G − {v}) bounds from above the
number of maximal independent sets not containing v. Therefore,
MIS(G) ≤ MIS(G − {v}) + MIS(G − Γ(v)).
If G has k vertex-disjoint P3 ’s, then G − Γ(v) has at least k − d(v) vertex-disjoint P3 ’s, and
so, by the induction hypothesis,
 1 1

n−(d(v)+1)
k−d(v)
d(v)+1
d(v)
k−1
n−1
n
k
− 25
2
≤ 2 2 − 25 2− 2 + 25 + 2− 2 + 25 .
MIS(G) ≤ 2 2 − 25 + 2
1

1

x+1

x

The function f (x) = 2− 2 + 25 + 2− 2 + 25 is a decreasing function with f (3) ≈ 0.9987 < 1. So,
n
k
if there exists a vertex of degree at least 3 in G, then we have MIS(G) ≤ 2 2 − 25 as desired.
It remains to verify (1) for graphs with ∆(G) ≤ 2. Observe that we can assume that
G is connected. Indeed, if G1 , . . . , Gl are maximal components of G, and each of Gi has ni
vertices and ki vertex-disjoint P3 ’s, then
Y
Y ni ki
P ni P ki
n
k
MIS(G) =
MIS(Gi ) ≤
2 2 − 25 = 2 i 2 − i 25 = 2 2 − 25 .
i

i

Every connected graph with ∆(G) ≤ 2 and n ≥ 2 vertices is either a path or a cycle.
2
0
3
1
Suppose first that G is a path Pn . We have MIS(P2 ) = 2 ≤ 2 2 − 25 , MIS(P3 ) = 2 ≤ 2 2 − 25 .
By Füredi [15, Example 1.1], MIS(Pn ) = MIS(Pn−2 ) + MIS(Pn−3 ) for all n ≥ 4. By the
induction hypothesis thus


n−3
k−1
k−1
n−2
n
n
k
1
3
1
k
MIS(Pn ) ≤ 2 2 − 25 + 2 2 − 25 ≤ 2 2 − 25 2−1+ 25 + 2− 2 + 25 ≤ 2 2 − 25 .
Let now G be a cycle Cn . We have MIS(C4 ) = 2 ≤ 24/2−1/25 and MIS(C5 ) = 5 ≤ 25/2−1/25 .
By Füredi [15, Example 1.2], MIS(Cn ) = MIS(Cn−2 ) + MIS(Cn−3 ) for all n ≥ 6. Therefore,
by the induction hypothesis,
MIS(Cn ) ≤ 2

n−2
− k−1
2
25

+2

n−3
− k−1
2
25

n

k

≤ 2 2 − 25 .

Remark 2.5. A disjoint union of C5 ’s and a matching shows that the constant c for which
n
k
MIS(G) ≤ 2 2 − c in Lemma 2.4 cannot be smaller than 5.6.

3

Asymptotic result

In this section we prove an asymptotic version of Theorem 1.1:
5

Lemma 3.1. Fix any γ > 0. Almost every maximal triangle-free graph G on the vertex set
[n] satisfies the following: for any max-cut V (G) = X ∪ Y , there exist X 0 ⊆ X and Y 0 ⊆ Y
such that
(i) |X 0 | ≤ γn and G[X − X 0 ] is an induced perfect matching, and
(ii) |Y 0 | ≤ γn and Y − Y 0 is an independent set.
The outline of the proof is as follows. We observe that every maximal triangle-free graph
G on [n] can be built in the following three steps.
(S1) Choose a max-cut X ∪ Y for G.
(S2) Choose triangle-free graphs S and T on the vertex sets X and Y , respectively.
(S3) Extend S ∪ T to a maximal triangle-free graph by adding edges between X and Y .
We give an upper bound on the number of choices for each step. First, there are at most
2n ways to fix a max-cut X ∪ Y in (S1). For (S2), we show (Lemma 3.5) that almost
all maximal triangle-free graphs on [n] are o(n2 )-close to bipartite, which implies that the
2
number of choices for most of these graphs in (S2) is at most 2o(n ) . For fixed X, Y, S, T , we
bound, using Claim 3.4, the number of choices in (S3) by the number of maximal independent
sets in some auxiliary link graph L. This enables us to use Lemma 2.4 to force the desired
structure on S and T .
Definition 3.2 (Link graph). Given edge-disjoint graphs A and S on [n], define the link
graph L := LS [A] of S on A as follows:
V (L) := E(A)

and

E(L) := {a1 a2 : ∃s ∈ E(S) such that {a1 , a2 , s} forms a triangle}.

Claim 3.3. If A and S are triangle-free, then LS [A] is triangle-free.
Proof. Indeed, otherwise there exist a1 , a2 , a3 ∈ E(A) and s1 , s2 , s3 ∈ E(S) such that the 3sets {a1 , a2 , s1 }, {a2 , a3 , s2 }, and {a1 , a3 , s3 } span triangles. Since A is triangle-free, the edges
a1 , a2 , a3 share a common endpoint, and {s1 , s2 , s3 } spans a triangle. This is a contradiction
since S is triangle-free.
Claim 3.4. Let S and A be two edge-disjoint triangle-free graphs on [n] such that there is no
triangle {a, s1 , s2 } in S ∪ A with a ∈ E(A) and s1 , s2 ∈ E(S). Then the number of maximal
triangle-free subgraphs of S ∪ A containing S is at most MIS(LS [A]).
Proof. Let G be a maximal triangle-free subgraph of S ∪ A that contains S. We show that
E(G) ∩ E(A) spans a maximal independent set in L := LS [A]. Clearly, E(G) ∩ E(A) spans
an independent set in L because otherwise there would be a triangle in G. Suppose that
E(G) ∩ E(A) is not a maximal independent set in L. Then there is a1 ∈ E(A) − E(G)
such that, for any two edges a2 ∈ E(A) ∩ E(G) and s ∈ E(S), {a1 , a2 , s} does not form
a triangle. By our assumption, there is no triangle {a1 , a2 , a3 } with a2 , a3 ∈ E(A) and no
triangle {a1 , s1 , s2 } with s1 , s2 ∈ E(S). Therefore, G ∪ {a1 } is triangle-free, contradicting
the maximality of G.
6

We fix the following parameters that will be used throughout the rest of the paper. Let
γ, β, ε, ε0 > 0 be sufficiently small constants satisfying the following hierachy:
ε0  δ2.3 (ε)  ε  β  δ2.3 (γ 3 )  γ  1,

(2)

where δ2.3 (x) > 0 is the constant returned from Theorem 2.3 with input x. The notation
x  y above means that x is a sufficiently small function of y to satisfy some inequalities
in the proof. In the following proof, δ2.2 (x) is the constant returned from Theorem 2.2 with
input x, and in the rest of the paper, we shall always assume that n is sufficiently large, even
when this is not explicitly stated.
Lemma 3.5. Almost all maximal triangle-free graphs on [n] are 2εn2 -close to bipartite.
Proof. Let F be the family of graphs obtained from Theorem 2.1 using δ2.2 (ε0 ). Then every
triangle-free graph on [n] is a subgraph of some container F ∈ F.
We first show that the family of maximal triangle-free graphs in small containers is
negligible. Consider a container F ∈ F with e(F ) ≤ n2 /4 − 6ε0 n2 . Since F contains at
most δ2.2 (ε0 )n3 triangles, by Theorem 2.2, we can find A and B, subgraphs of F , such that
F = A ∪ B, where A is triangle-free, and e(B) ≤ ε0 n2 . For each F ∈ F, fix such a pair
(A, B). Then every maximal triangle-free graph in F can be built in two steps:
(i) Choose a triangle-free S ⊆ B;
(ii) Extend S in A to a maximal triangle-free graph.
0 2

The number of choices in (i) is at most 2e(B) ≤ 2ε n . Let L := LS [A] be the link graph of
S on A. By Claim 3.3, L is triangle-free. Claim 3.4 implies that the number of maximal
triangle-free graphs in S ∪ A containing S (i.e. the number of extensions in (ii)) is at most
MIS(L). Thus, by Lemma 2.4,
2 /8−3ε0 n2

MIS(L) ≤ 2|A|/2 ≤ 2n

.

Therefore, the number of maximal triangle-free graphs in small containers is at most
0 2

|F| · 2ε n · 2n

2 /8−3ε0 n2

2 /8−ε0 n2

≤ 2n

.

From now on, we may consider only maximal triangle-free graphs contained in containers
of size at least n2 /4 − 6ε0 n2 . Let F be any large container. Recall that by Theorem 2.2,
F = A ∪ B, where A is triangle-free with e(A) ≥ n2 /4 − 7ε0 n2 and e(B) ≤ ε0 n2 . Since
ε0  δ2.3 (ε), by Theorem 2.3, A can be made bipartite by removing at most εn2 edges. Since
ε0  ε, F can be made bipartite by removing at most (ε0 + ε)n2 ≤ 2εn2 edges. Therefore,
every maximal triangle-free graphs contained in F is 2εn2 -close to bipartite.
Fix X, Y, S, T as in steps (S1) and (S2). Let A be the complete bipartite graph with
parts X and Y . By Claim 3.4, the number of ways to extend S ∪ T in (S3) is at most
MIS(LS∪T [A]). The number of ways to fix X and Y is at most 2n , and by Lemma 3.5, the

n2
number of ways to fix S and T is at most 2εn
2 . It follows that if MIS(LS∪T [A]) is smaller
2
2
than 2n /8−cn for some c  ε, then the family of maximal triangle-free graphs with such
(X, Y, S, T ) is negligible.
7

Claim 3.6. LS∪T [A] = ST .
Proof. Note that V (LS∪T [A]) = E(A) = {(x, y) : x ∈ X, y ∈ Y } = V (ST ). Using the
definition of the Cartesian product, (x, y) and (x0 , y 0 ) are adjacent in ST if and only if
x = x0 and {y, y 0 } ∈ E(T ), or y = y 0 and {x, x0 } ∈ E(S), i.e. if and only if {x = x0 , y, y 0 }
or {x, x0 , y = y 0 } form a triangle in S ∪ A. But by the definition of LS∪T [A], this is exactly
when (x, y) and (x0 , y 0 ) are adjacent in LS∪T [A].
Claim 3.6 allows us to rule out certain structures of S and T since, by Lemma 2.4, if
ST has many vertex disjoint P3 ’s then the number of maximal-triangle free graphs with
2
S = G[X] and T = G[Y ] is much smaller than 2n /8 .
Claim 3.7. For almost all maximal triangle-free n-vertex graphs G with a max-cut X ∪ Y ,
(i) |X|, |Y | ≥ n/2 − βn, and
(ii) ∆(X), ∆(Y ) ≤ βn.
Proof. Let G be a maximal triangle-free graph with a max-cut X ∪Y . By Lemma 3.5, almost
all maximal triangle-free graphs are 2εn2 -close to bipartite, which implies that the number
n2
of choices for G[X] and G[Y ] is at most 2εn
2 . Denote by A the complete bipartite graph
with partite sets X and Y .
For (i), suppose that |X| ≤ n/2 − βn. Then |X||Y | ≤ n2 /4 − β 2 n2 , and for any fixed S
2
2 2
on X and T on Y , Lemma 2.4 implies MIS(LS∪T [A]) ≤ 2n /8−β n /2 . Since β  ε, it follows
from the discussion before Claim 3.6 that the family of maximal triangle-free graphs with
such max-cut X ∪ Y is negligible.
For (ii), suppose that G has a vertex x ∈ X of inner degree at least βn. Since X ∪ Y is
a max-cut, |NY (x)| ≥ |NX (x)| ≥ βn. Since G is triangle-free, there is no edge in between
NX (x) and NY (x). Let A0 ⊆ A be a graph formed by deleting all edges between NX (x)
and NY (y) from A. Define a link graph L0 := LS∪T [A0 ] of S ∪ T on A0 . In this case, the
number of choices for (S3) is at most MIS(L0 ). Since L0 is triangle-free (Claim 3.3) and
2
|L0 | = e(A0 ) ≤ |X||Y | − |NX (x)||NY (x)| ≤ n4 − β 2 n2 , it follows from Lemma 2.4 that
0

2 /8−β 2 n2 /2

MIS(L0 ) ≤ 2|L |/2 ≤ 2n

.

Proof of Lemma 3.1. First, we show that for almost every maximal triangle-free graph G on
[n] with max-cut X ∪ Y and with G[X] = S and G[Y ] = T , there are very few vertex-disjoint
P3 ’s in S ∪ T . Suppose that there exist βn vertex-disjoint P3 ’s in S or in T , say in S. Since
LS∪T [A] = ST by Claim 3.6, and for each of the βn vertex-disjoint P3 ’s in S we obtain
|T | vertex-disjoint P3 ’s in ST , the number of vertex-disjoint P3 ’s in LS∪T [A] is at least
βn|T | = βn|Y |. By Claim 3.7(i), βn|Y | ≥ βn(n/2 − βn) ≥ βn2 /3. Then by Lemma 2.4,
MIS(LS∪T [A]) ≤ 2|ST |/2−βn

2 /75

2 /8−βn2 /75

≤ 2n

.

Since β  ε, the family of maximal triangle-free graphs with such (X, Y, S, T ) is negligible.
Hence, for almost every maximal triangle-free graph G with some (X, Y, S, T ), we can find
8

S

S S 00
β 2 n2 P3 ’s
S0

S0

J = (ST 0 ) ∪ (S 0 T )

T0

T0

T

T

(a)

(b)

Figure 2: Forbidden structures in S and T .
some induced subgraphs S 0 ⊆ S and T 0 ⊆ T with |S 0 | ≤ 3βn and |T 0 | ≤ 3βn such that both
S − S 0 and T − T 0 are P3 -free. This implies that each of S − S 0 and T − T 0 is a union of a
matching and an independent set.
Next, we show that at most one of the graphs S and T can have a large matching.
Suppose both S and T have a matching of size at least βn, then there are at least β 2 n2
vertex-disjoint C4 ’s in ST , each of which contains a copy of P3 (see Figure 2a). It follows
2
2 2
that the family of such graphs is negligible since MIS(LS∪T [A]) ≤ 2n /8−β n /25 and β  ε.
Hence, we can assume that all but 2βn vertices in T form an independent set. Redefine T 0
so that |T 0 | ≤ 2βn and V (T − T 0 ) is an independent set.
Lastly, we show that there are very few isolated vertices in the graph S − S 0 . Suppose
that there are γn/2 isolated vertices in S − S 0 , spanning a subgraph S 00 of S. We count
MIS(ST ) as follows. Let J := (ST 0 ) ∪ (S 0 T ) and L0 := ST − J. Every maximal
independent set in ST can be built by
(i) choosing an independent set in J, and
(ii) extending it to a maximal independent set in L0 .
2

Since |J| ≤ |S 0 ||T | + |T 0 ||S| ≤ 3βn · n + 2βn · n = 5βn2 , there are at most 2|J| = 25βn choices
for (i). Note that L0 consists of isolated vertices from S 00 (T − T 0 ) and an induced matching
from (S − S 0 − S 00 )(T − T 0 ) (see Figure 2b). Thus the number of extensions in (ii) is at
most MIS((S − S 0 − S 00 )(T − T 0 )). The graph (S − S 0 − S 00 )(T − T 0 ) is a perfect matching
with
1
1
1
γn 
1  n γn 2 n2 γn2
0
00
0
00
|S − S − S ||T − T | ≤ |S − S ||T | ≤
|S| −
(n − |S|) ≤
−
≤
−
2
2
2
2
2 2
4
8
16
2

2

edges, and so choosing one vertex for each matching edge gives at most 2n /8−γn /16 maximal
2
2
2
2
2
independent sets. Since β  γ, it follows that MIS(ST ) ≤ 25βn ·2n /8−γn /16 ≤ 2n /8−γn /17 .
Thus, such family of maximal triangle-free graphs is negligible, and we may assume that
|S 00 | ≤ γn/2.
9

The statement of Lemma 3.1 follows by setting X 0 := V (S 0 ∪ S 00 ) and Y 0 := V (T 0 ).
Indeed, |X 0 | ≤ 3βn + γn/2 ≤ γn, |Y 0 | ≤ 2βn ≤ γn, G[X − X 0 ] = S − S 0 − S 00 is a perfect
matching, and Y − Y 0 = V (T ) − V (T 0 ) is an independent set.

4

Proof of Theorem 1.1

For the proof of Theorem 1.1, we need to introduce several classes of graphs on the vertex
set V = [n]. Recall the hierarchy of parameters fixed in Section 3:
ε0  δ2.3 (ε)  ε  β  δ2.3 (γ 3 )  γ  1,

(3)

Definition 4.1. Fix a vertex partition V = X ∪ Y , a perfect matching M on the vertex set
X (in case |X| is odd, M is an almost perfect matching covering all but one vertex of X),
and non-negative integers r, s and t.
1. Denote by B(X, Y, M, s, t) the class of maximal triangle-free graphs G with max-cut X ∪Y
satisfying the following three conditions:
(i) The subgraph G[X] has a maximum matching M 0 ⊆ M covering all but at most γn
vertices in X;
(ii) The size of a largest family of vertex-disjoint P3 ’s in S := G[X] is s;
(iii) The size of a maximum matching in T := G[Y ] is t.
2. Denote by B(X, Y, M, r) ⊆ B(X, Y, M, 0, 0) the subclass consisting of all graphs in
B(X, Y, M, 0, 0) with exactly r isolated vertices in G[X].

3. When |X| is even, denote by G(X, Y, M ) the class of all maximal triangle-free graphs G
with max-cut X ∪ Y , G[X] = M , and Y an independent set.

4. When |X| is even, denote by H(X, Y, M ) the class of maximal triangle-free graphs G that
are constructed as follows:
(P1) Add M to X;
(P2) For every edge x1 x2 ∈ M and every vertex y ∈ Y , add either the edge x1 y or x2 y;
(P3) Extend each of the 2|X||Y |/2 resulting graphs to a maximal triangle-free graph by
adding edges in X and/or Y .
By Lemmas 3.1, 3.5 and ClaimS
3.7, throughout the rest of the proof, we may only consider
maximal triangle-free graphs in X,Y,M,s,t B(X, Y, M, s, t) that are βn2 -close to bipartite,
|X|, |Y | ≥ n/2 − βn and ∆(X), ∆(Y ) ≤ βn. We may further assume from the proof of
Lemma 3.1 that s, t ≤ βn.
Notice that graphs from G(X, Y, M ) = B(X, Y, M, 0) are precisely those with the desired structure. We will show that the number of graphs without the desired structure is
exponentially smaller. The
S set of “bad” graphs consists of the following two types:
(i) when |X| is even, Ss,t B(X, Y, M, s, t) − B(X, Y, M, 0);
(ii) when |X| is odd, s,t B(X, Y, M, s, t).
10

tn/5
|X|−r
2

sn/3

S

|X|−r
2

S

s
r

βn
t
T

T

2(|X|−r)|Y |/2

(a) The number of vertex-disjoint P3 ’s in
ST is at least sn/3 + tn/5 (Lemma 4.2).

(b) MIS(ST ) ≤
if s = t = 0
and X has r isolated vertices (Lemma 4.3).

Figure 3
Fix an arbitrary choice of (X, Y, M ). For simplicity, let B(s, t) := B(X, Y, M, s, t) and
B(r) := B(X, Y, M, r). Let A be the complete bipartite graph with parts X and Y .
Lemma 4.2. If s + t ≥ 1, then |B(s, t)| ≤ 2|X||Y |/2−n/200 .
Proof. Let s and t be two non-negative integers, at least one of which is nonzero. We first
bound the number of ways to choose S and T , i.e. the number of ways to add inner edges.
The number of ways to choose the
set of the s vertex-disjoint P3 ’s in S and the t
 nvertex

n
matching edges in T is at most 3s 2t . Since ∆(X), ∆(Y ) ≤ βn, each of the 3s + 2t chosen
vertices has inner degree at most βn. Therefore, the number of ways to choose their inner
neighbors is at most
 3s+2t
 βn !3s+2t
n
en
≤ 2β log(e/β)·(3s+2t)n .
≤
βn
βn
The number of ways to add the [X, Y ]-edges is MIS(LS∪T (A)). We claim that the link
graph L := LS∪T (A) = ST has at least (s + t)n/5 vertex-disjoint P3 ’s. Indeed, recall
that |S| = |T | ≥ n/2 − βn and s, t ≤ βn, thus in ST (see Figure 3a), we have at least
s(|T | − 2t) ≥ sn/3 vertex-disjoint P3 ’s coming from s vertex-disjoint P3 ’s in S and at least
1
(|S| − βn − 3s) · t ≥ tn/5 vertex-disjoint P3 ’s coming from the Cartesian product of a
2
matching in S and a matching in T . So by Lemma 2.4,
MIS(L) ≤ 2|X||Y |/2−(s+t)n/125 .
Since s + t ≥ 1 and β is sufficiently small,
  
n
n
|B(s, t)| ≤
· 2β log(e/β)·(3s+2t)n · 2|X||Y |/2−(s+t)n/125 ≤ 2|X||Y |/2−n/200 .
3s 2t

11

· |Y |

y1

y1
x1

x1
⇒

x2

x2
y2

y3

X10 Y10
X

Y10

y3

y2
in Y’

X0

Y

Y0

Figure 4: (X 0 , Y 0 , M 0 ) is uniquely determined after choosing x1 y1 ∈ M 0 (Lemma 4.4).
Lemma 4.3. If s = t = 0 and r ∈ Z+ , then |B(r)| ≤ 2|X||Y |/2−n/6 .
Proof. By the definition of B(r), X consists of r isolated vertices and a matching of size
(|X| − r)/2, and Y is an independent set. Hence the graph LS∪T (A) = ST consists of
a matching
of size (|X| − r)|Y |/2 and isolated vertices (see Figure 3b). There are at most

n
ways to pick the isolated vertices in X and at most MIS(LS∪T (A)) ways to choose the
r
[X, Y ]-edges. Recall that |Y | ≥ n/2 − βn. Thus we have
 
n
|B(r)| ≤
· 2(|X|−r)|Y |/2 ≤ 2|X||Y |/2+r log n−rn/5 ≤ 2|X||Y |/2−rn/6 ≤ 2|X||Y |/2−n/6 .
r

Case 1: |X| is even. For simplicity, denote G := G(X, Y, M ) and H := H(X, Y, M ).
Lemma 4.4. An n-vertex graph G is in at most n2 different classes G(X, Y, M ).
Proof. Let G ∈ G(X, Y, M ). Recall that G[X] = M and Y is an independent set. Thus
G can be in a different class G(X 0 , Y 0 , M 0 ) if and only if X 0 6= X, Y 0 6= Y and M 0 6= M .
Since M 0 6= M and Y is an independent set, there exists an edge x1 y1 in M 0 with x1 ∈ X
and y1 ∈ Y . There are at most n2 ways to choose such an edge. Since G is a maximal
triangle-free graph, every vertex in Y is adjacent to exactly one vertex from each edge in M .
Let x01 be the neighbor of x1 in X, and set Y10 := NX (y1 ) ∪ {x01 } − {x1 } and X10 = X − Y10 .
Note that x1 y1 ∈ M 0 and G[X 0 ] = M 0 imply Y10 ⊆ Y 0 . Since Y 0 is an independent set, it
follows that X10 ⊆ X 0 .
We claim that for any vertex x2 ∈ X10 , there is at most one vertex in Y that can serve as
its neighbor in M 0 (see Figure 4). Suppose to the contrary that there are two such vertices
y2 and y3 in Y . Then neither of y2 and y3 has neighbors in X10 − {x2 }, and so both y2 and y3
are adjacent to all but one (the neighbor of x2 ) vertex of Y10 ⊆ Y 0 . If now x2 y2 ∈ M 0 , then
y3 ∈ Y 0 . But y3 is adjacent to some vertices of Y 0 , which contradicts the independence of Y 0 .
In conclusion, after we pick one of the edges of M 0 with exactly one end in X and one end
in Y , since the graph G is labeled, the rest of X 0 , Y 0 and M 0 is uniquely determined.
12

By Lemma 4.4, it is sufficient to show that for any choice of (X, Y, M ) with |X| even,
S
| s,t B(X, Y, M, s, t) − B(X, Y, M, 0)|
≤ 2−n/300 .
(4)
|G(X, Y, M )|
Lemma 4.5. We have |G| ≥ (1 + o(1))2|X||Y |/2 .

2

2

Proof. Recall that |X|, |Y | ≥ n/2 − βn, and therefore |H| = 2|X||Y |/2  2n /8−βn . Running
the same proof as Lemma 3.5 (start the proof by invoking Theorem 2.1 with δ2.2 (β), replace
ε0 by β and ε by γ 3 ) implies that almost all graphs in H are 2γ 3 n2 -close to bipartite. Let
H0 ⊆ H be the subfamily consisting of all those that are 2γ 3 n2 -close to bipartite. Then it is
sufficient to show |H0 − G| = o(2|X||Y |/2 ). There are two types of graphs in H0 − G:
(i) H1 : those that X ∪ Y is not one of its max-cut;
(ii) H2 : those with X ∪ Y as a max-cut, but not maximal after (P2), i.e. there are inner
edges added in X and/or Y in (P3).
We first bound the number of graphs in H1 . Let G ∈ H1 with a max-cut X 0 ∪ Y 0
minimizing |X4X 0 |. We may assume that |X 0 |, |Y 0 | ≥ n/2 − γn and ∆(X 0 ), ∆(Y 0 ) ≤ γn.
Indeed, since graphs in H1 are 2γ 3 n2 -close to bipartite, if |X 0 | ≤ n/2 − γn or ∆(X 0 ) ≥ γn,
then the same proof as the proof of Claim 3.7 yields that the number of such graphs in H1
is at most
 2 
n
2
2 2
3 2
3
2
2 2
2
2
· 2n /8−γ n /2 ≤ 22γ n log(e/2γ ) 2n /8−γ n /2  2n /8−γn ,
3
2
2γ n
2

2

which is exponentially smaller than |H0 | = (1 + o(1))2|X||Y |/2  2n /8−βn .
Let X1 := X ∩ X 0 , X2 := X − X1 , Y1 := Y ∩ X 0 , and Y2 := Y − Y1 (see Figure 5a).
Since X ∪ Y is not a max-cut of G, the set X4X 0 = Y 4Y 0 = X2 ∪ Y1 is non-empty. By
symmetry, we can assume that Y1 6= ∅. Recall that from (P2), for every y ∈ Y1 ⊆ X 0 ,
we have dX (y) = |X|/2 ≥ n/4 − βn/2. It follows that |X2 | ≥ n/4 − 2γn, since otherwise
dX 0 (y) ≥ dX1 (y) = dX (y) − |X2 | ≥ 3γn/2, contradicting ∆(X 0 ) ≤ γn. Similarly, we have
|X1 | ≥ n/4 − 2γn. Recall also that |X| = n − |Y | ≤ n/2 + βn. Thus for i = 1, 2,
n
 n
n
− 2γn ≤ + 3γn.
|Xi | = |X| − |X3−i | ≤ + βn −
2
4
4
Therefore, for i = 1, 2, every vertex y ∈ Yi is adjacent to at most γn vertices in Xi and all
but at most


n
n βn
−
+ γn ≤ 5γn
|X3−i | − (dX (y) − dXi (y)) ≤ + 3γn −
4
4
2
vertices in X3−i , as shown in Figure 5a. Hence,
 |Xfor
 fixed X1 and X2 , the number of ways
1|
2|
. Since the number of graphs in H1 is
to choose N (y) for any y ∈ Y is at most |X
5γn
5γn
precisely the number of ways to add the [X, Y ]-edges in (P2), we have


|Y |
|X1 | |X2 |
1/2 2
|X|
|Y |
|H1 | ≤ 2 · 2 ·
≤ 2γ n ,
5γn
5γn
13

γn

y Y1

X1

X2

Y2

5γn

x1

X0

cannot
add uv

Y0

x2

u

u

v
u0

cannot
add uv

y

v
v0

X

X

Y

(a) The structure of graphs in H1 with
max-cut X 0 ∪ Y 0 .

Y

(b) Two examples of uv that cannot be
added when forming a graph from H2 .

Figure 5
where the first two terms count the number of ways to partition X = X1 ∪X2 and Y = Y1 ∪Y2 ,
and the last term bounds the number of ways to choose the [X, Y ]-edges.
We now bound the number of graphs in H2 . For any graph G ∈ H2 , some inner edges
were added in (P3). Suppose that [X, Y ]-edges added in (P2) were chosen randomly (each
of x1 y and x2 y with probability 1/2). Clearly, uv can be added in (P3) if and only if u
and v have no common neighbor. Consider the case when u, v ∈ X and let uu0 , vv 0 be the
corresponding edges in M (see Figure 5b). Every y ∈ Y is adjacent to exactly one of u, u0
and exactly one of v, v 0 . Thus the probability that y is a common neighbor of u and v is
1/4, which implies that uv can be added with probability (3/4)|Y | . Let now u, v ∈ Y . Then
u and v have no common neighbor if and only if for every x1 x2 ∈ M , u and v chose different
neighbors among x1 and x2 . So in this case we can add u, v with probability (1/2)|X|/2 .
Summing over all possible outcomes of (P2) and all possible choices for uv implies
 
 |X|/2  |Y | !
3
n
1
+
 2|X||Y |/2−n/5 .
|H2 | ≤ 2|X||Y |/2 ·
·
2
4
2
Hence, we have
|H0 − G| = |H1 | + |H2 | ≤ 2γ

1/2 n2

+ 2|X||Y |/2−n/5 = o(2|X||Y |/2 ).

Since s, t, r ≤ n, Lemmas 4.2, 4.3 and 4.5 imply (4):


[



 B(s, t) − B(0)


s,t

|G|

X
=

s,t: s+t≥1

|B(s, t)| +

X
r≥1

|B(r)|

|G|
14

≤

(n2 + n) · 2|X||Y |/2−n/200
≤ 2−n/300 .
(1 + o(1))2|X||Y |/2

Case 2: |X| is odd.

Fix an arbitrary choice of X, Y, M with |X| odd and let x ∈ X be the vertex not covered
by M . By Lemmas 4.2 and 4.3,



[
X
X


|B(X, Y, M, s, t)| +
|B(X, Y, M, r)| ≤ 2|X||Y |/2−n/300 .
 B(X, Y, M, s, t) ≤


s,t

s,t: s+t≥1

r≥1

Pick an arbitrary vertex y ∈ Y , define X0 = X ∪ {y}, Y0 = Y − {y} and M0 = M ∪ {xy}.
Then by Lemma 4.5, we have
|G(X0 , Y0 , M0 )| ≥ (1 + o(1))2|X0 ||Y0 |/2 ≥ 2|X||Y |/2−(|X|−|Y |)/2−1 ≥ 2|X||Y |/2−2βn ,
since |X| − |Y | ≤ 2βn. Notice that any (X0 , Y0 , M0 ) with |X0 | even can be obtained from at
most n different triples S
(X, Y, M ) with |X| odd in this way. Together with Lemma 4.4, it is
sufficient to show that s,t B(X, Y, M, s, t) is negligible compared to G(X0 , Y0 , M0 ):

S


 s,t B(X, Y, M, s, t)
|G(X0 , Y0 , M0 )|

≤

2|X||Y |/2−n/300
≤ 2−n/400 .
2|X||Y |/2−2βn

This completes the proof of Theorem 1.1.

References
[1] N. Alon, J. Balogh, R. Morris and W. Samotij, Counting sum-free sets in Abelian
groups, Israel Journal of Mathematics, to appear.
[2] J. Balogh, B. Bollobás and M. Simonovits, The typical structure of graphs without given
excluded subgraphs, Random Structures & Algorithms, 34, 305–318, 2009.
[3] J. Balogh, N. Bushaw, M. Collares Neto, H. Liu, R. Morris and M. Sharifzadeh, The
typical structure of graphs with no large cliques, submitted.
[4] J. Balogh, and J. Butterfield, Excluding induced subgraphs: critical graphs, Random
Structures & Algorithms, 38, 100–120, 2011.
[5] J. Balogh, R. Morris, and W. Samotij, Independent sets in hypergraphs, to appear in
J. Amer. Math. Soc.
[6] J. Balogh, S. Das, M. Delcourt, H. Liu, and M. Sharifzadeh, Intersecting families of
discrete structures are typically trivial, to appear in J. Combin. Theory Ser. A.
[7] J. Balogh, H. Liu, M. Sharifzadeh and A. Treglown, The number of maximal sum-free
subsets of integers, to appear in Proc. Amer. Math. Soc.
15

[8] J. Balogh, H. Liu, M. Sharifzadeh and A. Treglown, Sharp bound on the number of
maximal sum-free subsets of integers, in preparation.
[9] J. Balogh, R. Morris, W. Samotij, and L. Warnke, The typical structure of sparse
Kr+1 -free graphs, to appear in Trans. Amer. Math. Soc.
[10] J. Balogh, and D. Mubayi, Almost all triple systems with independent neighborhoods
are semi-bipartite, J. Combin. Theory Ser. A, 118, 1494–1518, 2011.
[11] J. Balogh and Š. Petřı́čková, Number of maximal triangle-free graphs, Bull. London
Math. Soc. (2014) 46 (5): 1003–1006.
[12] P. Erdős, P. Frankl, and V. Rödl, The asymptotic number of graphs not containing a fixed
subgraph and a problem for hypergraphs having no exponent, Graphs and Combinatorics
2 (1986), 113–121.
[13] P. Erdős, D. J. Kleitman and B. L. Rothschild, Asymptotic enumeration of Kn -free
graphs, Colloquio Internazionale sulle Teorie Combinatorie, Tomo II, Atti dei Convegni
Lincei, No. 17, 19–27, Accad. Naz. Lincei, Rome, 1976.
[14] P. Erdős and M. Simonovits, A limit theorem in graph theory, Studia Sci. Math.
Hungar., 1 (1966), 51–57.
[15] Z. Füredi, The number of maximal independent sets in connected graphs, Journal of
Graph Theory, Vol. 11, No. 4, 463–470, 1987.
[16] B. Green, A Szemerédi-type regularity lemma in abelian groups, with applications,
Geom. Funct. Anal., 15, (2005), 340–376.
[17] B. Green and I. Ruzsa, Counting sumsets and sum-free sets modulo a prime, Studia
Sci. Math. Hungarica, 41, (2004), 285–293.
[18] M. Hujter and Z. Tuza, The Number of Maximal Independent Sets in Triangle-Free
Graphs, SIAM J. Discrete Math., 6(2), 284–288, 1993.
[19] P. G. Kolaitis, H. J. Prömel and B. L. Rothschild, K`+1 -free graphs: asymptotic structure
and a 0-1 law, Trans. Amer. Math. Soc., 303, 637–671, 1987.
[20] J. W. Moon and L. Moser, On cliques in graphs, Israel J. Math., 3, (1965), 23–28.
[21] D. Osthus, H. J. Prömel and A. Taraz, For which densities are random triangle-free
graphs almost surely bipartite?, Combinatorica, 23, 105–150, 2003.
[22] Y. Person and M. Schacht, Almost all hypergraphs without Fano planes are bipartite,
Proceedings of the Twentieth Annual ACM-SIAM Symposium on Discrete Algorithms,
217–226, 2009.

16

[23] H. J. Prömel and A. Steger, The asymptotic number of graphs not containing a fixed
color-critical subgraph, Combinatorica, 12, 463–473, 1992.
[24] I. Z. Ruzsa and E. Szemerédi, Triple systems with no six points carrying three triangles,
in Combinatorics (Keszthely, 1976), Coll. Math. Soc. J. Bolyai 18, Volume II, 939–945.
[25] D. Saxton and A. Thomason, Hypergraph containers, arXiv:1204.6595.
[26] M. Simonovits, Paul Erdős’ influence on extremal graph theory, The Mathematics of
Paul Erdős, II, 148-192, Springer-Verlag, Berlin, 1996.

17

